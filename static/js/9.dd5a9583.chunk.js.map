{"version":3,"sources":["../node_modules/epubjs/lib/utils/core.js","../node_modules/epubjs/lib/epubcfi.js","../node_modules/epubjs/lib/utils/constants.js","../node_modules/epubjs/lib/utils/path.js","../node_modules/epubjs/lib/utils/url.js","../node_modules/epubjs/lib/utils/replacements.js","../node_modules/epubjs/lib/utils/request.js","../node_modules/epubjs/lib/contents.js","../node_modules/epubjs/lib/utils/hook.js","../node_modules/epubjs/lib/utils/queue.js","../node_modules/epubjs/lib/utils/mime.js","../node_modules/epubjs/lib/rendition.js","../node_modules/epubjs/lib/managers/default/index.js","../node_modules/react-transition-group/Transition.js","../node_modules/react-lifecycles-compat/react-lifecycles-compat.es.js","../node_modules/react-transition-group/utils/PropTypes.js","../node_modules/react-transition-group/TransitionGroup.js","../node_modules/react-reader/lib/index.js","../node_modules/epubjs/lib/book.js","../node_modules/epubjs/lib/layout.js","../node_modules/epubjs/lib/mapping.js","../node_modules/epubjs/lib/managers/views/iframe.js","../node_modules/epubjs/lib/managers/continuous/index.js","../node_modules/react-reader/lib/EpubView/style.js","../node_modules/react-reader/lib/ReactReader/style.js","components/step/transitions.js","../node_modules/react-transition-group/index.js","../node_modules/react-transition-group/CSSTransition.js","../node_modules/dom-helpers/class/addClass.js","../node_modules/@babel/runtime/helpers/interopRequireDefault.js","../node_modules/dom-helpers/class/hasClass.js","../node_modules/dom-helpers/class/removeClass.js","../node_modules/react-transition-group/ReplaceTransition.js","../node_modules/react-transition-group/utils/ChildMapping.js","../node_modules/react-reader/lib/EpubView/EpubView.js","../node_modules/epubjs/lib/index.js","../node_modules/epubjs/lib/spine.js","../node_modules/epubjs/lib/section.js","../node_modules/epubjs/lib/locations.js","../node_modules/epubjs/lib/container.js","../node_modules/epubjs/lib/packaging.js","../node_modules/epubjs/lib/navigation.js","../node_modules/epubjs/lib/resources.js","../node_modules/epubjs/lib/pagelist.js","../node_modules/epubjs/lib/themes.js","../node_modules/epubjs/lib/annotations.js","../node_modules/epubjs/lib/utils/scrolltype.js","../node_modules/epubjs/lib/managers/helpers/stage.js","../node_modules/epubjs/lib/managers/helpers/views.js","../node_modules/epubjs/lib/managers/helpers/snap.js","../node_modules/epubjs/lib/archive.js","../node_modules/epubjs/lib/store.js","../node_modules/epubjs/lib/displayoptions.js","../node_modules/epubjs/lib/epub.js","../node_modules/react-reader/lib/ReactReader/ReactReader.js","../../src/types.ts","../../src/index.ts"],"names":["Object","defineProperty","exports","value","RangeObject","blob2base64","blob","Promise","resolve","reject","reader","FileReader","readAsDataURL","onloadend","result","borders","el","style","window","getComputedStyle","width","height","forEach","prop","parseFloat","bounds","createBase64Url","content","mime","data","btoa","encodeURIComponent","createBlob","createBlobUrl","_URL","createObjectURL","defaults","obj","i","length","arguments","source","defer","this","id","uuid","promise","freeze","documentHeight","Math","max","document","documentElement","clientHeight","body","scrollHeight","offsetHeight","extend","target","sources","slice","call","getOwnPropertyNames","propName","getOwnPropertyDescriptor","filterChildren","nodeName","single","childNodes","node","nodeType","toLowerCase","push","findChildren","getParentByTagName","tagname","parent","parentNode","tagName","indexOfElementNode","elementNode","indexOfNode","indexOfSorted","item","array","compareFunction","_start","_end","compared","start","end","pivot","parseInt","a","b","indexOfTextNode","textNode","insert","location","locationOf","splice","isElement","isFloat","n","f","isNumber","indexOf","floor","isXml","ext","nodeBounds","elPos","doc","ownerDocument","Node","TEXT_NODE","elRange","createRange","selectNodeContents","getBoundingClientRect","parents","parse","markup","forceXMLDom","Parser","DOMParser","_xmldom","charCodeAt","parseFromString","prefixed","unprefixed","prefixes","lower","qs","sel","elements","Error","querySelector","getElementsByTagName","qsa","qsp","props","q","filtered","Array","prototype","filter","getAttribute","querySelectorByType","html","element","type","query","getAttributeNS","requestAnimationFrame","revokeBlobUrl","url","revokeObjectURL","sprint","root","func","createTreeWalker","treeWalker","NodeFilter","SHOW_TEXT","walk","toString","windowBounds","innerWidth","innerHeight","top","left","right","bottom","require","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","URL","webkitURL","mozURL","undefined","d","Date","getTime","replace","c","r","random","isNaN","isFinite","typeId","sib","children","index","Blob","querySelectorAll","nextNode","callback","firstChild","nextSibling","nodes","unshift","constructor","collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset","setStart","startNode","_commonAncestorContainer","collapse","_checkCollapsed","setEnd","endNode","toStart","selectNode","referenceNode","endIndex","textContent","startParents","endParents","default","_core","EpubCFI","cfiFrom","base","ignoreClass","str","spinePos","range","path","parseComponent","steps","checkType","fromRange","fromNode","TypeError","cfi","isCfiString","cfiStr","baseComponent","pathComponent","getChapterComponent","getPathComponent","getRange","componentStr","terminal","component","offset","assertion","parts","split","parseTerminal","shift","map","step","parseStep","bind","stepStr","num","has_brackets","match","termialStr","characterOffset","textLocationAssertion","indirection","ranges","getCharecterOffsetComponent","joinSteps","part","segment","join","segmentString","cfiString","compare","cfiOne","cfiTwo","stepsA","stepsB","terminalA","terminalB","concat","position","filteredStep","filteredNode","filteredPosition","pathTo","currentNode","equalStep","stepA","stepB","needsIgnoring","patchOffset","len","anchor","sibling","previousSibling","isText","classList","contains","curr","totalOffset","normalizedMap","currNodeType","prevNodeType","output","prevIndex","textNodes","stepsToXpath","xpath","stepsToQuerySelector","container","walkToNode","_doc","getElementById","findNode","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","fixMiss","child","lastStepIndex","childIndex","hasOwnProperty","toRange","startSteps","endSteps","missed","console","log","e","generateChapterComponent","_spineNodeIndex","_pos","_default","EVENTS","EPUBJS_VERSION","DOM_EVENTS","BOOK","OPEN_FAILED","CONTENTS","EXPAND","RESIZE","SELECTED","SELECTED_RANGE","LINK_CLICKED","LOCATIONS","CHANGED","MANAGERS","RESIZED","ORIENTATION_CHANGE","ADDED","SCROLL","SCROLLED","REMOVED","VIEWS","AXIS","WRITING_MODE","LOAD_ERROR","RENDERED","DISPLAYED","SHOWN","HIDDEN","MARK_CLICKED","RENDITION","STARTED","ATTACHED","DISPLAY_ERROR","LOCATION_CHANGED","RELOCATED","LAYOUT","UPDATED","ANNOTATION","ATTACH","DETACH","_pathWebpack","__esModule","pathString","parsed","pathname","isDirectory","directory","dir","filename","extension","what","isAbsolute","charAt","relative","splitPath","splitPathRe","exec","_path","_interopRequireDefault","urlString","baseString","absolute","Url","href","protocol","origin","hash","search","Path","fullpath","replaceBase","section","head","createElement","insertBefore","setAttribute","replaceCanonical","link","canonical","appendChild","replaceLinks","contents","fn","links","replaceLink","linkUrl","_url","error","onclick","replaceMeta","meta","idref","substitute","urls","replacements","RegExp","withCredentials","headers","header","supportsURL","BLOB_RESPONSE","deferred","xhr","XMLHttpRequest","xhrPrototype","onreadystatechange","readyState","DONE","responseXML","responseType","status","response","message","stack","JSON","onerror","open","setRequestHeader","overrideMimeType","send","_eventEmitter","_epubcfi","_mapping","_replacements","_constants","hasNavigator","navigator","isChrome","test","userAgent","isWebkit","Contents","cfiBase","sectionIndex","epubcfi","defaultView","_size","epubReadingSystem","called","active","listeners","w","frame","h","contentWidth","contentHeight","textWidth","rect","border","round","textHeight","scrollWidth","overflow","overflowX","overflowY","css","property","priority","setProperty","removeProperty","viewport","options","settings","$viewport","newContent","hasAttribute","_width","_height","_scale","_minimum","_maximum","_scalable","scale","minimum","maximum","scalable","scrollTo","expand","emit","imageLoadListeners","mediaQueryListeners","addEventListeners","addSelectionListeners","ResizeObserver","resizeListeners","visibilityListeners","resizeObservers","linksHandler","removeListeners","removeEventListeners","removeSelectionListeners","observer","disconnect","clearTimeout","expanding","resizeCheck","onResize","setTimeout","addEventListener","visibilityState","transitionListeners","_resizeCheck","sheets","styleSheets","mediaChangeHandler","m","matches","_expanding","rules","cssRules","j","media","matchMedia","mediaText","addListener","observe","mutationObservers","MutationObserver","mutations","attributes","childList","characterData","subtree","img","images","naturalWidth","onload","fontLoadListeners","fonts","ready","then","targetPos","pos","ELEMENT_NODE","newRange","Range","substring","addStylesheet","src","$stylesheet","rel","_getStylesheetNode","key","styleEl","addStylesheetCss","serializedCss","innerHTML","addStylesheetRules","styleSheet","sheet","rl","rule","selector","propStr","pl","insertRule","keys","definition","isArray","addScript","$script","async","addClass","className","add","removeClass","remove","_triggerEvent","triggerEvent","eventName","passive","removeEventListener","_onSelectionChange","onSelectionChange","selectionEndTimeout","selection","getSelection","triggerSelectedEvent","cfirange","rangeCount","getRangeAt","_cfi","cfiFromRange","cfiFromNode","layout","size","layoutStyle","columns","columnWidth","gap","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","axis","writingMode","direction","scaler","offsetX","offsetY","scaleStr","translateStr","fit","viewportWidth","viewportHeight","widthScale","heightScale","properties","includes","marginLeft","mapPage","dev","page","mode","_layoutStyle","name","version","hasFeature","feature","destroy","context","hooks","register","deregister","hook","trigger","args","promises","task","executing","apply","err","all","list","clear","Task","toApply","_q","tick","running","paused","enqueue","queued","run","dequeue","inwait","dump","defered","flush","pause","stop","table","mimeTypes","subtype","val","lookup","pop","_hook","_queue","_layout","_themes","_annotations","_iframe","_index","_index2","Rendition","book","manager","view","flow","spread","minSpreadWidth","stylesheet","resizeOnOrientationChange","script","snap","defaultDirection","allowScriptedContent","display","serialize","unloaded","render","show","handleLinks","passEvents","adjustImages","spine","injectIdentifier","injectStylesheet","injectScript","themes","annotations","opened","starting","started","setManager","requireManager","requireView","package","metadata","displayOptions","fixedLayout","ViewManager","View","queue","request","load","globalLayoutProperties","determineLayoutProperties","on","afterDisplayed","afterRemoved","onResized","onOrientationChange","reportLocation","attachTo","displaying","_display","displayed","locations","cfiFromPercentage","get","cfiRange","triggerMarkEvent","orientation","moveTo","resize","next","prev","_flow","applyLayout","updateFlow","isRendered","changed","min","updateLayout","currentLocation","located","percentage","mapping","pages","total","totalPages","locationStart","locationFromCfi","locationEnd","percentageFromLocation","pageStart","pageList","pageFromCfi","pageEnd","last","atEnd","first","atStart","ev","triggerViewEvent","found","visible","computed","paddingTop","paddingBottom","horizontalPadding","paddingLeft","paddingRight","getContents","views","ident","packaging","identifier","_scrolltype","_stage","_views","DefaultViewManager","optsSettings","renditionQueue","infinite","hidden","fullsize","viewSettings","method","forceEvenPages","rendered","tag","rtlScrollType","stage","getContainer","_bounds","_stageSize","scroller","_onScroll","onScroll","orientationTimeout","resizeTimeout","afterScrolled","stageSize","winBounds","createView","forceRight","handleNextPrePaginated","action","divisor","find","afterResized","distX","distY","isPaginated","delta","append","onDisplayed","updateAxis","updateWritingMode","prepend","counter","scrollBy","heightDelta","widthDelta","scrollLeft","scrollTop","offsetWidth","current","hide","paginatedLocation","scrolledLocation","pageHeight","pageWidth","vertical","scrollY","scrollX","startPos","endPos","stopPos","count","currPage","ceil","endPage","tempStartPage","pg","used","abs","startPage","isVisible","offsetPrev","offsetNext","_container","viewsLength","x","y","silent","ignore","scrolled","calculate","setLayout","forceUpdate","defaultScrolledOverflow","viewContents","EXITING","ENTERED","ENTERING","EXITED","UNMOUNTED","PropTypes","newObj","desc","set","_interopRequireWildcard","_react","_reactDom","_reactLifecyclesCompat","Transition","_React$Component","subClass","superClass","_this","initialStatus","parentGroup","transitionGroup","appear","isMounting","enter","appearStatus","in","unmountOnExit","mountOnEnter","state","nextCallback","create","__proto__","_proto","getChildContext","getDerivedStateFromProps","_ref","prevState","componentDidMount","updateStatus","componentDidUpdate","prevProps","nextStatus","componentWillUnmount","cancelNextCallback","getTimeouts","exit","timeout","mounting","findDOMNode","performEnter","performExit","setState","_this2","appearing","timeouts","enterTimeout","onEnter","safeSetState","onEntering","onTransitionEnd","onEntered","_this3","onExit","onExiting","onExited","cancel","nextState","setNextCallback","_this4","event","handler","doesNotHaveTimeoutOrListener","addEndListener","_this$props","childProps","excluded","sourceKeys","_objectWithoutPropertiesLoose","Children","only","cloneElement","Component","noop","contextTypes","object","childContextTypes","propTypes","defaultProps","polyfill","componentWillMount","componentWillReceiveProps","nextProps","componentWillUpdate","__reactInternalSnapshotFlag","__reactInternalSnapshot","getSnapshotBeforeUpdate","isReactComponent","foundWillMountName","foundWillReceivePropsName","foundWillUpdateName","UNSAFE_componentWillMount","UNSAFE_componentWillReceiveProps","UNSAFE_componentWillUpdate","componentName","displayName","newApiName","maybeSnapshot","snapshot","__suppressDeprecationWarning","classNamesShape","timeoutsShape","_propTypes","_ChildMapping","_extends","assign","_assertThisInitialized","self","ReferenceError","values","k","TransitionGroup","handleExited","firstRender","appeared","mounted","prevChildMapping","getInitialChildMapping","getNextChildMapping","currentChildMapping","getChildMapping","childFactory","isRequired","module","enumerable","_EpubView","_style","_ReactReader","_style2","_spine","_locations","_packaging","_navigation","_resources","_pagelist","_rendition","_archive","_request2","_store","_displayoptions","CONTAINER_PATH","INPUT_TYPE","Book","ArrayBuffer","requestMethod","requestCredentials","requestHeaders","encoding","openAs","store","opening","isOpen","loading","manifest","cover","navigation","resources","loaded","archived","archive","storage","rendition","catch","input","determineType","openEpub","openPackaging","openManifest","openContainer","unarchive","packagePath","xml","unpack","json","resolved","resolver","loadNavigation","coverPath","navPath","ncxPath","toc","renderTo","setRequestCredentials","credentials","setRequestHeaders","replacementsSetting","originalUrl","requester","substituteResources","replaceCss","coverUrl","createUrl","_request","Layout","_spread","_minSpreadWidth","_evenSpreads","evenSpreads","spreadWidth","update","_gap","format","totalLength","pageLength","spreads","newProps","horizontal","_dev","findRanges","rangeListToCfiList","rangePairToCfiPair","findStart","findEnd","startRange","endRange","removeAllRanges","addRange","trim","FILTER_ACCEPT","FILTER_REJECT","safeFilter","acceptNode","$el","$prev","findTextStartRange","findTextEndRange","splitTextNodeIntoRanges","_splitter","text","splitter","rangePair","cifPair","_contents","_marksPane","IframeView","added","fixedWidth","fixedHeight","pane","highlights","underlines","marks","flex","iframe","createContainer","scrolling","seamless","sandbox","resizing","visibility","elementBounds","supportsSrcdoc","sectionRender","setAxis","setWritingMode","addListeners","reset","_textWidth","_contentWidth","_textHeight","_contentHeight","_needsReframe","lock","iframeBorders","elBorders","lockedWidth","lockedHeight","force","reframe","prevBounds","mark","placeMark","onLoad","blobUrl","srcdoc","contentDocument","MSApp","execUnsafeLocalFunction","outerThis","write","close","contentWindow","rendering","layoutFunc","transform","stopExpanding","offsetTop","offsetLeft","highlight","cb","styles","emitter","Pane","Highlight","addMark","underline","Underline","dataset","rects","getClientRects","unhighlight","removeMark","l","ununderline","unmark","removeChild","_default2","_snap","_debounce","ContinuousViewManager","super","offsetDelta","afterScrolledTimeout","fill","_full","full","check","removeShownListeners","expanded","_offset","updating","trimTimeout","_offsetLeft","_offsetTop","checking","newViews","visibleLength","contentLength","rtl","firstIndex","lastIndex","above","below","erase","prevTop","prevLeft","addScrollListeners","snapper","scrollDeltaVert","scrollDeltaHorz","_scrolled","didScroll","prevScrollTop","prevScrollLeft","scrollTimeout","supportsTouch","needsSnap","viewHolder","readerArea","zIndex","backgroundColor","transition","containerExpanded","titleArea","textAlign","color","swipeWrapper","arrow","outline","background","marginTop","fontSize","padding","fontFamily","cursor","userSelect","appearance","fontWeight","arrowHover","tocBackground","tocArea","WebkitOverflowScrolling","tocAreaButton","borderBottom","boxSizing","tocButton","borderRadius","tocButtonExpanded","tocButtonBar","margin","tocButtonBarTop","tocButtonBottom","loadingView","margintop","transitions","entering","entered","exiting","exited","rotate","skew","_CSSTransition","_ReplaceTransition","_TransitionGroup","_Transition","ReplaceTransition","CSSTransition","_addClass","_removeClass","classes","_len","_key","getClassNames","removeClasses","activeClassName","reflowAndAddClass","appearClassName","doneClassName","enterClassName","classNames","isStringClassNames","_this$getClassNames6","_hasClass","baseVal","replaceClassName","origClass","classToRemove","_args","handleEnter","_len2","_key2","handleLifecycle","handleEntering","_len3","_key3","handleEntered","_len4","_key4","handleExit","_len5","_key5","handleExiting","_len6","_key6","_len7","_key7","idx","originalArgs","_child$props","toArray","inProp","_React$Children$toArr","second","mergeChildMappings","getProp","nextChildMapping","isValidElement","hasPrev","hasNext","prevChild","isLeaving","mapFn","mapper","getValueForKey","nextKeysPending","pendingKeys","prevKey","childMapping","nextKey","pendingNextKey","_typeof","Symbol","iterator","nodeInterop","cache","_getRequireWildcardCache","has","hasPropertyDescriptor","WeakMap","cacheBabelInterop","cacheNodeInterop","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","_defineProperties","descriptor","configurable","writable","_setPrototypeOf","o","p","setPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","_isNativeReflectConstruct","Super","_getPrototypeOf","NewTarget","_possibleConstructorReturn","getPrototypeOf","_defineProperty","EpubView","_Component","_inherits","Constructor","protoProps","staticProps","_super","instance","_classCallCheck","loc","locationChanged","newLocation","nextPage","prevPage","isLoaded","viewerRef","createRef","initBook","handleKeyPress","_this$props2","tocChanged","epubInitOptions","_ref2","initReader","_this$props3","epubOptions","getRendition","getOwnPropertyDescriptors","defineProperties","_objectSpread","contained","registerEvents","_this$props4","handleTextSelected","onLocationChange","ref","_this$props5","renderBook","oneOfType","string","instanceOf","number","_book","_section","spineItems","spineByHref","spineById","items","spineNodeIndex","baseUrl","_package","basePath","spineItem","manifestItem","linear","nextIndex","encodeURI","decodeURI","each","isIE","serializer","XMLSerializer","serializeToString","_query","excerpt","limit","maxSeqEle","nodeList","reduce","acc","startNodeIndex","endNodeIndex","beforeEndLengthCount","excerptLimit","reconcileLayoutSettings","globalLayout","_range","cfiFromElement","unload","Locations","_locationsWords","break","_current","_wordCounter","_currentCfi","processingTimeout","generate","chars","process","completed","_break","dist","generateFromWords","startCfi","wordCount","processWords","parseWords","remainingCount","countWords","s","foundStartNode","percentageFromCfi","cfiFromLocation","warn","save","stringify","getCurrent","setCurrent","containerDocument","rootfile","dirname","xmlEncoding","packageDocument","metadataNode","manifestNode","spineNode","parseManifest","findNavPath","findNcxPath","findCoverPath","parseSpine","uniqueIdentifier","findUniqueIdentifier","parseMetadata","title","getElementText","creator","description","pubdate","publisher","language","rights","modified_date","getPropertyText","media_active_class","manifestXml","selected","overlay","spineXml","propArray","itemref","packageXml","uniqueIdentifierId","localName","namespaceURI","nodeValue","tocId","metaCover","coverId","getElementsByTagNameNS","readingOrder","label","tocByHref","tocById","landmarks","landmarksByType","ncx","parseNav","parseLandmarks","parseNcx","subitems","getByIndex","navItems","landmark","navHtml","navElement","navList","parseNavList","navListHtml","navItem","nested","landmarkItem","tocXml","navPoints","ncxItem","navLabel","_mime","replacementUrls","assets","cssUrls","splitUrls","parsedUrl","mimeType","replaced","replacement","createCssFile","replacementUrl","indexInUrls","textResponse","getText","relUrls","assetHref","relativeTo","firstPage","lastPage","navXml","pageTargets","pageText","packageUrl","cfiFromPage","pageFromPercentage","percent","percentageFromPage","_overrides","_injected","inject","overrides","registerThemes","registerUrl","registerRules","theme","registerCss","select","serialized","injected","override","removeOverride","font","Annotation","attach","detach","_annotationsBySectionIndex","annotation","_removeFromAnnotationBySectionIndex","_annotationsAt","createDefiner","definer","innerDiv","spanA","spanB","Element","scrollIntoView","_throttle","_options","wrapper","wrap","wordSpacing","lineHeight","verticalAlign","flexDirection","flexWrap","getElement","_element","resizeFunc","orientationChangeFunc","clientWidth","containerStyles","containerPadding","_windowBounds","bodyStyles","bodyPadding","box","getSheet","createTextNode","addStyleRules","rulesArray","scope","PI_D2","PI","EASING_EQUATIONS","easeOutSine","sin","easeInOutSine","cos","easeInOutQuint","pow","easeInCubic","Snap","duration","minVelocity","minDistance","easing","setup","disableScroll","isVertical","touchCanceler","resizeCanceler","snapping","startTouchX","startTouchY","startTime","endTouchX","endTouchY","endTime","DocumentTouch","enableScroll","_onResize","_onTouchStart","onTouchStart","_onTouchMove","onTouchMove","_onTouchEnd","onTouchEnd","_afterDisplayed","off","screenX","screenY","touches","now","deltaY","swipped","wasSwiped","snapWidth","distance","velocity","howMany","snapTo","smoothScrollTo","destination","time","scroll","performance","_jszip","zip","urlCache","checkRequirements","isBase64","loadAsync","openUrl","zipUrl","getBlob","handleResponse","decodededUrl","decodeURIComponent","substr","entry","file","uint8array","getBase64","tempUrl","useBase64","base64","revokeUrl","fromCache","_localforage","Store","online","createInstance","_status","onLine","mapped","encodedUrl","getItem","setItem","put","retrieve","readAsText","displayOptionsDocument","interactive","openToSpread","orientationLock","displayOptionsNode","utils","ePub","VERSION","global","CFI","_reactSwipeable","_","_excluded","_excluded2","_createClass","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","Swipeable","handlers","useSwipeable","TocItem","_PureComponent","setLocation","onClick","PureComponent","ReactReader","_PureComponent2","_super2","expandedToc","readerRef","_this$state","toggleToc","showToc","swipeable","epubViewStyles","_this$state2","renderTocToggle","onSwipedRight","onSwipedLeft","trackMouse","onTocChange","renderToc","bool","LEFT","RIGHT","UP","DOWN","preventDefaultTouchmoveEvent","rotationAngle","trackTouch","initialState","initial","swiping","xy","mouseMove","mouseUp","touchEnd","touchMove","touchStart","absX","deltaX","angle","angleInRadians","onStart","rotateXYByAngle","clientX","clientY","onMove","absY","vxvy","getDirection","eventData","cancelablePageSwipe","onEnd","onSwipedDir","cleanUpMouse","onUp","attachTouch","cleanup","tls","addState","handlerProps","transientState","React","transientProps","getHandlers","stateSetter","updateTransientState"],"mappings":"6IAEAA,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQE,iBAAc,EACtBF,EAAQG,YAqsBR,SAAqBC,GACnB,OAAO,IAAIC,SAAQ,SAAUC,EAASC,GACpC,IAAIC,EAAS,IAAIC,WACjBD,EAAOE,cAAcN,GAErBI,EAAOG,UAAY,WACjBL,EAAQE,EAAOI,aA1sBrBZ,EAAQa,QA8UR,SAAiBC,GACf,IAAIC,EAAQC,OAAOC,iBAAiBH,GAGhCI,EAAQ,EACRC,EAAS,EAOb,MAViB,CAAC,eAAgB,cAAe,cAAe,aAAc,mBAAoB,mBAIvFC,SAAQ,SAAUC,GAC3BH,GAASI,WAAWP,EAAMM,KAAU,KAJpB,CAAC,aAAc,gBAAiB,YAAa,eAAgB,iBAAkB,qBAMrFD,SAAQ,SAAUC,GAC5BF,GAAUG,WAAWP,EAAMM,KAAU,KAEhC,CACLF,OAAQA,EACRD,MAAOA,IA3VXlB,EAAQuB,OAmTR,SAAgBT,GACd,IAAIC,EAAQC,OAAOC,iBAAiBH,GAGhCI,EAAQ,EACRC,EAAS,EAOb,MAViB,CAAC,QAAS,eAAgB,cAAe,cAAe,aAAc,mBAAoB,mBAIhGC,SAAQ,SAAUC,GAC3BH,GAASI,WAAWP,EAAMM,KAAU,KAJpB,CAAC,SAAU,aAAc,gBAAiB,YAAa,eAAgB,iBAAkB,qBAM/FD,SAAQ,SAAUC,GAC5BF,GAAUG,WAAWP,EAAMM,KAAU,KAEhC,CACLF,OAAQA,EACRD,MAAOA,IAhUXlB,EAAQwB,gBAmfR,SAAyBC,EAASC,GAChC,IAAIC,EAGJ,GAAuB,kBAAZF,EAET,OAKF,OAFAE,EAAOC,KAAKC,mBAAmBJ,IACrB,QAAUC,EAAO,WAAaC,GA5f1C3B,EAAQ8B,WAAaA,EACrB9B,EAAQ+B,cAwdR,SAAuBN,EAASC,GAC9B,IACItB,EAAO0B,EAAWL,EAASC,GAE/B,OADUM,EAAKC,gBAAgB7B,IA1djCJ,EAAQkC,SA4JR,SAAkBC,GAChB,IAAK,IAAIC,EAAI,EAAGC,EAASC,UAAUD,OAAQD,EAAIC,EAAQD,IAAK,CAC1D,IAAIG,EAASD,UAAUF,GAEvB,IAAK,IAAIf,KAAQkB,OACG,IAAdJ,EAAId,KAAkBc,EAAId,GAAQkB,EAAOlB,IAIjD,OAAOc,GApKTnC,EAAQwC,MA+sBR,WAQEC,KAAKnC,QAAU,KASfmC,KAAKlC,OAAS,KACdkC,KAAKC,GAAKC,IAKVF,KAAKG,QAAU,IAAIvC,SAAQ,CAACC,EAASC,KACnCkC,KAAKnC,QAAUA,EACfmC,KAAKlC,OAASA,KAEhBT,OAAO+C,OAAOJ,OAzuBhBzC,EAAQ8C,eA4ER,WACE,OAAOC,KAAKC,IAAIC,SAASC,gBAAgBC,aAAcF,SAASG,KAAKC,aAAcJ,SAASC,gBAAgBG,aAAcJ,SAASG,KAAKE,aAAcL,SAASC,gBAAgBI,eA5EjLtD,EAAQuD,OA4KR,SAAgBC,GACd,IAAIC,EAAU,GAAGC,MAAMC,KAAKrB,UAAW,GAOvC,OANAmB,EAAQrC,SAAQ,SAAUmB,GACnBA,GACLzC,OAAO8D,oBAAoBrB,GAAQnB,SAAQ,SAAUyC,GACnD/D,OAAOC,eAAeyD,EAAQK,EAAU/D,OAAOgE,yBAAyBvB,EAAQsB,UAG7EL,GAnLTxD,EAAQ+D,eAwzBR,SAAwBjD,EAAIkD,EAAUC,GAIpC,IAHA,IAAIrD,EAAS,GACTsD,EAAapD,EAAGoD,WAEX9B,EAAI,EAAGA,EAAI8B,EAAW7B,OAAQD,IAAK,CAC1C,IAAI+B,EAAOD,EAAW9B,GAEtB,GAAsB,IAAlB+B,EAAKC,UAAkBD,EAAKH,SAASK,gBAAkBL,EAAU,CACnE,GAAIC,EACF,OAAOE,EAEPvD,EAAO0D,KAAKH,IAKlB,IAAKF,EACH,OAAOrD,GAx0BXZ,EAAQuE,aA8wBR,SAAsBzD,GAIpB,IAHA,IAAIF,EAAS,GACTsD,EAAapD,EAAGoD,WAEX9B,EAAI,EAAGA,EAAI8B,EAAW7B,OAAQD,IAAK,CAC1C,IAAI+B,EAAOD,EAAW9B,GAEA,IAAlB+B,EAAKC,UACPxD,EAAO0D,KAAKH,GAIhB,OAAOvD,GAzxBTZ,EAAQwE,mBAm1BR,SAA4BL,EAAMM,GAChC,IAAIC,EACJ,GAAa,OAATP,GAA6B,KAAZM,EAAgB,OACrCC,EAASP,EAAKQ,WAEd,KAA2B,IAApBD,EAAON,UAAgB,CAC5B,GAAIM,EAAOE,QAAQP,gBAAkBI,EACnC,OAAOC,EAGTA,EAASA,EAAOC,aA51BpB3E,EAAQ6E,mBA2aR,SAA4BC,GAC1B,OAAOC,EAAYD,EAnYA,IAxCrB9E,EAAQ+E,YAAcA,EACtB/E,EAAQgF,cA2PR,SAASA,EAAcC,EAAMC,EAAOC,EAAiBC,EAAQC,GAC3D,IAGIC,EAHAC,EAAQH,GAAU,EAClBI,EAAMH,GAAQH,EAAM7C,OACpBoD,EAAQC,SAASH,GAASC,EAAMD,GAAS,GAGxCJ,IACHA,EAAkB,SAAUQ,EAAGC,GAC7B,OAAID,EAAIC,EAAU,EACdD,EAAIC,GAAW,EACfD,GAAKC,EAAU,OAAnB,IAIJ,GAAIJ,EAAMD,GAAS,EACjB,OAAQ,EAKV,GAFAD,EAAWH,EAAgBD,EAAMO,GAAQR,GAErCO,EAAMD,IAAU,EAClB,OAAoB,IAAbD,EAAiBG,GAAS,EAGnC,GAAiB,IAAbH,EACF,OAAOG,EAGT,OAAkB,IAAdH,EACKN,EAAcC,EAAMC,EAAOC,EAAiBM,EAAOD,GAEnDR,EAAcC,EAAMC,EAAOC,EAAiBI,EAAOE,IAzR9DzF,EAAQ6F,gBA6ZR,SAAyBC,GACvB,OAAOf,EAAYe,EAvXH,IAtClB9F,EAAQ+F,OAyLR,SAAgBd,EAAMC,EAAOC,GAC3B,IAAIa,EAAWC,EAAWhB,EAAMC,EAAOC,GAEvC,OADAD,EAAMgB,OAAOF,EAAU,EAAGf,GACnBe,GA3LThG,EAAQmG,UA6ER,SAAmBhE,GACjB,SAAUA,GAAuB,GAAhBA,EAAIiC,WA7EvBpE,EAAQoG,QAgGR,SAAiBC,GACf,IAAIC,EAAIhF,WAAW+E,GAEnB,IAAoB,IAAhBE,EAASF,GACX,OAAO,EAGT,GAAiB,kBAANA,GAAkBA,EAAEG,QAAQ,MAAQ,EAC7C,OAAO,EAGT,OAAOzD,KAAK0D,MAAMH,KAAOA,GA1G3BtG,EAAQuG,SAAWA,EACnBvG,EAAQ0G,MA8aR,SAAeC,GACb,MAAO,CAAC,MAAO,MAAO,OAAOH,QAAQG,IAAQ,GA9a/C3G,EAAQiG,WAAaA,EACrBjG,EAAQ4G,WAkVR,SAAoBzC,GAClB,IAAI0C,EACAC,EAAM3C,EAAK4C,cAEf,GAAI5C,EAAKC,UAAY4C,KAAKC,UAAW,CACnC,IAAIC,EAAUJ,EAAIK,cAClBD,EAAQE,mBAAmBjD,GAC3B0C,EAAQK,EAAQG,6BAEhBR,EAAQ1C,EAAKkD,wBAGf,OAAOR,GA7VT7G,EAAQsH,QAAUA,EAClBtH,EAAQuH,MA+fR,SAAeC,EAAQ9F,EAAM+F,GAC3B,IACIC,EAGFA,EADuB,qBAAdC,WAA6BF,EAC7BG,EAAQD,UAERA,UAKkB,QAAzBH,EAAOK,WAAW,KACpBL,EAASA,EAAO9D,MAAM,IAIxB,OADM,IAAIgE,GAASI,gBAAgBN,EAAQ9F,IA9gB7C1B,EAAQ+H,SA8GR,SAAkBC,GAChB,IACIC,EAAW,CAAC,WAAY,WAAY,QAAS,MAAO,QACpDC,EAAQF,EAAW3D,cACnBhC,EAHU,CAAC,SAAU,SAAU,MAAO,IAAK,MAG1BA,OAErB,GAAwB,qBAAbY,UAAiE,oBAA9BA,SAASG,KAAKrC,MAAMmH,GAChE,OAAOF,EAGT,IAAK,IAAI5F,EAAI,EAAGA,EAAIC,EAAQD,IAC1B,GAAuD,oBAA5Ca,SAASG,KAAKrC,MAAMkH,EAAS7F,GAAK8F,GAC3C,OAAOD,EAAS7F,GAAK8F,EAIzB,OAAOF,GA7HThI,EAAQmI,GAyhBR,SAAYrH,EAAIsH,GACd,IAAIC,EAEJ,IAAKvH,EACH,MAAM,IAAIwH,MAAM,uBAGlB,GAA+B,oBAApBxH,EAAGyH,cACZ,OAAOzH,EAAGyH,cAAcH,GAIxB,IAFAC,EAAWvH,EAAG0H,qBAAqBJ,IAEtB/F,OACX,OAAOgG,EAAS,IAriBtBrI,EAAQyI,IAAMA,EACdzI,EAAQ0I,IAkkBR,SAAa5H,EAAIsH,EAAKO,GACpB,IAAIC,EAAGC,EAEP,GAA+B,oBAApB/H,EAAGyH,cAA8B,CAG1C,IAAK,IAAIlH,KAFT+G,GAAO,IAEUO,EACfP,GAAO/G,EAAO,MAAQsH,EAAMtH,GAAQ,IAItC,OADA+G,GAAO,IACAtH,EAAGyH,cAAcH,GAaxB,GAXAQ,EAAI9H,EAAG0H,qBAAqBJ,GAC5BS,EAAWC,MAAMC,UAAUrF,MAAMC,KAAKiF,EAAG,GAAGI,QAAO,SAAUlI,GAC3D,IAAK,IAAIO,KAAQsH,EACf,GAAI7H,EAAGmI,aAAa5H,KAAUsH,EAAMtH,GAClC,OAAO,EAIX,OAAO,KAIP,OAAOwH,EAAS,IA1lBtB7I,EAAQkJ,oBA+tBR,SAA6BC,EAAMC,EAASC,GAC1C,IAAIC,EAE6B,oBAAtBH,EAAKZ,gBACde,EAAQH,EAAKZ,cAAe,GAAEa,aAAmBC,QAInD,GAAKC,GAA0B,IAAjBA,EAAMjH,OASlB,OAAOiH,EARPA,EAAQb,EAAIU,EAAMC,GAElB,IAAK,IAAIhH,EAAI,EAAGA,EAAIkH,EAAMjH,OAAQD,IAChC,GAAIkH,EAAMlH,GAAGmH,eAAe,+BAAgC,UAAYF,GAAQC,EAAMlH,GAAG6G,aAAa,eAAiBI,EACrH,OAAOC,EAAMlH,IA3uBrBpC,EAAQwJ,2BAAwB,EAChCxJ,EAAQyJ,cA0cR,SAAuBC,GACrB,OAAO1H,EAAK2H,gBAAgBD,IA1c9B1J,EAAQ4J,OAmmBR,SAAgBC,EAAMC,GAGgB,qBAF1BD,EAAK9C,eAAiB8C,GAEjBE,iBACbC,EAAWH,EAAMC,EAAMG,WAAWC,WAElCC,EAAKN,GAAM,SAAU1F,GACfA,GAA0B,IAAlBA,EAAKC,UAEf0F,EAAK3F,OA3mBbnE,EAAQgK,WAAaA,EACrBhK,EAAQqJ,KAweR,SAAclH,GACZ,OAAOrC,OAAOiJ,UAAUqB,SAASzG,KAAKxB,GAAKuB,MAAM,GAAI,IAxevD1D,EAAQ2C,KAAOA,EACf3C,EAAQmK,KAAOA,EACfnK,EAAQqK,aAwVR,WACE,IAAInJ,EAAQF,OAAOsJ,WACfnJ,EAASH,OAAOuJ,YACpB,MAAO,CACLC,IAAK,EACLC,KAAM,EACNC,MAAOxJ,EACPyJ,OAAQxJ,EACRD,MAAOA,EACPC,OAAQA,IA/VZ,IAAIyG,EAAUgD,EAAQ,IAYtB,MAAMpB,EAAyC,oBAAVxI,SAAwBA,OAAOwI,uBAAyBxI,OAAO6J,0BAA4B7J,OAAO8J,6BAA+B9J,OAAO+J,yBAC7K/K,EAAQwJ,sBAAwBA,EAChC,MAKMxH,EAAqB,oBAAPgJ,IAAqBA,IAAuB,oBAAVhK,OAAwBA,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,YAASC,EAShI,SAASxI,IACP,IAAIyI,GAAI,IAAIC,MAAOC,UAMnB,MALW,uCAAuCC,QAAQ,SAAS,SAAUC,GAC3E,IAAIC,GAAKL,EAAoB,GAAhBrI,KAAK2I,UAAiB,GAAK,EAExC,OADAN,EAAIrI,KAAK0D,MAAM2E,EAAI,KACN,KAALI,EAAWC,EAAQ,EAAJA,EAAU,GAAKrB,SAAS,OAgCnD,SAAS7D,EAASF,GAChB,OAAQsF,MAAMrK,WAAW+E,KAAOuF,SAASvF,GAiH3C,SAASJ,EAAWhB,EAAMC,EAAOC,EAAiBC,EAAQC,GACxD,IAGIC,EAHAC,EAAQH,GAAU,EAClBI,EAAMH,GAAQH,EAAM7C,OACpBoD,EAAQC,SAASH,GAASC,EAAMD,GAAS,GAW7C,OARKJ,IACHA,EAAkB,SAAUQ,EAAGC,GAC7B,OAAID,EAAIC,EAAU,EACdD,EAAIC,GAAW,EACfD,GAAKC,EAAU,OAAnB,IAIAJ,EAAMD,GAAS,EACVE,GAGTH,EAAWH,EAAgBD,EAAMO,GAAQR,GAErCO,EAAMD,IAAU,EACXD,GAAY,EAAIG,EAAQA,EAAQ,EAGxB,IAAbH,EACKG,GAGS,IAAdH,EACKW,EAAWhB,EAAMC,EAAOC,EAAiBM,EAAOD,GAEhDS,EAAWhB,EAAMC,EAAOC,EAAiBI,EAAOE,IAyJ3D,SAASV,EAAYZ,EAAM0H,GAMzB,IALA,IAEIC,EADAC,EADS5H,EAAKQ,WACIT,WAElB8H,GAAS,EAEJ5J,EAAI,EAAGA,EAAI2J,EAAS1J,UAC3ByJ,EAAMC,EAAS3J,IAEPgC,WAAayH,GACnBG,IAGEF,GAAO3H,GAPwB/B,KAUrC,OAAO4J,EA4CT,SAASlK,EAAWL,EAASC,GAC3B,OAAO,IAAIuK,KAAK,CAACxK,GAAU,CACzB4H,KAAM3H,IA6HV,SAAS+G,EAAI3H,EAAIsH,GACf,MAA+B,oBAApBtH,EAAGyH,cACLzH,EAAGoL,iBAAiB9D,GAEpBtH,EAAG0H,qBAAqBJ,GAyEnC,SAAS4B,EAAWH,EAAMC,EAAMd,GAC9B,IAAIgB,EAAa/G,SAAS8G,iBAAiBF,EAAMb,EAAQ,MAAM,GAC/D,IAAI7E,EAEJ,KAAOA,EAAO6F,EAAWmC,YACvBrC,EAAK3F,GAUT,SAASgG,EAAKhG,EAAMiI,GAClB,GAAIA,EAASjI,GACX,OAAO,EAKT,GAFAA,EAAOA,EAAKkI,WAGV,EAAG,CAGD,GAFalC,EAAKhG,EAAMiI,GAGtB,OAAO,EAGTjI,EAAOA,EAAKmI,kBACLnI,GAqHb,SAASmD,EAAQnD,GAGf,IAFA,IAAIoI,EAAQ,CAACpI,GAENA,EAAMA,EAAOA,EAAKQ,WACvB4H,EAAMC,QAAQrI,GAGhB,OAAOoI,EAuJTvM,EAAQE,YA1FR,MACEuM,cACEhK,KAAKiK,WAAY,EACjBjK,KAAKkK,6BAA0BxB,EAC/B1I,KAAKmK,kBAAezB,EACpB1I,KAAKoK,eAAY1B,EACjB1I,KAAKqK,oBAAiB3B,EACtB1I,KAAKsK,iBAAc5B,EAGrB6B,SAASC,EAAWF,GAClBtK,KAAKqK,eAAiBG,EACtBxK,KAAKsK,YAAcA,EAEdtK,KAAKmK,aAGRnK,KAAKkK,wBAA0BlK,KAAKyK,2BAFpCzK,KAAK0K,UAAS,GAKhB1K,KAAK2K,kBAGPC,OAAOC,EAAST,GACdpK,KAAKmK,aAAeU,EACpB7K,KAAKoK,UAAYA,EAEZpK,KAAKqK,gBAGRrK,KAAKiK,WAAY,EACjBjK,KAAKkK,wBAA0BlK,KAAKyK,4BAHpCzK,KAAK0K,UAAS,GAMhB1K,KAAK2K,kBAGPD,SAASI,GACP9K,KAAKiK,WAAY,EAEba,GACF9K,KAAKmK,aAAenK,KAAKqK,eACzBrK,KAAKoK,UAAYpK,KAAKsK,YACtBtK,KAAKkK,wBAA0BlK,KAAKqK,eAAenI,aAEnDlC,KAAKqK,eAAiBrK,KAAKmK,aAC3BnK,KAAKsK,YAActK,KAAKoK,UACxBpK,KAAKkK,wBAA0BlK,KAAKoK,UAAUlI,YAIlD6I,WAAWC,GACT,IAAI/I,EAAS+I,EAAc9I,WACvBqH,EAAQlD,MAAMC,UAAUvC,QAAQ7C,KAAKe,EAAOR,WAAYuJ,GAC5DhL,KAAKuK,SAAStI,EAAQsH,GACtBvJ,KAAK4K,OAAO3I,EAAQsH,EAAQ,GAG9B5E,mBAAmBqG,GACPA,EAAcvJ,WAAWuJ,EAAcvJ,WAAa,GAA9D,IACIwJ,EAAsC,IAA3BD,EAAcrJ,SAAiBqJ,EAAcE,YAAYtL,OAASqC,OAAOR,WAAW7B,OACnGI,KAAKuK,SAASS,EAAe,GAC7BhL,KAAK4K,OAAOI,EAAeC,GAG7BR,yBAAyBJ,EAAgBF,GACvC,IAAIgB,EAAetG,EAAQwF,GAAkBrK,KAAKqK,gBAC9Ce,EAAavG,EAAQsF,GAAgBnK,KAAKmK,cAC9C,GAAIgB,EAAa,IAAMC,EAAW,GAElC,IAAK,IAAIzL,EAAI,EAAGA,EAAIwL,EAAavL,OAAQD,IACvC,GAAIwL,EAAaxL,IAAMyL,EAAWzL,GAChC,OAAOwL,EAAaxL,EAAI,GAK9BgL,kBACM3K,KAAKqK,iBAAmBrK,KAAKmK,cAAgBnK,KAAKsK,cAAgBtK,KAAKoK,UACzEpK,KAAKiK,WAAY,EAEjBjK,KAAKiK,WAAY,EAIrBtC,e,kCC58BFtK,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IAwBpB,MAAMoD,EACJvB,YAAYwB,EAASC,EAAMC,GACzB,IAAI9E,EAWJ,GAVA5G,KAAK2L,IAAM,GACX3L,KAAKyL,KAAO,GACZzL,KAAK4L,SAAW,EAEhB5L,KAAK6L,OAAQ,EAEb7L,KAAK8L,KAAO,GACZ9L,KAAK8C,MAAQ,KACb9C,KAAK+C,IAAM,OAEL/C,gBAAgBuL,GACpB,OAAO,IAAIA,EAAQC,EAASC,EAAMC,GAWpC,GARoB,kBAATD,EACTzL,KAAKyL,KAAOzL,KAAK+L,eAAeN,GACP,kBAATA,GAAqBA,EAAKO,QAC1ChM,KAAKyL,KAAOA,GAKD,YAFb7E,EAAO5G,KAAKiM,UAAUT,IAIpB,OADAxL,KAAK2L,IAAMH,GACJ,EAAIF,EAAMxK,QAAQd,KAAMA,KAAK8E,MAAM0G,IACrC,GAAa,UAAT5E,EACT,OAAO,EAAI0E,EAAMxK,QAAQd,KAAMA,KAAKkM,UAAUV,EAASxL,KAAKyL,KAAMC,IAC7D,GAAa,SAAT9E,EACT,OAAO,EAAI0E,EAAMxK,QAAQd,KAAMA,KAAKmM,SAASX,EAASxL,KAAKyL,KAAMC,IAC5D,GAAa,YAAT9E,GAAsB4E,EAAQM,KACvC,OAAON,EACF,GAAKA,EAGV,MAAM,IAAIY,UAAU,oCAFpB,OAAOpM,KAWXiM,UAAUI,GACR,OAAIrM,KAAKsM,YAAYD,GACZ,UACEA,GAAsB,kBAARA,GAA8C,WAAzB,EAAIf,EAAM1E,MAAMyF,IAAiD,oBAAtBA,EAAIhC,eAElFgC,GAAsB,kBAARA,GAA2C,oBAAhBA,EAAI1K,SAE/C,UACE0K,GAAsB,kBAARA,GAAoBA,aAAed,IACnD,UALA,QAiBXzG,MAAMyH,GACJ,IAQIC,EAAeC,EAAeZ,EAR9BQ,EAAM,CACRT,UAAW,EACXC,OAAO,EACPJ,KAAM,GACNK,KAAM,GACNhJ,MAAO,KACPC,IAAK,MAIP,MAAsB,kBAAXwJ,EACF,CACLX,UAAW,IAIoB,IAA/BW,EAAOxI,QAAQ,aAAmD,MAA9BwI,EAAOA,EAAO3M,OAAS,KAE7D2M,EAASA,EAAOtL,MAAM,EAAGsL,EAAO3M,OAAS,KAG3C4M,EAAgBxM,KAAK0M,oBAAoBH,KAQzCF,EAAIZ,KAAOzL,KAAK+L,eAAeS,GAC/BC,EAAgBzM,KAAK2M,iBAAiBJ,GACtCF,EAAIP,KAAO9L,KAAK+L,eAAeU,IAC/BZ,EAAQ7L,KAAK4M,SAASL,MAGpBF,EAAIR,OAAQ,EACZQ,EAAIvJ,MAAQ9C,KAAK+L,eAAeF,EAAM,IACtCQ,EAAItJ,IAAM/C,KAAK+L,eAAeF,EAAM,KAMtCQ,EAAIT,SAAWS,EAAIZ,KAAKO,MAAM,GAAGzC,MAC1B8C,GApBE,CACLT,UAAW,IAsBjBG,eAAec,GACb,IASIC,EATAC,EAAY,CACdf,MAAO,GACPc,SAAU,CACRE,OAAQ,KACRC,UAAW,OAGXC,EAAQL,EAAaM,MAAM,KAC3BnB,EAAQkB,EAAM,GAAGC,MAAM,KAe3B,OAZID,EAAMtN,OAAS,IACjBkN,EAAWI,EAAM,GACjBH,EAAUD,SAAW9M,KAAKoN,cAAcN,IAGzB,KAAbd,EAAM,IACRA,EAAMqB,QAGRN,EAAUf,MAAQA,EAAMsB,IAAI,SAAUC,GACpC,OAAOvN,KAAKwN,UAAUD,IACtBE,KAAKzN,OACA+M,EAGTS,UAAUE,GACR,IAAI9G,EAAM+G,EAAKpE,EAAOqE,EAAc3N,EAUpC,IATA2N,EAAeF,EAAQG,MAAM,cAETD,EAAa,KAC/B3N,EAAK2N,EAAa,IAIpBD,EAAM1K,SAASyK,IAEXxE,MAAMyE,GAaV,OATIA,EAAM,IAAM,GAEd/G,EAAO,UACP2C,EAAQoE,EAAM,EAAI,IAElB/G,EAAO,OACP2C,GAASoE,EAAM,GAAK,GAGf,CACL,KAAQ/G,EACR,MAAS2C,EACT,GAAMtJ,GAAM,MAIhBmN,cAAcU,GACZ,IAAIC,EAAiBC,EACjBf,EAAYa,EAAWD,MAAM,YAajC,OAXIZ,GAAaA,EAAU,IACzBc,EAAkB9K,SAAS6K,EAAWX,MAAM,KAAK,IACjDa,EAAwBf,EAAU,IAElCc,EAAkB9K,SAAS6K,IAGxB,EAAIxC,EAAMxH,UAAUiK,KACvBA,EAAkB,MAGb,CACL,OAAUA,EACV,UAAaC,GAIjBtB,oBAAoBH,GAElB,OADkBA,EAAOY,MAAM,KACZ,GAGrBR,iBAAiBJ,GACf,IAAI0B,EAAc1B,EAAOY,MAAM,KAE/B,GAAIc,EAAY,GAAI,CAElB,OADaA,EAAY,GAAGd,MAAM,KACpB,IAIlBP,SAASL,GACP,IAAI2B,EAAS3B,EAAOY,MAAM,KAE1B,OAAsB,IAAlBe,EAAOtO,QACF,CAACsO,EAAO,GAAIA,EAAO,IAM9BC,4BAA4B5B,GAE1B,OADeA,EAAOY,MAAM,KACZ,IAAM,GAGxBiB,UAAUpC,GACR,OAAKA,EAIEA,EAAMsB,KAAI,SAAUe,GACzB,IAAIC,EAAU,GAcd,MAZkB,YAAdD,EAAKzH,OACP0H,GAA8B,GAAlBD,EAAK9E,MAAQ,IAGT,SAAd8E,EAAKzH,OACP0H,GAAW,EAAI,EAAID,EAAK9E,OAGtB8E,EAAKpO,KACPqO,GAAW,IAAMD,EAAKpO,GAAK,KAGtBqO,KACNC,KAAK,KAnBC,GAsBXC,cAAcF,GACZ,IAAIE,EAAgB,IAWpB,OAVAA,GAAiBxO,KAAKoO,UAAUE,EAAQtC,OAEpCsC,EAAQxB,UAAuC,MAA3BwB,EAAQxB,SAASE,SACvCwB,GAAiB,IAAMF,EAAQxB,SAASE,QAGtCsB,EAAQxB,UAA0C,MAA9BwB,EAAQxB,SAASG,YACvCuB,GAAiB,IAAMF,EAAQxB,SAASG,UAAY,KAG/CuB,EAQT7G,WACE,IAAI8G,EAAY,WAgBhB,OAfAA,GAAazO,KAAKwO,cAAcxO,KAAKyL,MACrCgD,GAAa,IACbA,GAAazO,KAAKwO,cAAcxO,KAAK8L,MAEjC9L,KAAK6L,OAAS7L,KAAK8C,QACrB2L,GAAa,IACbA,GAAazO,KAAKwO,cAAcxO,KAAK8C,QAGnC9C,KAAK6L,OAAS7L,KAAK+C,MACrB0L,GAAa,IACbA,GAAazO,KAAKwO,cAAcxO,KAAK+C,MAGvC0L,GAAa,IASfC,QAAQC,EAAQC,GACd,IAAIC,EAAQC,EACRC,EAAWC,EAef,GATsB,kBAAXL,IACTA,EAAS,IAAIpD,EAAQoD,IAGD,kBAAXC,IACTA,EAAS,IAAIrD,EAAQqD,IAInBD,EAAO/C,SAAWgD,EAAOhD,SAC3B,OAAO,EAGT,GAAI+C,EAAO/C,SAAWgD,EAAOhD,SAC3B,OAAQ,EAGN+C,EAAO9C,OACTgD,EAASF,EAAO7C,KAAKE,MAAMiD,OAAON,EAAO7L,MAAMkJ,OAC/C+C,EAAYJ,EAAO7L,MAAMgK,WAEzB+B,EAASF,EAAO7C,KAAKE,MACrB+C,EAAYJ,EAAO7C,KAAKgB,UAGtB8B,EAAO/C,OACTiD,EAASF,EAAO9C,KAAKE,MAAMiD,OAAOL,EAAO9L,MAAMkJ,OAC/CgD,EAAYJ,EAAO9L,MAAMgK,WAEzBgC,EAASF,EAAO9C,KAAKE,MACrBgD,EAAYJ,EAAO9C,KAAKgB,UAI1B,IAAK,IAAInN,EAAI,EAAGA,EAAIkP,EAAOjP,OAAQD,IAAK,CACtC,IAAKkP,EAAOlP,GACV,OAAQ,EAGV,IAAKmP,EAAOnP,GACV,OAAO,EAGT,GAAIkP,EAAOlP,GAAG4J,MAAQuF,EAAOnP,GAAG4J,MAC9B,OAAO,EAGT,GAAIsF,EAAOlP,GAAG4J,MAAQuF,EAAOnP,GAAG4J,MAC9B,OAAQ,EAMZ,OAAIsF,EAAOjP,OAASkP,EAAOlP,QACjB,EAINmP,EAAU/B,OAASgC,EAAUhC,OACxB,EAGL+B,EAAU/B,OAASgC,EAAUhC,QACvB,EAIH,EAGTO,KAAK7L,GACH,IAAIC,EAzYU,IAyYCD,EAAKC,SAAyB,OAAS,UACtD,MAAO,CACL,GAAMD,EAAKzB,GACX,QAAWyB,EAAKS,QAChB,KAAQR,EACR,MAAS3B,KAAKkP,SAASxN,IAI3ByN,aAAazN,EAAMgK,GACjB,IACI/J,EADAyN,EAAepP,KAAKuG,OAAO7E,EAAMgK,GAGrC,GAAK0D,EAML,OADAzN,EA3Zc,IA2ZHyN,EAAazN,SAAyB,OAAS,UACnD,CACL,GAAMyN,EAAanP,GACnB,QAAWmP,EAAajN,QACxB,KAAQR,EACR,MAAS3B,KAAKqP,iBAAiBD,EAAc1D,IAIjD4D,OAAO5N,EAAMsL,EAAQtB,GAWnB,IAVA,IAQI6B,EARAe,EAAU,CACZtC,MAAO,GACPc,SAAU,CACRE,OAAQ,KACRC,UAAW,OAGXsC,EAAc7N,EAGX6N,GAAeA,EAAYrN,YA7ahB,GA6a8BqN,EAAYrN,WAAWP,WAEnE4L,EADE7B,EACK1L,KAAKmP,aAAaI,EAAa7D,GAE/B1L,KAAKuN,KAAKgC,KAIjBjB,EAAQtC,MAAMjC,QAAQwD,GAGxBgC,EAAcA,EAAYrN,WAc5B,OAXc,MAAV8K,GAAkBA,GAAU,IAC9BsB,EAAQxB,SAASE,OAASA,EAE0B,QAAhDsB,EAAQtC,MAAMsC,EAAQtC,MAAMpM,OAAS,GAAGgH,MAC1C0H,EAAQtC,MAAMnK,KAAK,CACjB,KAAQ,OACR,MAAS,KAKRyM,EAGTkB,UAAUC,EAAOC,GACf,SAAKD,IAAUC,KAIXD,EAAMlG,QAAUmG,EAAMnG,OAASkG,EAAMxP,KAAOyP,EAAMzP,IAAMwP,EAAM7I,OAAS8I,EAAM9I,MAenFsF,UAAUL,EAAOJ,EAAMC,GACrB,IAAIW,EAAM,CACRR,OAAO,EACPJ,KAAM,GACNK,KAAM,GACNhJ,MAAO,KACPC,IAAK,MAEHD,EAAQ+I,EAAMxB,eACdtH,EAAM8I,EAAM1B,aACZG,EAAcuB,EAAMvB,YACpBF,EAAYyB,EAAMzB,UAClBuF,GAAgB,EAcpB,GAZIjE,IAEFiE,EAAwE,MAAxD7M,EAAMwB,cAAcwB,cAAc,IAAM4F,IAGtC,kBAATD,GACTY,EAAIZ,KAAOzL,KAAK+L,eAAeN,GAC/BY,EAAIT,SAAWS,EAAIZ,KAAKO,MAAM,GAAGzC,OACR,kBAATkC,IAChBY,EAAIZ,KAAOA,GAGTI,EAAM5B,UACJ0F,IACFrF,EAActK,KAAK4P,YAAY9M,EAAOwH,EAAaoB,IAGrDW,EAAIP,KAAO9L,KAAKsP,OAAOxM,EAAOwH,EAAaoB,OACtC,CACLW,EAAIR,OAAQ,EAER8D,IACFrF,EAActK,KAAK4P,YAAY9M,EAAOwH,EAAaoB,IAGrDW,EAAIvJ,MAAQ9C,KAAKsP,OAAOxM,EAAOwH,EAAaoB,GAExCiE,IACFvF,EAAYpK,KAAK4P,YAAY7M,EAAKqH,EAAWsB,IAG/CW,EAAItJ,IAAM/C,KAAKsP,OAAOvM,EAAKqH,EAAWsB,GAEtCW,EAAIP,KAAO,CACTE,MAAO,GACPc,SAAU,MAGZ,IACInN,EADAkQ,EAAMxD,EAAIvJ,MAAMkJ,MAAMpM,OAG1B,IAAKD,EAAI,EAAGA,EAAIkQ,GACV7P,KAAKwP,UAAUnD,EAAIvJ,MAAMkJ,MAAMrM,GAAI0M,EAAItJ,IAAIiJ,MAAMrM,IADlCA,IAEbA,IAAMkQ,EAAM,EAEVxD,EAAIvJ,MAAMgK,WAAaT,EAAItJ,IAAI+J,WAEjCT,EAAIP,KAAKE,MAAMnK,KAAKwK,EAAIvJ,MAAMkJ,MAAMrM,IAEpC0M,EAAIR,OAAQ,GAGdQ,EAAIP,KAAKE,MAAMnK,KAAKwK,EAAIvJ,MAAMkJ,MAAMrM,IAO1C0M,EAAIvJ,MAAMkJ,MAAQK,EAAIvJ,MAAMkJ,MAAM/K,MAAMoL,EAAIP,KAAKE,MAAMpM,QACvDyM,EAAItJ,IAAIiJ,MAAQK,EAAItJ,IAAIiJ,MAAM/K,MAAMoL,EAAIP,KAAKE,MAAMpM,QAGrD,OAAOyM,EAWTF,SAAS2D,EAAQrE,EAAMC,GACrB,IAAIW,EAAM,CACRR,OAAO,EACPJ,KAAM,GACNK,KAAM,GACNhJ,MAAO,KACPC,IAAK,MAWP,MARoB,kBAAT0I,GACTY,EAAIZ,KAAOzL,KAAK+L,eAAeN,GAC/BY,EAAIT,SAAWS,EAAIZ,KAAKO,MAAM,GAAGzC,OACR,kBAATkC,IAChBY,EAAIZ,KAAOA,GAGbY,EAAIP,KAAO9L,KAAKsP,OAAOQ,EAAQ,KAAMpE,GAC9BW,EAGT9F,OAAOuJ,EAAQpE,GACb,IAAIiE,EACAI,EAEA9N,EAAQ+N,EAAiBnG,EACzBoG,GAAS,EAWb,OA3lBc,IAklBVH,EAAOnO,UACTsO,GAAS,EACThO,EAAS6N,EAAO5N,WAChByN,EAAgBG,EAAO5N,WAAWgO,UAAUC,SAASzE,KAErDuE,GAAS,EACTN,EAAgBG,EAAOI,UAAUC,SAASzE,IAGxCiE,GAAiBM,GACnBD,EAAkB/N,EAAO+N,gBACzBnG,EAAc5H,EAAO4H,YAEjBmG,GA/lBQ,IA+lBWA,EAAgBrO,SACrCoO,EAAUC,EACDnG,GAjmBC,IAimBcA,EAAYlI,WACpCoO,EAAUlG,GAGRkG,GAIKD,KAEAH,IAAkBM,IAKpBH,EAIXF,YAAYE,EAAQ9C,EAAQtB,GAC1B,GArnBc,GAqnBVoE,EAAOnO,SACT,MAAM,IAAIkE,MAAM,8BAGlB,IAAIuK,EAAON,EACPO,EAAcrD,EAMlB,IAJI8C,EAAO5N,WAAWgO,UAAUC,SAASzE,KACvC0E,EAAON,EAAO5N,YAGTkO,EAAKJ,iBAAiB,CAC3B,GAloBe,IAkoBXI,EAAKJ,gBAAgBrO,SAA2B,CAElD,IAAIyO,EAAKJ,gBAAgBE,UAAUC,SAASzE,GAG1C,MAFA2E,GAAeD,EAAKJ,gBAAgB9E,YAAYtL,YAMlDyQ,GAAeD,EAAKJ,gBAAgB9E,YAAYtL,OAGlDwQ,EAAOA,EAAKJ,gBAGd,OAAOK,EAGTC,cAAchH,EAAU3H,EAAU+J,GAChC,IAEI/L,EAEA4Q,EACAC,EALAC,EAAS,GACTC,GAAa,EAEbb,EAAMvG,EAAS1J,OAInB,IAAKD,EAAI,EAAGA,EAAIkQ,EAAKlQ,IA5pBJ,KA6pBf4Q,EAAejH,EAAS3J,GAAGgC,WAEU2H,EAAS3J,GAAGuQ,UAAUC,SAASzE,KAClE6E,EA/pBU,GAkqBR5Q,EAAI,GAlqBI,IAkqBC4Q,GAlqBD,IAkqB+BC,EAEzCC,EAAO9Q,GAAK+Q,EACH/O,IAAa4O,IACtBG,GAAwB,EACxBD,EAAO9Q,GAAK+Q,GAGdF,EAAeD,EAGjB,OAAOE,EAGTvB,SAASY,GACP,IAAIxG,EAAUC,EAed,OAjsBiB,IAorBbuG,EAAOnO,WACT2H,EAAWwG,EAAO5N,WAAWoH,YAG3BA,GAAW,EAAIgC,EAAMxJ,cAAcgO,EAAO5N,aAG5CqH,EAAQlD,MAAMC,UAAUvC,QAAQ7C,KAAKoI,EAAUwG,IAG/CvG,GADAD,EAAWtJ,KAAK2Q,UAAUb,EAAO5N,aAChB6B,QAAQ+L,GAGpBvG,EAGT8F,iBAAiBS,EAAQpE,GACvB,IAAIpC,EAAiBgE,EAiBrB,OAttBiB,IAusBbwC,EAAOnO,UACT2H,EAAWwG,EAAO5N,WAAWoH,SAC7BgE,EAAMtN,KAAKsQ,cAAchH,EAzsBV,EAysBkCoC,KAEjDpC,EAAWwG,EAAO5N,WAAWT,WAEzBqO,EAAO5N,WAAWgO,UAAUC,SAASzE,KAEvCpC,GADAwG,EAASA,EAAO5N,YACEA,WAAWT,YAG/B6L,EAAMtN,KAAKsQ,cAAchH,EAjtBb,EAitBkCoC,IAIzC4B,EADCjH,MAAMC,UAAUvC,QAAQ7C,KAAKoI,EAAUwG,IAIjDc,aAAa5E,GACX,IAAI6E,EAAQ,CAAC,IAAK,KAYlB,OAXA7E,EAAMrN,SAAQ,SAAU4O,GACtB,IAAI2B,EAAW3B,EAAKhE,MAAQ,EAExBgE,EAAKtN,GACP4Q,EAAMhP,KAAK,gBAAkBqN,EAAW,aAAe3B,EAAKtN,GAAK,MAC1C,SAAdsN,EAAK3G,KACdiK,EAAMhP,KAAK,UAAYqN,EAAW,KAElC2B,EAAMhP,KAAK,KAAOqN,EAAW,QAG1B2B,EAAMtC,KAAK,KAiBpBuC,qBAAqB9E,GACnB,IAAInF,EAAQ,CAAC,QAYb,OAXAmF,EAAMrN,SAAQ,SAAU4O,GACtB,IAAI2B,EAAW3B,EAAKhE,MAAQ,EAExBgE,EAAKtN,GACP4G,EAAMhF,KAAK,IAAM0L,EAAKtN,IACC,SAAdsN,EAAK3G,MAGdC,EAAMhF,KAAK,eAAiBqN,EAAW,QAGpCrI,EAAM0H,KAAK,KAGpBoC,UAAUI,EAAWrF,GACnB,OAAOrF,MAAMC,UAAUrF,MAAMC,KAAK6P,EAAUtP,YAAY8E,QAAO,SAAU7E,GACvE,OAxwBY,IAwwBRA,EAAKC,aAEE+J,IAAehK,EAAKwO,UAAUC,SAASzE,OAQtDsF,WAAWhF,EAAOiF,EAAMvF,GACtB,IAGI6B,EAEA5N,EALA0E,EAAM4M,GAAQzQ,SACduQ,EAAY1M,EAAI5D,gBAGhBoP,EAAM7D,EAAMpM,OAGhB,IAAKD,EAAI,EAAGA,EAAIkQ,IAGI,aAFlBtC,EAAOvB,EAAMrM,IAEJiH,KAILmK,EADExD,EAAKtN,GACKoE,EAAI6M,eAAe3D,EAAKtN,KAEzB8Q,EAAUzH,WAAY,EAAIgC,EAAMxJ,cAAciP,IACpCxD,EAAKhE,OAEL,SAAdgE,EAAK3G,OACdmK,EAAY/Q,KAAK2Q,UAAUI,EAAWrF,GAAa6B,EAAKhE,QAGrDwH,GAhBcpR,KAwBrB,OAAOoR,EAGTI,SAASnF,EAAOiF,EAAMvF,GACpB,IACIqF,EACAF,EAFAxM,EAAM4M,GAAQzQ,SAalB,OATKkL,GAAsC,oBAAhBrH,EAAI+M,SAI7BL,EADSrF,EACG1L,KAAKgR,WAAWhF,EAAO3H,EAAKqH,GAE5B1L,KAAKgR,WAAWhF,EAAO3H,IALnCwM,EAAQ7Q,KAAK4Q,aAAa5E,GAC1B+E,EAAY1M,EAAI+M,SAASP,EAAOxM,EAAK,KAAMgN,YAAYC,wBAAyB,MAAMC,iBAOjFR,EAGTS,QAAQxF,EAAOgB,EAAQiE,EAAMvF,GAC3B,IAGI+F,EACA5B,EAJAkB,EAAY/Q,KAAKmR,SAASnF,EAAM/K,MAAM,GAAI,GAAIgQ,EAAMvF,GACpDpC,EAAWyH,EAAUtP,WACrB6L,EAAMtN,KAAKsQ,cAAchH,EAz0Bf,EAy0BoCoC,GAG9CgG,EAAgB1F,EAAMA,EAAMpM,OAAS,GAAG2J,MAE5C,IAAK,IAAIoI,KAAcrE,EAAK,CAC1B,IAAKA,EAAIsE,eAAeD,GAAa,OAErC,GAAIrE,EAAIqE,KAAgBD,EAAe,CAIrC,KAAI1E,GAFJ6C,GADA4B,EAAQnI,EAASqI,IACLzG,YAAYtL,SAIjB,CAEHmR,EA11BS,IAy1BPU,EAAM9P,SACI8P,EAAMhQ,WAAW,GAEjBgQ,EAGd,MARAzE,GAAkB6C,GAaxB,MAAO,CACLkB,UAAWA,EACX/D,OAAQA,GAWZ6E,QAAQZ,EAAMvF,GACZ,IACIG,EACA/I,EAAOC,EAAKsH,EAAgBF,EAE5B2H,EAAYC,EAEZC,EANA3N,EAAM4M,GAAQzQ,SAGd6L,EAAMrM,KAEN2P,IAAgBjE,GAAsD,MAAxCrH,EAAIyB,cAAc,IAAM4F,GAsB1D,GAlBEG,EAD6B,qBAApBxH,EAAIK,YACLL,EAAIK,cAEJ,IAAI4G,EAAM7N,YAGhB4O,EAAIR,OACN/I,EAAQuJ,EAAIvJ,MACZgP,EAAazF,EAAIP,KAAKE,MAAMiD,OAAOnM,EAAMkJ,OACzC3B,EAAiBrK,KAAKmR,SAASW,EAAYzN,EAAKsL,EAAgBjE,EAAc,MAC9E3I,EAAMsJ,EAAItJ,IACVgP,EAAW1F,EAAIP,KAAKE,MAAMiD,OAAOlM,EAAIiJ,OACrC7B,EAAenK,KAAKmR,SAASY,EAAU1N,EAAKsL,EAAgBjE,EAAc,QAE1E5I,EAAQuJ,EAAIP,KACZgG,EAAazF,EAAIP,KAAKE,MACtB3B,EAAiBrK,KAAKmR,SAAS9E,EAAIP,KAAKE,MAAO3H,EAAKsL,EAAgBjE,EAAc,QAGhFrB,EAcF,OAFA4H,QAAQC,IAAI,8BAA+BlS,KAAK2H,YAEzC,KAbP,IAC+B,MAAzB7E,EAAMgK,SAASE,OACjBnB,EAAMtB,SAASF,EAAgBvH,EAAMgK,SAASE,QAE9CnB,EAAMtB,SAASF,EAAgB,GAEjC,MAAO8H,GACPH,EAAShS,KAAKwR,QAAQM,EAAYhP,EAAMgK,SAASE,OAAQ3I,EAAKsL,EAAgBjE,EAAc,MAC5FG,EAAMtB,SAASyH,EAAOjB,UAAWiB,EAAOhF,QAQ5C,GAAI7C,EACF,IAC6B,MAAvBpH,EAAI+J,SAASE,OACfnB,EAAMjB,OAAOT,EAAcpH,EAAI+J,SAASE,QAExCnB,EAAMjB,OAAOT,EAAc,GAE7B,MAAOgI,GACPH,EAAShS,KAAKwR,QAAQO,EAAU1F,EAAItJ,IAAI+J,SAASE,OAAQ3I,EAAKsL,EAAgBjE,EAAc,MAC5FG,EAAMjB,OAAOoH,EAAOjB,UAAWiB,EAAOhF,QAK1C,OAAOnB,EASTS,YAAYX,GACV,MAAmB,kBAARA,GAAgD,IAA5BA,EAAI5H,QAAQ,aAA6C,MAAxB4H,EAAIA,EAAI/L,OAAS,GAOnFwS,yBAAyBC,EAAiBC,EAAMrS,GAC9C,IAEIoM,EAAM,IADmC,GAAvBgG,EAAkB,GACP,IAOjC,OANAhG,GAAmB,GAHTpJ,SAASqP,GAGL,GAEVrS,IACFoM,GAAO,IAAMpM,EAAK,KAGboM,EAQT3B,SAASI,GACF9K,KAAK6L,QAIV7L,KAAK6L,OAAQ,EAETf,GACF9K,KAAK8L,KAAKE,MAAQhM,KAAK8L,KAAKE,MAAMiD,OAAOjP,KAAK8C,MAAMkJ,OACpDhM,KAAK8L,KAAKgB,SAAW9M,KAAK8C,MAAMgK,WAEhC9M,KAAK8L,KAAKE,MAAQhM,KAAK8L,KAAKE,MAAMiD,OAAOjP,KAAK+C,IAAIiJ,OAClDhM,KAAK8L,KAAKgB,SAAW9M,KAAK+C,IAAI+J,YAMpC,IAAIyF,EAAWhH,EACfhO,EAAQ8N,QAAUkH,G,6BCz+BlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQiV,OAASjV,EAAQkV,eAAiBlV,EAAQmV,gBAAa,EAG/DnV,EAAQkV,eAFe,MAIvBlV,EAAQmV,WADW,CAAC,UAAW,QAAS,aAAc,UAAW,YAAa,YAAa,QAAS,WAAY,aAAc,aA2D9HnV,EAAQiV,OAzDO,CACbG,KAAM,CACJC,YAAa,cAEfC,SAAU,CACRC,OAAQ,SACRC,OAAQ,SACRC,SAAU,WACVC,eAAgB,gBAChBC,aAAc,eAEhBC,UAAW,CACTC,QAAS,WAEXC,SAAU,CACRN,OAAQ,SACRO,QAAS,UACTC,mBAAoB,oBACpBC,MAAO,QACPC,OAAQ,SACRC,SAAU,WACVC,QAAS,WAEXC,MAAO,CACLC,KAAM,OACNC,aAAc,cACdC,WAAY,YACZC,SAAU,WACVV,QAAS,UACTW,UAAW,YACXC,MAAO,QACPC,OAAQ,SACRC,aAAc,eAEhBC,UAAW,CACTC,QAAS,UACTC,SAAU,WACVN,UAAW,YACXO,cAAe,eACfR,SAAU,WACVL,QAAS,UACTL,QAAS,UACTC,mBAAoB,oBACpBkB,iBAAkB,kBAClBC,UAAW,YACXN,aAAc,cACdpB,SAAU,WACV2B,OAAQ,UAEVA,OAAQ,CACNC,QAAS,WAEXC,WAAY,CACVC,OAAQ,SACRC,OAAQ,Y,kCC/DZ1X,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAEgC3L,EAF5BsV,GAE4BtV,EAFUyI,EAAQ,MAEGzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GA0GvF,IAAI6S,EAjGJ,MACEvI,YAAYkL,GACV,IACIC,EACOD,EAAWnR,QAAQ,QAEd,IACdmR,EAAa,IAAI3M,IAAI2M,GAAYE,UAGnCD,EAASnV,KAAK8E,MAAMoQ,GACpBlV,KAAK8L,KAAOoJ,EAERlV,KAAKqV,YAAYH,GACnBlV,KAAKsV,UAAYJ,EAEjBlV,KAAKsV,UAAYH,EAAOI,IAAM,IAGhCvV,KAAKwV,SAAWL,EAAO1J,KACvBzL,KAAKyV,UAAYN,EAAOjR,IAAIjD,MAAM,GASpC6D,MAAM4Q,GACJ,OAAOV,EAAa3J,QAAQvG,MAAM4Q,GAQpCC,WAAWD,GACT,OAAOV,EAAa3J,QAAQsK,WAAWD,GAAQ1V,KAAK8L,MAStDuJ,YAAYK,GACV,MAAwC,MAAjCA,EAAKE,OAAOF,EAAK9V,OAAS,GAWnC/B,QAAQ6X,GACN,OAAOV,EAAa3J,QAAQxN,QAAQmC,KAAKsV,UAAWI,GAWtDG,SAASH,GAGP,OAFiBA,GAAQA,EAAK3R,QAAQ,QAAU,EAGvC2R,EAGFV,EAAa3J,QAAQwK,SAAS7V,KAAKsV,UAAWI,GAGvDI,UAAUN,GACR,OAAOxV,KAAK+V,YAAYC,KAAKR,GAAUvU,MAAM,GAQ/C0G,WACE,OAAO3H,KAAK8L,OAMhBvO,EAAQ8N,QAAUkH,G,oCClHlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI4K,EAAQC,EAAuB/N,EAAQ,KAEvC6M,EAAekB,EAAuB/N,EAAQ,KAElD,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAyGvF,IAAI6S,EAjGJ,MACEvI,YAAYmM,EAAWC,GACrB,IAAIC,EAAWF,EAAUpS,QAAQ,QAAU,EACvCqR,EAAWe,EAgBf,GAdAnW,KAAKsW,SAAM5N,EACX1I,KAAKuW,KAAOJ,EACZnW,KAAKwW,SAAW,GAChBxW,KAAKyW,OAAS,GACdzW,KAAK0W,KAAO,GACZ1W,KAAK0W,KAAO,GACZ1W,KAAK2W,OAAS,GACd3W,KAAKyL,KAAO2K,GAEPC,IAA2B,IAAfD,GAA8C,kBAAfA,GAA2B7X,QAAUA,OAAOgF,WAC1FvD,KAAKyL,KAAOlN,OAAOgF,SAASgT,MAI1BF,GAAYrW,KAAKyL,KACnB,IACMzL,KAAKyL,KAEPzL,KAAKsW,IAAM,IAAI/N,IAAI4N,EAAWnW,KAAKyL,MAEnCzL,KAAKsW,IAAM,IAAI/N,IAAI4N,GAGrBnW,KAAKuW,KAAOvW,KAAKsW,IAAIC,KACrBvW,KAAKwW,SAAWxW,KAAKsW,IAAIE,SACzBxW,KAAKyW,OAASzW,KAAKsW,IAAIG,OACvBzW,KAAK0W,KAAO1W,KAAKsW,IAAII,KACrB1W,KAAK2W,OAAS3W,KAAKsW,IAAIK,OACvBvB,EAAWpV,KAAKsW,IAAIlB,UAAYpV,KAAKsW,IAAIK,OAAS3W,KAAKsW,IAAIK,OAAS,IACpE,MAAOxE,GAEPnS,KAAKsW,SAAM5N,EAEP1I,KAAKyL,OAEP2J,EADW,IAAIa,EAAM5K,QAAQrL,KAAKyL,MACd5N,QAAQuX,IAKlCpV,KAAK4W,KAAO,IAAIX,EAAM5K,QAAQ+J,GAC9BpV,KAAKsV,UAAYtV,KAAK4W,KAAKtB,UAC3BtV,KAAKwV,SAAWxV,KAAK4W,KAAKpB,SAC1BxV,KAAKyV,UAAYzV,KAAK4W,KAAKnB,UAO7B3J,OACE,OAAO9L,KAAK4W,KASd/Y,QAAQ6X,GACN,IACImB,EAEJ,OAHiBnB,EAAK3R,QAAQ,QAAU,EAI/B2R,GAGTmB,EAAW7B,EAAa3J,QAAQxN,QAAQmC,KAAKsV,UAAWI,GACjD1V,KAAKyW,OAASI,GASvBhB,SAASH,GACP,OAAOV,EAAa3J,QAAQwK,SAASH,EAAM1V,KAAKsV,WAOlD3N,WACE,OAAO3H,KAAKuW,OAMhBhZ,EAAQ8N,QAAUkH,G,6BCnHlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQuZ,YAcR,SAAqBzS,EAAK0S,GACxB,IAAItL,EACAuL,EACA/P,EAAM8P,EAAQ9P,IACdoP,EAAWpP,EAAIlD,QAAQ,QAAU,EAErC,IAAKM,EACH,OAGF2S,GAAO,EAAI1L,EAAM5F,IAAIrB,EAAK,SAC1BoH,GAAO,EAAIH,EAAM5F,IAAIsR,EAAM,WAGzBvL,EAAOpH,EAAI4S,cAAc,QACzBD,EAAKE,aAAazL,EAAMuL,EAAKpN,cAI1ByM,GAAY9X,QAAUA,OAAOgF,WAChC0D,EAAM1I,OAAOgF,SAASkT,OAASxP,GAGjCwE,EAAK0L,aAAa,OAAQlQ,IApC5B1J,EAAQ6Z,iBAuCR,SAA0B/S,EAAK0S,GAC7B,IAAIC,EACAK,EACApQ,EAAM8P,EAAQO,UAElB,IAAKjT,EACH,OAGF2S,GAAO,EAAI1L,EAAM5F,IAAIrB,EAAK,SAC1BgT,GAAO,EAAI/L,EAAM5F,IAAIsR,EAAM,0BAGzBK,EAAKF,aAAa,OAAQlQ,KAE1BoQ,EAAOhT,EAAI4S,cAAc,SACpBE,aAAa,MAAO,aACzBE,EAAKF,aAAa,OAAQlQ,GAC1B+P,EAAKO,YAAYF,KAxDrB9Z,EAAQia,aAmFR,SAAsBC,EAAUC,GAC9B,IAAIC,EAAQF,EAAShO,iBAAiB,WAEtC,IAAKkO,EAAM/X,OACT,OAuCF,IApCA,IAAI6L,GAAO,EAAIH,EAAM5F,IAAI+R,EAASnT,cAAe,QAC7Cf,EAAWkI,EAAOA,EAAKjF,aAAa,aAAUkC,EAE9CkP,EAAc,SAAUP,GAC1B,IAAId,EAAOc,EAAK7Q,aAAa,QAE7B,GAAgC,IAA5B+P,EAAKxS,QAAQ,WAMjB,GAFewS,EAAKxS,QAAQ,QAAU,EAGpCsT,EAAKF,aAAa,SAAU,cACvB,CACL,IAAIU,EAEJ,IACEA,EAAU,IAAIC,EAAKzM,QAAQkL,EAAMhT,GACjC,MAAOwU,IAGTV,EAAKW,QAAU,WASb,OARIH,GAAWA,EAAQnB,KACrBgB,EAAGG,EAAQjB,KAAK9K,KAAO+L,EAAQnB,MAE/BgB,EADSG,EACNA,EAAQjB,KAAK9K,KAEbyK,IAGE,KAGX9I,KAAKzN,MAEEL,EAAI,EAAGA,EAAIgY,EAAM/X,OAAQD,IAChCiY,EAAYD,EAAMhY,KA9HtBpC,EAAQ0a,YA2DR,SAAqB5T,EAAK0S,GACxB,IAAIC,EACAkB,EACAjY,EAAK8W,EAAQoB,MAEjB,IAAK9T,EACH,OAGF2S,GAAO,EAAI1L,EAAM5F,IAAIrB,EAAK,SAC1B6T,GAAO,EAAI5M,EAAM5F,IAAIsR,EAAM,mCAGzBkB,EAAKf,aAAa,UAAWlX,KAE7BiY,EAAO7T,EAAI4S,cAAc,SACpBE,aAAa,OAAQ,iBAC1Be,EAAKf,aAAa,UAAWlX,GAC7B+W,EAAKO,YAAYW,KA5ErB3a,EAAQ6a,WAiIR,SAAoBpZ,EAASqZ,EAAMC,GASjC,OARAD,EAAK1Z,SAAQ,SAAUsI,EAAKtH,GACtBsH,GAAOqR,EAAa3Y,KAGtBsH,EAAMA,EAAI6B,QAAQ,2BAA4B,QAC9C9J,EAAUA,EAAQ8J,QAAQ,IAAIyP,OAAOtR,EAAK,KAAMqR,EAAa3Y,QAG1DX,GAxIT,IAAIsM,EAAQnD,EAAQ,IAEhB2P,EAAO5B,EAAuB/N,EAAQ,KAE9B+N,EAAuB/N,EAAQ,KAE3C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,K,6BCfvFrC,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAIgC3L,EAJ5B4L,EAAQnD,EAAQ,IAEhB8N,GAE4BvW,EAFGyI,EAAQ,MAEUzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAsIvF,IAAI6S,EApIJ,SAAiBtL,EAAKL,EAAM4R,EAAiBC,GAC3C,IAQIC,EARAC,EAA+B,oBAAVpa,QAAwBA,OAAOgK,IAEpDqQ,EAAgBD,EAAc,OAAS,cACvCE,EAAW,IAAIvN,EAAMvL,MACrB+Y,EAAM,IAAIC,eAGVC,EAAeD,eAAezS,UAkBlC,IAAKoS,IAfC,qBAAsBM,GAE1B3b,OAAOC,eAAe0b,EAAc,mBAAoB,CACtDxb,MAAO,eAIPgb,IACFM,EAAIN,iBAAkB,GAGxBM,EAAIG,mBA0CJ,WACE,GAAIjZ,KAAKkZ,aAAeH,eAAeI,KAAM,CAC3C,IAAIC,GAAc,EAMlB,GAJ0B,KAAtBpZ,KAAKqZ,cAA6C,aAAtBrZ,KAAKqZ,eACnCD,EAAcpZ,KAAKoZ,aAGD,MAAhBpZ,KAAKsZ,QAAkC,IAAhBtZ,KAAKsZ,QAAgBF,EAAa,CAE3D,IAAIpQ,EAEJ,IAAKhJ,KAAKuZ,WAAaH,EAMrB,OALAP,EAAS/a,OAAO,CACdwb,OAAQtZ,KAAKsZ,OACbE,QAAS,iBACTC,OAAO,IAAI5T,OAAQ4T,QAEdZ,EAAS1Y,QAGlB,GAAoB,MAAhBH,KAAKsZ,OAOP,OANAT,EAAS/a,OAAO,CACdwb,OAAQtZ,KAAKsZ,OACbC,SAAUvZ,KAAKuZ,SACfC,QAAS,YACTC,OAAO,IAAI5T,OAAQ4T,QAEdZ,EAAS1Y,QAIhB6I,EADEoQ,EACEpZ,KAAKoZ,aACA,EAAI9N,EAAMrH,OAAO2C,IAGtB,EAAI0E,EAAMxG,OAAO9E,KAAKuZ,SAAU,YACnB,SAAR3S,GACL,EAAI0E,EAAMxG,OAAO9E,KAAKuZ,SAAU,yBACnB,QAAR3S,GAA0B,OAARA,GACvB,EAAI0E,EAAMxG,OAAO9E,KAAKuZ,SAAU,aACnB,QAAR3S,EACL8S,KAAK5U,MAAM9E,KAAKuZ,UACH,QAAR3S,EACL+R,EACE3Y,KAAKuZ,SAGL,IAAI/P,KAAK,CAACxJ,KAAKuZ,WAGjBvZ,KAAKuZ,SAGXV,EAAShb,QAAQmL,QAEjB6P,EAAS/a,OAAO,CACdwb,OAAQtZ,KAAKsZ,OACbE,QAASxZ,KAAKuZ,SACdE,OAAO,IAAI5T,OAAQ4T,UApG3BX,EAAIa,QAqCJ,SAAaxH,GACX0G,EAAS/a,OAAOqU,IArClB2G,EAAIc,KAAK,MAAO3S,GAAK,GAENwR,EACbK,EAAIe,iBAAiBnB,EAAQD,EAAQC,IAsGvC,MAnGY,QAAR9R,GACFkS,EAAIe,iBAAiB,SAAU,oBAI5BjT,IACHA,EAAO,IAAIqP,EAAM5K,QAAQpE,GAAKwO,WAGpB,QAAR7O,IACFkS,EAAIO,aAAeT,IAGjB,EAAItN,EAAMrH,OAAO2C,IAEnBkS,EAAIgB,iBAAiB,YASX,UAARlT,IACFkS,EAAIO,aAAe,eAGrBP,EAAIiB,OAuEGlB,EAAS1Y,SAIlB5C,EAAQ8N,QAAUkH,G,6BChJlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI2O,EAAgB9D,EAAuB/N,EAAQ,KAE/CmD,EAAQnD,EAAQ,IAEhB8R,EAAW/D,EAAuB/N,EAAQ,KAE1C+R,EAAWhE,EAAuB/N,EAAQ,MAE1CgS,EAAgBhS,EAAQ,IAExBiS,EAAajS,EAAQ,IAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,MAAM2a,EAAoC,qBAAdC,UACtBC,EAAWF,GAAgB,SAASG,KAAKF,UAAUG,WACnDC,EAAWL,IAAiBE,GAAY,cAAcC,KAAKF,UAAUG,WAY3E,MAAME,EACJ3Q,YAAY3F,EAAKrF,EAAS4b,EAASC,GAEjC7a,KAAK8a,QAAU,IAAIb,EAAS5O,QAC5BrL,KAAKQ,SAAW6D,EAChBrE,KAAKS,gBAAkBT,KAAKQ,SAASC,gBACrCT,KAAKhB,QAAUA,GAAWgB,KAAKQ,SAASG,KACxCX,KAAKzB,OAASyB,KAAKQ,SAASua,YAC5B/a,KAAKgb,MAAQ,CACXvc,MAAO,EACPC,OAAQ,GAEVsB,KAAK6a,aAAeA,GAAgB,EACpC7a,KAAK4a,QAAUA,GAAW,GAC1B5a,KAAKib,kBAAkB,UAAWb,EAAW3H,gBAC7CzS,KAAKkb,OAAS,EACdlb,KAAKmb,QAAS,EACdnb,KAAKob,YAOkB,4BACvB,OAAOhB,EAAW1H,WASpBjU,MAAM4c,GAEJ,IAAIC,EAAQtb,KAAKhB,QAUjB,OARIqc,IAAK,EAAI/P,EAAMxH,UAAUuX,KAC3BA,GAAQ,MAGNA,IACFC,EAAMhd,MAAMG,MAAQ4c,GAGfpY,SAASjD,KAAKzB,OAAOC,iBAAiB8c,GAA7B,OASlB5c,OAAO6c,GAEL,IAAID,EAAQtb,KAAKhB,QAUjB,OARIuc,IAAK,EAAIjQ,EAAMxH,UAAUyX,KAC3BA,GAAQ,MAGNA,IACFD,EAAMhd,MAAMI,OAAS6c,GAGhBtY,SAASjD,KAAKzB,OAAOC,iBAAiB8c,GAA7B,QASlBE,aAAaH,GACX,IAAIrc,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,KAU5C,OARI0a,IAAK,EAAI/P,EAAMxH,UAAUuX,KAC3BA,GAAQ,MAGNA,IACFrc,EAAQV,MAAMG,MAAQ4c,GAGjBpY,SAASjD,KAAKzB,OAAOC,iBAAiBQ,GAA7B,OASlByc,cAAcF,GACZ,IAAIvc,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,KAU5C,OARI4a,IAAK,EAAIjQ,EAAMxH,UAAUyX,KAC3BA,GAAQ,MAGNA,IACFvc,EAAQV,MAAMI,OAAS6c,GAGlBtY,SAASjD,KAAKzB,OAAOC,iBAAiBQ,GAA7B,QAQlB0c,YACE,IAAIC,EACAld,EACAoN,EAAQ7L,KAAKQ,SAASkE,cACtB1F,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,KACxCib,GAAS,EAAItQ,EAAMlN,SAASY,GAWhC,OATA6M,EAAMlH,mBAAmB3F,GAEzB2c,EAAO9P,EAAMjH,wBACbnG,EAAQkd,EAAKld,MAETmd,GAAUA,EAAOnd,QACnBA,GAASmd,EAAOnd,OAGX6B,KAAKub,MAAMpd,GAQpBqd,aACE,IAAIH,EACAjd,EACAmN,EAAQ7L,KAAKQ,SAASkE,cACtB1F,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,KAI5C,OAHAkL,EAAMlH,mBAAmB3F,GACzB2c,EAAO9P,EAAMjH,wBACblG,EAASid,EAAKzT,OACP5H,KAAKub,MAAMnd,GAQpBqd,cAEE,OADY/b,KAAKS,gBAAgBsb,YASnCnb,eAEE,OADaZ,KAAKS,gBAAgBG,aASpCob,SAASA,GAKP,OAJIA,IACFhc,KAAKS,gBAAgBnC,MAAM0d,SAAWA,GAGjChc,KAAKzB,OAAOC,iBAAiBwB,KAAKS,iBAAlC,SAQTwb,UAAUD,GAKR,OAJIA,IACFhc,KAAKS,gBAAgBnC,MAAM2d,UAAYD,GAGlChc,KAAKzB,OAAOC,iBAAiBwB,KAAKS,iBAAlC,UAQTyb,UAAUF,GAKR,OAJIA,IACFhc,KAAKS,gBAAgBnC,MAAM4d,UAAYF,GAGlChc,KAAKzB,OAAOC,iBAAiBwB,KAAKS,iBAAlC,UAUT0b,IAAIC,EAAU5e,EAAO6e,GACnB,IAAIrd,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,KAQ5C,OANInD,EACFwB,EAAQV,MAAMge,YAAYF,EAAU5e,EAAO6e,EAAW,YAAc,IAEpErd,EAAQV,MAAMie,eAAeH,GAGxBpc,KAAKzB,OAAOC,iBAAiBQ,GAASod,GAc/CI,SAASC,GACP,IAaIC,EAVAC,EAAY3c,KAAKQ,SAASsF,cAAc,yBACxCqP,EAAS,CACX,WAASzM,EACT,YAAUA,EACV,WAASA,EACT,aAAWA,EACX,aAAWA,EACX,cAAYA,GAEVkU,EAAa,GAOjB,GAAID,GAAaA,EAAUE,aAAa,WAAY,CAClD,IAAI7d,EAAU2d,EAAUnW,aAAa,WAEjCsW,EAAS9d,EAAQ6O,MAAM,uBAEvBkP,EAAU/d,EAAQ6O,MAAM,wBAExBmP,EAAShe,EAAQ6O,MAAM,+BAEvBoP,EAAWje,EAAQ6O,MAAM,+BAEzBqP,EAAWle,EAAQ6O,MAAM,+BAEzBsP,EAAYne,EAAQ6O,MAAM,+BAE1BiP,GAAUA,EAAOld,QAA+B,qBAAdkd,EAAO,KAC3C3H,EAAO1W,MAAQqe,EAAO,IAGpBC,GAAWA,EAAQnd,QAAgC,qBAAfmd,EAAQ,KAC9C5H,EAAOzW,OAASqe,EAAQ,IAGtBC,GAAUA,EAAOpd,QAA+B,qBAAdod,EAAO,KAC3C7H,EAAOiI,MAAQJ,EAAO,IAGpBC,GAAYA,EAASrd,QAAiC,qBAAhBqd,EAAS,KACjD9H,EAAOkI,QAAUJ,EAAS,IAGxBC,GAAYA,EAAStd,QAAiC,qBAAhBsd,EAAS,KACjD/H,EAAOmI,QAAUJ,EAAS,IAGxBC,GAAaA,EAAUvd,QAAkC,qBAAjBud,EAAU,KACpDhI,EAAOoI,SAAWJ,EAAU,IA+ChC,OA3CAT,GAAW,EAAIpR,EAAM7L,UAAUgd,GAAW,GAAItH,GAE1CsH,IACEC,EAASje,OACXme,EAAW/a,KAAK,SAAW6a,EAASje,OAGlCie,EAAShe,QACXke,EAAW/a,KAAK,UAAY6a,EAAShe,QAGnCge,EAASU,OACXR,EAAW/a,KAAK,iBAAmB6a,EAASU,OAGpB,OAAtBV,EAASa,UACXX,EAAW/a,KAAK,iBAAmB6a,EAASU,OAC5CR,EAAW/a,KAAK,iBAAmB6a,EAASU,OAC5CR,EAAW/a,KAAK,iBAAmB6a,EAASa,YAExCb,EAASa,UACXX,EAAW/a,KAAK,iBAAmB6a,EAASa,UAG1Cb,EAASW,SACXT,EAAW/a,KAAK,iBAAmB6a,EAASW,SAG1CX,EAASY,SACXV,EAAW/a,KAAK,iBAAmB6a,EAASY,UAI3CX,KACHA,EAAY3c,KAAKQ,SAASyW,cAAc,SAC9BE,aAAa,OAAQ,YAC/BnX,KAAKQ,SAASsF,cAAc,QAAQyR,YAAYoF,IAGlDA,EAAUxF,aAAa,UAAWyF,EAAWrO,KAAK,OAClDvO,KAAKzB,OAAOif,SAAS,EAAG,IAGnBd,EAQTe,SACEzd,KAAK0d,KAAKtD,EAAW5H,OAAOK,SAASC,QAQvCsI,YACEpb,KAAK2d,qBACL3d,KAAK4d,sBAEL5d,KAAK6d,oBACL7d,KAAK8d,wBAEyB,qBAAnBC,gBACT/d,KAAKge,kBACLhe,KAAKie,uBAELje,KAAKke,kBAIPle,KAAKme,eAQPC,kBACEpe,KAAKqe,uBACLre,KAAKse,2BAEDte,KAAKue,UACPve,KAAKue,SAASC,aAGhBC,aAAaze,KAAK0e,WASpBC,cACE,IAAIlgB,EAAQuB,KAAK0b,YACbhd,EAASsB,KAAK8b,aAEdrd,GAASuB,KAAKgb,MAAMvc,OAASC,GAAUsB,KAAKgb,MAAMtc,SACpDsB,KAAKgb,MAAQ,CACXvc,MAAOA,EACPC,OAAQA,GAEVsB,KAAK4e,UAAY5e,KAAK4e,SAAS5e,KAAKgb,OACpChb,KAAK0d,KAAKtD,EAAW5H,OAAOK,SAASE,OAAQ/S,KAAKgb,QAStDgD,kBAGES,aAAaze,KAAK0e,WAClB3X,sBAAsB/G,KAAK2e,YAAYlR,KAAKzN,OAC5CA,KAAK0e,UAAYG,WAAW7e,KAAKge,gBAAgBvQ,KAAKzN,MAAO,KAQ/Die,sBACEzd,SAASse,iBAAiB,oBAAoB,KACX,YAA7Bte,SAASue,kBAAiD,IAAhB/e,KAAKmb,QACjDnb,KAAKmb,QAAS,EACdnb,KAAKge,oBAELhe,KAAKmb,QAAS,EACdsD,aAAaze,KAAK0e,eAUxBM,sBACE,IAAIre,EAAOX,KAAKhB,QAChB2B,EAAKrC,MAAL,mBAAmC,uGACnCqC,EAAKrC,MAAL,mBAAmC,UACnCqC,EAAKrC,MAAL,yBAAyC,SACzCqC,EAAKrC,MAAL,gBAAgC,IAChC0B,KAAKif,aAAejf,KAAK2e,YAAYlR,KAAKzN,MAC1CA,KAAKQ,SAASse,iBAAiB,gBAAiB9e,KAAKif,cASvDrB,sBASE,IARA,IAAIsB,EAASlf,KAAKQ,SAAS2e,YAEvBC,EAAqB,SAAUC,GAC7BA,EAAEC,UAAYtf,KAAKuf,YACrBV,WAAW7e,KAAKyd,OAAOhQ,KAAKzN,MAAO,IAErCyN,KAAKzN,MAEEL,EAAI,EAAGA,EAAIuf,EAAOtf,OAAQD,GAAK,EAAG,CACzC,IAAI6f,EAEJ,IACEA,EAAQN,EAAOvf,GAAG8f,SAClB,MAAOtN,GACP,OAGF,IAAKqN,EAAO,OAEZ,IAAK,IAAIE,EAAI,EAAGA,EAAIF,EAAM5f,OAAQ8f,GAAK,EAAG,CAExC,GAAIF,EAAME,GAAGC,MACD3f,KAAKzB,OAAOqhB,WAAWJ,EAAME,GAAGC,MAAME,WAC5CC,YAAYV,KAWxBlB,kBAEEle,KAAKue,SAAW,IAAIR,gBAAe5L,IACjCpL,sBAAsB/G,KAAK2e,YAAYlR,KAAKzN,UAG9CA,KAAKue,SAASwB,QAAQ/f,KAAKQ,SAASC,iBAQtCuf,oBAEEhgB,KAAKue,SAAW,IAAI0B,kBAAiBC,IACnClgB,KAAK2e,iBAUP3e,KAAKue,SAASwB,QAAQ/f,KAAKQ,SAPd,CACX2f,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,SAAS,IAWb3C,qBAIE,IAHA,IACI4C,EADAC,EAASxgB,KAAKQ,SAASiJ,iBAAiB,OAGnC9J,EAAI,EAAGA,EAAI6gB,EAAO5gB,OAAQD,IAGD,qBAFhC4gB,EAAMC,EAAO7gB,IAEE8gB,cAAqD,IAArBF,EAAIE,eACjDF,EAAIG,OAAS1gB,KAAKyd,OAAOhQ,KAAKzN,OAUpC2gB,oBACO3gB,KAAKQ,UAAaR,KAAKQ,SAASogB,OAIrC5gB,KAAKQ,SAASogB,MAAMC,MAAMC,KAAK,WAC7B9gB,KAAK2e,eACLlR,KAAKzN,OAQToH,OACE,OAAKpH,KAAKQ,SACHR,KAAKQ,SAASC,gBADM,KAW7B+C,WAAWzC,EAAQ2K,GACjB,IAAIwD,EACA6R,EAAY,CACd,KAAQ,EACR,IAAO,GAET,IAAK/gB,KAAKQ,SAAU,OAAOugB,EAE3B,GAAI/gB,KAAK8a,QAAQxO,YAAYvL,GAAS,CACpC,IAAI8K,EAAQ,IAAIoO,EAAS5O,QAAQtK,GAAQ8Q,QAAQ7R,KAAKQ,SAAUkL,GAEhE,GAAIG,EAAO,CACT,IACE,IAAKA,EAAM1B,cAAgB0B,EAAMxB,gBAAkBwB,EAAM1B,cAAgB0B,EAAMvB,aAAeuB,EAAMzB,UAAW,CAK7G,IAAI4W,EAAMnV,EAAMxB,eAAea,YAAYnH,QAAQ,IAAK8H,EAAMvB,cAElD,GAAR0W,IACFA,EAAMnV,EAAMxB,eAAea,YAAYtL,QAGzCiM,EAAMjB,OAAOiB,EAAMxB,eAAgB2W,IAErC,MAAO7O,GACPF,QAAQ8F,MAAM,sDAAuD5F,GAGvE,GAAItG,EAAMxB,eAAe1I,WAAa4C,KAAK0c,aACzC/R,EAAWrD,EAAMxB,eAAezF,wBAChCmc,EAAU/Y,KAAOkH,EAASlH,KAC1B+Y,EAAUhZ,IAAMmH,EAASnH,SAKzB,GAAI2S,EAAU,CACZ,IAAI3J,EAAYlF,EAAMxB,eAClB6W,EAAW,IAAIC,MAEnB,IAxnBS,IAynBHpQ,EAAUpP,SACZuN,EAAW6B,EAAUnM,wBACZiH,EAAMvB,YAAc,EAAIyG,EAAUnR,QAC3CshB,EAAS3W,SAASwG,EAAWlF,EAAMvB,aACnC4W,EAAStW,OAAOmG,EAAWlF,EAAMvB,YAAc,GAC/C4E,EAAWgS,EAAStc,yBACXiH,EAAMvB,YAAc,EAAI,GACjC4W,EAAS3W,SAASwG,EAAWlF,EAAMvB,YAAc,GACjD4W,EAAStW,OAAOmG,EAAWlF,EAAMvB,aACjC4E,EAAWgS,EAAStc,yBAGpBsK,EAAW6B,EAAU7O,WAAW0C,wBAElC,MAAOuN,GACPF,QAAQ8F,MAAM5F,EAAGA,EAAEsH,aAGrBvK,EAAWrD,EAAMjH,8BAIlB,GAAsB,kBAAX7D,GAAuBA,EAAOgD,QAAQ,MAAQ,EAAG,CACjE,IAAI9D,EAAKc,EAAOqgB,UAAUrgB,EAAOgD,QAAQ,KAAO,GAC5C1F,EAAK2B,KAAKQ,SAAS0Q,eAAejR,GAEtC,GAAI5B,EACF,GAAIqc,EAAU,CAEZ,IAAIwG,EAAW,IAAIC,MACnBD,EAASnW,WAAW1M,GACpB6Q,EAAWgS,EAAStc,6BAEpBsK,EAAW7Q,EAAGuG,wBAUpB,OALIsK,IACF6R,EAAU/Y,KAAOkH,EAASlH,KAC1B+Y,EAAUhZ,IAAMmH,EAASnH,KAGpBgZ,EAQTM,cAAcC,GACZ,OAAO,IAAI1jB,QAAQ,SAAUC,EAASC,GACpC,IAAIyjB,EACAV,GAAQ,EAEP7gB,KAAKQ,UAMV+gB,EAAcvhB,KAAKQ,SAASsF,cAAc,cAAgBwb,EAAM,OAG9DzjB,GAAQ,KAIV0jB,EAAcvhB,KAAKQ,SAASyW,cAAc,SAC9BrQ,KAAO,WACnB2a,EAAYC,IAAM,aAClBD,EAAYhL,KAAO+K,EAEnBC,EAAYb,OAASa,EAAYtI,mBAAqB,WAC/C4H,GAAW7gB,KAAKkZ,YAAiC,YAAnBlZ,KAAKkZ,aACtC2H,GAAQ,EAERhC,YAAW,KACThhB,GAAQ,KACP,KAIPmC,KAAKQ,SAASwW,KAAKO,YAAYgK,IA3B7B1jB,GAAQ,IA4BV4P,KAAKzN,OAGTyhB,mBAAmBC,GACjB,IAAIC,EAEJ,OADAD,EAAM,wBAA0BA,GAAO,MAClC1hB,KAAKQ,YAEVmhB,EAAU3hB,KAAKQ,SAAS0Q,eAAewQ,OAGrCC,EAAU3hB,KAAKQ,SAASyW,cAAc,UAC9BhX,GAAKyhB,EAEb1hB,KAAKQ,SAASwW,KAAKO,YAAYoK,IAG1BA,GASTC,iBAAiBC,EAAeH,GAC9B,SAAK1hB,KAAKQ,WAAaqhB,KAEb7hB,KAAKyhB,mBAAmBC,GAC1BI,UAAYD,GACb,GAWTE,mBAAmBvC,EAAOkC,GACxB,IAAIM,EACJ,GAAKhiB,KAAKQ,UAAagf,GAA0B,IAAjBA,EAAM5f,OAItC,GAFAoiB,EAAahiB,KAAKyhB,mBAAmBC,GAAKO,MAEI,mBAA1C5kB,OAAOiJ,UAAUqB,SAASzG,KAAKse,GACjC,IAAK,IAAI7f,EAAI,EAAGuiB,EAAK1C,EAAM5f,OAAQD,EAAIuiB,EAAIviB,IAAK,CAC9C,IAAI+f,EAAI,EACJyC,EAAO3C,EAAM7f,GACbyiB,EAAW5C,EAAM7f,GAAG,GACpB0iB,EAAU,GAEqC,mBAA/ChlB,OAAOiJ,UAAUqB,SAASzG,KAAKihB,EAAK,GAAG,MACzCA,EAAOA,EAAK,GACZzC,EAAI,GAGN,IAAK,IAAI4C,EAAKH,EAAKviB,OAAQ8f,EAAI4C,EAAI5C,IAAK,CACtC,IAAI9gB,EAAOujB,EAAKzC,GAChB2C,GAAWzjB,EAAK,GAAK,IAAMA,EAAK,IAAMA,EAAK,GAAK,cAAgB,IAAM,MAIxEojB,EAAWO,WAAWH,EAAW,IAAMC,EAAU,IAAKL,EAAWvC,SAAS7f,YAEvE,CACavC,OAAOmlB,KAAKhD,GACpB7gB,SAAQyjB,IAChB,MAAMK,EAAajD,EAAM4C,GAEzB,GAAI/b,MAAMqc,QAAQD,GAChBA,EAAW9jB,SAAQ6D,IACjB,MAEMrE,EAFSd,OAAOmlB,KAAKhgB,GAEL8K,KAAI6U,GAChB,GAAEA,KAAQ3f,EAAK2f,OACtB5T,KAAK,KAERyT,EAAWO,WAAY,GAAEH,KAAYjkB,KAAW6jB,EAAWvC,SAAS7f,eAEjE,CACL,MAEMzB,EAFSd,OAAOmlB,KAAKC,GAELnV,KAAI6U,GAChB,GAAEA,KAAQM,EAAWN,OAC5B5T,KAAK,KAERyT,EAAWO,WAAY,GAAEH,KAAYjkB,KAAW6jB,EAAWvC,SAAS7f,aAY5E+iB,UAAUrB,GACR,OAAO,IAAI1jB,QAAQ,SAAUC,EAASC,GACpC,IAAI8kB,EACA/B,GAAQ,EAEP7gB,KAAKQ,WAKVoiB,EAAU5iB,KAAKQ,SAASyW,cAAc,WAC9BrQ,KAAO,kBACfgc,EAAQC,OAAQ,EAChBD,EAAQtB,IAAMA,EAEdsB,EAAQlC,OAASkC,EAAQ3J,mBAAqB,WACvC4H,GAAW7gB,KAAKkZ,YAAiC,YAAnBlZ,KAAKkZ,aACtC2H,GAAQ,EACRhC,YAAW,WACThhB,GAAQ,KACP,KAIPmC,KAAKQ,SAASwW,KAAKO,YAAYqL,IAlB7B/kB,GAAQ,IAmBV4P,KAAKzN,OAQT8iB,SAASC,GACP,IAAI/jB,EACCgB,KAAKQ,WACVxB,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,OAGtC3B,EAAQkR,UAAU8S,IAAID,GAS1BE,YAAYF,GACV,IAAI/jB,EACCgB,KAAKQ,WACVxB,EAAUgB,KAAKhB,SAAWgB,KAAKQ,SAASG,OAGtC3B,EAAQkR,UAAUgT,OAAOH,GAS7BlF,oBACO7d,KAAKQ,WAIVR,KAAKmjB,cAAgBnjB,KAAKojB,aAAa3V,KAAKzN,MAE5Coa,EAAW1H,WAAW/T,SAAQ,SAAU0kB,GACtCrjB,KAAKQ,SAASse,iBAAiBuE,EAAWrjB,KAAKmjB,cAAe,CAC5DG,SAAS,MAEVtjB,OAQLqe,uBACOre,KAAKQ,WAIV4Z,EAAW1H,WAAW/T,SAAQ,SAAU0kB,GACtCrjB,KAAKQ,SAAS+iB,oBAAoBF,EAAWrjB,KAAKmjB,cAAe,CAC/DG,SAAS,MAEVtjB,MAEHA,KAAKmjB,mBAAgBza,GAQvB0a,aAAajR,GACXnS,KAAK0d,KAAKvL,EAAEvL,KAAMuL,GAQpB2L,wBACO9d,KAAKQ,WAIVR,KAAKwjB,mBAAqBxjB,KAAKyjB,kBAAkBhW,KAAKzN,MACtDA,KAAKQ,SAASse,iBAAiB,kBAAmB9e,KAAKwjB,mBAAoB,CACzEF,SAAS,KASbhF,2BACOte,KAAKQ,WAIVR,KAAKQ,SAAS+iB,oBAAoB,kBAAmBvjB,KAAKwjB,mBAAoB,CAC5EF,SAAS,IAEXtjB,KAAKwjB,wBAAqB9a,GAQ5B+a,kBAAkBtR,GACZnS,KAAK0jB,qBACPjF,aAAaze,KAAK0jB,qBAGpB1jB,KAAK0jB,oBAAsB7E,WAAW,WACpC,IAAI8E,EAAY3jB,KAAKzB,OAAOqlB,eAC5B5jB,KAAK6jB,qBAAqBF,IAC1BlW,KAAKzN,MAAO,KAQhB6jB,qBAAqBF,GACnB,IAAI9X,EAAOiY,EAEPH,GAAaA,EAAUI,WAAa,KACtClY,EAAQ8X,EAAUK,WAAW,IAElB/Z,YAET6Z,EAAW,IAAI7J,EAAS5O,QAAQQ,EAAO7L,KAAK4a,SAASjT,WACrD3H,KAAK0d,KAAKtD,EAAW5H,OAAOK,SAASG,SAAU8Q,GAC/C9jB,KAAK0d,KAAKtD,EAAW5H,OAAOK,SAASI,eAAgBpH,KAY3DA,MAAMoY,EAAMvY,GAEV,OADU,IAAIuO,EAAS5O,QAAQ4Y,GACpBpS,QAAQ7R,KAAKQ,SAAUkL,GAUpCwY,aAAarY,EAAOH,GAClB,OAAO,IAAIuO,EAAS5O,QAAQQ,EAAO7L,KAAK4a,QAASlP,GAAa/D,WAUhEwc,YAAYziB,EAAMgK,GAChB,OAAO,IAAIuO,EAAS5O,QAAQ3J,EAAM1B,KAAK4a,QAASlP,GAAa/D,WAI/D2F,IAAI8W,GAEF,OADU,IAAIlK,EAAS7O,QAAQ+Y,GACpBrN,UASbsN,KAAK5lB,EAAOC,GACV,IAAI8d,EAAW,CACbY,MAAO,EACPG,SAAU,MAEZvd,KAAKskB,YAAY,aAEb7lB,GAAS,IACXuB,KAAKvB,MAAMA,GACX+d,EAAS/d,MAAQA,EACjBuB,KAAKmc,IAAI,UAAW,KAAO1d,EAAQ,GAAK,OAGtCC,GAAU,IACZsB,KAAKtB,OAAOA,GACZ8d,EAAS9d,OAASA,GAGpBsB,KAAKmc,IAAI,SAAU,KACnBnc,KAAKmc,IAAI,aAAc,cACvBnc,KAAKwc,SAASA,GAWhB+H,QAAQ9lB,EAAOC,EAAQ8lB,EAAaC,EAAKlP,GACvC,IAAImP,GAAc,EAAIpZ,EAAMhG,UAAU,eAClCqf,GAAa,EAAIrZ,EAAMhG,UAAU,cACjCsf,GAAe,EAAItZ,EAAMhG,UAAU,gBACnCuf,GAAc,EAAIvZ,EAAMhG,UAAU,eAElCwf,EAA2C,IAD7B9kB,KAAK+kB,cACAhhB,QAAQ,YAAoB,WAAa,aAChE/D,KAAKskB,YAAY,aAEL,QAAR/O,GAA0B,eAATuP,GACnB9kB,KAAKglB,UAAUzP,GAGjBvV,KAAKvB,MAAMA,GACXuB,KAAKtB,OAAOA,GAEZsB,KAAKwc,SAAS,CACZ/d,MAAOA,EACPC,OAAQA,EACR0e,MAAO,EACPG,SAAU,OAKZvd,KAAKmc,IAAI,aAAc,UACvBnc,KAAKmc,IAAI,SAAU,KAAK,GAEX,aAAT2I,GACF9kB,KAAKmc,IAAI,cAAesI,EAAM,EAAI,MAAM,GACxCzkB,KAAKmc,IAAI,iBAAkBsI,EAAM,EAAI,MAAM,GAC3CzkB,KAAKmc,IAAI,eAAgB,QACzBnc,KAAKmc,IAAI,gBAAiB,QAC1Bnc,KAAKmc,IAAIuI,EAAa,cAEtB1kB,KAAKmc,IAAI,cAAe,QACxBnc,KAAKmc,IAAI,iBAAkB,QAC3Bnc,KAAKmc,IAAI,eAAgBsI,EAAM,EAAI,MAAM,GACzCzkB,KAAKmc,IAAI,gBAAiBsI,EAAM,EAAI,MAAM,GAC1CzkB,KAAKmc,IAAIuI,EAAa,eAGxB1kB,KAAKmc,IAAI,aAAc,cACvBnc,KAAKmc,IAAI,YAAa,WACtBnc,KAAKmc,IAAI0I,EAAa,QACtB7kB,KAAKmc,IAAIwI,EAAYF,EAAM,MAC3BzkB,KAAKmc,IAAIyI,EAAcJ,EAAc,MAGrCxkB,KAAKmc,IAAI,2BAA4B,yBAUvC8I,OAAO7H,EAAO8H,EAASC,GACrB,IAAIC,EAAW,SAAWhI,EAAQ,IAC9BiI,EAAe,GAEnBrlB,KAAKmc,IAAI,mBAAoB,aAEzB+I,GAAW,GAAKC,GAAW,KAC7BE,EAAe,eAAiBH,GAAW,GAAK,QAAUC,GAAW,GAAK,QAG5EnlB,KAAKmc,IAAI,YAAaiJ,EAAWC,GASnCC,IAAI7mB,EAAOC,EAAQqY,GACjB,IAAIyF,EAAWxc,KAAKwc,WAChB+I,EAAgBtiB,SAASuZ,EAAS/d,OAClC+mB,EAAiBviB,SAASuZ,EAAS9d,QACnC+mB,EAAahnB,EAAQ8mB,EACrBG,EAAchnB,EAAS8mB,EACvBpI,EAAQqI,EAAaC,EAAcD,EAAaC,EAmBpD,GAZA1lB,KAAKskB,YAAY,aAEjBtkB,KAAKvB,MAAM8mB,GACXvlB,KAAKtB,OAAO8mB,GACZxlB,KAAKgc,SAAS,UAEdhc,KAAKilB,OAAO7H,EAAO,EAAG,GAGtBpd,KAAKmc,IAAI,kBAAmBoJ,EAAgBnI,EAAQ,MAAQoI,EAAiBpI,EAAQ,MACrFpd,KAAKmc,IAAI,mBAAoB,eAEzBpF,GAAWA,EAAQ4O,WAAWC,SAAS,oBAAqB,CAE9D,IAAIC,EAAapnB,EAAQ8mB,EAAgBnI,EACzCpd,KAAKmc,IAAI,cAAe0J,EAAa,OASzCb,UAAUzP,GACJvV,KAAKS,kBACPT,KAAKS,gBAAgBnC,MAArB,UAA0CiX,GAI9CuQ,QAAQlL,EAASwJ,EAAQthB,EAAOC,EAAKgjB,GAEnC,OADc,IAAI7L,EAAS7O,QAAQ+Y,EAAQ2B,GAC5BC,KAAKhmB,KAAM4a,EAAS9X,EAAOC,GAQ5Cob,gBACE,EAAIhE,EAAc3C,cAAcxX,KAAKhB,SAASuX,IAC5CvW,KAAK0d,KAAKtD,EAAW5H,OAAOK,SAASK,aAAcqD,MASvDwO,YAAYkB,GACV,IAAInS,GAAe,EAAIxI,EAAMhG,UAAU,gBAMvC,OAJI2gB,GAAQjmB,KAAKS,kBACfT,KAAKS,gBAAgBnC,MAAMwV,GAAgBmS,GAGtCjmB,KAAKzB,OAAOC,iBAAiBwB,KAAKS,iBAAiBqT,IAAiB,GAS7EwQ,YAAYhmB,GAMV,OALIA,IACF0B,KAAKkmB,aAAe5nB,EACpBgc,UAAUW,kBAAkBqJ,YAActkB,KAAKkmB,cAG1ClmB,KAAKkmB,cAAgB,YAU9BjL,kBAAkBkL,EAAMC,GA8BtB,OA7BA9L,UAAUW,kBAAoB,CAC5BkL,KAAMA,EACNC,QAASA,EACT9B,YAAatkB,KAAKskB,cAClB+B,WAAY,SAAUC,GACpB,OAAQA,GACN,IAAK,mBAGL,IAAK,iBAGL,IAAK,eAGL,IAAK,eAGL,IAAK,kBACH,OAAO,EAET,IAAK,kBAGL,QACE,OAAO,KAIRhM,UAAUW,kBAGnBsL,UAEEvmB,KAAKoe,oBAKT,EAAIpE,EAAc3O,SAASsP,EAASrU,WACpC,IAAIiM,EAAWoI,EACfpd,EAAQ8N,QAAUkH,G,oCC5xClBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAuFlB,IAAIkH,EA9EJ,MACEvI,YAAYwc,GACVxmB,KAAKwmB,QAAUA,GAAWxmB,KAC1BA,KAAKymB,MAAQ,GAQfC,WACE,IAAK,IAAI/mB,EAAI,EAAGA,EAAIE,UAAUD,SAAUD,EACtC,GAA4B,oBAAjBE,UAAUF,GACnBK,KAAKymB,MAAM5kB,KAAKhC,UAAUF,SAG1B,IAAK,IAAI+f,EAAI,EAAGA,EAAI7f,UAAUF,GAAGC,SAAU8f,EACzC1f,KAAKymB,MAAM5kB,KAAKhC,UAAUF,GAAG+f,IAWrCiH,WAAWtf,GACT,IAAIuf,EAEJ,IAAK,IAAIjnB,EAAI,EAAGA,EAAIK,KAAKymB,MAAM7mB,OAAQD,IAGrC,GAFAinB,EAAO5mB,KAAKymB,MAAM9mB,GAEdinB,IAASvf,EAAM,CACjBrH,KAAKymB,MAAMhjB,OAAO9D,EAAG,GACrB,OAUNknB,UACE,IAAIC,EAAOjnB,UACP2mB,EAAUxmB,KAAKwmB,QACfO,EAAW,GAcf,OAbA/mB,KAAKymB,MAAM9nB,SAAQ,SAAUqoB,GAC3B,IACE,IAAIC,EAAYD,EAAKE,MAAMV,EAASM,GACpC,MAAOK,GACPlV,QAAQC,IAAIiV,GAGVF,GAA0C,oBAAtBA,EAAS,MAE/BF,EAASllB,KAAKolB,MAIXrpB,QAAQwpB,IAAIL,GAIrBM,OACE,OAAOrnB,KAAKymB,MAGda,QACE,OAAOtnB,KAAKymB,MAAQ,KAMxBlpB,EAAQ8N,QAAUkH,G,6BC3FlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,QAAU9N,EAAQgqB,UAAO,EAEjC,IAAIjc,EAAQnD,EAAQ,IAmOpB5K,EAAQgqB,KAvBR,MACEvd,YAAYgd,EAAMF,EAAMN,GACtB,OAAO,WACL,IAAIgB,EAAU3nB,WAAa,GAC3B,OAAO,IAAIjC,SAAQ,CAACC,EAASC,KAU3B0pB,EAAQ3lB,MATO,SAAUrE,EAAO2pB,IACzB3pB,GAAS2pB,EACZrpB,EAAOqpB,GAEPtpB,EAAQL,MAOZwpB,EAAKE,MAAMV,GAAWxmB,KAAMwnB,SAQpC,IAAIjV,EA7NJ,MACEvI,YAAYwc,GACVxmB,KAAKynB,GAAK,GACVznB,KAAKwmB,QAAUA,EACfxmB,KAAK0nB,KAAOpc,EAAMvE,sBAClB/G,KAAK2nB,SAAU,EACf3nB,KAAK4nB,QAAS,EAQhBC,UACE,IAAIhP,EACAiP,EACAd,EAAO,GAAG3Z,MAAMnM,KAAKrB,WACrBinB,EAAOjnB,UAKX,IAAKmnB,EACH,MAAM,IAAInhB,MAAM,oBA6BlB,OAvBEiiB,EAHkB,oBAATd,EAGA,CACP,KAAQA,EACR,KAAQF,EAER,SANFjO,EAAW,IAAIvN,EAAMvL,MAOnB,QANQ8Y,EAAS1Y,SAUV,CACP,QAAW6mB,GAIfhnB,KAAKynB,GAAG5lB,KAAKimB,GAGM,GAAf9nB,KAAK4nB,QAAoB5nB,KAAK2nB,SAGhC3nB,KAAK+nB,MAGAD,EAAO3nB,QAQhB6nB,UACE,IAAIC,EAAQjB,EAAM7oB,EAElB,OAAI6B,KAAKynB,GAAG7nB,QAAWI,KAAK4nB,SAyB1BK,EAAS,IAAI3c,EAAMvL,OACZ8Y,SAAShb,UACToqB,EAAO9nB,UAzBd6mB,GADAiB,EAASjoB,KAAKynB,GAAGpa,SACH2Z,OAIZ7oB,EAAS6oB,EAAKE,MAAMlnB,KAAKwmB,QAASyB,EAAOnB,QAED,oBAAnB3oB,EAAM,KAElBA,EAAO2iB,KAAK,WACjBmH,EAAOpP,SAAShb,QAAQqpB,MAAMlnB,KAAKwmB,QAAS3mB,YAC5C4N,KAAKzN,MAAO,WACZioB,EAAOpP,SAAS/a,OAAOopB,MAAMlnB,KAAKwmB,QAAS3mB,YAC3C4N,KAAKzN,QAGPioB,EAAOpP,SAAShb,QAAQqpB,MAAMlnB,KAAKwmB,QAASroB,GACrC8pB,EAAO9nB,SAEP8nB,EAAO9nB,QAET8nB,EAAO9nB,aAFT,EAYX+nB,OACE,KAAOloB,KAAKynB,GAAG7nB,QACbI,KAAKgoB,UASTD,MAqBE,OApBK/nB,KAAK2nB,UACR3nB,KAAK2nB,SAAU,EACf3nB,KAAKmoB,QAAU,IAAI7c,EAAMvL,OAG3BC,KAAK0nB,KAAKxmB,KAAK3C,QAAQ,KACjByB,KAAKynB,GAAG7nB,OACVI,KAAKgoB,UAAUlH,KAAK,WAClB9gB,KAAK+nB,OACLta,KAAKzN,QAEPA,KAAKmoB,QAAQtqB,UACbmC,KAAK2nB,aAAUjf,MAIA,GAAf1I,KAAK4nB,SACP5nB,KAAK4nB,QAAS,GAGT5nB,KAAKmoB,QAAQhoB,QAQtBioB,QACE,OAAIpoB,KAAK2nB,QACA3nB,KAAK2nB,QAGV3nB,KAAKynB,GAAG7nB,QACVI,KAAK2nB,QAAU3nB,KAAKgoB,UAAUlH,KAAK,WAEjC,OADA9gB,KAAK2nB,aAAUjf,EACR1I,KAAKooB,SACZ3a,KAAKzN,OACAA,KAAK2nB,cALd,EAaFL,QACEtnB,KAAKynB,GAAK,GAQZ7nB,SACE,OAAOI,KAAKynB,GAAG7nB,OAOjByoB,QACEroB,KAAK4nB,QAAS,EAOhBU,OACEtoB,KAAKynB,GAAK,GACVznB,KAAK2nB,SAAU,EACf3nB,KAAK4nB,QAAS,IAwClBrqB,EAAQ8N,QAAUkH,G,6BC1OlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAMlB,IAAIkd,EAAQ,CACV,YAAe,CACb,WAAc,CAAC,KAAM,QACrB,WAAc,KACd,IAAO,MACP,IAAO,MACP,WAAc,CAAC,KAAM,KAAM,MAAO,OAAQ,OAAQ,OAAQ,QAC1D,UAAW,MACX,KAAQ,CAAC,MAAO,QAChB,YAAa,CAAC,QAAS,OACvB,IAAO,CAAC,MAAO,MAAO,MAAO,MAAO,OACpC,IAAO,MACP,gBAAiB,QACjB,UAAW,QACX,UAAW,CAAC,MAAO,QAAS,QAAS,KAAM,KAAM,OAAQ,SACzD,WAAY,IACZ,oBAAqB,CAAC,MAAO,QAC7B,gBAAiB,MACjB,WAAY,OACZ,aAAc,MACd,YAAa,CAAC,MAAO,SACrB,KAAQ,OACR,cAAe,SACf,aAAc,SACd,eAAgB,WAChB,IAAO,OAEP,YAAa,QACb,KAAQ,OACR,mBAAoB,MACpB,OAAU,MAEV,eAAgB,MAChB,oBAAqB,MACrB,aAAc,MACd,qBAAsB,MACtB,mBAAoB,MACpB,aAAc,MACd,aAAc,MACd,aAAc,MACd,aAAc,CAAC,MAAO,OACtB,eAAgB,CAAC,MAAO,MAAO,MAAO,OACtC,cAAe,OACf,qBAAsB,CAAC,MAAO,QAC9B,gBAAiB,MACjB,QAAS,MACT,SAAU,MACV,WAAY,OACZ,UAAW,MACX,YAAa,MACb,WAAY,OACZ,2BAA4B,MAC5B,aAAc,IACd,eAAgB,MAChB,SAAU,MAEZ,MAAS,CACP,KAAQ,OACR,KAAQ,CAAC,MAAO,OAAQ,MAAO,OAC/B,KAAQ,CAAC,OAAQ,QAAS,MAAO,MAAO,MAAO,OAAQ,MAAO,OAC9D,QAAW,MACX,IAAO,CAAC,MAAO,MAAO,OACtB,SAAU,CAAC,MAAO,OAAQ,QAC1B,WAAY,MACZ,QAAS,MACT,MAAS,MACT,IAAO,OACP,KAAQ,OACR,QAAS,MACT,QAAS,MACT,aAAc,MACd,wBAAyB,MACzB,GAAM,KACN,IAAO,CAAC,MAAO,QAEjB,MAAS,CACP,IAAO,MACP,IAAO,MACP,KAAQ,CAAC,OAAQ,MAAO,OACxB,IAAO,MACP,IAAO,MACP,UAAW,CAAC,MAAO,QACnB,KAAQ,CAAC,OAAQ,OACjB,SAAU,MACV,IAAO,MACP,KAAQ,OACR,SAAU,CAAC,MAAO,OAClB,QAAS,MACT,UAAW,OAEb,KAAQ,CACN,iBAAkB,CAAC,WAAY,YAC/B,IAAO,MACP,IAAO,MACP,KAAQ,CAAC,OAAQ,MAAO,QAAS,OACjC,OAAU,MACV,MAAS,CAAC,MAAO,OAAQ,MAAO,OAAQ,MAAO,OAAQ,MAAO,KAAM,OACpE,SAAY,MACZ,uBAAwB,MACxB,WAAY,OAEd,MAAS,CACP,KAAQ,CAAC,OAAQ,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,QAC3D,IAAO,CAAC,MAAO,OAAQ,QACvB,UAAa,CAAC,KAAM,OACpB,IAAO,MACP,cAAe,CAAC,MAAO,OACvB,QAAS,MACT,WAAY,CAAC,MAAO,OACpB,QAAS,MACT,WAAY,CAAC,MAAO,MAAO,OAC3B,UAAW,KACX,WAAY,MACZ,WAAY,MACZ,WAAY,MACZ,YAAa,MACb,cAAe,QACf,aAAc,CAAC,MAAO,MAAO,OAAQ,OACrC,QAAS,MACT,KAAQ,OACR,KAAQ,OACR,KAAQ,OACR,KAAQ,OACR,IAAO,CAAC,MAAO,QACf,IAAO,CAAC,MAAO,QACf,6BAA8B,MAC9B,eAAgB,CAAC,MAAO,QACxB,WAAY,MACZ,KAAQ,OACR,QAAS,MACT,QAAS,MACT,WAAY,MACZ,QAAS,QAITC,EAAY,WACd,IAAI5hB,EACA6hB,EACAC,EACAnf,EACAif,EAAY,GAEhB,IAAK5hB,KAAQ2hB,EACX,GAAIA,EAAM3W,eAAehL,GACvB,IAAK6hB,KAAWF,EAAM3hB,GACpB,GAAI2hB,EAAM3hB,GAAMgL,eAAe6W,GAG7B,GAAkB,iBAFlBC,EAAMH,EAAM3hB,GAAM6hB,IAGhBD,EAAUE,GAAO9hB,EAAO,IAAM6hB,OAE9B,IAAKlf,EAAQ,EAAGA,EAAQmf,EAAI9oB,OAAQ2J,IAClCif,EAAUE,EAAInf,IAAU3C,EAAO,IAAM6hB,EAQjD,OAAOD,EAzBO,GAmChB,IAAIjW,EAAW,CACboW,OANF,SAAgBnT,GACd,OAAOA,GAAYgT,EAAUhT,EAASrI,MAAM,KAAKyb,MAAMhnB,gBAHtC,eAUnBrE,EAAQ8N,QAAUkH,G,6BCvLlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI2O,EAAgB9D,EAAuB/N,EAAQ,KAE/CmD,EAAQnD,EAAQ,IAEhB0gB,EAAQ3S,EAAuB/N,EAAQ,MAEvC8R,EAAW/D,EAAuB/N,EAAQ,KAE1C2gB,EAAS5S,EAAuB/N,EAAQ,MAExC4gB,EAAU7S,EAAuB/N,EAAQ,MAEzC6gB,EAAU9S,EAAuB/N,EAAQ,MAIzC8gB,GAFY/S,EAAuB/N,EAAQ,KAE5B+N,EAAuB/N,EAAQ,OAE9CiS,EAAajS,EAAQ,IAErB+gB,EAAUhT,EAAuB/N,EAAQ,MAEzCghB,EAASjT,EAAuB/N,EAAQ,MAExCihB,EAAUlT,EAAuB/N,EAAQ,MAE7C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GA4BvF,MAAM2pB,EACJrf,YAAYsf,EAAM7M,GAChBzc,KAAK0c,UAAW,EAAIpR,EAAMxK,QAAQd,KAAK0c,UAAY,GAAI,CACrDje,MAAO,KACPC,OAAQ,KACRgN,YAAa,GACb6d,QAAS,UACTC,KAAM,SACNC,KAAM,KACNrF,OAAQ,KACRsF,OAAQ,KACRC,eAAgB,IAChBC,WAAY,KACZC,2BAA2B,EAC3BC,OAAQ,KACRC,MAAM,EACNC,iBAAkB,MAClBC,sBAAsB,KAExB,EAAI3e,EAAMxK,QAAQd,KAAK0c,SAAUD,GAEI,kBAA1Bzc,KAAK0c,SAAS6M,UACvBvpB,KAAKupB,QAAUvpB,KAAK0c,SAAS6M,SAG/BvpB,KAAKspB,KAAOA,EAQZtpB,KAAKymB,MAAQ,GACbzmB,KAAKymB,MAAMyD,QAAU,IAAIrB,EAAMxd,QAAQrL,MACvCA,KAAKymB,MAAM0D,UAAY,IAAItB,EAAMxd,QAAQrL,MACzCA,KAAKymB,MAAMznB,QAAU,IAAI6pB,EAAMxd,QAAQrL,MACvCA,KAAKymB,MAAM2D,SAAW,IAAIvB,EAAMxd,QAAQrL,MACxCA,KAAKymB,MAAMrC,OAAS,IAAIyE,EAAMxd,QAAQrL,MACtCA,KAAKymB,MAAM4D,OAAS,IAAIxB,EAAMxd,QAAQrL,MACtCA,KAAKymB,MAAM6D,KAAO,IAAIzB,EAAMxd,QAAQrL,MACpCA,KAAKymB,MAAMznB,QAAQ0nB,SAAS1mB,KAAKuqB,YAAY9c,KAAKzN,OAClDA,KAAKymB,MAAMznB,QAAQ0nB,SAAS1mB,KAAKwqB,WAAW/c,KAAKzN,OACjDA,KAAKymB,MAAMznB,QAAQ0nB,SAAS1mB,KAAKyqB,aAAahd,KAAKzN,OACnDA,KAAKspB,KAAKoB,MAAMjE,MAAMznB,QAAQ0nB,SAAS1mB,KAAK2qB,iBAAiBld,KAAKzN,OAE9DA,KAAK0c,SAASkN,YAChB5pB,KAAKspB,KAAKoB,MAAMjE,MAAMznB,QAAQ0nB,SAAS1mB,KAAK4qB,iBAAiBnd,KAAKzN,OAGhEA,KAAK0c,SAASoN,QAChB9pB,KAAKspB,KAAKoB,MAAMjE,MAAMznB,QAAQ0nB,SAAS1mB,KAAK6qB,aAAapd,KAAKzN,OAQhEA,KAAK8qB,OAAS,IAAI9B,EAAQ3d,QAAQrL,MAMlCA,KAAK+qB,YAAc,IAAI9B,EAAa5d,QAAQrL,MAC5CA,KAAK8a,QAAU,IAAIb,EAAS5O,QAC5BrL,KAAKmG,EAAI,IAAI2iB,EAAOzd,QAAQrL,MA4B5BA,KAAKuD,cAAWmF,EAEhB1I,KAAKmG,EAAE0hB,QAAQ7nB,KAAKspB,KAAK0B,QACzBhrB,KAAKirB,SAAW,IAAI3f,EAAMvL,MAM1BC,KAAKkrB,QAAUlrB,KAAKirB,SAAS9qB,QAE7BH,KAAKmG,EAAE0hB,QAAQ7nB,KAAK8C,OAQtBqoB,WAAW5B,GACTvpB,KAAKupB,QAAUA,EASjB6B,eAAe7B,GAYb,MATuB,kBAAZA,GAAoC,YAAZA,EACnBJ,EAAO9d,QACO,kBAAZke,GAAoC,eAAZA,EAC1BH,EAAQ/d,QAGRke,EAYlB8B,YAAY7B,GAUV,MAPmB,iBAARA,GAA6B,WAATA,EACtBN,EAAQ7d,QAGRme,EAWX1mB,QAKE,OAJK9C,KAAK0c,SAAS0H,QAAiD,kBAAtCpkB,KAAKspB,KAAKgC,QAAQC,SAASnH,QAAuE,SAAzCpkB,KAAKspB,KAAKkC,eAAeC,cAC9GzrB,KAAK0c,SAAS0H,OAAS,iBAGjBpkB,KAAKspB,KAAKgC,QAAQC,SAAS7B,QACjC,IAAK,OACH1pB,KAAK0c,SAASgN,OAAS,OACvB,MAEF,IAAK,OACH1pB,KAAK0c,SAASgN,QAAS,EAItB1pB,KAAKupB,UACRvpB,KAAK0rB,YAAc1rB,KAAKorB,eAAeprB,KAAK0c,SAAS6M,SACrDvpB,KAAK2rB,KAAO3rB,KAAKqrB,YAAYrrB,KAAK0c,SAAS8M,MAC3CxpB,KAAKupB,QAAU,IAAIvpB,KAAK0rB,YAAY,CAClClC,KAAMxpB,KAAK2rB,KACXC,MAAO5rB,KAAKmG,EACZ0lB,QAAS7rB,KAAKspB,KAAKwC,KAAKre,KAAKzN,KAAKspB,MAClC5M,SAAU1c,KAAK0c,YAInB1c,KAAKglB,UAAUhlB,KAAKspB,KAAKgC,QAAQC,SAASvG,WAAahlB,KAAK0c,SAASsN,kBAErEhqB,KAAK0c,SAASqP,uBAAyB/rB,KAAKgsB,0BAA0BhsB,KAAKspB,KAAKgC,QAAQC,UACxFvrB,KAAKypB,KAAKzpB,KAAK0c,SAASqP,uBAAuBtC,MAC/CzpB,KAAKokB,OAAOpkB,KAAK0c,SAASqP,wBAE1B/rB,KAAKupB,QAAQ0C,GAAG7R,EAAW5H,OAAOa,SAASG,MAAOxT,KAAKksB,eAAeze,KAAKzN,OAC3EA,KAAKupB,QAAQ0C,GAAG7R,EAAW5H,OAAOa,SAASM,QAAS3T,KAAKmsB,aAAa1e,KAAKzN,OAE3EA,KAAKupB,QAAQ0C,GAAG7R,EAAW5H,OAAOa,SAASC,QAAStT,KAAKosB,UAAU3e,KAAKzN,OAExEA,KAAKupB,QAAQ0C,GAAG7R,EAAW5H,OAAOa,SAASE,mBAAoBvT,KAAKqsB,oBAAoB5e,KAAKzN,OAE7FA,KAAKupB,QAAQ0C,GAAG7R,EAAW5H,OAAOa,SAASK,SAAU1T,KAAKssB,eAAe7e,KAAKzN,OAO9EA,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUC,SAEtCtU,KAAKirB,SAASptB,UAUhB0uB,SAAS5lB,GACP,OAAO3G,KAAKmG,EAAE0hB,QAAQ,WAEpB7nB,KAAKupB,QAAQc,OAAO1jB,EAAS,CAC3B,MAAS3G,KAAK0c,SAASje,MACvB,OAAUuB,KAAK0c,SAAShe,SAQ1BsB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUE,WACtC9G,KAAKzN,OAYTkqB,QAAQnpB,GAKN,OAJIf,KAAKwsB,YACPxsB,KAAKwsB,WAAW3uB,UAGXmC,KAAKmG,EAAE0hB,QAAQ7nB,KAAKysB,SAAU1rB,GAUvC0rB,SAAS1rB,GACP,GAAKf,KAAKspB,KAAV,CAIkBtpB,KAAK8a,QAAQxO,YAAYvL,GAA3C,IAGIgW,EAFAyV,EAAa,IAAIlhB,EAAMvL,MACvB2sB,EAAYF,EAAWrsB,QAW3B,OARAH,KAAKwsB,WAAaA,EAEdxsB,KAAKspB,KAAKqD,UAAU/sB,WAAY,EAAI0L,EAAM3H,SAAS5C,KACrDA,EAASf,KAAKspB,KAAKqD,UAAUC,kBAAkB/tB,WAAWkC,MAG5DgW,EAAU/W,KAAKspB,KAAKoB,MAAMmC,IAAI9rB,KAO9Bf,KAAKupB,QAAQW,QAAQnT,EAAShW,GAAQ+f,MAAK,KACzC0L,EAAW3uB,QAAQkZ,GACnB/W,KAAKwsB,gBAAa9jB,EAQlB1I,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUJ,UAAW8C,GACjD/W,KAAKssB,oBACJnF,IAODnnB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUG,cAAe2S,MAEhDuF,IAzBLF,EAAW1uB,OAAO,IAAI+H,MAAM,qBACrB6mB,IAyEXR,eAAe1C,GACbA,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMQ,cAAc,CAAC0Y,EAAU5tB,IAASc,KAAK+sB,iBAAiBD,EAAU5tB,EAAMsqB,EAAK/R,YAC7GzX,KAAKymB,MAAM4D,OAAOxD,QAAQ2C,EAAMxpB,MAAM8gB,MAAK,KACrC0I,EAAK/R,SACPzX,KAAKymB,MAAMznB,QAAQ6nB,QAAQ2C,EAAK/R,SAAUzX,MAAM8gB,MAAK,KAQnD9gB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUL,SAAUwV,EAAKzS,QAASyS,MAGhExpB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUL,SAAUwV,EAAKzS,QAASyS,MAWpE2C,aAAa3C,GACXxpB,KAAKymB,MAAM2D,SAASvD,QAAQ2C,EAAMxpB,MAAM8gB,MAAK,KAQ3C9gB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUV,QAAS6V,EAAKzS,QAASyS,MASjE4C,UAAU/H,EAAMvJ,GASd9a,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUf,QAAS,CAC7C7U,MAAO4lB,EAAK5lB,MACZC,OAAQ2lB,EAAK3lB,QACZoc,GAEC9a,KAAKuD,UAAYvD,KAAKuD,SAAST,OACjC9C,KAAKkqB,QAAQpP,GAAW9a,KAAKuD,SAAST,MAAMuJ,KAShDggB,oBAAoBW,GAOlBhtB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUd,mBAAoByZ,GAS5DC,OAAOjgB,GACLhN,KAAKupB,QAAQ0D,OAAOjgB,GAUtBkgB,OAAOzuB,EAAOC,EAAQoc,GAChBrc,IACFuB,KAAK0c,SAASje,MAAQA,GAGpBC,IACFsB,KAAK0c,SAAShe,OAASA,GAGzBsB,KAAKupB,QAAQ2D,OAAOzuB,EAAOC,EAAQoc,GAOrCwM,QACEtnB,KAAKupB,QAAQjC,QAQf6F,OACE,OAAOntB,KAAKmG,EAAE0hB,QAAQ7nB,KAAKupB,QAAQ4D,KAAK1f,KAAKzN,KAAKupB,UAAUzI,KAAK9gB,KAAKssB,eAAe7e,KAAKzN,OAQ5FotB,OACE,OAAOptB,KAAKmG,EAAE0hB,QAAQ7nB,KAAKupB,QAAQ6D,KAAK3f,KAAKzN,KAAKupB,UAAUzI,KAAK9gB,KAAKssB,eAAe7e,KAAKzN,OAW5FgsB,0BAA0BT,GACxB,IACInH,EAASpkB,KAAK0c,SAAS0H,QAAUmH,EAASnH,QAAU,aACpDsF,EAAS1pB,KAAK0c,SAASgN,QAAU6B,EAAS7B,QAAU,OACpDsD,EAAchtB,KAAK0c,SAASsQ,aAAezB,EAASyB,aAAe,OACnEvD,EAAOzpB,KAAK0c,SAAS+M,MAAQ8B,EAAS9B,MAAQ,OAC9CjN,EAAW+O,EAAS/O,UAAY,GAChCmN,EAAiB3pB,KAAK0c,SAASiN,gBAAkB4B,EAAS5B,gBAAkB,IAC5E3E,EAAYhlB,KAAK0c,SAASsI,WAAauG,EAASvG,WAAa,MAcjE,OAZ6B,IAAxBhlB,KAAK0c,SAASje,OAAeuB,KAAK0c,SAASje,MAAQ,KAAgC,IAAzBuB,KAAK0c,SAAShe,QAAgBsB,KAAK0c,SAAShe,QAG9F,CACX0lB,OAAQA,EACRsF,OAAQA,EACRsD,YAAaA,EACbvD,KAAMA,EACNjN,SAAUA,EACVmN,eAAgBA,EAChB3E,UAAWA,GAWfyE,KAAKA,GACH,IAAI4D,EAAQ5D,EAEC,aAATA,GAAgC,iBAATA,GAAoC,wBAATA,IACpD4D,EAAQ,YAGG,SAAT5D,GAA4B,cAATA,IACrB4D,EAAQ,aAGVrtB,KAAK0c,SAAS+M,KAAOA,EAEjBzpB,KAAK+oB,SACP/oB,KAAK+oB,QAAQU,KAAK4D,GAGhBrtB,KAAKupB,SAAWvpB,KAAK+oB,SACvB/oB,KAAKupB,QAAQ+D,YAAYttB,KAAK+oB,SAG5B/oB,KAAKupB,SACPvpB,KAAKupB,QAAQgE,WAAWF,GAGtBrtB,KAAKupB,SAAWvpB,KAAKupB,QAAQiE,cAAgBxtB,KAAKuD,WACpDvD,KAAKupB,QAAQjC,QACbtnB,KAAKkqB,QAAQlqB,KAAKuD,SAAST,MAAMuJ,MASrC+X,OAAO1H,GAgBL,OAfIA,IACF1c,KAAK+oB,QAAU,IAAIA,EAAQ1d,QAAQqR,GAEnC1c,KAAK+oB,QAAQW,OAAOhN,EAASgN,OAAQ1pB,KAAK0c,SAASiN,gBAGnD3pB,KAAK+oB,QAAQkD,GAAG7R,EAAW5H,OAAOmC,OAAOC,SAAS,CAAC1O,EAAOunB,KACxDztB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUM,OAAQzO,EAAOunB,OAIrDztB,KAAKupB,SAAWvpB,KAAK+oB,SACvB/oB,KAAKupB,QAAQ+D,YAAYttB,KAAK+oB,SAGzB/oB,KAAK+oB,QASdW,OAAOA,EAAQgE,GACb1tB,KAAK0c,SAASgN,OAASA,EAEnBgE,IACF1tB,KAAK0c,SAASiN,eAAiB+D,GAG7B1tB,KAAK+oB,SACP/oB,KAAK+oB,QAAQW,OAAOA,EAAQgE,GAG1B1tB,KAAKupB,SAAWvpB,KAAKupB,QAAQiE,cAC/BxtB,KAAKupB,QAAQoE,eASjB3I,UAAUzP,GACRvV,KAAK0c,SAASsI,UAAYzP,GAAO,MAE7BvV,KAAKupB,SACPvpB,KAAKupB,QAAQvE,UAAUhlB,KAAK0c,SAASsI,WAGnChlB,KAAKupB,SAAWvpB,KAAKupB,QAAQiE,cAAgBxtB,KAAKuD,WACpDvD,KAAKupB,QAAQjC,QACbtnB,KAAKkqB,QAAQlqB,KAAKuD,SAAST,MAAMuJ,MAUrCigB,iBACE,OAAOtsB,KAAKmG,EAAE0hB,QAAQ,WACpB9gB,sBAAsB,WACpB,IAAIxD,EAAWvD,KAAKupB,QAAQqE,kBAE5B,GAAIrqB,GAAYA,EAASud,MAAiC,oBAAlBvd,EAASud,KAC/Cvd,EAASud,KAAK,SAAU3iB,GACtB,IAAI0vB,EAAU7tB,KAAK6tB,QAAQ1vB,GAEtB0vB,GAAYA,EAAQ/qB,OAAU+qB,EAAQ9qB,MAI3C/C,KAAKuD,SAAWsqB,EAChB7tB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUI,iBAAkB,CACtDlL,MAAOvJ,KAAKuD,SAAST,MAAMyG,MAC3BgN,KAAMvW,KAAKuD,SAAST,MAAMyT,KAC1BzT,MAAO9C,KAAKuD,SAAST,MAAMuJ,IAC3BtJ,IAAK/C,KAAKuD,SAASR,IAAIsJ,IACvByhB,WAAY9tB,KAAKuD,SAAST,MAAMgrB,aAElC9tB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUK,UAAW1U,KAAKuD,YACtDkK,KAAKzN,YACF,GAAIuD,EAAU,CACnB,IAAIsqB,EAAU7tB,KAAK6tB,QAAQtqB,GAE3B,IAAKsqB,IAAYA,EAAQ/qB,QAAU+qB,EAAQ9qB,IACzC,OAGF/C,KAAKuD,SAAWsqB,EAahB7tB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUI,iBAAkB,CACtDlL,MAAOvJ,KAAKuD,SAAST,MAAMyG,MAC3BgN,KAAMvW,KAAKuD,SAAST,MAAMyT,KAC1BzT,MAAO9C,KAAKuD,SAAST,MAAMuJ,IAC3BtJ,IAAK/C,KAAKuD,SAASR,IAAIsJ,IACvByhB,WAAY9tB,KAAKuD,SAAST,MAAMgrB,aAQlC9tB,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUK,UAAW1U,KAAKuD,YAExDkK,KAAKzN,QACPyN,KAAKzN,OAQT4tB,kBACE,IAAIrqB,EAAWvD,KAAKupB,QAAQqE,kBAE5B,GAAIrqB,GAAYA,EAASud,MAAiC,oBAAlBvd,EAASud,KAC/Cvd,EAASud,KAAK,SAAU3iB,GAEtB,OADc6B,KAAK6tB,QAAQ1vB,IAE3BsP,KAAKzN,YACF,GAAIuD,EAAU,CAEnB,OADcvD,KAAK6tB,QAAQtqB,IAY/BsqB,QAAQtqB,GACN,IAAKA,EAAS3D,OACZ,MAAO,GAGT,IAAIkD,EAAQS,EAAS,GACjBR,EAAMQ,EAASA,EAAS3D,OAAS,GACjCiuB,EAAU,CACZ/qB,MAAO,CACLyG,MAAOzG,EAAMyG,MACbgN,KAAMzT,EAAMyT,KACZlK,IAAKvJ,EAAMirB,QAAQjrB,MACnB4pB,UAAW,CACT1G,KAAMljB,EAAMkrB,MAAM,IAAM,EACxBC,MAAOnrB,EAAMorB,aAGjBnrB,IAAK,CACHwG,MAAOxG,EAAIwG,MACXgN,KAAMxT,EAAIwT,KACVlK,IAAKtJ,EAAIgrB,QAAQhrB,IACjB2pB,UAAW,CACT1G,KAAMjjB,EAAIirB,MAAMjrB,EAAIirB,MAAMpuB,OAAS,IAAM,EACzCquB,MAAOlrB,EAAImrB,cAIbC,EAAgBnuB,KAAKspB,KAAKqD,UAAUyB,gBAAgBtrB,EAAMirB,QAAQjrB,OAClEurB,EAAcruB,KAAKspB,KAAKqD,UAAUyB,gBAAgBrrB,EAAIgrB,QAAQhrB,KAE7C,MAAjBorB,IACFN,EAAQ/qB,MAAMS,SAAW4qB,EACzBN,EAAQ/qB,MAAMgrB,WAAa9tB,KAAKspB,KAAKqD,UAAU2B,uBAAuBH,IAGrD,MAAfE,IACFR,EAAQ9qB,IAAIQ,SAAW8qB,EACvBR,EAAQ9qB,IAAI+qB,WAAa9tB,KAAKspB,KAAKqD,UAAU2B,uBAAuBD,IAGtE,IAAIE,EAAYvuB,KAAKspB,KAAKkF,SAASC,YAAY3rB,EAAMirB,QAAQjrB,OACzD4rB,EAAU1uB,KAAKspB,KAAKkF,SAASC,YAAY1rB,EAAIgrB,QAAQhrB,KAkBzD,OAhBkB,GAAdwrB,IACFV,EAAQ/qB,MAAMkjB,KAAOuI,IAGP,GAAZG,IACFb,EAAQ9qB,IAAIijB,KAAO0I,GAGjB3rB,EAAIwG,QAAUvJ,KAAKspB,KAAKoB,MAAMiE,OAAOplB,OAASskB,EAAQ9qB,IAAI2pB,UAAU1G,MAAQ6H,EAAQ9qB,IAAI2pB,UAAUuB,QACpGJ,EAAQe,OAAQ,GAGd9rB,EAAMyG,QAAUvJ,KAAKspB,KAAKoB,MAAMmE,QAAQtlB,OAA0C,IAAjCskB,EAAQ/qB,MAAM4pB,UAAU1G,OAC3E6H,EAAQiB,SAAU,GAGbjB,EAOTtH,UAIEvmB,KAAKupB,SAAWvpB,KAAKupB,QAAQhD,UAC7BvmB,KAAKspB,UAAO5gB,EAqBd8hB,WAAW/S,GACT2C,EAAW1H,WAAW/T,SAAQwT,IAC5BsF,EAASwU,GAAG9Z,GAAG4c,GAAM/uB,KAAKgvB,iBAAiBD,EAAItX,QAGjDA,EAASwU,GAAG7R,EAAW5H,OAAOK,SAASG,UAAUb,GAAKnS,KAAK6jB,qBAAqB1R,EAAGsF,KASrFuX,iBAAiB7c,EAAGsF,GAClBzX,KAAK0d,KAAKvL,EAAEvL,KAAMuL,EAAGsF,GASvBoM,qBAAqBC,EAAUrM,GAQ7BzX,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUrB,SAAU8Q,EAAUrM,GAS5DsV,iBAAiBD,EAAU5tB,EAAMuY,GAS/BzX,KAAK0d,KAAKtD,EAAW5H,OAAO6B,UAAUD,aAAc0Y,EAAU5tB,EAAMuY,GAUtE7K,SAASP,EAAKX,GACZ,IAAIuY,EAAO,IAAIhK,EAAS5O,QAAQgB,GAE5B4iB,EAAQjvB,KAAKupB,QAAQ2F,UAAU3oB,QAAO,SAAUijB,GAClD,GAAIvF,EAAKrY,WAAa4d,EAAKjgB,MAAO,OAAO,KAG3C,GAAI0lB,EAAMrvB,OACR,OAAOqvB,EAAM,GAAGxX,SAAS5L,MAAMoY,EAAMvY,GAUzC+e,aAAahT,GACX,GAA0B,kBAAtBzX,KAAK+oB,QAAQ5C,KACf,OAAO,IAAIvoB,SAAQ,SAAUC,GAC3BA,OAIJ,IAAIsxB,EAAW1X,EAASlZ,OAAOC,iBAAiBiZ,EAASzY,QAAS,MAC9DN,EAAoH,KAA1G+Y,EAASzY,QAAQ6B,cAAgBhC,WAAWswB,EAASC,YAAcvwB,WAAWswB,EAASE,iBACjGC,EAAoBzwB,WAAWswB,EAASI,aAAe1wB,WAAWswB,EAASK,cAiB/E,OAhBA/X,EAASsK,mBAAmB,CAC1B,IAAO,CACL,aAAc/hB,KAAK+oB,QAAQvE,YAAcxkB,KAAK+oB,QAAQvE,YAAc8K,EAAoB,KAAO,QAAU,aACzG,aAAc5wB,iBACd,aAAc,UACd,oBAAqB,QACrB,eAAgB,QAChB,aAAc,cAEhB,IAAO,CACL,aAAcsB,KAAK+oB,QAAQvE,YAAcxkB,KAAK+oB,QAAQvE,YAAc8K,EAAoB,KAAO,QAAU,aACzG,aAAc5wB,iBACd,oBAAqB,QACrB,eAAgB,WAGb,IAAId,SAAQ,SAAUC,EAASC,GAEpC+gB,YAAW,WACThhB,MACC,MASP4xB,cACE,OAAOzvB,KAAKupB,QAAUvpB,KAAKupB,QAAQkG,cAAgB,GAQrDC,QAEE,OADY1vB,KAAKupB,QAAUvpB,KAAKupB,QAAQmG,WAAQhnB,IAChC,GASlB6hB,YAAY9S,GACNA,GACFA,EAASwU,GAAG7R,EAAW5H,OAAOK,SAASK,cAAcqD,IACnD,IAAIV,EAAW7V,KAAKspB,KAAKxd,KAAK+J,SAASU,GACvCvW,KAAKkqB,QAAQrU,MAanB+U,iBAAiBvmB,EAAK0S,GACpB,IAAIzY,EAAQ+F,EAAI4S,cAAc,QAC9B3Y,EAAM6Y,aAAa,OAAQ,YAC3B7Y,EAAM6Y,aAAa,MAAO,cAC1B7Y,EAAM6Y,aAAa,OAAQnX,KAAK0c,SAASkN,YACzCvlB,EAAI0B,qBAAqB,QAAQ,GAAGwR,YAAYjZ,GAWlDusB,aAAaxmB,EAAK0S,GAChB,IAAI+S,EAASzlB,EAAI4S,cAAc,UAC/B6S,EAAO3S,aAAa,OAAQ,mBAC5B2S,EAAO3S,aAAa,MAAOnX,KAAK0c,SAASoN,QACzCA,EAAO5e,YAAc,IAErB7G,EAAI0B,qBAAqB,QAAQ,GAAGwR,YAAYuS,GAWlDa,iBAAiBtmB,EAAK0S,GACpB,IAAI4Y,EAAQ3vB,KAAKspB,KAAKsG,UAAUrE,SAASsE,WACrC3X,EAAO7T,EAAI4S,cAAc,QAC7BiB,EAAKf,aAAa,OAAQ,wBAEtBwY,GACFzX,EAAKf,aAAa,UAAWwY,GAG/BtrB,EAAI0B,qBAAqB,QAAQ,GAAGwR,YAAYW,KAMpD,EAAI8B,EAAc3O,SAASge,EAAU/iB,WACrC,IAAIiM,EAAW8W,EACf9rB,EAAQ8N,QAAUkH,G,6BC/iClBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI2O,EAAgB9D,EAAuB/N,EAAQ,KAE/CmD,EAAQnD,EAAQ,IAEhB2nB,EAAc5Z,EAAuB/N,EAAQ,MAE7C+R,EAAWhE,EAAuB/N,EAAQ,MAE1C2gB,EAAS5S,EAAuB/N,EAAQ,MAExC4nB,EAAS7Z,EAAuB/N,EAAQ,MAExC6nB,EAAS9Z,EAAuB/N,EAAQ,MAExCiS,EAAajS,EAAQ,IAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,MAAMuwB,EACJjmB,YAAYyS,GACVzc,KAAKmmB,KAAO,UACZnmB,KAAKkwB,aAAezT,EAAQC,SAC5B1c,KAAK2rB,KAAOlP,EAAQ+M,KACpBxpB,KAAK6rB,QAAUpP,EAAQoP,QACvB7rB,KAAKmwB,eAAiB1T,EAAQmP,MAC9B5rB,KAAKmG,EAAI,IAAI2iB,EAAOzd,QAAQrL,MAC5BA,KAAK0c,UAAW,EAAIpR,EAAMxK,QAAQd,KAAK0c,UAAY,GAAI,CACrD0T,UAAU,EACVC,QAAQ,EACR5xB,WAAOiK,EACPhK,YAAQgK,EACRoc,UAAMpc,EACNqc,iBAAarc,EACb+gB,KAAM,WACN/d,YAAa,GACb4kB,cAAU5nB,EACVuhB,sBAAsB,KAExB,EAAI3e,EAAMxK,QAAQd,KAAK0c,SAAUD,EAAQC,UAAY,IACrD1c,KAAKuwB,aAAe,CAClB7kB,YAAa1L,KAAK0c,SAAShR,YAC3BoZ,KAAM9kB,KAAK0c,SAASoI,KACpB2E,KAAMzpB,KAAK0c,SAAS+M,KACpBrF,OAAQpkB,KAAKokB,OACboM,OAAQxwB,KAAK0c,SAAS8T,OAEtB/xB,MAAO,EACPC,OAAQ,EACR+xB,gBAAgB,EAChBxG,qBAAsBjqB,KAAK0c,SAASuN,sBAEtCjqB,KAAK0wB,UAAW,EAGlBrG,OAAO1jB,EAAS0d,GACd,IAAIsM,EAAMhqB,EAAQxE,QAEoB,qBAA3BnC,KAAK0c,SAAS4T,WAA4BK,GAA6B,QAArBA,EAAI/uB,eAAgD,QAArB+uB,EAAI/uB,gBAC9F5B,KAAK0c,SAAS4T,UAAW,GAGvBtwB,KAAK0c,SAAS4T,WAChBtwB,KAAK0c,SAASV,SAAW,UACzBhc,KAAKgc,SAAWhc,KAAK0c,SAASV,UAGhChc,KAAK0c,SAAS2H,KAAOA,EACrBrkB,KAAK0c,SAASkU,eAAgB,EAAId,EAAYzkB,WAE9CrL,KAAK6wB,MAAQ,IAAId,EAAO1kB,QAAQ,CAC9B5M,MAAO4lB,EAAK5lB,MACZC,OAAQ2lB,EAAK3lB,OACbsd,SAAUhc,KAAKgc,SACfqU,OAAQrwB,KAAK0c,SAAS2T,OACtBvL,KAAM9kB,KAAK0c,SAASoI,KACpBwL,SAAUtwB,KAAK0c,SAAS4T,SACxBtL,UAAWhlB,KAAK0c,SAASsI,YAE3BhlB,KAAK6wB,MAAMtE,SAAS5lB,GAEpB3G,KAAK+Q,UAAY/Q,KAAK6wB,MAAMC,eAE5B9wB,KAAK0vB,MAAQ,IAAIM,EAAO3kB,QAAQrL,KAAK+Q,WAErC/Q,KAAK+wB,QAAU/wB,KAAKlB,SACpBkB,KAAKgxB,WAAahxB,KAAK6wB,MAAMxM,OAE7BrkB,KAAKuwB,aAAa9xB,MAAQuB,KAAKgxB,WAAWvyB,MAC1CuB,KAAKuwB,aAAa7xB,OAASsB,KAAKgxB,WAAWtyB,OAG3CsB,KAAK6wB,MAAMjS,SAAS5e,KAAKosB,UAAU3e,KAAKzN,OACxCA,KAAK6wB,MAAMxE,oBAAoBrsB,KAAKqsB,oBAAoB5e,KAAKzN,OAE7DA,KAAK6d,oBAGD7d,KAAKokB,QACPpkB,KAAK2tB,eAGP3tB,KAAK0wB,UAAW,EAGlB7S,oBACE,IAAIoT,EACJ1yB,OAAOugB,iBAAiB,SAAU,SAAU3M,GAC1CnS,KAAKumB,WACL9Y,KAAKzN,OAKLixB,EAHGjxB,KAAK0c,SAAS4T,SAGN/xB,OAFAyB,KAAK+Q,UAKlB/Q,KAAKkxB,UAAYlxB,KAAKmxB,SAAS1jB,KAAKzN,MACpCixB,EAASnS,iBAAiB,SAAU9e,KAAKkxB,WAG3C7S,wBAGOre,KAAK0c,SAAS4T,SAGN/xB,OAFAyB,KAAK+Q,WAKTwS,oBAAoB,SAAUvjB,KAAKkxB,WAC5ClxB,KAAKkxB,eAAYxoB,EAGnB6d,UACE9H,aAAaze,KAAKoxB,oBAClB3S,aAAaze,KAAKqxB,eAClB5S,aAAaze,KAAKsxB,eAClBtxB,KAAKsnB,QACLtnB,KAAKqe,uBACLre,KAAK6wB,MAAMtK,UACXvmB,KAAK0wB,UAAW,EAWlBrE,oBAAoBla,GAClB,IAAI,YACF6a,GACEzuB,OAEAyB,KAAKkwB,aAAarG,2BACpB7pB,KAAKktB,SAQPzO,aAAaze,KAAKoxB,oBAClBpxB,KAAKoxB,mBAAqBvS,WAAW,WACnC7e,KAAKoxB,wBAAqB1oB,EAEtB1I,KAAKkwB,aAAarG,2BACpB7pB,KAAKktB,SAGPltB,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASE,mBAAoByZ,IACzDvf,KAAKzN,MAAO,KAGhBosB,UAAUja,GACRnS,KAAKktB,SAGPA,OAAOzuB,EAAOC,EAAQoc,GACpB,IAAIyW,EAAYvxB,KAAK6wB,MAAMxM,KAAK5lB,EAAOC,GAGvCsB,KAAKwxB,WAAY,EAAIlmB,EAAM1D,gBAEvB5H,KAAKoxB,oBAAsBpxB,KAAKwxB,UAAU/yB,QAAUuB,KAAKwxB,UAAU9yB,OAErEsB,KAAKgxB,gBAAatoB,EAIhB1I,KAAKgxB,YAAchxB,KAAKgxB,WAAWvyB,QAAU8yB,EAAU9yB,OAASuB,KAAKgxB,WAAWtyB,SAAW6yB,EAAU7yB,SAKzGsB,KAAKgxB,WAAaO,EAClBvxB,KAAK+wB,QAAU/wB,KAAKlB,SAEpBkB,KAAKsnB,QAELtnB,KAAKuwB,aAAa9xB,MAAQuB,KAAKgxB,WAAWvyB,MAC1CuB,KAAKuwB,aAAa7xB,OAASsB,KAAKgxB,WAAWtyB,OAC3CsB,KAAK2tB,eACL3tB,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASC,QAAS,CAC5C7U,MAAOuB,KAAKgxB,WAAWvyB,MACvBC,OAAQsB,KAAKgxB,WAAWtyB,QACvBoc,IAGL2W,WAAW1a,EAAS2a,GAClB,OAAO,IAAI1xB,KAAK2rB,KAAK5U,GAAS,EAAIzL,EAAMxK,QAAQd,KAAKuwB,aAAc,CACjEmB,gBAIJC,uBAAuBD,EAAY3a,EAAS6a,GAC1C,IAAIzE,EAEJ,GAAyB,kBAArBntB,KAAKokB,OAAO+B,MAA4BnmB,KAAKokB,OAAOyN,QAAU,EAAG,CACnE,GAAIH,GAAgC,IAAlB3a,EAAQxN,MAExB,OAKF,GAFA4jB,EAAOpW,EAAQoW,OAEXA,IAASA,EAAKxH,WAAWC,SAAS,oBACpC,OAAOgM,EAAO1wB,KAAKlB,KAAMmtB,IAK/BjD,QAAQnT,EAAShW,GACf,IAAIyrB,EAAa,IAAIlhB,EAAMvL,MACvB2sB,EAAYF,EAAWrsB,SAEvBY,IAAWgW,EAAQR,OAAQ,EAAIjL,EAAMxH,UAAU/C,MACjDA,OAAS2H,GAIX,IAAIwmB,EAAUlvB,KAAK0vB,MAAMoC,KAAK/a,GAE9B,GAAImY,GAAWnY,GAAgC,kBAArB/W,KAAKokB,OAAO+B,KAA0B,CAC9D,IAAInZ,EAASkiB,EAAQliB,SAErB,GAAgC,QAA5BhN,KAAK0c,SAASsI,UAChBhlB,KAAKwd,SAASxQ,EAAOhF,KAAMgF,EAAOjF,KAAK,OAClC,CACL,IAAItJ,EAAQywB,EAAQzwB,QACpBuB,KAAKwd,SAASxQ,EAAOhF,KAAOvJ,EAAOuO,EAAOjF,KAAK,GAGjD,GAAIhH,EAAQ,CACV,IAAIiM,EAASkiB,EAAQ1rB,WAAWzC,GAC5BtC,EAAQywB,EAAQzwB,QACpBuB,KAAKitB,OAAOjgB,EAAQvO,GAItB,OADA+tB,EAAW3uB,UACJ6uB,EAIT1sB,KAAKsnB,QACL,IAAIoK,GAAa,EA2BjB,MAzByB,kBAArB1xB,KAAKokB,OAAO+B,MAAoD,IAAxBnmB,KAAKokB,OAAOyN,SAAiB9a,EAAQ4O,WAAWC,SAAS,uBACnG8L,GAAa,GAGf1xB,KAAKgjB,IAAIjM,EAAS2a,GAAY5Q,KAAK,SAAU0I,GAE3C,GAAIzoB,EAAQ,CACV,IAAIiM,EAASwc,EAAKhmB,WAAWzC,GACzBtC,EAAQ+qB,EAAK/qB,QACjBuB,KAAKitB,OAAOjgB,EAAQvO,KAEtBgP,KAAKzN,OAAOmnB,IACZqF,EAAW1uB,OAAOqpB,MACjBrG,KAAK,WACN,OAAO9gB,KAAK2xB,uBAAuBD,EAAY3a,EAAS/W,KAAKgjB,MAC7DvV,KAAKzN,OAAO8gB,KAAK,WACjB9gB,KAAK0vB,MAAMpF,OACXkC,EAAW3uB,WACX4P,KAAKzN,OAOA0sB,EAGTR,eAAe1C,GACbxpB,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASG,MAAOgW,GAG9CuI,aAAavI,GACXxpB,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASN,OAAQyW,EAAKzS,SAGpDkW,OAAOjgB,EAAQvO,GACb,IAAIuzB,EAAQ,EACRC,EAAQ,EAEPjyB,KAAKkyB,cAGRF,EAAQ1xB,KAAK0D,MAAMgJ,EAAOhF,KAAOhI,KAAKokB,OAAO+N,OAASnyB,KAAKokB,OAAO+N,OAEtDnyB,KAAKokB,OAAO+N,MAAQnyB,KAAK+Q,UAAUgL,cAC7CiW,EAAQhyB,KAAK+Q,UAAUgL,YAAc/b,KAAKokB,OAAO+N,QAGnDF,EAAQ3xB,KAAK0D,MAAMgJ,EAAOjF,IAAM/H,KAAKokB,OAAO+N,OAASnyB,KAAKokB,OAAO+N,OAErDnyB,KAAKokB,OAAO+N,MAAQnyB,KAAK+Q,UAAUnQ,eAC7CqxB,EAAQjyB,KAAK+Q,UAAUnQ,aAAeZ,KAAKokB,OAAO+N,QAXpDF,EAAQjlB,EAAOjF,IAee,QAA5B/H,KAAK0c,SAASsI,YAMhBgN,GAAgBhyB,KAAKokB,OAAO+N,MAC5BH,GAAgBvzB,GAGlBuB,KAAKwd,SAASwU,EAAOC,GAAO,GAG9BjP,IAAIjM,EAAS2a,GACX,IAAIlI,EAAOxpB,KAAKyxB,WAAW1a,EAAS2a,GAWpC,OAVA1xB,KAAK0vB,MAAM0C,OAAO5I,GAElBA,EAAK6I,YAAcryB,KAAKksB,eAAeze,KAAKzN,MAC5CwpB,EAAK5K,SAAW5e,KAAK+xB,aAAatkB,KAAKzN,MACvCwpB,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMC,MAAMiR,IACpC9kB,KAAKsyB,WAAWxN,MAElB0E,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAME,cAAcmS,IAC5CjmB,KAAKuyB,kBAAkBtM,MAElBuD,EAAKU,QAAQlqB,KAAK6rB,SAG3BuG,OAAOrb,EAAS2a,GACd,IAAIlI,EAAOxpB,KAAKyxB,WAAW1a,EAAS2a,GAUpC,OATA1xB,KAAK0vB,MAAM0C,OAAO5I,GAClBA,EAAK6I,YAAcryB,KAAKksB,eAAeze,KAAKzN,MAC5CwpB,EAAK5K,SAAW5e,KAAK+xB,aAAatkB,KAAKzN,MACvCwpB,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMC,MAAMiR,IACpC9kB,KAAKsyB,WAAWxN,MAElB0E,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAME,cAAcmS,IAC5CjmB,KAAKuyB,kBAAkBtM,MAElBuD,EAAKU,QAAQlqB,KAAK6rB,SAG3B2G,QAAQzb,EAAS2a,GACf,IAAIlI,EAAOxpB,KAAKyxB,WAAW1a,EAAS2a,GAapC,OAZAlI,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMN,SAASxU,IACvCkB,KAAKyyB,QAAQ3zB,MAEfkB,KAAK0vB,MAAM8C,QAAQhJ,GACnBA,EAAK6I,YAAcryB,KAAKksB,eAAeze,KAAKzN,MAC5CwpB,EAAK5K,SAAW5e,KAAK+xB,aAAatkB,KAAKzN,MACvCwpB,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMC,MAAMiR,IACpC9kB,KAAKsyB,WAAWxN,MAElB0E,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAME,cAAcmS,IAC5CjmB,KAAKuyB,kBAAkBtM,MAElBuD,EAAKU,QAAQlqB,KAAK6rB,SAG3B4G,QAAQ3zB,GACqB,aAAvBkB,KAAK0c,SAASoI,KAChB9kB,KAAK0yB,SAAS,EAAG5zB,EAAO6zB,aAAa,GAErC3yB,KAAK0yB,SAAS5zB,EAAO8zB,WAAY,GAAG,GAaxCzF,OACE,IAAIA,EAEJ,IAAI5X,EAAMvV,KAAK0c,SAASsI,UACxB,GAAKhlB,KAAK0vB,MAAM9vB,OAAhB,CAEA,IAAII,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,MAA2BvP,GAAe,QAARA,EASjE,GAAIvV,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,MAAiC,QAARvP,EACpEvV,KAAK6yB,WAAa7yB,KAAK+Q,UAAU8hB,WAEG,YAAhC7yB,KAAK0c,SAASkU,cACT5wB,KAAK+Q,UAAU8hB,WAEX,EACT7yB,KAAK0yB,SAAS1yB,KAAKokB,OAAO+N,MAAO,GAAG,GAEpChF,EAAOntB,KAAK0vB,MAAMf,OAAO5X,QAAQoW,OAG5BntB,KAAK+Q,UAAU8hB,YAAkC,EAArB7yB,KAAKokB,OAAO+N,OAEN,EAA9BnyB,KAAK+Q,UAAUgL,YACxB/b,KAAK0yB,SAAS1yB,KAAKokB,OAAO+N,MAAO,GAAG,GAEpChF,EAAOntB,KAAK0vB,MAAMf,OAAO5X,QAAQoW,YAGhC,GAAIntB,KAAKkyB,aAAsC,aAAvBlyB,KAAK0c,SAASoI,KAAqB,CAChE9kB,KAAK8yB,UAAY9yB,KAAK+Q,UAAU+hB,UACtB9yB,KAAK+Q,UAAU+hB,UAAY9yB,KAAK+Q,UAAUlQ,aAE1Cb,KAAK+Q,UAAUnQ,aACvBZ,KAAK0yB,SAAS,EAAG1yB,KAAKokB,OAAO1lB,QAAQ,GAErCyuB,EAAOntB,KAAK0vB,MAAMf,OAAO5X,QAAQoW,YAGnCA,EAAOntB,KAAK0vB,MAAMf,OAAO5X,QAAQoW,YAtCjCntB,KAAK6yB,WAAa7yB,KAAK+Q,UAAU8hB,WAC1B7yB,KAAK+Q,UAAU8hB,WAAa7yB,KAAK+Q,UAAUgiB,YAAc/yB,KAAKokB,OAAO+N,OAEhEnyB,KAAK+Q,UAAUgL,YACzB/b,KAAK0yB,SAAS1yB,KAAKokB,OAAO+N,MAAO,GAAG,GAEpChF,EAAOntB,KAAK0vB,MAAMf,OAAO5X,QAAQoW,OAmCrC,GAAIA,EAAM,CACRntB,KAAKsnB,QAELtnB,KAAK2tB,eACL,IAAI+D,GAAa,EAMjB,MAJyB,kBAArB1xB,KAAKokB,OAAO+B,MAAoD,IAAxBnmB,KAAKokB,OAAOyN,SAAiB1E,EAAKxH,WAAWC,SAAS,uBAChG8L,GAAa,GAGR1xB,KAAKoyB,OAAOjF,EAAMuE,GAAY5Q,KAAK,WACxC,OAAO9gB,KAAK2xB,uBAAuBD,EAAYvE,EAAMntB,KAAKoyB,SAC1D3kB,KAAKzN,OAAOmnB,GACLA,IACNrG,KAAK,WAED9gB,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,MAAqD,QAA5B9kB,KAAK0c,SAASsI,WAAuD,YAAhChlB,KAAK0c,SAASkU,eACjH5wB,KAAKwd,SAASxd,KAAK+Q,UAAUgL,YAAa,GAAG,GAG/C/b,KAAK0vB,MAAMpF,QACX7c,KAAKzN,SAIXotB,OACE,IAAIA,EAEJ,IAAI7X,EAAMvV,KAAK0c,SAASsI,UACxB,GAAKhlB,KAAK0vB,MAAM9vB,OAAhB,CAEA,IAAII,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,MAA2BvP,GAAe,QAARA,EASjE,GAAIvV,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,MAAiC,QAARvP,EACpEvV,KAAK6yB,WAAa7yB,KAAK+Q,UAAU8hB,WAEG,YAAhC7yB,KAAK0c,SAASkU,cACT5wB,KAAK+Q,UAAU8hB,WAAa7yB,KAAK+Q,UAAUgiB,YAEvC/yB,KAAK+Q,UAAUgL,YACxB/b,KAAK0yB,UAAU1yB,KAAKokB,OAAO+N,MAAO,GAAG,GAErC/E,EAAOptB,KAAK0vB,MAAMb,QAAQ9X,QAAQqW,OAG7BptB,KAAK+Q,UAAU8hB,WAEX,EACT7yB,KAAK0yB,UAAU1yB,KAAKokB,OAAO+N,MAAO,GAAG,GAErC/E,EAAOptB,KAAK0vB,MAAMb,QAAQ9X,QAAQqW,YAGjC,GAAIptB,KAAKkyB,aAAsC,aAAvBlyB,KAAK0c,SAASoI,KAAqB,CAChE9kB,KAAK8yB,UAAY9yB,KAAK+Q,UAAU+hB,UACtB9yB,KAAK+Q,UAAU+hB,UAEf,EACR9yB,KAAK0yB,SAAS,GAAI1yB,KAAKokB,OAAO1lB,QAAQ,GAEtC0uB,EAAOptB,KAAK0vB,MAAMb,QAAQ9X,QAAQqW,YAGpCA,EAAOptB,KAAK0vB,MAAMb,QAAQ9X,QAAQqW,YAtClCptB,KAAK6yB,WAAa7yB,KAAK+Q,UAAU8hB,WAC1B7yB,KAAK+Q,UAAU8hB,WAEX,EACT7yB,KAAK0yB,UAAU1yB,KAAKokB,OAAO+N,MAAO,GAAG,GAErC/E,EAAOptB,KAAK0vB,MAAMb,QAAQ9X,QAAQqW,OAmCtC,GAAIA,EAAM,CACRptB,KAAKsnB,QAELtnB,KAAK2tB,eACL,IAAI+D,GAAa,EAMjB,MAJyB,kBAArB1xB,KAAKokB,OAAO+B,MAAoD,IAAxBnmB,KAAKokB,OAAOyN,SAAwC,kBAAhBzE,EAAKA,SACnFsE,GAAa,GAGR1xB,KAAKwyB,QAAQpF,EAAMsE,GAAY5Q,KAAK,WACzC,IAAI9Y,EAEJ,GAAyB,kBAArBhI,KAAKokB,OAAO+B,MAA4BnmB,KAAKokB,OAAOyN,QAAU,IAChE7pB,EAAOolB,EAAKA,QAGV,OAAOptB,KAAKwyB,QAAQxqB,IAGxByF,KAAKzN,OAAOmnB,GACLA,IACNrG,KAAK,WACF9gB,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,OACJ,QAA5B9kB,KAAK0c,SAASsI,UACoB,YAAhChlB,KAAK0c,SAASkU,cAChB5wB,KAAKwd,SAAS,EAAG,GAAG,GAEpBxd,KAAKwd,UAAuC,EAA9Bxd,KAAK+Q,UAAUgL,YAAmB/b,KAAKokB,OAAO+N,MAAO,GAAG,GAGxEnyB,KAAKwd,SAASxd,KAAK+Q,UAAUgL,YAAc/b,KAAKokB,OAAO+N,MAAO,GAAG,IAIrEnyB,KAAK0vB,MAAMpF,QACX7c,KAAKzN,SAIXgzB,UACE,IAAI9D,EAAUlvB,KAAKkvB,UAEnB,OAAIA,EAAQtvB,OAEHsvB,EAAQA,EAAQtvB,OAAS,GAG3B,KAGT0nB,QAEMtnB,KAAK0vB,QACP1vB,KAAK0vB,MAAMuD,OACXjzB,KAAKwd,SAAS,EAAG,GAAG,GACpBxd,KAAK0vB,MAAMpI,SAIfsG,kBASE,OARA5tB,KAAK2tB,eAED3tB,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,KACpC9kB,KAAKuD,SAAWvD,KAAKkzB,oBAErBlzB,KAAKuD,SAAWvD,KAAKmzB,mBAGhBnzB,KAAKuD,SAGd4vB,mBACE,IAAIjE,EAAUlvB,KAAKkvB,UACfne,EAAY/Q,KAAK+Q,UAAUnM,wBAC3BwuB,EAAariB,EAAUrS,OAASH,OAAOuJ,YAAciJ,EAAUrS,OAASH,OAAOuJ,YAC/EurB,EAAYtiB,EAAUtS,MAAQF,OAAOsJ,WAAakJ,EAAUtS,MAAQF,OAAOsJ,WAC3EyrB,EAAkC,aAAvBtzB,KAAK0c,SAASoI,KAEzB9X,GADMhN,KAAK0c,SAASsI,UACX,GA0Db,OAvDIhlB,KAAK0c,SAAS4T,WAChBtjB,EAASsmB,EAAW/0B,OAAOg1B,QAAUh1B,OAAOi1B,SAG/BtE,EAAQ5hB,KAAIkc,IACzB,IAOIiK,EACAC,EACAC,EACAzF,GAVA,MACF3kB,EADE,KAEFgN,GACEiT,EAAKzS,QACL7H,EAAWsa,EAAKta,WAChBzQ,EAAQ+qB,EAAK/qB,QACbC,EAAS8qB,EAAK9qB,SAMd40B,GACFG,EAAWzmB,EAAS+D,EAAUhJ,IAAMmH,EAASnH,IApBtC,EAqBP2rB,EAASD,EAAWL,EArBb,EAsBPlF,EAAaluB,KAAKokB,OAAOwP,MAAMl1B,EAAQ00B,GAAYpF,MACnD2F,EAAUP,IAEVK,EAAWzmB,EAAS+D,EAAU/I,KAAOkH,EAASlH,KAzBvC,EA0BP0rB,EAASD,EAAWJ,EA1Bb,EA2BPnF,EAAaluB,KAAKokB,OAAOwP,MAAMn1B,EAAO40B,GAAWrF,MACjD2F,EAAUN,GAGZ,IAAIQ,EAAWvzB,KAAKwzB,KAAKL,EAAWE,GAChC3F,EAAQ,GACR+F,EAAUzzB,KAAKwzB,KAAKJ,EAASC,GAEjC,GAAgC,QAA5B3zB,KAAK0c,SAASsI,YAAwBsO,EAAU,CAClD,IAAIU,EAAgBH,EACpBA,EAAW3F,EAAa6F,EACxBA,EAAU7F,EAAa8F,EAGzBhG,EAAQ,GAER,IAAK,IAAIruB,EAAIk0B,EAAUl0B,GAAKo0B,EAASp0B,IAAK,CACxC,IAAIs0B,EAAKt0B,EAAI,EACbquB,EAAMnsB,KAAKoyB,GAIb,MAAO,CACL1qB,QACAgN,OACAyX,QACAE,aACAH,QANY/tB,KAAK+tB,QAAQ/H,KAAKwD,EAAK/R,SAAU+R,EAAKzS,QAAQ6D,QAAS6Y,EAAUC,OAYnFR,oBACE,IAAIhE,EAAUlvB,KAAKkvB,UACfne,EAAY/Q,KAAK+Q,UAAUnM,wBAC3BoD,EAAO,EACPksB,EAAO,EA+DX,OA7DIl0B,KAAK0c,SAAS4T,WAChBtoB,EAAOzJ,OAAOi1B,SAGDtE,EAAQ5hB,KAAIkc,IACzB,IAIIxc,EAIAlK,EACAC,EACAswB,GAVA,MACF9pB,EADE,KAEFgN,GACEiT,EAAKzS,QAEL7H,EAAWsa,EAAKta,WAChBzQ,EAAQ+qB,EAAK/qB,QAMe,QAA5BuB,KAAK0c,SAASsI,WAChBhY,EAAS+D,EAAU9I,MAAQD,EAC3BqrB,EAAY/yB,KAAKotB,IAAIptB,KAAK6zB,IAAInnB,EAASkC,EAASlH,MAAOhI,KAAKokB,OAAO3lB,OAASy1B,EAC5EnxB,EAAMmM,EAASzQ,OAASyQ,EAASjH,MAAQ+E,GAAUknB,EACnDpxB,EAAQC,EAAMswB,IAEdrmB,EAAS+D,EAAU/I,KAAOA,EAC1BqrB,EAAY/yB,KAAKotB,IAAIxe,EAASjH,MAAQ+E,EAAQhN,KAAKokB,OAAO3lB,OAASy1B,EACnEpxB,EAAQkK,EAASkC,EAASlH,KAAOksB,EACjCnxB,EAAMD,EAAQuwB,GAGhBa,GAAQb,EACR,IAAItF,EAAU/tB,KAAK+tB,QAAQ/H,KAAKwD,EAAK/R,SAAU+R,EAAKzS,QAAQ6D,QAAS9X,EAAOC,GACxEmrB,EAAaluB,KAAKokB,OAAOwP,MAAMn1B,GAAOuvB,MACtCoG,EAAY9zB,KAAK0D,MAAMlB,EAAQ9C,KAAKokB,OAAOiP,WAC3CrF,EAAQ,GACR+F,EAAUzzB,KAAK0D,MAAMjB,EAAM/C,KAAKokB,OAAOiP,WAQ3C,GANIe,EAAY,IACdA,EAAY,EACZL,GAAoB,GAIU,QAA5B/zB,KAAK0c,SAASsI,UAAqB,CACrC,IAAIgP,EAAgBI,EACpBA,EAAYlG,EAAa6F,EACzBA,EAAU7F,EAAa8F,EAGzB,IAAK,IAAIr0B,EAAIy0B,EAAY,EAAGz0B,GAAKo0B,EAASp0B,IAAK,CAC7C,IAAIs0B,EAAKt0B,EACTquB,EAAMnsB,KAAKoyB,GAGb,MAAO,CACL1qB,QACAgN,OACAyX,QACAE,aACAH,cAMNsG,UAAU7K,EAAM8K,EAAYC,EAAYC,GACtC,IAAItlB,EAAWsa,EAAKta,WAEhB6B,EAAYyjB,GAAcx0B,KAAKlB,SAEnC,MAA2B,eAAvBkB,KAAK0c,SAASoI,MAAyB5V,EAASjH,MAAQ8I,EAAU/I,KAAOssB,GAAcplB,EAASlH,KAAO+I,EAAU9I,MAAQssB,GAE3F,aAAvBv0B,KAAK0c,SAASoI,MAAuB5V,EAAShH,OAAS6I,EAAUhJ,IAAMusB,GAAcplB,EAASnH,IAAMgJ,EAAU7I,OAASqsB,EAOpIrF,UAQE,IAPA,IAKI1F,EALAzY,EAAY/Q,KAAKlB,SACjB4wB,EAAQ1vB,KAAK0vB,MAAMhD,YACnB+H,EAAc/E,EAAM9vB,OACpBsvB,EAAU,GAILvvB,EAAI,EAAGA,EAAI80B,EAAa90B,IAC/B6pB,EAAOkG,EAAM/vB,IAGK,IAFNK,KAAKq0B,UAAU7K,EAAM,EAAG,EAAGzY,IAGrCme,EAAQrtB,KAAK2nB,GAIjB,OAAO0F,EAGTwD,SAASgC,EAAGC,EAAGC,GACb,IAAIrf,EAAkC,QAA5BvV,KAAK0c,SAASsI,WAAuB,EAAI,EAE/C4P,IACF50B,KAAK60B,QAAS,GAGX70B,KAAK0c,SAAS4T,SAIjB/xB,OAAOm0B,SAASgC,EAAInf,EAAKof,EAAIpf,IAHzBmf,IAAG10B,KAAK+Q,UAAU8hB,YAAc6B,EAAInf,GACpCof,IAAG30B,KAAK+Q,UAAU+hB,WAAa6B,IAKrC30B,KAAK80B,UAAW,EAGlBtX,SAASkX,EAAGC,EAAGC,GACTA,IACF50B,KAAK60B,QAAS,GAGX70B,KAAK0c,SAAS4T,SAIjB/xB,OAAOif,SAASkX,EAAGC,IAHnB30B,KAAK+Q,UAAU8hB,WAAa6B,EAC5B10B,KAAK+Q,UAAU+hB,UAAY6B,GAK7B30B,KAAK80B,UAAW,EAGlB3D,WACE,IAAI2B,EACAD,EAEC7yB,KAAK0c,SAAS4T,UAIjBwC,EAAYv0B,OAAOg1B,QACnBV,EAAat0B,OAAOi1B,UAJpBV,EAAY9yB,KAAK+Q,UAAU+hB,UAC3BD,EAAa7yB,KAAK+Q,UAAU8hB,YAM9B7yB,KAAK8yB,UAAYA,EACjB9yB,KAAK6yB,WAAaA,EAEb7yB,KAAK60B,OAaR70B,KAAK60B,QAAS,GAZd70B,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASI,OAAQ,CAC3C1L,IAAK+qB,EACL9qB,KAAM6qB,IAERpU,aAAaze,KAAKsxB,eAClBtxB,KAAKsxB,cAAgBzS,WAAW,WAC9B7e,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASK,SAAU,CAC7C3L,IAAK/H,KAAK8yB,UACV9qB,KAAMhI,KAAK6yB,cAEbplB,KAAKzN,MAAO,KAMlBlB,SAGE,OADSkB,KAAK6wB,MAAM/xB,SAItBwuB,YAAYlJ,GACVpkB,KAAKokB,OAASA,EACdpkB,KAAK2tB,eAED3tB,KAAK0vB,OAAS1vB,KAAK0vB,MAAM9vB,OAAS,GAA0B,kBAArBI,KAAKokB,OAAO+B,MACrDnmB,KAAKkqB,QAAQlqB,KAAK0vB,MAAMb,QAAQ9X,SAKpC4W,eACO3tB,KAAK6wB,QAIV7wB,KAAKgxB,WAAahxB,KAAK6wB,MAAMxM,OAExBrkB,KAAKkyB,aAGRlyB,KAAKokB,OAAO2Q,UAAU/0B,KAAKgxB,WAAWvyB,MAAOuB,KAAKgxB,WAAWtyB,OAAQsB,KAAK0c,SAAS+H,KAEnFzkB,KAAK0c,SAAS1P,OAAShN,KAAKokB,OAAO+N,MAAQnyB,KAAKokB,OAAOyN,SAJvD7xB,KAAKokB,OAAO2Q,UAAU/0B,KAAKgxB,WAAWvyB,MAAOuB,KAAKgxB,WAAWtyB,QAQ/DsB,KAAKuwB,aAAa9xB,MAAQuB,KAAKokB,OAAO3lB,MACtCuB,KAAKuwB,aAAa7xB,OAASsB,KAAKokB,OAAO1lB,OACvCsB,KAAKg1B,UAAUh1B,KAAKokB,SAGtB4Q,UAAU5Q,GACRpkB,KAAKuwB,aAAanM,OAASA,EAC3BpkB,KAAK+tB,QAAU,IAAI7T,EAAS7O,QAAQ+Y,EAAOle,MAAOlG,KAAK0c,SAASsI,UAAWhlB,KAAK0c,SAASoI,MAErF9kB,KAAK0vB,OACP1vB,KAAK0vB,MAAM/wB,SAAQ,SAAU6qB,GACvBA,GACFA,EAAKwL,UAAU5Q,MAMvBmO,kBAAkBtM,GAChBjmB,KAAK+kB,YAAckB,EAGrBqM,WAAWxN,EAAMmQ,IACVA,GAAenQ,IAAS9kB,KAAK0c,SAASoI,QAI3C9kB,KAAK0c,SAASoI,KAAOA,EACrB9kB,KAAK6wB,OAAS7wB,KAAK6wB,MAAM/L,KAAKA,GAC9B9kB,KAAKuwB,aAAazL,KAAOA,EAErB9kB,KAAK+tB,UACP/tB,KAAK+tB,QAAU,IAAI7T,EAAS7O,QAAQrL,KAAKokB,OAAOle,MAAOlG,KAAK0c,SAASsI,UAAWhlB,KAAK0c,SAASoI,OAG5F9kB,KAAKokB,SACM,aAATU,EACF9kB,KAAKokB,OAAOsF,OAAO,QAEnB1pB,KAAKokB,OAAOsF,OAAO1pB,KAAKokB,OAAO1H,SAASgN,UAK9C6D,WAAW9D,EAAMyL,EAA0B,QACzC,IAAIhD,EAAuB,cAATzI,GAAiC,SAATA,EAC1CzpB,KAAKkyB,YAAcA,EAEN,iBAATzI,GAAoC,wBAATA,GAA2C,aAATA,EAC/DzpB,KAAKsyB,WAAW,YAEhBtyB,KAAKsyB,WAAW,cAGlBtyB,KAAKuwB,aAAa9G,KAAOA,EAEpBzpB,KAAK0c,SAASV,SAGjBhc,KAAKgc,SAAWhc,KAAK0c,SAASV,SAF9Bhc,KAAKgc,SAAWkW,EAAc,SAAWgD,EAK3Cl1B,KAAK6wB,OAAS7wB,KAAK6wB,MAAM7U,SAAShc,KAAKgc,UACvChc,KAAK2tB,eAGP8B,cACE,IAAIhY,EAAW,GAEf,OAAKzX,KAAK0vB,OAIV1vB,KAAK0vB,MAAM/wB,SAAQ,SAAU6qB,GAC3B,MAAM2L,EAAe3L,GAAQA,EAAK/R,SAE9B0d,GACF1d,EAAS5V,KAAKszB,MAGX1d,GAVEA,EAaXuN,UAAUzP,EAAM,OACdvV,KAAK0c,SAASsI,UAAYzP,EAC1BvV,KAAK6wB,OAAS7wB,KAAK6wB,MAAM7L,UAAUzP,GACnCvV,KAAKuwB,aAAavL,UAAYzP,EAC9BvV,KAAK2tB,eAGPH,aACE,OAAOxtB,KAAK0wB,WAMhB,EAAI1W,EAAc3O,SAAS4kB,EAAmB3pB,WAC9C,IAAIiM,EAAW0d,EACf1yB,EAAQ8N,QAAUkH,G,wDCv8BlBhV,EAAQ0X,YAAa,EACrB1X,EAAQ8N,QAAU9N,EAAQ63B,QAAU73B,EAAQ83B,QAAU93B,EAAQ+3B,SAAW/3B,EAAQg4B,OAASh4B,EAAQi4B,eAAY,EAE9G,IAAIC,EAYJ,SAAiC/1B,GAAO,GAAIA,GAAOA,EAAIuV,WAAc,OAAOvV,EAAc,IAAIg2B,EAAS,GAAI,GAAW,MAAPh2B,EAAe,IAAK,IAAIgiB,KAAOhiB,EAAO,GAAIrC,OAAOiJ,UAAUsL,eAAe1Q,KAAKxB,EAAKgiB,GAAM,CAAE,IAAIiU,EAAOt4B,OAAOC,gBAAkBD,OAAOgE,yBAA2BhE,OAAOgE,yBAAyB3B,EAAKgiB,GAAO,GAAQiU,EAAK9I,KAAO8I,EAAKC,IAAOv4B,OAAOC,eAAeo4B,EAAQhU,EAAKiU,GAAgBD,EAAOhU,GAAOhiB,EAAIgiB,GAAoC,OAAtBgU,EAAOrqB,QAAU3L,EAAYg2B,EAZ7bG,CAAwB1tB,EAAQ,IAE5C2tB,EAAS5f,EAAuB/N,EAAQ,IAExC4tB,EAAY7f,EAAuB/N,EAAQ,KAE3C6tB,EAAyB7tB,EAAQ,KAEpBA,EAAQ,KAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAQvF,IAAI81B,EAAY,YAChBj4B,EAAQi4B,UAAYA,EACpB,IAAID,EAAS,SACbh4B,EAAQg4B,OAASA,EACjB,IAAID,EAAW,WACf/3B,EAAQ+3B,SAAWA,EACnB,IAAID,EAAU,UACd93B,EAAQ83B,QAAUA,EAClB,IAAID,EAAU,UA2Fd73B,EAAQ63B,QAAUA,EAElB,IAAIa,EAEJ,SAAUC,GAzGV,IAAwBC,EAAUC,EA4GhC,SAASH,EAAW/vB,EAAOsgB,GACzB,IAAI6P,EAEJA,EAAQH,EAAiBh1B,KAAKlB,KAAMkG,EAAOsgB,IAAYxmB,KACvD,IAGIs2B,EAHAC,EAAc/P,EAAQgQ,gBAEtBC,EAASF,IAAgBA,EAAYG,WAAaxwB,EAAMywB,MAAQzwB,EAAMuwB,OAuB1E,OArBAJ,EAAMO,aAAe,KAEjB1wB,EAAM2wB,GACJJ,GACFH,EAAgBf,EAChBc,EAAMO,aAAetB,GAErBgB,EAAgBjB,EAIhBiB,EADEpwB,EAAM4wB,eAAiB5wB,EAAM6wB,aACfvB,EAEAD,EAIpBc,EAAMW,MAAQ,CACZ1d,OAAQgd,GAEVD,EAAMY,aAAe,KACdZ,EAzIuBD,EA0GLF,GA1GLC,EA0GPF,GA1GwC3vB,UAAYjJ,OAAO65B,OAAOd,EAAW9vB,WAAY6vB,EAAS7vB,UAAU0D,YAAcmsB,EAAUA,EAASgB,UAAYf,EA4IxK,IAAIgB,EAASnB,EAAW3vB,UAqQxB,OAnQA8wB,EAAOC,gBAAkB,WACvB,MAAO,CACLb,gBAAiB,OAKrBP,EAAWqB,yBAA2B,SAAkCC,EAAMC,GAG5E,OAFaD,EAAKV,IAEJW,EAAUle,SAAWkc,EAC1B,CACLlc,OAAQic,GAIL,MAmBT6B,EAAOK,kBAAoB,WACzBz3B,KAAK03B,cAAa,EAAM13B,KAAK42B,eAG/BQ,EAAOO,mBAAqB,SAA4BC,GACtD,IAAIC,EAAa,KAEjB,GAAID,IAAc53B,KAAKkG,MAAO,CAC5B,IAAIoT,EAAStZ,KAAKg3B,MAAM1d,OAEpBtZ,KAAKkG,MAAM2wB,GACTvd,IAAWgc,GAAYhc,IAAW+b,IACpCwC,EAAavC,GAGXhc,IAAWgc,GAAYhc,IAAW+b,IACpCwC,EAAazC,GAKnBp1B,KAAK03B,cAAa,EAAOG,IAG3BT,EAAOU,qBAAuB,WAC5B93B,KAAK+3B,sBAGPX,EAAOY,YAAc,WACnB,IACIC,EAAMtB,EAAOF,EADbyB,EAAUl4B,KAAKkG,MAAMgyB,QAWzB,OATAD,EAAOtB,EAAQF,EAASyB,EAET,MAAXA,GAAsC,kBAAZA,IAC5BD,EAAOC,EAAQD,KACftB,EAAQuB,EAAQvB,MAEhBF,OAA4B/tB,IAAnBwvB,EAAQzB,OAAuByB,EAAQzB,OAASE,GAGpD,CACLsB,KAAMA,EACNtB,MAAOA,EACPF,OAAQA,IAIZW,EAAOM,aAAe,SAAsBS,EAAUN,GAKpD,QAJiB,IAAbM,IACFA,GAAW,GAGM,OAAfN,EAAqB,CAEvB73B,KAAK+3B,qBAEL,IAAIr2B,EAAOq0B,EAAU1qB,QAAQ+sB,YAAYp4B,MAErC63B,IAAevC,EACjBt1B,KAAKq4B,aAAa32B,EAAMy2B,GAExBn4B,KAAKs4B,YAAY52B,QAEV1B,KAAKkG,MAAM4wB,eAAiB92B,KAAKg3B,MAAM1d,SAAWic,GAC3Dv1B,KAAKu4B,SAAS,CACZjf,OAAQkc,KAKd4B,EAAOiB,aAAe,SAAsB32B,EAAMy2B,GAChD,IAAIK,EAASx4B,KAET22B,EAAQ32B,KAAKkG,MAAMywB,MACnB8B,EAAYz4B,KAAKwmB,QAAQgQ,gBAAkBx2B,KAAKwmB,QAAQgQ,gBAAgBE,WAAayB,EACrFO,EAAW14B,KAAKg4B,cAChBW,EAAeF,EAAYC,EAASjC,OAASiC,EAAS/B,MAGrDwB,GAAaxB,GASlB32B,KAAKkG,MAAM0yB,QAAQl3B,EAAM+2B,GACzBz4B,KAAK64B,aAAa,CAChBvf,OAAQgc,IACP,WACDkD,EAAOtyB,MAAM4yB,WAAWp3B,EAAM+2B,GAE9BD,EAAOO,gBAAgBr3B,EAAMi3B,GAAc,WACzCH,EAAOK,aAAa,CAClBvf,OAAQ+b,IACP,WACDmD,EAAOtyB,MAAM8yB,UAAUt3B,EAAM+2B,aAlBjCz4B,KAAK64B,aAAa,CAChBvf,OAAQ+b,IACP,WACDmD,EAAOtyB,MAAM8yB,UAAUt3B,OAqB7B01B,EAAOkB,YAAc,SAAqB52B,GACxC,IAAIu3B,EAASj5B,KAETi4B,EAAOj4B,KAAKkG,MAAM+xB,KAClBS,EAAW14B,KAAKg4B,cAEfC,GASLj4B,KAAKkG,MAAMgzB,OAAOx3B,GAClB1B,KAAK64B,aAAa,CAChBvf,OAAQ8b,IACP,WACD6D,EAAO/yB,MAAMizB,UAAUz3B,GAEvBu3B,EAAOF,gBAAgBr3B,EAAMg3B,EAAST,MAAM,WAC1CgB,EAAOJ,aAAa,CAClBvf,OAAQic,IACP,WACD0D,EAAO/yB,MAAMkzB,SAAS13B,aAlB1B1B,KAAK64B,aAAa,CAChBvf,OAAQic,IACP,WACD0D,EAAO/yB,MAAMkzB,SAAS13B,OAqB5B01B,EAAOW,mBAAqB,WACA,OAAtB/3B,KAAKi3B,eACPj3B,KAAKi3B,aAAaoC,SAClBr5B,KAAKi3B,aAAe,OAIxBG,EAAOyB,aAAe,SAAsBS,EAAW3vB,GAIrDA,EAAW3J,KAAKu5B,gBAAgB5vB,GAChC3J,KAAKu4B,SAASe,EAAW3vB,IAG3BytB,EAAOmC,gBAAkB,SAAyB5vB,GAChD,IAAI6vB,EAASx5B,KAETmb,GAAS,EAcb,OAZAnb,KAAKi3B,aAAe,SAAUwC,GACxBte,IACFA,GAAS,EACTqe,EAAOvC,aAAe,KACtBttB,EAAS8vB,KAIbz5B,KAAKi3B,aAAaoC,OAAS,WACzBle,GAAS,GAGJnb,KAAKi3B,cAGdG,EAAO2B,gBAAkB,SAAyBr3B,EAAMw2B,EAASwB,GAC/D15B,KAAKu5B,gBAAgBG,GACrB,IAAIC,EAA0C,MAAXzB,IAAoBl4B,KAAKkG,MAAM0zB,eAE7Dl4B,IAAQi4B,GAKT35B,KAAKkG,MAAM0zB,gBACb55B,KAAKkG,MAAM0zB,eAAel4B,EAAM1B,KAAKi3B,cAGxB,MAAXiB,GACFrZ,WAAW7e,KAAKi3B,aAAciB,IAT9BrZ,WAAW7e,KAAKi3B,aAAc,IAalCG,EAAO/M,OAAS,WACd,IAAI/Q,EAAStZ,KAAKg3B,MAAM1d,OAExB,GAAIA,IAAWkc,EACb,OAAO,KAGT,IAAIqE,EAAc75B,KAAKkG,MACnBoD,EAAWuwB,EAAYvwB,SACvBwwB,EAxXR,SAAuCh6B,EAAQi6B,GAAY,GAAc,MAAVj6B,EAAgB,MAAO,GAAI,IAA2D4hB,EAAK/hB,EAA5DoB,EAAS,GAAQi5B,EAAa38B,OAAOmlB,KAAK1iB,GAAqB,IAAKH,EAAI,EAAGA,EAAIq6B,EAAWp6B,OAAQD,IAAO+hB,EAAMsY,EAAWr6B,GAAQo6B,EAASh2B,QAAQ2d,IAAQ,IAAa3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAQ,OAAO3gB,EAwXrRk5B,CAA8BJ,EAAa,CAAC,aAkB7D,UAfOC,EAAWjD,UACXiD,EAAW/C,oBACX+C,EAAWhD,qBACXgD,EAAWrD,cACXqD,EAAWnD,aACXmD,EAAW7B,YACX6B,EAAW5B,eACX4B,EAAWF,sBACXE,EAAWlB,eACXkB,EAAWhB,kBACXgB,EAAWd,iBACXc,EAAWZ,cACXY,EAAWX,iBACXW,EAAWV,SAEM,oBAAb9vB,EACT,OAAOA,EAASgQ,EAAQwgB,GAG1B,IAAIroB,EAAQqkB,EAAOzqB,QAAQ6uB,SAASC,KAAK7wB,GAEzC,OAAOwsB,EAAOzqB,QAAQ+uB,aAAa3oB,EAAOqoB,IAGrC7D,EAxST,CAySEH,EAAOzqB,QAAQgvB,WAiKjB,SAASC,KA/JTrE,EAAWsE,aAAe,CACxB/D,gBAAiBf,EAAU+E,QAE7BvE,EAAWwE,kBAAoB,CAC7BjE,gBAAiB,cAEnBP,EAAWyE,UAuJP,GAIJzE,EAAW0E,aAAe,CACxB9D,IAAI,EACJE,cAAc,EACdD,eAAe,EACfL,QAAQ,EACRE,OAAO,EACPsB,MAAM,EACNW,QAAS0B,EACTxB,WAAYwB,EACZtB,UAAWsB,EACXpB,OAAQoB,EACRnB,UAAWmB,EACXlB,SAAUkB,GAEZrE,EAAWT,UAAY,EACvBS,EAAWV,OAAS,EACpBU,EAAWX,SAAW,EACtBW,EAAWZ,QAAU,EACrBY,EAAWb,QAAU,EAErB,IAAI7iB,GAAW,EAAIyjB,EAAuB4E,UAAU3E,GAEpD14B,EAAQ8N,QAAUkH,G,6BCzlBlB,SAASsoB,IAEP,IAAI7D,EAAQh3B,KAAKgK,YAAYstB,yBAAyBt3B,KAAKkG,MAAOlG,KAAKg3B,OACzD,OAAVA,QAA4BtuB,IAAVsuB,GACpBh3B,KAAKu4B,SAASvB,GAIlB,SAAS8D,EAA0BC,GAQjC/6B,KAAKu4B,SALL,SAAiBf,GACf,IAAIR,EAAQh3B,KAAKgK,YAAYstB,yBAAyByD,EAAWvD,GACjE,OAAiB,OAAVR,QAA4BtuB,IAAVsuB,EAAsBA,EAAQ,MAGnCvpB,KAAKzN,OAG7B,SAASg7B,EAAoBD,EAAWzB,GACtC,IACE,IAAI1B,EAAY53B,KAAKkG,MACjBsxB,EAAYx3B,KAAKg3B,MACrBh3B,KAAKkG,MAAQ60B,EACb/6B,KAAKg3B,MAAQsC,EACbt5B,KAAKi7B,6BAA8B,EACnCj7B,KAAKk7B,wBAA0Bl7B,KAAKm7B,wBAClCvD,EACAJ,GARJ,QAWEx3B,KAAKkG,MAAQ0xB,EACb53B,KAAKg3B,MAAQQ,GAUjB,SAASoD,EAASP,GAChB,IAAI/zB,EAAY+zB,EAAU/zB,UAE1B,IAAKA,IAAcA,EAAU80B,iBAC3B,MAAM,IAAIv1B,MAAM,sCAGlB,GACgD,oBAAvCw0B,EAAU/C,0BAC4B,oBAAtChxB,EAAU60B,wBAEjB,OAAOd,EAMT,IAAIgB,EAAqB,KACrBC,EAA4B,KAC5BC,EAAsB,KAgB1B,GAf4C,oBAAjCj1B,EAAUu0B,mBACnBQ,EAAqB,qBACmC,oBAAxC/0B,EAAUk1B,4BAC1BH,EAAqB,6BAE4B,oBAAxC/0B,EAAUw0B,0BACnBQ,EAA4B,4BACmC,oBAA/Ch1B,EAAUm1B,mCAC1BH,EAA4B,oCAEe,oBAAlCh1B,EAAU00B,oBACnBO,EAAsB,sBACmC,oBAAzCj1B,EAAUo1B,6BAC1BH,EAAsB,8BAGC,OAAvBF,GAC8B,OAA9BC,GACwB,OAAxBC,EACA,CACA,IAAII,EAAgBtB,EAAUuB,aAAevB,EAAUlU,KACnD0V,EAC4C,oBAAvCxB,EAAU/C,yBACb,6BACA,4BAEN,MAAMzxB,MACJ,2FACE81B,EACA,SACAE,EACA,uDACwB,OAAvBR,EAA8B,OAASA,EAAqB,KAC9B,OAA9BC,EACG,OAASA,EACT,KACqB,OAAxBC,EAA+B,OAASA,EAAsB,IATjE,wIA0BJ,GARkD,oBAAvClB,EAAU/C,2BACnBhxB,EAAUu0B,mBAAqBA,EAC/Bv0B,EAAUw0B,0BAA4BA,GAMS,oBAAtCx0B,EAAU60B,wBAAwC,CAC3D,GAA4C,oBAAjC70B,EAAUqxB,mBACnB,MAAM,IAAI9xB,MACR,qHAIJS,EAAU00B,oBAAsBA,EAEhC,IAAIrD,EAAqBrxB,EAAUqxB,mBAEnCrxB,EAAUqxB,mBAAqB,SAC7BC,EACAJ,EACAsE,GAUA,IAAIC,EAAW/7B,KAAKi7B,4BAChBj7B,KAAKk7B,wBACLY,EAEJnE,EAAmBz2B,KAAKlB,KAAM43B,EAAWJ,EAAWuE,IAIxD,OAAO1B,EA1JT,gDA6CAQ,EAAmBmB,8BAA+B,EAClDlB,EAA0BkB,8BAA+B,EACzDhB,EAAoBgB,8BAA+B,G,6BC7CnDz+B,EAAQ0X,YAAa,EACrB1X,EAAQ0+B,gBAAkB1+B,EAAQ2+B,mBAAgB,EAElD,IAEgCx8B,KAFQyI,EAAQ,KAEKzI,EAAIuV,WAOzD1X,EAAQ2+B,cADU,KAclB3+B,EAAQ0+B,gBADD,M,6BCxBP1+B,EAAQ0X,YAAa,EACrB1X,EAAQ8N,aAAU,EAElB,IAAI8wB,EAAajmB,EAAuB/N,EAAQ,IAE5C2tB,EAAS5f,EAAuB/N,EAAQ,IAExC6tB,EAAyB7tB,EAAQ,KAEjCi0B,EAAgBj0B,EAAQ,KAE5B,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAIvF,SAAS28B,IAA2Q,OAA9PA,EAAWh/B,OAAOi/B,QAAU,SAAUv7B,GAAU,IAAK,IAAIpB,EAAI,EAAGA,EAAIE,UAAUD,OAAQD,IAAK,CAAE,IAAIG,EAASD,UAAUF,GAAI,IAAK,IAAI+hB,KAAO5hB,EAAczC,OAAOiJ,UAAUsL,eAAe1Q,KAAKpB,EAAQ4hB,KAAQ3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAY,OAAO3gB,IAA2BmmB,MAAMlnB,KAAMH,WAIhT,SAAS08B,EAAuBC,GAAQ,QAAa,IAATA,EAAmB,MAAM,IAAIC,eAAe,6DAAgE,OAAOD,EAE/J,IAAIE,EAASr/B,OAAOq/B,QAAU,SAAUh9B,GACtC,OAAOrC,OAAOmlB,KAAK9iB,GAAK4N,KAAI,SAAUqvB,GACpC,OAAOj9B,EAAIi9B,OA0BXC,EAEJ,SAAU1G,GAlCV,IAAwBC,EAAUC,EAqChC,SAASwG,EAAgB12B,EAAOsgB,GAC9B,IAAI6P,EAIAwG,GAFJxG,EAAQH,EAAiBh1B,KAAKlB,KAAMkG,EAAOsgB,IAAYxmB,MAE9B68B,aAAapvB,KAAK8uB,EAAuBA,EAAuBlG,KAOzF,OAJAA,EAAMW,MAAQ,CACZ6F,aAAcA,EACdC,aAAa,GAERzG,EAjDuBD,EAmCAF,GAnCVC,EAmCPyG,GAnCwCt2B,UAAYjJ,OAAO65B,OAAOd,EAAW9vB,WAAY6vB,EAAS7vB,UAAU0D,YAAcmsB,EAAUA,EAASgB,UAAYf,EAoDxK,IAAIgB,EAASwF,EAAgBt2B,UAmE7B,OAjEA8wB,EAAOC,gBAAkB,WACvB,MAAO,CACLb,gBAAiB,CACfE,YAAa12B,KAAK+8B,YAKxB3F,EAAOK,kBAAoB,WACzBz3B,KAAK+8B,UAAW,EAChB/8B,KAAKg9B,SAAU,GAGjB5F,EAAOU,qBAAuB,WAC5B93B,KAAKg9B,SAAU,GAGjBJ,EAAgBtF,yBAA2B,SAAkCyD,EAAWxD,GACtF,IAAI0F,EAAmB1F,EAAKjuB,SACxBuzB,EAAetF,EAAKsF,aAExB,MAAO,CACLvzB,SAFgBiuB,EAAKuF,aAEG,EAAIV,EAAcc,wBAAwBnC,EAAW8B,IAAgB,EAAIT,EAAce,qBAAqBpC,EAAWkC,EAAkBJ,GACjKC,aAAa,IAIjB1F,EAAOyF,aAAe,SAAsBprB,EAAO/P,GACjD,IAAI07B,GAAsB,EAAIhB,EAAciB,iBAAiBr9B,KAAKkG,MAAMoD,UACpEmI,EAAMiQ,OAAO0b,IAEb3rB,EAAMvL,MAAMkzB,UACd3nB,EAAMvL,MAAMkzB,SAAS13B,GAGnB1B,KAAKg9B,SACPh9B,KAAKu4B,UAAS,SAAUvB,GACtB,IAAI1tB,EAAW+yB,EAAS,GAAIrF,EAAM1tB,UAGlC,cADOA,EAASmI,EAAMiQ,KACf,CACLpY,SAAUA,QAMlB8tB,EAAO/M,OAAS,WACd,IAAIwP,EAAc75B,KAAKkG,MACnBm0B,EAAYR,EAAY9sB,UACxBuwB,EAAezD,EAAYyD,aAC3Bp3B,EA7GR,SAAuCpG,EAAQi6B,GAAY,GAAc,MAAVj6B,EAAgB,MAAO,GAAI,IAA2D4hB,EAAK/hB,EAA5DoB,EAAS,GAAQi5B,EAAa38B,OAAOmlB,KAAK1iB,GAAqB,IAAKH,EAAI,EAAGA,EAAIq6B,EAAWp6B,OAAQD,IAAO+hB,EAAMsY,EAAWr6B,GAAQo6B,EAASh2B,QAAQ2d,IAAQ,IAAa3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAQ,OAAO3gB,EA6G1Rk5B,CAA8BJ,EAAa,CAAC,YAAa,iBAEjEvwB,EAAWozB,EAAO18B,KAAKg3B,MAAM1tB,UAAUgE,IAAIgwB,GAK/C,cAJOp3B,EAAMuwB,cACNvwB,EAAMywB,aACNzwB,EAAM+xB,KAEK,OAAdoC,EACK/wB,EAGFwsB,EAAOzqB,QAAQ4L,cAAcojB,EAAWn0B,EAAOoD,IAGjDszB,EArFT,CAsFE9G,EAAOzqB,QAAQgvB,WAEjBuC,EAAgBnC,kBAAoB,CAClCjE,gBAAiB2F,EAAW9wB,QAAQmvB,OAAO+C,YAE7CX,EAAgBlC,UAyDZ,GACJkC,EAAgBjC,aA7KG,CACjB5tB,UAAW,MACXuwB,aAAc,SAAsB7rB,GAClC,OAAOA,IA4KX,IAAIc,GAAW,EAAIyjB,EAAuB4E,UAAUgC,GAEpDr/B,EAAQ8N,QAAUkH,EAClBirB,EAAOjgC,QAAUA,EAAO,S,6BC7MxBF,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETH,OAAOC,eAAeC,EAAS,WAAY,CACzCkgC,YAAY,EACZ5Q,IAAK,WACH,OAAO6Q,EAAUryB,WAGrBhO,OAAOC,eAAeC,EAAS,gBAAiB,CAC9CkgC,YAAY,EACZ5Q,IAAK,WACH,OAAO8Q,EAAOtyB,WAGlBhO,OAAOC,eAAeC,EAAS,cAAe,CAC5CkgC,YAAY,EACZ5Q,IAAK,WACH,OAAO+Q,EAAavyB,WAGxBhO,OAAOC,eAAeC,EAAS,mBAAoB,CACjDkgC,YAAY,EACZ5Q,IAAK,WACH,OAAOgR,EAAQxyB,WAInB,IAAIqyB,EAAYxnB,EAAuB/N,EAAQ,MAE3Cw1B,EAASznB,EAAuB/N,EAAQ,MAExCy1B,EAAe1nB,EAAuB/N,EAAQ,MAE9C01B,EAAU3nB,EAAuB/N,EAAQ,MAE7C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,K,6BCpCvFrC,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI2O,EAAgB9D,EAAuB/N,EAAQ,KAE/CmD,EAAQnD,EAAQ,IAEhB2P,EAAO5B,EAAuB/N,EAAQ,KAEtC8N,EAAQC,EAAuB/N,EAAQ,KAEvC21B,EAAS5nB,EAAuB/N,EAAQ,MAExC41B,EAAa7nB,EAAuB/N,EAAQ,MAE5CqsB,EAAate,EAAuB/N,EAAQ,MAE5C61B,EAAa9nB,EAAuB/N,EAAQ,MAE5C81B,EAAc/nB,EAAuB/N,EAAQ,MAE7C+1B,EAAahoB,EAAuB/N,EAAQ,MAE5Cg2B,EAAYjoB,EAAuB/N,EAAQ,MAE3Ci2B,EAAaloB,EAAuB/N,EAAQ,MAE5Ck2B,EAAWnoB,EAAuB/N,EAAQ,MAE1Cm2B,EAAYpoB,EAAuB/N,EAAQ,KAE3C8R,EAAW/D,EAAuB/N,EAAQ,KAE1Co2B,EAASroB,EAAuB/N,EAAQ,MAExCq2B,EAAkBtoB,EAAuB/N,EAAQ,MAEjDiS,EAAajS,EAAQ,IAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,MAAM++B,EAAiB,yBAEjBC,EACI,SADJA,EAEI,SAFJA,EAGE,OAHFA,EAIC,MAJDA,EAKM,OALNA,EAMO,YAqBb,MAAMC,EACJ30B,YAAY/C,EAAKwV,GAEQ,qBAAZA,GAA0C,kBAARxV,GAAoBA,aAAeuC,QAAS,GAASvC,aAAe23B,eAAgB,IAC/HniB,EAAUxV,EACVA,OAAMyB,GAGR1I,KAAK0c,UAAW,EAAIpR,EAAMxK,QAAQd,KAAK0c,UAAY,GAAI,CACrDmiB,mBAAen2B,EACfo2B,wBAAoBp2B,EACpBq2B,oBAAgBr2B,EAChBs2B,cAAUt2B,EACV4P,kBAAc5P,EACd4O,eAAW5O,EACXu2B,YAAQv2B,EACRw2B,WAAOx2B,KAET,EAAI4C,EAAMxK,QAAQd,KAAK0c,SAAUD,GAEjCzc,KAAKm/B,QAAU,IAAI7zB,EAAMvL,MAMzBC,KAAKgrB,OAAShrB,KAAKm/B,QAAQh/B,QAC3BH,KAAKo/B,QAAS,EACdp/B,KAAKq/B,QAAU,CACbC,SAAU,IAAIh0B,EAAMvL,MACpB2qB,MAAO,IAAIpf,EAAMvL,MACjBwrB,SAAU,IAAIjgB,EAAMvL,MACpBw/B,MAAO,IAAIj0B,EAAMvL,MACjBy/B,WAAY,IAAIl0B,EAAMvL,MACtByuB,SAAU,IAAIljB,EAAMvL,MACpB0/B,UAAW,IAAIn0B,EAAMvL,MACrByrB,eAAgB,IAAIlgB,EAAMvL,OAE5BC,KAAK0/B,OAAS,CACZJ,SAAUt/B,KAAKq/B,QAAQC,SAASn/B,QAChCuqB,MAAO1qB,KAAKq/B,QAAQ3U,MAAMvqB,QAC1BorB,SAAUvrB,KAAKq/B,QAAQ9T,SAASprB,QAChCo/B,MAAOv/B,KAAKq/B,QAAQE,MAAMp/B,QAC1Bq/B,WAAYx/B,KAAKq/B,QAAQG,WAAWr/B,QACpCquB,SAAUxuB,KAAKq/B,QAAQ7Q,SAASruB,QAChCs/B,UAAWz/B,KAAKq/B,QAAQI,UAAUt/B,QAClCqrB,eAAgBxrB,KAAKq/B,QAAQ7T,eAAerrB,SAQ9CH,KAAK6gB,MAAQjjB,QAAQwpB,IAAI,CAACpnB,KAAK0/B,OAAOJ,SAAUt/B,KAAK0/B,OAAOhV,MAAO1qB,KAAK0/B,OAAOnU,SAAUvrB,KAAK0/B,OAAOH,MAAOv/B,KAAK0/B,OAAOF,WAAYx/B,KAAK0/B,OAAOD,UAAWz/B,KAAK0/B,OAAOlU,iBAEvKxrB,KAAKwtB,YAAa,EAQlBxtB,KAAK6rB,QAAU7rB,KAAK0c,SAASmiB,eAAiBP,EAAUjzB,QAMxDrL,KAAK0qB,MAAQ,IAAIoT,EAAOzyB,QAMxBrL,KAAK2sB,UAAY,IAAIoR,EAAW1yB,QAAQrL,KAAK0qB,MAAO1qB,KAAK8rB,KAAKre,KAAKzN,OAMnEA,KAAKw/B,gBAAa92B,EAMlB1I,KAAKwuB,cAAW9lB,EAOhB1I,KAAKiH,SAAMyB,EAOX1I,KAAK8L,UAAOpD,EAOZ1I,KAAK2/B,UAAW,EAOhB3/B,KAAK4/B,aAAUl3B,EAOf1I,KAAK6/B,aAAUn3B,EAOf1I,KAAKy/B,eAAY/2B,EAOjB1I,KAAK8/B,eAAYp3B,EAOjB1I,KAAK+Q,eAAYrI,EAOjB1I,KAAK4vB,eAAYlnB,EAOjB1I,KAAKwrB,oBAAiB9iB,EAElB1I,KAAK0c,SAASwiB,OAChBl/B,KAAKk/B,MAAMl/B,KAAK0c,SAASwiB,OAGvBj4B,GACFjH,KAAK4Z,KAAK3S,EAAKjH,KAAK0c,SAASuiB,QAAQc,OAAMhoB,IACzC,IAAIoP,EAAM,IAAIthB,MAAM,uBAAyBoB,GAC7CjH,KAAK0d,KAAKtD,EAAW5H,OAAOG,KAAKC,YAAauU,MAapDvN,KAAKomB,EAAOtqB,GACV,IAAIypB,EACAv4B,EAAO8O,GAAQ1V,KAAKigC,cAAcD,GAyBtC,OAvBIp5B,IAAS83B,GACX1+B,KAAK2/B,UAAW,EAChB3/B,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ,IAAK,IACjC8zB,EAAUn/B,KAAKkgC,SAASF,IACfp5B,IAAS83B,GAClB1+B,KAAK2/B,UAAW,EAChB3/B,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ,IAAK,IACjC8zB,EAAUn/B,KAAKkgC,SAASF,EAAOp5B,IACtBA,IAAS83B,GAClB1+B,KAAK2/B,UAAW,EAChB3/B,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ,IAAK,IACjC8zB,EAAUn/B,KAAK6rB,QAAQmU,EAAO,SAAUhgC,KAAK0c,SAASoiB,mBAAoB9+B,KAAK0c,SAASqiB,gBAAgBje,KAAK9gB,KAAKkgC,SAASzyB,KAAKzN,QACvH4G,GAAQ83B,GACjB1+B,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ20B,GAC5Bb,EAAUn/B,KAAKmgC,cAAcngC,KAAKiH,IAAI2P,KAAKjP,aAClCf,GAAQ83B,GACjB1+B,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ20B,GAC5Bb,EAAUn/B,KAAKogC,aAAapgC,KAAKiH,IAAI2P,KAAKjP,cAE1C3H,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ20B,GAC5Bb,EAAUn/B,KAAKqgC,cAAc5B,GAAgB3d,KAAK9gB,KAAKmgC,cAAc1yB,KAAKzN,QAGrEm/B,EAWTe,SAAShhC,EAAM8/B,GACb,OAAOh/B,KAAKsgC,UAAUphC,EAAM8/B,GAAYh/B,KAAK0c,SAASsiB,UAAUle,MAAK,IAC5D9gB,KAAKqgC,cAAc5B,KACzB3d,MAAKyf,GACCvgC,KAAKmgC,cAAcI,KAW9BF,cAAcp5B,GACZ,OAAOjH,KAAK8rB,KAAK7kB,GAAK6Z,MAAK0f,IACzBxgC,KAAK+Q,UAAY,IAAIyjB,EAAWnpB,QAAQm1B,GACjCxgC,KAAKnC,QAAQmC,KAAK+Q,UAAUwvB,gBAWvCJ,cAAcl5B,GAEZ,OADAjH,KAAK8L,KAAO,IAAImK,EAAM5K,QAAQpE,GACvBjH,KAAK8rB,KAAK7kB,GAAK6Z,MAAK0f,IACzBxgC,KAAK4vB,UAAY,IAAIoO,EAAW3yB,QAAQm1B,GACjCxgC,KAAKygC,OAAOzgC,KAAK4vB,cAW5BwQ,aAAan5B,GAEX,OADAjH,KAAK8L,KAAO,IAAImK,EAAM5K,QAAQpE,GACvBjH,KAAK8rB,KAAK7kB,GAAK6Z,MAAK4f,IACzB1gC,KAAK4vB,UAAY,IAAIoO,EAAW3yB,QAChCrL,KAAK4vB,UAAU9D,KAAK4U,GACb1gC,KAAKygC,OAAOzgC,KAAK4vB,cAU5B9D,KAAKhgB,GACH,IAAI60B,EAAW3gC,KAAKnC,QAAQiO,GAE5B,OAAI9L,KAAK2/B,SACA3/B,KAAK4/B,QAAQ/T,QAAQ8U,GAErB3gC,KAAK6rB,QAAQ8U,EAAU,KAAM3gC,KAAK0c,SAASoiB,mBAAoB9+B,KAAK0c,SAASqiB,gBAWxFlhC,QAAQiO,EAAMuK,GACZ,GAAKvK,EAAL,CAIA,IAAI60B,EAAW70B,EAGf,OAFiBA,EAAK/H,QAAQ,QAAU,EAG/B+H,GAGL9L,KAAK8L,OACP60B,EAAW3gC,KAAK8L,KAAKjO,QAAQiO,IAGf,GAAZuK,GAAqBrW,KAAKiH,MAC5B05B,EAAW3gC,KAAKiH,IAAIpJ,QAAQ8iC,IAGvBA,IASTrpB,UAAUxL,GAGR,OAAKA,EAID9L,KAAK0c,SAASpF,UACVtX,KAAK0c,SAASpF,UAAUxL,GAExB9L,KAAKnC,QAAQiO,GAAM,GANlB,GAmBXm0B,cAAcD,GACZ,IAEIvqB,EAEJ,MAA+B,WAA3BzV,KAAK0c,SAASsiB,SACTN,EAGW,iBAATsB,EACFtB,IAKTjpB,EAFM,IAAIqC,EAAKzM,QAAQ20B,GACZl0B,OACM2J,aAGfA,EAAYA,EAAU3M,QAAQ,QAAS,KAGpC2M,EAIa,SAAdA,EACKipB,EAGS,QAAdjpB,EACKipB,EAGS,SAAdjpB,EACKipB,OADT,EAXSA,GAsBX+B,OAAO7Q,GACL5vB,KAAKsrB,QAAUsE,EAEwB,KAAnC5vB,KAAK4vB,UAAUrE,SAASnH,OAE1BpkB,KAAK8rB,KAAK9rB,KAAKiH,IAAIpJ,QAvaW,kDAua2BijB,MAAK0f,IAC5DxgC,KAAKwrB,eAAiB,IAAIgT,EAAgBnzB,QAAQm1B,GAClDxgC,KAAKq/B,QAAQ7T,eAAe3tB,QAAQmC,KAAKwrB,mBACxCuU,OAAM5Y,IACPnnB,KAAKwrB,eAAiB,IAAIgT,EAAgBnzB,QAC1CrL,KAAKq/B,QAAQ7T,eAAe3tB,QAAQmC,KAAKwrB,oBAG3CxrB,KAAKwrB,eAAiB,IAAIgT,EAAgBnzB,QAC1CrL,KAAKq/B,QAAQ7T,eAAe3tB,QAAQmC,KAAKwrB,iBAG3CxrB,KAAK0qB,MAAM+V,OAAOzgC,KAAK4vB,UAAW5vB,KAAKnC,QAAQ4P,KAAKzN,MAAOA,KAAKsX,UAAU7J,KAAKzN,OAC/EA,KAAKy/B,UAAY,IAAIvB,EAAW7yB,QAAQrL,KAAK4vB,UAAU0P,SAAU,CAC/DM,QAAS5/B,KAAK4/B,QACdgB,SAAU5gC,KAAKnC,QAAQ4P,KAAKzN,MAC5B6rB,QAAS7rB,KAAK6rB,QAAQpe,KAAKzN,MAC3BsY,aAActY,KAAK0c,SAASpE,eAAiBtY,KAAK2/B,SAAW,UAAY,YAE3E3/B,KAAK6gC,eAAe7gC,KAAK4vB,WAAW9O,MAAK,KAEvC9gB,KAAKq/B,QAAQG,WAAW3hC,QAAQmC,KAAKw/B,eAGnCx/B,KAAK4vB,UAAUkR,YACjB9gC,KAAKu/B,MAAQv/B,KAAKnC,QAAQmC,KAAK4vB,UAAUkR,YAI3C9gC,KAAKq/B,QAAQC,SAASzhC,QAAQmC,KAAK4vB,UAAU0P,UAC7Ct/B,KAAKq/B,QAAQ9T,SAAS1tB,QAAQmC,KAAK4vB,UAAUrE,UAC7CvrB,KAAKq/B,QAAQ3U,MAAM7sB,QAAQmC,KAAK0qB,OAChC1qB,KAAKq/B,QAAQE,MAAM1hC,QAAQmC,KAAKu/B,OAChCv/B,KAAKq/B,QAAQI,UAAU5hC,QAAQmC,KAAKy/B,WACpCz/B,KAAKq/B,QAAQ7Q,SAAS3wB,QAAQmC,KAAKwuB,UACnCxuB,KAAKo/B,QAAS,EAEVp/B,KAAK2/B,UAAY3/B,KAAK0c,SAASpE,cAA8C,QAA9BtY,KAAK0c,SAASpE,aAC/DtY,KAAKsY,eAAewI,MAAK,KACvB9gB,KAAK0/B,OAAOlU,eAAe1K,MAAK,KAC9B9gB,KAAKm/B,QAAQthC,QAAQmC,YAEtB+/B,OAAM5Y,IACPlV,QAAQ8F,MAAMoP,MAIhBnnB,KAAK0/B,OAAOlU,eAAe1K,MAAK,KAC9B9gB,KAAKm/B,QAAQthC,QAAQmC,SAW3B6gC,eAAejR,GACb,IAAImR,EAAUnR,EAAUmR,SAAWnR,EAAUoR,QACzCC,EAAMrR,EAAUqR,IAEpB,OAAIA,EACK,IAAIrjC,SAAQ,CAACC,EAASC,KAC3BkC,KAAKw/B,WAAa,IAAIvB,EAAY5yB,QAAQ41B,GAEtCrR,EAAUpB,WACZxuB,KAAKwuB,SAAW,IAAI2P,EAAU9yB,QAAQukB,EAAUpB,WAGlD3wB,EAAQmC,KAAKw/B,eAIZuB,EAQE/gC,KAAK8rB,KAAKiV,EAAS,OAAOjgB,MAAK0f,IACpCxgC,KAAKw/B,WAAa,IAAIvB,EAAY5yB,QAAQm1B,GAC1CxgC,KAAKwuB,SAAW,IAAI2P,EAAU9yB,QAAQm1B,GAC/BxgC,KAAKw/B,cAVL,IAAI5hC,SAAQ,CAACC,EAASC,KAC3BkC,KAAKw/B,WAAa,IAAIvB,EAAY5yB,QAClCrL,KAAKwuB,SAAW,IAAI2P,EAAU9yB,QAC9BxN,EAAQmC,KAAKw/B,eAkBnBzoB,QAAQhW,GACN,OAAOf,KAAK0qB,MAAMmC,IAAI9rB,GAUxBmgC,SAASv6B,EAAS8V,GAGhB,OAFAzc,KAAK8/B,UAAY,IAAI1B,EAAW/yB,QAAQrL,KAAMyc,GAC9Czc,KAAK8/B,UAAUvT,SAAS5lB,GACjB3G,KAAK8/B,UAQdqB,sBAAsBC,GACpBphC,KAAK0c,SAASoiB,mBAAqBsC,EAQrCC,kBAAkB5oB,GAChBzY,KAAK0c,SAASqiB,eAAiBtmB,EAWjC6nB,UAAUN,EAAOhB,GAEf,OADAh/B,KAAK4/B,QAAU,IAAIvB,EAAShzB,QACrBrL,KAAK4/B,QAAQhmB,KAAKomB,EAAOhB,GAWlCE,MAAM/Y,GAEJ,IAAImb,EAAsBthC,KAAK0c,SAASpE,cAA+C,SAA/BtY,KAAK0c,SAASpE,aAElEipB,EAAcvhC,KAAKiH,IAEnBu6B,EAAYxhC,KAAK0c,SAASmiB,eAAiBP,EAAUjzB,QAAQoC,KAAKzN,MAmCtE,OAhCAA,KAAK6/B,QAAU,IAAItB,EAAOlzB,QAAQ8a,EAAMqb,EAAWxhC,KAAKnC,QAAQ4P,KAAKzN,OAErEA,KAAK6rB,QAAU7rB,KAAK6/B,QAAQhU,QAAQpe,KAAKzN,KAAK6/B,SAC9C7/B,KAAKgrB,OAAOlK,MAAK,KACX9gB,KAAK2/B,WACP3/B,KAAK6/B,QAAQ2B,UAAYxhC,KAAK4/B,QAAQ/T,QAAQpe,KAAKzN,KAAK4/B,UAI1D,IAAI6B,EAAsB,CAAChxB,EAAQsG,KACjCA,EAAQtG,OAASzQ,KAAKy/B,UAAUrnB,WAAW3H,EAAQsG,EAAQ9P,MAI7DjH,KAAKy/B,UAAU/iB,SAASpE,aAAegpB,GAAuB,UAE9DthC,KAAKy/B,UAAUnnB,eAAewI,MAAK,IAC1B9gB,KAAKy/B,UAAUiC,eAExB1hC,KAAK6/B,QAAQ5T,GAAG,WAAW,KAEzBjsB,KAAKiH,IAAM,IAAI6Q,EAAKzM,QAAQ,IAAK,IAEjCrL,KAAK0qB,MAAMjE,MAAM0D,UAAUzD,SAAS+a,MAEtCzhC,KAAK6/B,QAAQ5T,GAAG,UAAU,KAExBjsB,KAAKiH,IAAMs6B,EAEXvhC,KAAK0qB,MAAMjE,MAAM0D,UAAUxD,WAAW8a,SAGnCzhC,KAAK6/B,QAQd8B,WACE,OAAO3hC,KAAK0/B,OAAOH,MAAMze,MAAK,IACvB9gB,KAAKu/B,MAINv/B,KAAK2/B,SACA3/B,KAAK4/B,QAAQgC,UAAU5hC,KAAKu/B,OAE5Bv/B,KAAKu/B,MANL,OAiBbjnB,eAIE,OAHAtY,KAAK0qB,MAAMjE,MAAM0D,UAAUzD,UAAS,CAACjW,EAAQsG,KAC3CA,EAAQtG,OAASzQ,KAAKy/B,UAAUrnB,WAAW3H,EAAQsG,EAAQ9P,QAEtDjH,KAAKy/B,UAAUnnB,eAAewI,MAAK,IACjC9gB,KAAKy/B,UAAUiC,eAU1B90B,SAASkgB,GACP,IAAIzgB,EAAM,IAAI4N,EAAS5O,QAAQyhB,GAC3BtqB,EAAOxC,KAAK0qB,MAAMmC,IAAIxgB,EAAIT,UAE1Bi2B,EAAW7hC,KAAK8rB,KAAKre,KAAKzN,MAE9B,OAAKwC,EAMEA,EAAKspB,KAAK+V,GAAU/gB,MAAK,SAAUrJ,GAExC,OADYpL,EAAIwF,QAAQrP,EAAKhC,aANtB,IAAI5C,SAAQ,CAACC,EAASC,KAC3BA,EAAO,6BAgBb4jB,IAAImO,GACF,IAAIF,EAAQE,GAAc7vB,KAAK4vB,UAAUrE,SAASsE,YAAc7vB,KAAKiH,IAAIuO,SACzE,MAAQ,UAAS4E,EAAW3H,kBAAkBkd,IAOhDpJ,UACEvmB,KAAKgrB,YAAStiB,EACd1I,KAAKq/B,aAAU32B,EACf1I,KAAK0/B,YAASh3B,EACd1I,KAAK6gB,WAAQnY,EACb1I,KAAKo/B,QAAS,EACdp/B,KAAKwtB,YAAa,EAClBxtB,KAAK0qB,OAAS1qB,KAAK0qB,MAAMnE,UACzBvmB,KAAK2sB,WAAa3sB,KAAK2sB,UAAUpG,UACjCvmB,KAAKwuB,UAAYxuB,KAAKwuB,SAASjI,UAC/BvmB,KAAK4/B,SAAW5/B,KAAK4/B,QAAQrZ,UAC7BvmB,KAAKy/B,WAAaz/B,KAAKy/B,UAAUlZ,UACjCvmB,KAAK+Q,WAAa/Q,KAAK+Q,UAAUwV,UACjCvmB,KAAK4vB,WAAa5vB,KAAK4vB,UAAUrJ,UACjCvmB,KAAK8/B,WAAa9/B,KAAK8/B,UAAUvZ,UACjCvmB,KAAKwrB,gBAAkBxrB,KAAKwrB,eAAejF,UAC3CvmB,KAAK0qB,WAAQhiB,EACb1I,KAAK2sB,eAAYjkB,EACjB1I,KAAKwuB,cAAW9lB,EAChB1I,KAAK4/B,aAAUl3B,EACf1I,KAAKy/B,eAAY/2B,EACjB1I,KAAK+Q,eAAYrI,EACjB1I,KAAK4vB,eAAYlnB,EACjB1I,KAAK8/B,eAAYp3B,EACjB1I,KAAKw/B,gBAAa92B,EAClB1I,KAAKiH,SAAMyB,EACX1I,KAAK8L,UAAOpD,EACZ1I,KAAK2/B,UAAW,IAMpB,EAAI3lB,EAAc3O,SAASszB,EAAKr4B,WAChC,IAAIiM,EAAWosB,EACfphC,EAAQ8N,QAAUkH,G,+BCpwBlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAMgC3L,EAN5B4L,EAAQnD,EAAQ,IAEhBiS,EAAajS,EAAQ,IAErB6R,GAE4Bta,EAFWyI,EAAQ,MAEEzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAWvF,MAAMoiC,EACJ93B,YAAY0S,GACV1c,KAAK0c,SAAWA,EAChB1c,KAAKmmB,KAAOzJ,EAAS0H,QAAU,aAC/BpkB,KAAK+hC,QAA8B,SAApBrlB,EAASgN,OACxB1pB,KAAKgiC,gBAAkBtlB,EAASiN,gBAAkB,IAClD3pB,KAAKiiC,aAAevlB,EAASwlB,cAAe,EAEtB,aAAlBxlB,EAAS+M,MAAyC,wBAAlB/M,EAAS+M,MAAoD,iBAAlB/M,EAAS+M,KACtFzpB,KAAKqtB,MAAQ,WAEbrtB,KAAKqtB,MAAQ,YAGfrtB,KAAKvB,MAAQ,EACbuB,KAAKtB,OAAS,EACdsB,KAAKmiC,YAAc,EACnBniC,KAAKmyB,MAAQ,EACbnyB,KAAKwkB,YAAc,EACnBxkB,KAAKykB,IAAM,EACXzkB,KAAK6xB,QAAU,EACf7xB,KAAKkG,MAAQ,CACXigB,KAAMnmB,KAAKmmB,KACXuD,OAAQ1pB,KAAK+hC,QACbtY,KAAMzpB,KAAKqtB,MACX5uB,MAAO,EACPC,OAAQ,EACRyjC,YAAa,EACbhQ,MAAO,EACP3N,YAAa,EACbC,IAAK,EACLoN,QAAS,GAUbpI,KAAKA,GAcH,MAbmB,oBAARA,IAEPzpB,KAAKqtB,MADM,aAAT5D,GAAgC,wBAATA,GAA2C,iBAATA,EAC9C,WAEA,YAIfzpB,KAAKoiC,OAAO,CACV3Y,KAAMzpB,KAAKqtB,SAIRrtB,KAAKqtB,MAWd3D,OAAOA,EAAQgE,GAab,OAZIhE,IACF1pB,KAAK+hC,QAAqB,SAAXrY,EAEf1pB,KAAKoiC,OAAO,CACV1Y,OAAQ1pB,KAAK+hC,WAIbrU,GAAO,IACT1tB,KAAKgiC,gBAAkBtU,GAGlB1tB,KAAK+hC,QAUdhN,UAAUjY,EAAQC,EAASslB,GACzB,IAOI7d,EACA2d,EACA9O,EACAlB,EAVAN,EAAU,EACVpN,EAAM4d,GAAQ,EAGd5jC,EAAQqe,EACRpe,EAASqe,EACThG,EAAUzW,KAAK0D,MAAMvF,EAAQ,IAO/BozB,EADE7xB,KAAK+hC,SAAWtjC,GAASuB,KAAKgiC,gBACtB,EAEA,EAGM,eAAdhiC,KAAKmmB,MAAwC,cAAfnmB,KAAKqtB,OAA2BgV,GAAQ,IACxE5d,EAAM1N,EAAU,IAAM,EAAIA,EAAUA,EAAU,GAG9B,kBAAd/W,KAAKmmB,OACP1B,EAAM,GAIJoN,EAAU,EAKZwB,GADA7O,EAAc/lB,EAAQozB,EAAUpN,GACNA,GAE1BD,EAAc/lB,EACd40B,EAAY50B,GAGI,kBAAduB,KAAKmmB,MAA4B0L,EAAU,IAC7CpzB,EAAQ+lB,GAGV2d,EAAc3d,EAAcqN,EAAUpN,EACtC0N,EAAQ1zB,EACRuB,KAAKvB,MAAQA,EACbuB,KAAKtB,OAASA,EACdsB,KAAKmiC,YAAcA,EACnBniC,KAAKqzB,UAAYA,EACjBrzB,KAAKmyB,MAAQA,EACbnyB,KAAKwkB,YAAcA,EACnBxkB,KAAKykB,IAAMA,EACXzkB,KAAK6xB,QAAUA,EAUf7xB,KAAKoiC,OAAO,CACV3jC,QACAC,SACAyjC,cACA9O,YACAlB,QACA3N,cACAC,MACAoN,YAUJyQ,OAAO7qB,EAAUV,EAAS+N,GAaxB,MAVkB,kBAAd9kB,KAAKmmB,KACK1O,EAAS6N,IAAItlB,KAAKwkB,YAAaxkB,KAAKtB,OAAQqY,GAChC,cAAf/W,KAAKqtB,MACF5V,EAAS8M,QAAQvkB,KAAKvB,MAAOuB,KAAKtB,OAAQsB,KAAKwkB,YAAaxkB,KAAKykB,IAAKzkB,KAAK0c,SAASsI,WACvFF,GAAiB,eAATA,EACLrN,EAAS4M,KAAK,KAAMrkB,KAAKtB,QAEzB+Y,EAAS4M,KAAKrkB,KAAKvB,MAAO,MAa1Cm1B,MAAM2O,EAAaC,GACjB,IAAIC,EAASzU,EAgBb,MAdkB,kBAAdhuB,KAAKmmB,MACPsc,EAAU,EACVzU,EAAQ,GACgB,cAAfhuB,KAAKqtB,OACdmV,EAAaA,GAAcxiC,KAAKmyB,MAChCsQ,EAAUniC,KAAKwzB,KAAKyO,EAAcC,GAClCxU,EAAQyU,EAAUziC,KAAK6xB,UAGvB2Q,EAAaA,GAAcxiC,KAAKtB,OAChC+jC,EAAUniC,KAAKwzB,KAAKyO,EAAcC,GAClCxU,EAAQyU,GAGH,CACLA,UACAzU,SAUJoU,OAAOl8B,GAQL,GANA7I,OAAOmlB,KAAKtc,GAAOvH,SAAQyC,IACrBpB,KAAKkG,MAAM9E,KAAc8E,EAAM9E,WAC1B8E,EAAM9E,MAIb/D,OAAOmlB,KAAKtc,GAAOtG,OAAS,EAAG,CACjC,IAAI8iC,GAAW,EAAIp3B,EAAMxK,QAAQd,KAAKkG,MAAOA,GAC7ClG,KAAK0d,KAAKtD,EAAW5H,OAAOmC,OAAOC,QAAS8tB,EAAUx8B,MAM5D,EAAI8T,EAAc3O,SAASy2B,EAAOx7B,WAClC,IAAIiM,EAAWuvB,EACfvkC,EAAQ8N,QAAUkH,G,6BCrQlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAIgC3L,EAJ5Bua,GAI4Bva,EAJMyI,EAAQ,MAIOzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAFnF4L,EAAQnD,EAAQ,IAsdpB,IAAIoK,EA1cJ,MACEvI,YAAYoa,EAAQY,EAAWF,EAAMiB,GAAM,GACzC/lB,KAAKokB,OAASA,EACdpkB,KAAK2iC,WAAsB,eAAT7d,EAClB9kB,KAAKglB,UAAYA,GAAa,MAC9BhlB,KAAK4iC,KAAO7c,EAOdhP,QAAQyS,GACN,IAAItb,EAASlO,KAAK6iC,WAAWrZ,GAE7B,OADUxpB,KAAK8iC,mBAAmBtZ,EAAKzS,QAAQ6D,QAAS1M,GAY1D8X,KAAKvO,EAAUmD,EAAS9X,EAAOC,GAC7B,IACI5E,EADAiJ,KAAOqQ,IAAYA,EAASjX,WAAWiX,EAASjX,SAASG,KAG7D,GAAKyG,EAAL,CASA,GALAjJ,EAAS6B,KAAK+iC,mBAAmBnoB,EAAS,CACxC9X,MAAO9C,KAAKgjC,UAAU57B,EAAMtE,EAAOC,GACnCA,IAAK/C,KAAKijC,QAAQ77B,EAAMtE,EAAOC,MAGf,IAAd/C,KAAK4iC,KAAe,CACtB,IAAIv+B,EAAMoT,EAASjX,SACf0iC,EAAa,IAAIjpB,EAAS5O,QAAQlN,EAAO2E,OAAO+O,QAAQxN,GACxD8+B,EAAW,IAAIlpB,EAAS5O,QAAQlN,EAAO4E,KAAK8O,QAAQxN,GACpDsf,EAAYtf,EAAI0W,YAAY6I,eAC5B5a,EAAI3E,EAAIK,cACZif,EAAUyf,kBACVp6B,EAAEuB,SAAS24B,EAAW74B,eAAgB64B,EAAW54B,aACjDtB,EAAE4B,OAAOu4B,EAASh5B,aAAcg5B,EAAS/4B,WACzCuZ,EAAU0f,SAASr6B,GAGrB,OAAO7K,GAWTuJ,KAAKN,EAAMC,GAIT,IAAID,GAAQA,EAAKzF,WAAa4C,KAAKC,UAAnC,CAMA,IAAI+B,EACU,SAAU7E,GACpB,OAAIA,EAAKxC,KAAKokC,OAAO1jC,OAAS,EACrB4H,WAAW+7B,cAEX/7B,WAAWg8B,eAIpBC,EAAal9B,EACjBk9B,EAAWC,WAAan9B,EAKxB,IAJA,IACI7E,EACAvD,EAFAoJ,EAAa/G,SAAS8G,iBAAiBF,EAAMI,WAAWC,UAAWg8B,GAAY,IAI5E/hC,EAAO6F,EAAWmC,eACvBvL,EAASkJ,EAAK3F,MAIhB,OAAOvD,GAGT0kC,WAAWrZ,GAST,IARA,IAMI1mB,EAAOC,EANPwhB,EAAU,GACVxI,EAAcyN,EAAK/R,SAASsE,cAE5B6X,EADUtzB,KAAKwzB,KAAK/X,EAAc/b,KAAKokB,OAAO+d,aAC5BniC,KAAKokB,OAAOyN,QAC9BrN,EAAcxkB,KAAKokB,OAAOI,YAC1BC,EAAMzkB,KAAKokB,OAAOK,IAGb9kB,EAAI,EAAGA,EAAIi0B,EAAM5F,MAAOruB,IAC/BmD,GAAS0hB,EAAcC,GAAO9kB,EAC9BoD,EAAMyhB,GAAe7kB,EAAI,GAAK8kB,EAAM9kB,EACpC4kB,EAAQ1iB,KAAK,CACXiB,MAAO9C,KAAKgjC,UAAUxZ,EAAKhpB,SAASG,KAAMmC,EAAOC,GACjDA,IAAK/C,KAAKijC,QAAQzZ,EAAKhpB,SAASG,KAAMmC,EAAOC,KAIjD,OAAOwhB,EAYTye,UAAU57B,EAAMtE,EAAOC,GAMrB,IALA,IACI4gC,EACA1U,EAFAxV,EAAQ,CAACrS,GAGTw8B,EAAQx8B,EAELqS,EAAM7Z,QA+CX,GA9CA+jC,EAAMlqB,EAAMpM,QACZ4hB,EAAQjvB,KAAK0H,KAAKi8B,GAAKjiC,IACrB,IAAIsG,EAAMC,EAAOF,EAAKG,EAClB9D,EAIJ,GAFAA,GAAQ,EAAIkH,EAAMnH,YAAYzC,GAE1B1B,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,UAAqB,CAI/C,GAHAhd,EAAOhI,KAAK2iC,WAAav+B,EAAM4D,KAAO5D,EAAM2D,IAC5CE,EAAQjI,KAAK2iC,WAAav+B,EAAM6D,MAAQ7D,EAAM8D,OAE1CF,GAAQlF,GAASkF,GAAQjF,EAC3B,OAAOrB,EACF,GAAIuG,EAAQnF,EACjB,OAAOpB,EAEPkiC,EAAQliC,EACR+X,EAAM5X,KAAKH,QAER,GAAI1B,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,UAAqB,CAItD,GAHAhd,EAAO5D,EAAM4D,MACbC,EAAQ7D,EAAM6D,QAEDlF,GAAOkF,GAASnF,EAC3B,OAAOpB,EACF,GAAIsG,EAAOjF,EAChB,OAAOrB,EAEPkiC,EAAQliC,EACR+X,EAAM5X,KAAKH,OAER,CAIL,GAHAqG,EAAM3D,EAAM2D,IACZG,EAAS9D,EAAM8D,OAEXH,GAAOjF,GAASiF,GAAOhF,EACzB,OAAOrB,EACF,GAAIwG,EAASpF,EAClB,OAAOpB,EAEPkiC,EAAQliC,EACR+X,EAAM5X,KAAKH,OAMf,OAAO1B,KAAK6jC,mBAAmB5U,EAAOnsB,EAAOC,GAKjD,OAAO/C,KAAK6jC,mBAAmBD,EAAO9gC,EAAOC,GAY/CkgC,QAAQ77B,EAAMtE,EAAOC,GAMnB,IALA,IACI4gC,EAEA1U,EAHAxV,EAAQ,CAACrS,GAETw8B,EAAQx8B,EAGLqS,EAAM7Z,QA+CX,GA9CA+jC,EAAMlqB,EAAMpM,QACZ4hB,EAAQjvB,KAAK0H,KAAKi8B,GAAKjiC,IACrB,IAAIsG,EAAMC,EAAOF,EAAKG,EAClB9D,EAIJ,GAFAA,GAAQ,EAAIkH,EAAMnH,YAAYzC,GAE1B1B,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,UAAqB,CAI/C,GAHAhd,EAAO1H,KAAKub,MAAMzX,EAAM4D,MACxBC,EAAQ3H,KAAKub,MAAMzX,EAAM6D,OAErBD,EAAOjF,GAAO6gC,EAChB,OAAOA,EACF,GAAI37B,EAAQlF,EACjB,OAAOrB,EAEPkiC,EAAQliC,EACR+X,EAAM5X,KAAKH,QAER,GAAI1B,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,UAAqB,CAItD,GAHAhd,EAAO1H,KAAKub,MAAM7b,KAAK2iC,WAAav+B,EAAM4D,KAAO5D,EAAM2D,MACvDE,EAAQ3H,KAAKub,MAAM7b,KAAK2iC,WAAav+B,EAAM6D,MAAQ7D,EAAM8D,SAE7CpF,GAAS8gC,EACnB,OAAOA,EACF,GAAI57B,EAAOlF,EAChB,OAAOpB,EAEPkiC,EAAQliC,EACR+X,EAAM5X,KAAKH,OAER,CAIL,GAHAqG,EAAMzH,KAAKub,MAAMzX,EAAM2D,KACvBG,EAAS5H,KAAKub,MAAMzX,EAAM8D,QAEtBH,EAAMhF,GAAO6gC,EACf,OAAOA,EACF,GAAI17B,EAASnF,EAClB,OAAOrB,EAEPkiC,EAAQliC,EACR+X,EAAM5X,KAAKH,OAMf,OAAO1B,KAAK8jC,iBAAiB7U,EAAOnsB,EAAOC,GAK/C,OAAO/C,KAAK8jC,iBAAiBF,EAAO9gC,EAAOC,GAY7C8gC,mBAAmBniC,EAAMoB,EAAOC,GAM9B,IALA,IACI8I,EACAmV,EAFA9S,EAASlO,KAAK+jC,wBAAwBriC,GAKjC/B,EAAI,EAAGA,EAAIuO,EAAOtO,OAAQD,IAIjC,GAFAqhB,GADAnV,EAAQqC,EAAOvO,IACHiF,wBAER5E,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,WAG1B,GAFOhE,EAAIhZ,MAEClF,EACV,OAAO+I,OAEJ,GAAI7L,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,WAGjC,GAFQhE,EAAI/Y,OAEClF,EACX,OAAO8I,OAKT,GAFMmV,EAAIjZ,KAECjF,EACT,OAAO+I,EAMb,OAAOqC,EAAO,GAYhB41B,iBAAiBpiC,EAAMoB,EAAOC,GAO5B,IANA,IACIqqB,EACAvhB,EACAmV,EACAhZ,EAAMC,EAAOF,EAAKG,EAJlBgG,EAASlO,KAAK+jC,wBAAwBriC,GAMjC/B,EAAI,EAAGA,EAAIuO,EAAOtO,OAAQD,IAAK,CAItC,GAFAqhB,GADAnV,EAAQqC,EAAOvO,IACHiF,wBAER5E,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,UAAqB,CAI/C,GAHAhd,EAAOgZ,EAAIhZ,KACXC,EAAQ+Y,EAAI/Y,MAERD,EAAOjF,GAAOqqB,EAChB,OAAOA,EACF,GAAInlB,EAAQlF,EACjB,OAAO8I,OAEJ,GAAI7L,KAAK2iC,YAAiC,QAAnB3iC,KAAKglB,UAAqB,CAItD,GAHAhd,EAAOgZ,EAAIhZ,MACXC,EAAQ+Y,EAAI/Y,OAEAnF,GAASsqB,EACnB,OAAOA,EACF,GAAIplB,EAAOlF,EAChB,OAAO+I,MAEJ,CAIL,GAHA9D,EAAMiZ,EAAIjZ,IACVG,EAAS8Y,EAAI9Y,OAETH,EAAMhF,GAAOqqB,EACf,OAAOA,EACF,GAAIllB,EAASnF,EAClB,OAAO8I,EAIXuhB,EAAOvhB,EAIT,OAAOqC,EAAOA,EAAOtO,OAAS,GAWhCmkC,wBAAwBriC,EAAMsiC,GAC5B,IAGIn4B,EAHAqC,EAAS,GAET+1B,GADcviC,EAAKwJ,aAAe,IACfo4B,OAEnBj/B,EAAM3C,EAAK4C,cACX4/B,EAAWF,GAAa,IACxBhjB,EAAMijB,EAAKlgC,QAAQmgC,GAEvB,IAAa,IAATljB,GAActf,EAAKC,UAAY4C,KAAKC,UAGtC,OAFAqH,EAAQxH,EAAIK,eACNC,mBAAmBjD,GAClB,CAACmK,GASV,KANAA,EAAQxH,EAAIK,eACN6F,SAAS7I,EAAM,GACrBmK,EAAMjB,OAAOlJ,EAAMsf,GACnB9S,EAAOrM,KAAKgK,GACZA,GAAQ,GAEO,GAARmV,IACLA,EAAMijB,EAAKlgC,QAAQmgC,EAAUljB,EAAM,IAEzB,IACJnV,IACFA,EAAMjB,OAAOlJ,EAAMsf,GACnB9S,EAAOrM,KAAKgK,KAGdA,EAAQxH,EAAIK,eACN6F,SAAS7I,EAAMsf,EAAM,IAS/B,OALInV,IACFA,EAAMjB,OAAOlJ,EAAMuiC,EAAKrkC,QACxBsO,EAAOrM,KAAKgK,IAGPqC,EAWT60B,mBAAmBnoB,EAASupB,GAC1B,IAAIjB,EAAaiB,EAAUrhC,MACvBqgC,EAAWgB,EAAUphC,IAKzB,OAJAmgC,EAAWx4B,UAAS,GACpBy4B,EAASz4B,UAAS,GAGX,CACL5H,MAHa,IAAImX,EAAS5O,QAAQ63B,EAAYtoB,GAASjT,WAIvD5E,IAHW,IAAIkX,EAAS5O,QAAQ83B,EAAUvoB,GAASjT,YAOvDm7B,mBAAmBloB,EAAS2J,GAI1B,IAHA,IACI6f,EADA92B,EAAM,GAGD3N,EAAI,EAAGA,EAAI4kB,EAAQ3kB,OAAQD,IAClCykC,EAAUpkC,KAAK+iC,mBAAmBnoB,EAAS2J,EAAQ5kB,IACnD2N,EAAIzL,KAAKuiC,GAGX,OAAO92B,EASTwX,KAAKA,GAKH,OAJIA,IACF9kB,KAAK2iC,WAAsB,eAAT7d,GAGb9kB,KAAK2iC,aAMhBplC,EAAQ8N,QAAUkH,G,6BC9dlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI2O,EAAgB9D,EAAuB/N,EAAQ,KAE/CmD,EAAQnD,EAAQ,IAEhB8R,EAAW/D,EAAuB/N,EAAQ,KAE1Ck8B,EAAYnuB,EAAuB/N,EAAQ,KAE3CiS,EAAajS,EAAQ,IAErBm8B,EAAan8B,EAAQ,KAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,MAAM6kC,EACJv6B,YAAY+M,EAAS0F,GACnBzc,KAAK0c,UAAW,EAAIpR,EAAMxK,QAAQ,CAChC4K,YAAa,GACboZ,UAAMpc,EAENsc,eAAWtc,EACXjK,MAAO,EACPC,OAAQ,EACR0lB,YAAQ1b,EACRqjB,uBAAwB,GACxByE,YAAQ9nB,EACRgpB,YAAY,EACZzH,sBAAsB,GACrBxN,GAAW,IACdzc,KAAKC,GAAK,gBAAiB,EAAIqL,EAAMpL,QACrCF,KAAK+W,QAAUA,EACf/W,KAAKuJ,MAAQwN,EAAQxN,MACrBvJ,KAAK2G,QAAU3G,KAAK+Q,UAAU/Q,KAAK0c,SAASoI,MAC5C9kB,KAAKwkC,OAAQ,EACbxkC,KAAK0sB,WAAY,EACjB1sB,KAAK0wB,UAAW,EAGhB1wB,KAAKykC,WAAa,EAClBzkC,KAAK0kC,YAAc,EAEnB1kC,KAAK8a,QAAU,IAAIb,EAAS5O,QAC5BrL,KAAKokB,OAASpkB,KAAK0c,SAAS0H,OAG5BpkB,KAAK2kC,UAAOj8B,EACZ1I,KAAK4kC,WAAa,GAClB5kC,KAAK6kC,WAAa,GAClB7kC,KAAK8kC,MAAQ,GAGf/zB,UAAU+T,GACR,IAAIne,EAAUnG,SAASyW,cAAc,OAerC,OAdAtQ,EAAQuJ,UAAU8S,IAAI,aAEtBrc,EAAQrI,MAAMI,OAAS,MACvBiI,EAAQrI,MAAMG,MAAQ,MACtBkI,EAAQrI,MAAM0d,SAAW,SACzBrV,EAAQrI,MAAM4Q,SAAW,WACzBvI,EAAQrI,MAAM4rB,QAAU,QAGtBvjB,EAAQrI,MAAMymC,KADZjgB,GAAgB,cAARA,EACW,OAEA,UAGhBne,EAGTuwB,SACE,OAAIl3B,KAAKglC,SAIJhlC,KAAK2G,UACR3G,KAAK2G,QAAU3G,KAAKilC,mBAGtBjlC,KAAKglC,OAASxkC,SAASyW,cAAc,UACrCjX,KAAKglC,OAAO/kC,GAAKD,KAAKC,GACtBD,KAAKglC,OAAOE,UAAY,KAExBllC,KAAKglC,OAAO1mC,MAAM0d,SAAW,SAC7Bhc,KAAKglC,OAAOG,SAAW,WAEvBnlC,KAAKglC,OAAO1mC,MAAMsd,OAAS,OAE3B5b,KAAKglC,OAAOI,QAAU,oBAElBplC,KAAK0c,SAASuN,sBAAwBjqB,KAAK+W,QAAQ4O,WAAW5hB,QAAQ,aAAe,IACvF/D,KAAKglC,OAAOI,SAAW,kBAGzBplC,KAAKglC,OAAO7tB,aAAa,oBAAqB,QAC9CnX,KAAKqlC,UAAW,EAEhBrlC,KAAK2G,QAAQrI,MAAMgnC,WAAa,SAChCtlC,KAAKglC,OAAO1mC,MAAMgnC,WAAa,SAC/BtlC,KAAKglC,OAAO1mC,MAAMG,MAAQ,IAC1BuB,KAAKglC,OAAO1mC,MAAMI,OAAS,IAC3BsB,KAAK8c,OAAS,EACd9c,KAAK+c,QAAU,EACf/c,KAAK2G,QAAQwQ,aAAa,MAAOnX,KAAKuJ,OACtCvJ,KAAKwkC,OAAQ,EACbxkC,KAAKulC,eAAgB,EAAIj6B,EAAMxM,QAAQkB,KAAK2G,SAQxC,WAAY3G,KAAKglC,OACnBhlC,KAAKwlC,gBAAiB,EAEtBxlC,KAAKwlC,gBAAiB,EAGnBxlC,KAAK0c,SAAS8T,SACjBxwB,KAAK0c,SAAS8T,OAASxwB,KAAKwlC,eAAiB,SAAW,UAhDjDxlC,KAAKglC,OAsDhB3a,OAAOwB,EAASvB,GAWd,OATAtqB,KAAKk3B,SAELl3B,KAAKqkB,OAEArkB,KAAKylC,gBACRzlC,KAAKylC,cAAgBzlC,KAAK+W,QAAQsT,OAAOwB,IAIpC7rB,KAAKylC,cAAc3kB,KAAK,SAAUrJ,GACvC,OAAOzX,KAAK8rB,KAAKrU,IACjBhK,KAAKzN,OAAO8gB,KAAK,WAEjB,IAEIgE,EAFAC,EAAc/kB,KAAKyX,SAASsN,cAsBhC,OAjBED,EADyB,aAAvB9kB,KAAK0c,SAAS+M,KAC2B,IAApC1E,EAAYhhB,QAAQ,YAAoB,aAAe,WAEnB,IAApCghB,EAAYhhB,QAAQ,YAAoB,WAAa,aAGtB,IAApCghB,EAAYhhB,QAAQ,aAA4C,cAAvB/D,KAAK0c,SAAS+M,OACzDzpB,KAAKokB,OAAO+N,MAAQnyB,KAAKokB,OAAO1lB,QAGlCsB,KAAK0lC,QAAQ5gB,GACb9kB,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMC,KAAMiR,GACxC9kB,KAAK2lC,eAAe5gB,GACpB/kB,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAME,aAAciR,GAEhD/kB,KAAKokB,OAAOke,OAAOtiC,KAAKyX,SAAUzX,KAAK+W,QAAS/W,KAAK8kB,MAErD9kB,KAAK4lC,eACE,IAAIhoC,SAAQ,CAACC,EAASC,KAE3BkC,KAAKyd,SAEDzd,KAAK0c,SAASgV,aAChB1xB,KAAK2G,QAAQrI,MAAMunB,WAAa7lB,KAAKvB,QAAU,MAGjDZ,QAEF4P,KAAKzN,MAAO,SAAUmS,GAEtB,OADAnS,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMG,WAAY5B,GACvC,IAAIvU,SAAQ,CAACC,EAASC,KAC3BA,EAAOqU,OAET1E,KAAKzN,OAAO8gB,KAAK,WACjB9gB,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMI,SAAUhU,KAAK+W,UACjDtJ,KAAKzN,OAGT6lC,QACM7lC,KAAKglC,SACPhlC,KAAKglC,OAAO1mC,MAAMG,MAAQ,IAC1BuB,KAAKglC,OAAO1mC,MAAMI,OAAS,IAC3BsB,KAAK8c,OAAS,EACd9c,KAAK+c,QAAU,EACf/c,KAAK8lC,gBAAap9B,EAClB1I,KAAK+lC,mBAAgBr9B,EACrB1I,KAAKgmC,iBAAct9B,EACnB1I,KAAKimC,oBAAiBv9B,GAGxB1I,KAAKkmC,eAAgB,EAIvB7hB,KAAKvH,EAAQC,GACX,IAAIte,EAAQqe,GAAU9c,KAAK0c,SAASje,MAChCC,EAASqe,GAAW/c,KAAK0c,SAAShe,OAEb,kBAArBsB,KAAKokB,OAAO+B,KACdnmB,KAAKmmC,KAAK,OAAQ1nC,EAAOC,GACO,eAAvBsB,KAAK0c,SAASoI,KACvB9kB,KAAKmmC,KAAK,SAAU1nC,EAAOC,GAE3BsB,KAAKmmC,KAAK,QAAS1nC,EAAOC,GAG5BsB,KAAK0c,SAASje,MAAQA,EACtBuB,KAAK0c,SAAShe,OAASA,EAIzBynC,KAAKzwB,EAAMjX,EAAOC,GAChB,IACI0nC,EADAC,GAAY,EAAI/6B,EAAMlN,SAAS4B,KAAK2G,SAItCy/B,EADEpmC,KAAKglC,QACS,EAAI15B,EAAMlN,SAAS4B,KAAKglC,QAExB,CACdvmC,MAAO,EACPC,OAAQ,GAIA,SAARgX,IAAmB,EAAIpK,EAAMxH,UAAUrF,KACzCuB,KAAKsmC,YAAc7nC,EAAQ4nC,EAAU5nC,MAAQ2nC,EAAc3nC,OAGjD,UAARiX,IAAoB,EAAIpK,EAAMxH,UAAUpF,KAC1CsB,KAAKumC,aAAe7nC,EAAS2nC,EAAU3nC,OAAS0nC,EAAc1nC,QAGnD,SAATgX,IAAmB,EAAIpK,EAAMxH,UAAUrF,KAAU,EAAI6M,EAAMxH,UAAUpF,KACvEsB,KAAKsmC,YAAc7nC,EAAQ4nC,EAAU5nC,MAAQ2nC,EAAc3nC,MAC3DuB,KAAKumC,aAAe7nC,EAAS2nC,EAAU3nC,OAAS0nC,EAAc1nC,QAG5DsB,KAAK0sB,WAAa1sB,KAAKglC,QAEzBhlC,KAAKyd,SAKTA,OAAO+oB,GACL,IAEIjiB,EAFA9lB,EAAQuB,KAAKsmC,YACb5nC,EAASsB,KAAKumC,aAGbvmC,KAAKglC,SAAUhlC,KAAKuf,aACzBvf,KAAKuf,YAAa,EAEO,kBAArBvf,KAAKokB,OAAO+B,MACd1nB,EAAQuB,KAAKokB,OAAOI,YACpB9lB,EAASsB,KAAKokB,OAAO1lB,QAES,eAAvBsB,KAAK0c,SAASoI,OAErBrmB,EAAQuB,KAAKyX,SAASiE,aAEV1b,KAAKokB,OAAOiP,UAAY,IAClC50B,EAAQ6B,KAAKwzB,KAAKr1B,EAAQuB,KAAKokB,OAAOiP,WAAarzB,KAAKokB,OAAOiP,WAG7DrzB,KAAK0c,SAAS+T,iBAChBlM,EAAU9lB,EAAQuB,KAAKokB,OAAOiP,UAE1BrzB,KAAKokB,OAAOyN,QAAU,GAA0B,eAArB7xB,KAAKokB,OAAO+B,MAAyB5B,EAAU,EAAI,IAEhF9lB,GAASuB,KAAKokB,OAAOiP,aAIK,aAAvBrzB,KAAK0c,SAASoI,OACrBpmB,EAASsB,KAAKyX,SAASqE,aAEI,cAAvB9b,KAAK0c,SAAS+M,MAAwB/qB,EAASsB,KAAKokB,OAAO1lB,OAAS,IACtEA,EAAS4B,KAAKwzB,KAAKp1B,EAASsB,KAAKokB,OAAO1lB,QAAUsB,KAAKokB,OAAO1lB,UAM9DsB,KAAKkmC,eAAiBznC,GAASuB,KAAK8c,QAAUpe,GAAUsB,KAAK+c,UAC/D/c,KAAKymC,QAAQhoC,EAAOC,GAGtBsB,KAAKuf,YAAa,GAGpBknB,QAAQhoC,EAAOC,GACb,IAAI2lB,GAEA,EAAI/Y,EAAMxH,UAAUrF,KACtBuB,KAAK2G,QAAQrI,MAAMG,MAAQA,EAAQ,KACnCuB,KAAKglC,OAAO1mC,MAAMG,MAAQA,EAAQ,KAClCuB,KAAK8c,OAASre,IAGZ,EAAI6M,EAAMxH,UAAUpF,KACtBsB,KAAK2G,QAAQrI,MAAMI,OAASA,EAAS,KACrCsB,KAAKglC,OAAO1mC,MAAMI,OAASA,EAAS,KACpCsB,KAAK+c,QAAUre,GAKjB2lB,EAAO,CACL5lB,MAAOA,EACPC,OAAQA,EACRk0B,WALe5yB,KAAK0mC,WAAajoC,EAAQuB,KAAK0mC,WAAWjoC,MAAQA,EAMjEk0B,YALgB3yB,KAAK0mC,WAAahoC,EAASsB,KAAK0mC,WAAWhoC,OAASA,GAOtEsB,KAAK2kC,MAAQ3kC,KAAK2kC,KAAKta,SACvBtjB,uBAAsB,KACpB,IAAI4/B,EAEJ,IAAK,IAAItnB,KAAKrf,KAAK8kC,MACb9kC,KAAK8kC,MAAMlzB,eAAeyN,KAC5BsnB,EAAO3mC,KAAK8kC,MAAMzlB,GAClBrf,KAAK4mC,UAAUD,EAAKhgC,QAASggC,EAAK96B,WAIxC7L,KAAK4e,SAAS5e,KAAMqkB,GACpBrkB,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMN,QAAS+Q,GAC3CrkB,KAAK0mC,WAAariB,EAClBrkB,KAAKulC,eAAgB,EAAIj6B,EAAMxM,QAAQkB,KAAK2G,SAG9CmlB,KAAKrU,GACH,IAAI4nB,EAAU,IAAI/zB,EAAMvL,MACpB2/B,EAASL,EAAQl/B,QAErB,IAAKH,KAAKglC,OAER,OADA3F,EAAQvhC,OAAO,IAAI+H,MAAM,wBAClB65B,EAOT,GAJA1/B,KAAKglC,OAAOtkB,OAAS,SAAU+Y,GAC7Bz5B,KAAK6mC,OAAOpN,EAAO4F,IACnB5xB,KAAKzN,MAEsB,YAAzBA,KAAK0c,SAAS8T,OAChBxwB,KAAK8mC,SAAU,EAAIx7B,EAAMhM,eAAemY,EAAU,yBAClDzX,KAAKglC,OAAO1jB,IAAMthB,KAAK8mC,QACvB9mC,KAAK2G,QAAQ4Q,YAAYvX,KAAKglC,aACzB,GAA6B,WAAzBhlC,KAAK0c,SAAS8T,OACvBxwB,KAAKglC,OAAO+B,OAAStvB,EACrBzX,KAAK2G,QAAQ4Q,YAAYvX,KAAKglC,YACzB,CAIL,GAHAhlC,KAAK2G,QAAQ4Q,YAAYvX,KAAKglC,QAC9BhlC,KAAKQ,SAAWR,KAAKglC,OAAOgC,iBAEvBhnC,KAAKQ,SAER,OADA6+B,EAAQvhC,OAAO,IAAI+H,MAAM,0BAClB65B,EAKT,GAFA1/B,KAAKglC,OAAOgC,gBAAgBptB,OAExBrb,OAAO0oC,OAASA,MAAMC,wBAAyB,CACjD,IAAIC,EAAYnnC,KAChBinC,MAAMC,yBAAwB,WAC5BC,EAAUnC,OAAOgC,gBAAgBI,MAAM3vB,WAGzCzX,KAAKglC,OAAOgC,gBAAgBI,MAAM3vB,GAGpCzX,KAAKglC,OAAOgC,gBAAgBK,QAG9B,OAAO3H,EAGTmH,OAAOpN,EAAOt5B,GACZH,KAAKzB,OAASyB,KAAKglC,OAAOsC,cAC1BtnC,KAAKQ,SAAWR,KAAKglC,OAAOgC,gBAC5BhnC,KAAKyX,SAAW,IAAI4sB,EAAUh5B,QAAQrL,KAAKQ,SAAUR,KAAKQ,SAASG,KAAMX,KAAK+W,QAAQ6D,QAAS5a,KAAK+W,QAAQxN,OAC5GvJ,KAAKunC,WAAY,EACjB,IAAIlwB,EAAOrX,KAAKQ,SAASsF,cAAc,yBAEnCuR,EACFA,EAAKF,aAAa,OAAQnX,KAAK+W,QAAQO,aAEvCD,EAAOrX,KAAKQ,SAASyW,cAAc,SAC9BE,aAAa,MAAO,aACzBE,EAAKF,aAAa,OAAQnX,KAAK+W,QAAQO,WACvCtX,KAAKQ,SAASsF,cAAc,QAAQyR,YAAYF,IAGlDrX,KAAKyX,SAASwU,GAAG7R,EAAW5H,OAAOK,SAASC,QAAQ,KAC9C9S,KAAK0sB,WAAa1sB,KAAKglC,SACzBhlC,KAAKyd,SAEDzd,KAAKyX,UACPzX,KAAKokB,OAAOke,OAAOtiC,KAAKyX,cAI9BzX,KAAKyX,SAASwU,GAAG7R,EAAW5H,OAAOK,SAASE,QAAQZ,IAC9CnS,KAAK0sB,WAAa1sB,KAAKglC,SACzBhlC,KAAKyd,SAEDzd,KAAKyX,UACPzX,KAAKokB,OAAOke,OAAOtiC,KAAKyX,cAI9BtX,EAAQtC,QAAQmC,KAAKyX,UAGvBud,UAAU5Q,GACRpkB,KAAKokB,OAASA,EAEVpkB,KAAKyX,WACPzX,KAAKokB,OAAOke,OAAOtiC,KAAKyX,UACxBzX,KAAKyd,UAITioB,QAAQ5gB,GACN9kB,KAAK0c,SAASoI,KAAOA,EAGnB9kB,KAAK2G,QAAQrI,MAAMymC,KADT,cAARjgB,EACwB,OAEA,UAG5B9kB,KAAKqkB,OAGPshB,eAAe1f,GAEbjmB,KAAK+kB,YAAckB,EAGrB2f,gBAGAxnB,gBAAgBopB,IAGhBtd,QAAQ2B,GACN,IAAIa,EAAY,IAAIphB,EAAMvL,MAe1B,OAbKC,KAAK0sB,UAURA,EAAU7uB,QAAQmC,MATlBA,KAAKqqB,OAAOwB,GAAS/K,KAAK,WACxB9gB,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMK,UAAWjU,MAC7CA,KAAKqyB,YAAYryB,MACjBA,KAAK0sB,WAAY,EACjBA,EAAU7uB,QAAQmC,OAClByN,KAAKzN,OAAO,SAAUmnB,GACtBuF,EAAU5uB,OAAOqpB,EAAKnnB,SAMnB0sB,EAAUvsB,QAGnBmqB,OACEtqB,KAAK2G,QAAQrI,MAAMgnC,WAAa,UAE5BtlC,KAAKglC,SACPhlC,KAAKglC,OAAO1mC,MAAMgnC,WAAa,UAE/BtlC,KAAKglC,OAAO1mC,MAAMmpC,UAAY,gBAC9BznC,KAAKglC,OAAOjS,YACZ/yB,KAAKglC,OAAO1mC,MAAMmpC,UAAY,MAGhCznC,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMM,MAAOlU,MAG3CizB,OAEEjzB,KAAK2G,QAAQrI,MAAMgnC,WAAa,SAChCtlC,KAAKglC,OAAO1mC,MAAMgnC,WAAa,SAC/BtlC,KAAK0nC,eAAgB,EACrB1nC,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMO,OAAQnU,MAG5CgN,SACE,MAAO,CACLjF,IAAK/H,KAAK2G,QAAQghC,UAClB3/B,KAAMhI,KAAK2G,QAAQihC,YAIvBnpC,QACE,OAAOuB,KAAK8c,OAGdpe,SACE,OAAOsB,KAAK+c,QAGd7N,WACE,OAAOlP,KAAK2G,QAAQ/B,wBAGtBpB,WAAWzC,GACOf,KAAKglC,OAAOpgC,wBAA5B,IACImc,EAAY/gB,KAAKyX,SAASjU,WAAWzC,EAAQf,KAAK0c,SAAShR,aAC/D,MAAO,CACL,KAAQqV,EAAU/Y,KAClB,IAAO+Y,EAAUhZ,KAIrBsqB,YAAY7I,IAGZ5K,SAAS4K,EAAMrX,IAGfrT,OAAO0nC,GAKL,OAJIA,GAAUxmC,KAAKulC,gBACjBvlC,KAAKulC,eAAgB,EAAIj6B,EAAMxM,QAAQkB,KAAK2G,UAGvC3G,KAAKulC,cAGdsC,UAAU/a,EAAU5tB,EAAO,GAAI4oC,EAAI/kB,EAAY,YAAaglB,EAAS,IACnE,IAAK/nC,KAAKyX,SACR,OAGF,MAAM0I,EAAa9iB,OAAOi/B,OAAO,CAC/B,KAAQ,SACR,eAAgB,MAChB,iBAAkB,YACjByL,GACH,IAAIl8B,EAAQ7L,KAAKyX,SAAS5L,MAAMihB,GAE5Bkb,EAAU,KACZhoC,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMQ,aAAc0Y,EAAU5tB,IAG5DA,EAAI,QAAc4tB,EAEb9sB,KAAK2kC,OACR3kC,KAAK2kC,KAAO,IAAIL,EAAW2D,KAAKjoC,KAAKglC,OAAQhlC,KAAK2G,UAGpD,IAAI0Y,EAAI,IAAIilB,EAAW4D,UAAUr8B,EAAOkX,EAAW7jB,EAAMihB,GACrD5E,EAAIvb,KAAK2kC,KAAKwD,QAAQ9oB,GAe1B,OAdArf,KAAK4kC,WAAW9X,GAAY,CAC1B,KAAQvR,EACR,QAAWA,EAAE5U,QACb,UAAa,CAACqhC,EAASF,IAEzBvsB,EAAE5U,QAAQwQ,aAAa,MAAO4L,GAC9BxH,EAAE5U,QAAQmY,iBAAiB,QAASkpB,GACpCzsB,EAAE5U,QAAQmY,iBAAiB,aAAckpB,GAErCF,IACFvsB,EAAE5U,QAAQmY,iBAAiB,QAASgpB,GACpCvsB,EAAE5U,QAAQmY,iBAAiB,aAAcgpB,IAGpCvsB,EAGT6sB,UAAUtb,EAAU5tB,EAAO,GAAI4oC,EAAI/kB,EAAY,YAAaglB,EAAS,IACnE,IAAK/nC,KAAKyX,SACR,OAGF,MAAM0I,EAAa9iB,OAAOi/B,OAAO,CAC/B,OAAU,QACV,iBAAkB,MAClB,iBAAkB,YACjByL,GACH,IAAIl8B,EAAQ7L,KAAKyX,SAAS5L,MAAMihB,GAE5Bkb,EAAU,KACZhoC,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMQ,aAAc0Y,EAAU5tB,IAG5DA,EAAI,QAAc4tB,EAEb9sB,KAAK2kC,OACR3kC,KAAK2kC,KAAO,IAAIL,EAAW2D,KAAKjoC,KAAKglC,OAAQhlC,KAAK2G,UAGpD,IAAI0Y,EAAI,IAAIilB,EAAW+D,UAAUx8B,EAAOkX,EAAW7jB,EAAMihB,GACrD5E,EAAIvb,KAAK2kC,KAAKwD,QAAQ9oB,GAe1B,OAdArf,KAAK6kC,WAAW/X,GAAY,CAC1B,KAAQvR,EACR,QAAWA,EAAE5U,QACb,UAAa,CAACqhC,EAASF,IAEzBvsB,EAAE5U,QAAQwQ,aAAa,MAAO4L,GAC9BxH,EAAE5U,QAAQmY,iBAAiB,QAASkpB,GACpCzsB,EAAE5U,QAAQmY,iBAAiB,aAAckpB,GAErCF,IACFvsB,EAAE5U,QAAQmY,iBAAiB,QAASgpB,GACpCvsB,EAAE5U,QAAQmY,iBAAiB,aAAcgpB,IAGpCvsB,EAGTorB,KAAK7Z,EAAU5tB,EAAO,GAAI4oC,GACxB,IAAK9nC,KAAKyX,SACR,OAGF,GAAIqV,KAAY9sB,KAAK8kC,MAAO,CAE1B,OADW9kC,KAAK8kC,MAAMhY,GAIxB,IAAIjhB,EAAQ7L,KAAKyX,SAAS5L,MAAMihB,GAEhC,IAAKjhB,EACH,OAGF,IAAIkF,EAAYlF,EAAM3B,wBAClBjI,EAAgC,IAAvB8O,EAAUpP,SAAiBoP,EAAYA,EAAU7O,WAE1D8lC,EAAU71B,IACZnS,KAAK0d,KAAKtD,EAAW5H,OAAOoB,MAAMQ,aAAc0Y,EAAU5tB,IAGxD2M,EAAM5B,WAAoC,IAAvB8G,EAAUpP,UAC/BkK,EAAQ,IAAIsV,MACZtV,EAAMlH,mBAAmBoM,IAChBlF,EAAM5B,YAEf4B,EAAQ,IAAIsV,MACZtV,EAAMlH,mBAAmB1C,IAG3B,IAAI0kC,EAAO3mC,KAAKQ,SAASyW,cAAc,KAyBvC,OAxBA0vB,EAAKxvB,aAAa,MAAO,aACzBwvB,EAAKroC,MAAM4Q,SAAW,WACtBy3B,EAAK2B,QAAL,QAA0Bxb,EAEtB5tB,GACF7B,OAAOmlB,KAAKtjB,GAAMP,SAAQ+iB,IACxBilB,EAAK2B,QAAQ5mB,GAAOxiB,EAAKwiB,MAIzBomB,IACFnB,EAAK7nB,iBAAiB,QAASgpB,GAC/BnB,EAAK7nB,iBAAiB,aAAcgpB,IAGtCnB,EAAK7nB,iBAAiB,QAASkpB,GAC/BrB,EAAK7nB,iBAAiB,aAAckpB,GACpChoC,KAAK4mC,UAAUD,EAAM96B,GACrB7L,KAAK2G,QAAQ4Q,YAAYovB,GACzB3mC,KAAK8kC,MAAMhY,GAAY,CACrB,QAAW6Z,EACX,MAAS96B,EACT,UAAa,CAACm8B,EAASF,IAElB7lC,EAGT2kC,UAAUjgC,EAASkF,GACjB,IAAI9D,EAAKE,EAAOD,EAEhB,GAAyB,kBAArBhI,KAAKokB,OAAO+B,MAAmD,eAAvBnmB,KAAK0c,SAASoI,KAAuB,CAC/E,IAAI9D,EAAMnV,EAAMjH,wBAChBmD,EAAMiZ,EAAIjZ,IACVE,EAAQ+Y,EAAI/Y,UACP,CAEL,IACI0T,EADA4sB,EAAQ18B,EAAM28B,iBAGlB,IAAK,IAAI7oC,EAAI,EAAGA,GAAK4oC,EAAM3oC,OAAQD,IACjCgc,EAAO4sB,EAAM5oC,KAERqI,GAAQ2T,EAAK3T,KAAOA,KACvBA,EAAO2T,EAAK3T,KAEZC,EAAQ3H,KAAKwzB,KAAK9rB,EAAOhI,KAAKokB,OAAOle,MAAMmtB,WAAarzB,KAAKokB,OAAOle,MAAMmtB,UAAYrzB,KAAKokB,OAAOK,IAAM,EACxG1c,EAAM4T,EAAK5T,KAKjBpB,EAAQrI,MAAMyJ,IAAO,GAAEA,MACvBpB,EAAQrI,MAAM0J,KAAQ,GAAEC,MAG1BwgC,YAAY3b,GACV,IAAItqB,EAEAsqB,KAAY9sB,KAAK4kC,aACnBpiC,EAAOxC,KAAK4kC,WAAW9X,GACvB9sB,KAAK2kC,KAAK+D,WAAWlmC,EAAKmkC,MAC1BnkC,EAAK4Y,UAAUzc,SAAQgqC,IACjBA,IACFnmC,EAAKmE,QAAQ4c,oBAAoB,QAASolB,GAC1CnmC,EAAKmE,QAAQ4c,oBAAoB,aAAcolB,cAK5C3oC,KAAK4kC,WAAW9X,IAI3B8b,YAAY9b,GACV,IAAItqB,EAEAsqB,KAAY9sB,KAAK6kC,aACnBriC,EAAOxC,KAAK6kC,WAAW/X,GACvB9sB,KAAK2kC,KAAK+D,WAAWlmC,EAAKmkC,MAC1BnkC,EAAK4Y,UAAUzc,SAAQgqC,IACjBA,IACFnmC,EAAKmE,QAAQ4c,oBAAoB,QAASolB,GAC1CnmC,EAAKmE,QAAQ4c,oBAAoB,aAAcolB,cAK5C3oC,KAAK6kC,WAAW/X,IAI3B+b,OAAO/b,GACL,IAAItqB,EAEAsqB,KAAY9sB,KAAK8kC,QACnBtiC,EAAOxC,KAAK8kC,MAAMhY,GAClB9sB,KAAK2G,QAAQmiC,YAAYtmC,EAAKmE,SAC9BnE,EAAK4Y,UAAUzc,SAAQgqC,IACjBA,IACFnmC,EAAKmE,QAAQ4c,oBAAoB,QAASolB,GAC1CnmC,EAAKmE,QAAQ4c,oBAAoB,aAAcolB,cAK5C3oC,KAAK8kC,MAAMhY,IAItBvG,UACE,IAAK,IAAIuG,KAAY9sB,KAAK4kC,WACxB5kC,KAAKyoC,YAAY3b,GAGnB,IAAK,IAAIA,KAAY9sB,KAAK6kC,WACxB7kC,KAAK4oC,YAAY9b,GAGnB,IAAK,IAAIA,KAAY9sB,KAAK8kC,MACxB9kC,KAAK6oC,OAAO/b,GAGV9sB,KAAK8mC,UACP,EAAIx7B,EAAMtE,eAAehH,KAAK8mC,SAG5B9mC,KAAK0sB,YACP1sB,KAAK0sB,WAAY,EACjB1sB,KAAKoe,kBACLpe,KAAKyX,SAAS8O,UACdvmB,KAAK0nC,eAAgB,EACrB1nC,KAAK2G,QAAQmiC,YAAY9oC,KAAKglC,QAE1BhlC,KAAK2kC,OACP3kC,KAAK2kC,KAAKh+B,QAAQuc,SAClBljB,KAAK2kC,UAAOj8B,GAGd1I,KAAKglC,YAASt8B,EACd1I,KAAKyX,cAAW/O,EAChB1I,KAAK8lC,WAAa,KAClB9lC,KAAKgmC,YAAc,KACnBhmC,KAAK8c,OAAS,KACd9c,KAAK+c,QAAU,QAQrB,EAAI/C,EAAc3O,SAASk5B,EAAWj+B,WACtC,IAAIiM,EAAWgyB,EACfhnC,EAAQ8N,QAAUkH,G,iCCtyBlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IAEhB4gC,EAAY7yB,EAAuB/N,EAAQ,MAE3C6gC,EAAQ9yB,EAAuB/N,EAAQ,MAEvCiS,EAAajS,EAAQ,IAErB8gC,EAAY/yB,EAAuB/N,EAAQ,MAE/C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,MAAMwpC,UAA8BH,EAAU19B,QAC5CrB,YAAYyS,GACV0sB,MAAM1sB,GACNzc,KAAKmmB,KAAO,aACZnmB,KAAK0c,UAAW,EAAIpR,EAAMxK,QAAQd,KAAK0c,UAAY,GAAI,CACrD0T,UAAU,EACVpU,cAAUtT,EACVoc,UAAMpc,EACNqc,iBAAarc,EACb+gB,KAAM,WACNzc,OAAQ,IACRo8B,YAAa,IACb3qC,WAAOiK,EACPhK,YAAQgK,EACRqhB,MAAM,EACNsf,qBAAsB,GACtBpf,sBAAsB,KAExB,EAAI3e,EAAMxK,QAAQd,KAAK0c,SAAUD,EAAQC,UAAY,IAEzB,aAAxBD,EAAQC,SAAS+H,KAA+C,IAAzBhI,EAAQC,SAAS+H,MAC1DzkB,KAAK0c,SAAS+H,IAAMhI,EAAQC,SAAS+H,KAGvCzkB,KAAKuwB,aAAe,CAClB7kB,YAAa1L,KAAK0c,SAAShR,YAC3BoZ,KAAM9kB,KAAK0c,SAASoI,KACpB2E,KAAMzpB,KAAK0c,SAAS+M,KACpBrF,OAAQpkB,KAAKokB,OACb3lB,MAAO,EACPC,OAAQ,EACR+xB,gBAAgB,EAChBxG,qBAAsBjqB,KAAK0c,SAASuN,sBAEtCjqB,KAAK8yB,UAAY,EACjB9yB,KAAK6yB,WAAa,EAGpB3I,QAAQnT,EAAShW,GACf,OAAOgoC,EAAU19B,QAAQ/E,UAAU4jB,QAAQhpB,KAAKlB,KAAM+W,EAAShW,GAAQ+f,KAAK,WAC1E,OAAO9gB,KAAKspC,QACZ77B,KAAKzN,OAGTspC,KAAKC,GACH,IAAIC,EAAOD,GAAS,IAAIj+B,EAAMvL,MAU9B,OATAC,KAAKmG,EAAE0hB,SAAQ,IACN7nB,KAAKypC,UACX3oB,MAAK3iB,IACFA,EACF6B,KAAKspC,KAAKE,GAEVA,EAAK3rC,aAGF2rC,EAAKrpC,QAGd8sB,OAAOjgB,GAGL,IAAIglB,EAAQ,EACRC,EAAQ,EAIPjyB,KAAKkyB,aAIRF,EAAQ1xB,KAAK0D,MAAMgJ,EAAOhF,KAAOhI,KAAKokB,OAAO+N,OAASnyB,KAAKokB,OAAO+N,MAChDnyB,KAAK0c,SAAS0sB,cAJhCnX,EAAQjlB,EAAOjF,IACLiF,EAAOjF,IAAM/H,KAAK0c,SAAS0sB,cAMnCpX,EAAQ,GAAKC,EAAQ,IACvBjyB,KAAK0yB,SAASV,EAAOC,GAAO,GAIhCF,aAAavI,GACXxpB,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASN,OAAQyW,EAAKzS,SAIpD2yB,qBAAqBlgB,GAGnBA,EAAK6I,YAAc,aAGrBrP,IAAIjM,GACF,IAAIyS,EAAOxpB,KAAKyxB,WAAW1a,GAc3B,OAbA/W,KAAK0vB,MAAM0C,OAAO5I,GAClBA,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMN,SAASxU,IACvC0qB,EAAKmgB,UAAW,KAElBngB,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMC,MAAMiR,IACpC9kB,KAAKsyB,WAAWxN,MAElB0E,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAME,cAAcmS,IAC5CjmB,KAAKuyB,kBAAkBtM,MAGzBuD,EAAK6I,YAAcryB,KAAKksB,eAAeze,KAAKzN,MAC5CwpB,EAAK5K,SAAW5e,KAAK+xB,aAAatkB,KAAKzN,MAChCwpB,EAAKU,QAAQlqB,KAAK6rB,SAG3BuG,OAAOrb,GACL,IAAIyS,EAAOxpB,KAAKyxB,WAAW1a,GAY3B,OAXAyS,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMN,SAASxU,IACvC0qB,EAAKmgB,UAAW,KAElBngB,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMC,MAAMiR,IACpC9kB,KAAKsyB,WAAWxN,MAElB0E,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAME,cAAcmS,IAC5CjmB,KAAKuyB,kBAAkBtM,MAEzBjmB,KAAK0vB,MAAM0C,OAAO5I,GAClBA,EAAK6I,YAAcryB,KAAKksB,eAAeze,KAAKzN,MACrCwpB,EAGTgJ,QAAQzb,GACN,IAAIyS,EAAOxpB,KAAKyxB,WAAW1a,GAa3B,OAZAyS,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMN,SAASxU,IACvCkB,KAAKyyB,QAAQ3zB,GACb0qB,EAAKmgB,UAAW,KAElBngB,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAMC,MAAMiR,IACpC9kB,KAAKsyB,WAAWxN,MAElB0E,EAAKyC,GAAG7R,EAAW5H,OAAOoB,MAAME,cAAcmS,IAC5CjmB,KAAKuyB,kBAAkBtM,MAEzBjmB,KAAK0vB,MAAM8C,QAAQhJ,GACnBA,EAAK6I,YAAcryB,KAAKksB,eAAeze,KAAKzN,MACrCwpB,EAGTiJ,QAAQ3zB,GACqB,aAAvBkB,KAAK0c,SAASoI,KAChB9kB,KAAK0yB,SAAS,EAAG5zB,EAAO6zB,aAAa,GAErC3yB,KAAK0yB,SAAS5zB,EAAO8zB,WAAY,GAAG,GAIxCwP,OAAOwH,GAWL,IAVA,IAMIpgB,EANAzY,EAAY/Q,KAAKlB,SACjB4wB,EAAQ1vB,KAAK0vB,MAAMtI,MACnBqN,EAAc/E,EAAM9vB,OACpBsvB,EAAU,GACVliB,EAA2B,oBAAX48B,EAAyBA,EAAU5pC,KAAK0c,SAAS1P,QAAU,EAG3E68B,EAAW,IAAIv+B,EAAMvL,MACrBgnB,EAAW,GAENpnB,EAAI,EAAGA,EAAI80B,EAAa90B,IAI/B,GAHA6pB,EAAOkG,EAAM/vB,IAGK,IAFNK,KAAKq0B,UAAU7K,EAAMxc,EAAQA,EAAQ+D,GAEzB,CAEtB,GAAKyY,EAAKkD,UAQRlD,EAAKc,WARc,CACnB,IAAIoC,EAAYlD,EAAKU,QAAQlqB,KAAK6rB,SAAS/K,MAAK,SAAU0I,GACxDA,EAAKc,UACJnD,IACDqC,EAAKyJ,UAEPlM,EAASllB,KAAK6qB,GAKhBwC,EAAQrtB,KAAK2nB,QAEbxpB,KAAKmG,EAAE0hB,QAAQ2B,EAAKjD,QAAQ9Y,KAAK+b,IAEjC/K,aAAaze,KAAK8pC,aAClB9pC,KAAK8pC,YAAcjrB,WAAW,WAC5B7e,KAAKmG,EAAE0hB,QAAQ7nB,KAAKsjC,KAAK71B,KAAKzN,QAC9ByN,KAAKzN,MAAO,KAIlB,OAAI+mB,EAASnnB,OACJhC,QAAQwpB,IAAIL,GAAUgZ,OAAM5Y,IACjC0iB,EAAS/rC,OAAOqpB,OAGlB0iB,EAAShsC,UACFgsC,EAAS1pC,SAIpBspC,MAAMM,EAAaC,GACjB,IAAIC,EAAW,IAAI3+B,EAAMvL,MACrBmqC,EAAW,GACXvH,EAAoC,eAAvB3iC,KAAK0c,SAASoI,KAC3BqN,EAAQnyB,KAAK0c,SAAS1P,QAAU,EAEhC+8B,GAAepH,IACjBxQ,EAAQ4X,GAGNC,IAAerH,IACjBxQ,EAAQ6X,GAGV,IAAIlrC,EAASkB,KAAK+wB,QAElB,IAAI/jB,EAAS21B,EAAa3iC,KAAK6yB,WAAa7yB,KAAK8yB,UAC7CqX,EAAgBxH,EAAariC,KAAK0D,MAAMlF,EAAOL,OAASK,EAAOJ,OAC/D0rC,EAAgBzH,EAAa3iC,KAAK+Q,UAAUgL,YAAc/b,KAAK+Q,UAAUnQ,aACzEmkB,EAAc/kB,KAAK+kB,aAAwD,IAAzC/kB,KAAK+kB,YAAYhhB,QAAQ,YAAoB,WAAa,aAC5F6sB,EAAgB5wB,KAAK0c,SAASkU,cAC9ByZ,EAAkC,QAA5BrqC,KAAK0c,SAASsI,UAEnBhlB,KAAK0c,SAAS4T,UAYbqS,GAAc0H,GAAyB,aAAlBzZ,IAAiC+R,GAAc0H,GAAyB,YAAlBzZ,KAC7E5jB,IAAmB,IAXjBq9B,GAAyB,YAAlBzZ,GAA+C,eAAhB7L,IACxC/X,EAASo9B,EAAgBD,EAAgBn9B,GAIvCq9B,GAAyB,aAAlBzZ,GAAgD,eAAhB7L,IACzC/X,IAAmB,IASvB,IAAIwlB,EAAU,KACZ,IAAI3D,EAAQ7uB,KAAK0vB,MAAMb,QACnBzB,EAAOyB,GAASA,EAAM9X,QAAQqW,OAE9BA,GACF8c,EAASroC,KAAK7B,KAAKwyB,QAAQpF,KAc3BtqB,EAAQkK,EAASmlB,EADXnlB,EAASm9B,EAAgBhY,GAGxBiY,GAZE,MACX,IAAIzb,EAAO3uB,KAAK0vB,MAAMf,OAClBxB,EAAOwB,GAAQA,EAAK5X,QAAQoW,OAE5BA,GACF+c,EAASroC,KAAK7B,KAAKoyB,OAAOjF,KAQ5BiF,GAGEtvB,EAAQ,GACV0vB,IAGF,IAAIzL,EAAWmjB,EAAS58B,KAAIkc,GACnBA,EAAKU,QAAQlqB,KAAK6rB,WAG3B,OAAIqe,EAAStqC,OACJhC,QAAQwpB,IAAIL,GAAUjG,MAAK,IACzB9gB,KAAKypC,UACX3oB,MAAK,IAEC9gB,KAAKoiC,OAAOjQ,KAClBhL,GACMA,KAGTnnB,KAAKmG,EAAE0hB,QAAQ,WACb7nB,KAAKoiC,UACL30B,KAAKzN,OACPiqC,EAASpsC,SAAQ,GACVosC,EAAS9pC,SAIpBmjC,OAUE,IATA,IAAItc,EAAO,IAAI1b,EAAMvL,MACjB2sB,EAAY1sB,KAAK0vB,MAAMhD,YACvBmC,EAAQnC,EAAU,GAClBiC,EAAOjC,EAAUA,EAAU9sB,OAAS,GACpC0qC,EAAatqC,KAAK0vB,MAAM3rB,QAAQ8qB,GAChC0b,EAAYvqC,KAAK0vB,MAAM3rB,QAAQ4qB,GAC/B6b,EAAQxqC,KAAK0vB,MAAMzuB,MAAM,EAAGqpC,GAC5BG,EAAQzqC,KAAK0vB,MAAMzuB,MAAMspC,EAAY,GAEhC5qC,EAAI,EAAGA,EAAI6qC,EAAM5qC,OAAS,EAAGD,IACpCK,KAAK0qC,MAAMF,EAAM7qC,GAAI6qC,GAIvB,IAAK,IAAI9qB,EAAI,EAAGA,EAAI+qB,EAAM7qC,OAAQ8f,IAChC1f,KAAK0qC,MAAMD,EAAM/qB,IAInB,OADAsH,EAAKnpB,UACEmpB,EAAK7mB,QAGduqC,MAAMlhB,EAAMghB,GAEV,IAAIG,EACAC,EAEC5qC,KAAK0c,SAAS4T,UAIjBqa,EAAUpsC,OAAOg1B,QACjBqX,EAAWrsC,OAAOi1B,UAJlBmX,EAAU3qC,KAAK+Q,UAAU+hB,UACzB8X,EAAW5qC,KAAK+Q,UAAU8hB,YAM5B,IAAI/zB,EAAS0qB,EAAK1qB,SAClBkB,KAAK0vB,MAAMxM,OAAOsG,GAEdghB,IACyB,aAAvBxqC,KAAK0c,SAASoI,KAChB9kB,KAAKwd,SAAS,EAAGmtB,EAAU7rC,EAAOJ,QAAQ,GAEV,QAA5BsB,KAAK0c,SAASsI,UACXhlB,KAAK0c,SAAS4T,SAGjBtwB,KAAKwd,SAASotB,EAAWtqC,KAAK0D,MAAMlF,EAAOL,OAAQ,GAAG,GAFtDuB,KAAKwd,SAASotB,EAAU,GAAG,GAK7B5qC,KAAKwd,SAASotB,EAAWtqC,KAAK0D,MAAMlF,EAAOL,OAAQ,GAAG,IAM9Dof,kBAAkBgT,GAChBtyB,OAAOugB,iBAAiB,SAAU,SAAU3M,GAC1CnS,KAAK60B,QAAS,EAEd70B,KAAKumB,WACL9Y,KAAKzN,OACPA,KAAK6qC,qBAED7qC,KAAKkyB,aAAelyB,KAAK0c,SAASqN,OACpC/pB,KAAK8qC,QAAU,IAAI9B,EAAM39B,QAAQrL,KAAMA,KAAK0c,SAASqN,MAAsC,kBAAvB/pB,KAAK0c,SAASqN,MAAqB/pB,KAAK0c,SAASqN,OAIzH8gB,qBACE,IAAI5Z,EACJjxB,KAAK0nB,KAAOpc,EAAMvE,sBAClB,IAAIwO,EAAkC,QAA5BvV,KAAK0c,SAASsI,WAAuD,YAAhChlB,KAAK0c,SAASkU,eAA+B,EAAI,EAChG5wB,KAAK+qC,gBAAkB,EACvB/qC,KAAKgrC,gBAAkB,EAElBhrC,KAAK0c,SAAS4T,UAKjBW,EAAW1yB,OACXyB,KAAK8yB,UAAYv0B,OAAOg1B,QAAUhe,EAClCvV,KAAK6yB,WAAat0B,OAAOi1B,QAAUje,IANnC0b,EAAWjxB,KAAK+Q,UAChB/Q,KAAK8yB,UAAY9yB,KAAK+Q,UAAU+hB,UAChC9yB,KAAK6yB,WAAa7yB,KAAK+Q,UAAU8hB,YAOnC7yB,KAAKkxB,UAAYlxB,KAAKmxB,SAAS1jB,KAAKzN,MACpCixB,EAASnS,iBAAiB,SAAU9e,KAAKkxB,WACzClxB,KAAKirC,WAAY,EAAIhC,EAAU59B,SAASrL,KAAK80B,SAASrnB,KAAKzN,MAAO,IAElEA,KAAKkrC,WAAY,EAGnB7sB,wBAGOre,KAAK0c,SAAS4T,SAGN/xB,OAFAyB,KAAK+Q,WAKTwS,oBAAoB,SAAUvjB,KAAKkxB,WAC5ClxB,KAAKkxB,eAAYxoB,EAGnByoB,WACE,IAAI2B,EACAD,EACAtd,EAAkC,QAA5BvV,KAAK0c,SAASsI,WAAuD,YAAhChlB,KAAK0c,SAASkU,eAA+B,EAAI,EAE3F5wB,KAAK0c,SAAS4T,UAIjBwC,EAAYv0B,OAAOg1B,QAAUhe,EAC7Bsd,EAAat0B,OAAOi1B,QAAUje,IAJ9Bud,EAAY9yB,KAAK+Q,UAAU+hB,UAC3BD,EAAa7yB,KAAK+Q,UAAU8hB,YAM9B7yB,KAAK8yB,UAAYA,EACjB9yB,KAAK6yB,WAAaA,EAEb7yB,KAAK60B,OAGR70B,KAAK60B,QAAS,EAFd70B,KAAKirC,YAKPjrC,KAAK+qC,iBAAmBzqC,KAAK6zB,IAAIrB,EAAY9yB,KAAKmrC,eAClDnrC,KAAKgrC,iBAAmB1qC,KAAK6zB,IAAItB,EAAa7yB,KAAKorC,gBACnDprC,KAAKmrC,cAAgBrY,EACrB9yB,KAAKorC,eAAiBvY,EACtBpU,aAAaze,KAAKqrC,eAClBrrC,KAAKqrC,cAAgBxsB,WAAW,WAC9B7e,KAAK+qC,gBAAkB,EACvB/qC,KAAKgrC,gBAAkB,GACvBv9B,KAAKzN,MAAO,KACdye,aAAaze,KAAKsxB,eAClBtxB,KAAKkrC,WAAY,EAGnBpW,WACE90B,KAAKmG,EAAE0hB,QAAQ,WACb,OAAO7nB,KAAKypC,SACZh8B,KAAKzN,OACPA,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASI,OAAQ,CAC3C1L,IAAK/H,KAAK8yB,UACV9qB,KAAMhI,KAAK6yB,aAEbpU,aAAaze,KAAKsxB,eAClBtxB,KAAKsxB,cAAgBzS,WAAW,WAE1B7e,KAAK8qC,SAAW9qC,KAAK8qC,QAAQQ,eAAiBtrC,KAAK8qC,QAAQS,aAI/DvrC,KAAK0d,KAAKtD,EAAW5H,OAAOa,SAASK,SAAU,CAC7C3L,IAAK/H,KAAK8yB,UACV9qB,KAAMhI,KAAK6yB,cAEbplB,KAAKzN,MAAOA,KAAK0c,SAAS2sB,sBAG9Blc,OACE,IAAIgF,EAAmC,kBAA3BnyB,KAAKokB,OAAOle,MAAMigB,MAA4BnmB,KAAKokB,OAAOle,MAAMwjB,OAAmC,EAA1B1pB,KAAKokB,OAAOle,MAAMisB,MAAYnyB,KAAKokB,OAAOle,MAAMisB,MAChInyB,KAAK0vB,MAAM9vB,SAEZI,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,KACpC9kB,KAAK0yB,SAASP,EAAO,GAAG,GAExBnyB,KAAK0yB,SAAS,EAAG1yB,KAAKokB,OAAO1lB,QAAQ,GAGvCsB,KAAKmG,EAAE0hB,QAAQ,WACb,OAAO7nB,KAAKypC,SACZh8B,KAAKzN,QAGTotB,OACE,IAAI+E,EAAmC,kBAA3BnyB,KAAKokB,OAAOle,MAAMigB,MAA4BnmB,KAAKokB,OAAOle,MAAMwjB,OAAmC,EAA1B1pB,KAAKokB,OAAOle,MAAMisB,MAAYnyB,KAAKokB,OAAOle,MAAMisB,MAChInyB,KAAK0vB,MAAM9vB,SAEZI,KAAKkyB,aAAsC,eAAvBlyB,KAAK0c,SAASoI,KACpC9kB,KAAK0yB,UAAUP,EAAO,GAAG,GAEzBnyB,KAAK0yB,SAAS,GAAI1yB,KAAKokB,OAAO1lB,QAAQ,GAGxCsB,KAAKmG,EAAE0hB,QAAQ,WACb,OAAO7nB,KAAKypC,SACZh8B,KAAKzN,QAGTutB,WAAW9D,GACLzpB,KAAK0wB,UAAY1wB,KAAK8qC,UACxB9qC,KAAK8qC,QAAQvkB,UACbvmB,KAAK8qC,aAAUpiC,GAGjBygC,MAAM5b,WAAW9D,EAAM,UAEnBzpB,KAAK0wB,UAAY1wB,KAAKkyB,aAAelyB,KAAK0c,SAASqN,OACrD/pB,KAAK8qC,QAAU,IAAI9B,EAAM39B,QAAQrL,KAAMA,KAAK0c,SAASqN,MAAsC,kBAAvB/pB,KAAK0c,SAASqN,MAAqB/pB,KAAK0c,SAASqN,OAIzHxD,UACE4iB,MAAM5iB,UAEFvmB,KAAK8qC,SACP9qC,KAAK8qC,QAAQvkB,WAMnB,IAAIhU,EAAW22B,EACf3rC,EAAQ8N,QAAUkH,G,+BC3gBlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAClB,IAUIkH,EAViB,CACnBi5B,WAAY,CACVt8B,SAAU,WACVxQ,OAAQ,OACRD,MAAO,QAET+qB,KAAM,CACJ9qB,OAAQ,SAIZnB,EAAQ8N,QAAUkH,G,6BCflBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAClB,IA8IIkH,EA9IoB,CACtBxB,UAAW,CACTiL,SAAU,SACVtd,OAAQ,QAEV+sC,WAAY,CACVv8B,SAAU,WACVw8B,OAAQ,EACRhtC,OAAQ,OACRD,MAAO,OACPktC,gBAAiB,OACjBC,WAAY,gBAEdC,kBAAmB,CACjBpE,UAAW,qBAEbqE,UAAW,CACT58B,SAAU,WACVnH,IAAK,GACLC,KAAM,GACNC,MAAO,GACP8jC,UAAW,SACXC,MAAO,QAETjuC,OAAQ,CACNmR,SAAU,WACVnH,IAAK,GACLC,KAAM,GACNE,OAAQ,GACRD,MAAO,IAETgkC,aAAc,CACZ/8B,SAAU,WACVnH,IAAK,EACLC,KAAM,EACNE,OAAQ,EACRD,MAAO,EACPyjC,OAAQ,KAEVte,KAAM,CACJplB,KAAM,GAERmlB,KAAM,CACJllB,MAAO,GAETikC,MAAO,CACLC,QAAS,OACTvwB,OAAQ,OACRwwB,WAAY,OACZl9B,SAAU,WACVnH,IAAK,MACLskC,WAAY,GACZC,SAAU,GACVC,QAAS,SACTP,MAAO,UACPQ,WAAY,oBACZC,OAAQ,UACRC,WAAY,OACZC,WAAY,OACZC,WAAY,UAEdC,WAAY,CACVb,MAAO,QAETc,cAAe,CACb59B,SAAU,WACVlH,KAAM,IACND,IAAK,EACLG,OAAQ,EACRD,MAAO,EACPyjC,OAAQ,GAEVqB,QAAS,CACP79B,SAAU,WACVlH,KAAM,EACND,IAAK,EACLG,OAAQ,EACRwjC,OAAQ,EACRjtC,MAAO,IACPyd,UAAW,OACX8wB,wBAAyB,QACzBZ,WAAY,UACZG,QAAS,UAEXU,cAAe,CACbP,WAAY,OACZC,WAAY,OACZP,WAAY,OACZxwB,OAAQ,OACRsO,QAAS,QACTsiB,WAAY,aACZ/tC,MAAO,OACP6tC,SAAU,OACVP,UAAW,OACXQ,QAAS,WACTW,aAAc,iBACdlB,MAAO,OACPmB,UAAW,aACXhB,QAAS,OACTM,OAAQ,WAEVW,UAAW,CACThB,WAAY,OACZxwB,OAAQ,OACRnd,MAAO,GACPC,OAAQ,GACRwQ,SAAU,WACVnH,IAAK,GACLC,KAAM,GACNqlC,aAAc,EACdlB,QAAS,OACTM,OAAQ,WAEVa,kBAAmB,CACjBlB,WAAY,WAEdmB,aAAc,CACZr+B,SAAU,WACVzQ,MAAO,MACP2tC,WAAY,OACZ1tC,OAAQ,EACRsJ,KAAM,MACNwlC,OAAQ,YACRzlC,IAAK,MACL6jC,WAAY,gBAEd6B,gBAAiB,CACf1lC,IAAK,OAEP2lC,gBAAiB,CACf3lC,IAAK,OAEP4lC,YAAa,CACXz+B,SAAU,WACVnH,IAAK,MACLC,KAAM,MACNC,MAAO,MACP+jC,MAAO,OACPD,UAAW,SACX6B,UAAW,UAIfrwC,EAAQ8N,QAAUkH,G,mHCrJLs7B,GACXzwB,OACE0wB,UAAYrG,UAAW,+BACvBsG,SAAWtG,UAAW,6BACtBuG,SAAWvG,UAAW,+BACtBwG,QAAUxG,UAAW,8BAEvByG,QACEJ,UAAYrG,UAAW,mCACvBsG,SAAWtG,UAAW,iCACtBuG,SAAWvG,UAAW,iCACtBwG,QAAUxG,UAAW,oCAEvB0G,MACEL,UAAYrG,UAAW,iCACvBsG,SAAWtG,UAAW,gCACtBuG,SAAWvG,UAAW,iCACtBwG,QAAUxG,UAAW,yhE,6BCfzB,IAAI2G,EAAiBl4B,EAAuB/N,EAAQ,MAEhDkmC,EAAqBn4B,EAAuB/N,EAAQ,MAEpDmmC,EAAmBp4B,EAAuB/N,EAAQ,MAElDomC,EAAcr4B,EAAuB/N,EAAQ,MAEjD,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF89B,EAAOjgC,QAAU,CACf04B,WAAYsY,EAAYljC,QACxBuxB,gBAAiB0R,EAAiBjjC,QAClCmjC,kBAAmBH,EAAmBhjC,QACtCojC,cAAeL,EAAe/iC,U,6BCdhC9N,EAAQ0X,YAAa,EACrB1X,EAAQ8N,aAAU,GAgBlB,SAAiC3L,GAAO,GAAIA,GAAOA,EAAIuV,WAAc,OAAOvV,EAAc,IAAIg2B,EAAS,GAAI,GAAW,MAAPh2B,EAAe,IAAK,IAAIgiB,KAAOhiB,EAAO,GAAIrC,OAAOiJ,UAAUsL,eAAe1Q,KAAKxB,EAAKgiB,GAAM,CAAE,IAAIiU,EAAOt4B,OAAOC,gBAAkBD,OAAOgE,yBAA2BhE,OAAOgE,yBAAyB3B,EAAKgiB,GAAO,GAAQiU,EAAK9I,KAAO8I,EAAKC,IAAOv4B,OAAOC,eAAeo4B,EAAQhU,EAAKiU,GAAgBD,EAAOhU,GAAOhiB,EAAIgiB,GAAcgU,EAAOrqB,QAAU3L,EAdjbm2B,CAAwB1tB,EAAQ,IAAhD,IAEIumC,EAAYx4B,EAAuB/N,EAAQ,MAE3CwmC,EAAez4B,EAAuB/N,EAAQ,MAE9C2tB,EAAS5f,EAAuB/N,EAAQ,IAExComC,EAAcr4B,EAAuB/N,EAAQ,MAEhCA,EAAQ,KAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAIvF,SAAS28B,IAA2Q,OAA9PA,EAAWh/B,OAAOi/B,QAAU,SAAUv7B,GAAU,IAAK,IAAIpB,EAAI,EAAGA,EAAIE,UAAUD,OAAQD,IAAK,CAAE,IAAIG,EAASD,UAAUF,GAAI,IAAK,IAAI+hB,KAAO5hB,EAAczC,OAAOiJ,UAAUsL,eAAe1Q,KAAKpB,EAAQ4hB,KAAQ3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAY,OAAO3gB,IAA2BmmB,MAAMlnB,KAAMH,WAIhT,IAAIijB,EAAW,SAAkBphB,EAAMktC,GACrC,OAAOltC,GAAQktC,GAAWA,EAAQzhC,MAAM,KAAKxO,SAAQ,SAAUoK,GAC7D,OAAO,EAAI2lC,EAAUrjC,SAAS3J,EAAMqH,OAIpCka,EAAc,SAAqBvhB,EAAMktC,GAC3C,OAAOltC,GAAQktC,GAAWA,EAAQzhC,MAAM,KAAKxO,SAAQ,SAAUoK,GAC7D,OAAO,EAAI4lC,EAAatjC,SAAS3J,EAAMqH,OAiEvC0lC,EAEJ,SAAUvY,GA7EV,IAAwBC,EAAUC,EAgFhC,SAASqY,IAGP,IAFA,IAAIpY,EAEKwY,EAAOhvC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAMwoC,GAAOC,EAAO,EAAGA,EAAOD,EAAMC,IAC/EhoB,EAAKgoB,GAAQjvC,UAAUivC,GAkGzB,OA/FAzY,EAAQH,EAAiBh1B,KAAKgmB,MAAMgP,EAAkB,CAACl2B,MAAMiP,OAAO6X,KAAU9mB,MAExE44B,QAAU,SAAUl3B,EAAM+2B,GAC9B,IACI1V,EADsBsT,EAAM0Y,cAActW,EAAY,SAAW,SACjC1V,UAEpCsT,EAAM2Y,cAActtC,EAAM,QAE1BohB,EAASphB,EAAMqhB,GAEXsT,EAAMnwB,MAAM0yB,SACdvC,EAAMnwB,MAAM0yB,QAAQl3B,EAAM+2B,IAI9BpC,EAAMyC,WAAa,SAAUp3B,EAAM+2B,GACjC,IACIwW,EADuB5Y,EAAM0Y,cAActW,EAAY,SAAW,SAC3BwW,gBAE3C5Y,EAAM6Y,kBAAkBxtC,EAAMutC,GAE1B5Y,EAAMnwB,MAAM4yB,YACdzC,EAAMnwB,MAAM4yB,WAAWp3B,EAAM+2B,IAIjCpC,EAAM2C,UAAY,SAAUt3B,EAAM+2B,GAChC,IAAI0W,EAAkB9Y,EAAM0Y,cAAc,UAAUK,cAEhDC,EAAiBhZ,EAAM0Y,cAAc,SAASK,cAE9CA,EAAgB3W,EAAY0W,EAAkB,IAAME,EAAiBA,EAEzEhZ,EAAM2Y,cAActtC,EAAM+2B,EAAY,SAAW,SAEjD3V,EAASphB,EAAM0tC,GAEX/Y,EAAMnwB,MAAM8yB,WACd3C,EAAMnwB,MAAM8yB,UAAUt3B,EAAM+2B,IAIhCpC,EAAM6C,OAAS,SAAUx3B,GACvB,IACIqhB,EADuBsT,EAAM0Y,cAAc,QACVhsB,UAErCsT,EAAM2Y,cAActtC,EAAM,UAE1B20B,EAAM2Y,cAActtC,EAAM,SAE1BohB,EAASphB,EAAMqhB,GAEXsT,EAAMnwB,MAAMgzB,QACd7C,EAAMnwB,MAAMgzB,OAAOx3B,IAIvB20B,EAAM8C,UAAY,SAAUz3B,GAC1B,IACIutC,EADuB5Y,EAAM0Y,cAAc,QACJE,gBAE3C5Y,EAAM6Y,kBAAkBxtC,EAAMutC,GAE1B5Y,EAAMnwB,MAAMizB,WACd9C,EAAMnwB,MAAMizB,UAAUz3B,IAI1B20B,EAAM+C,SAAW,SAAU13B,GACzB,IACI0tC,EADuB/Y,EAAM0Y,cAAc,QACNK,cAEzC/Y,EAAM2Y,cAActtC,EAAM,QAE1BohB,EAASphB,EAAM0tC,GAEX/Y,EAAMnwB,MAAMkzB,UACd/C,EAAMnwB,MAAMkzB,SAAS13B,IAIzB20B,EAAM0Y,cAAgB,SAAUnoC,GAC9B,IAAI0oC,EAAajZ,EAAMnwB,MAAMopC,WACzBC,EAA2C,kBAAfD,EAE5BvsB,EAAYwsB,GADHA,GAAsBD,EAAaA,EAAa,IAAM,IACrB1oC,EAAO0oC,EAAW1oC,GAGhE,MAAO,CACLmc,UAAWA,EACXksB,gBAJoBM,EAAqBxsB,EAAY,UAAYusB,EAAW1oC,EAAO,UAKnFwoC,cAJkBG,EAAqBxsB,EAAY,QAAUusB,EAAW1oC,EAAO,UAQ5EyvB,EAtLuBD,EA8EFF,GA9ERC,EA8EPsY,GA9EwCnoC,UAAYjJ,OAAO65B,OAAOd,EAAW9vB,WAAY6vB,EAAS7vB,UAAU0D,YAAcmsB,EAAUA,EAASgB,UAAYf,EAyLxK,IAAIgB,EAASqX,EAAcnoC,UAuC3B,OArCA8wB,EAAO4X,cAAgB,SAAuBttC,EAAMkF,GAClD,IAAI4oC,EAAuBxvC,KAAK+uC,cAAcnoC,GAC1Cmc,EAAYysB,EAAqBzsB,UACjCksB,EAAkBO,EAAqBP,gBACvCG,EAAgBI,EAAqBJ,cAEzCrsB,GAAaE,EAAYvhB,EAAMqhB,GAC/BksB,GAAmBhsB,EAAYvhB,EAAMutC,GACrCG,GAAiBnsB,EAAYvhB,EAAM0tC,IAGrChY,EAAO8X,kBAAoB,SAA2BxtC,EAAMqhB,GAGtDA,IAEFrhB,GAAQA,EAAKoxB,UAGbhQ,EAASphB,EAAMqhB,KAInBqU,EAAO/M,OAAS,WACd,IAAInkB,EAAQm2B,EAAS,GAAIr8B,KAAKkG,OAG9B,cADOA,EAAMopC,WACNxZ,EAAOzqB,QAAQ4L,cAAcs3B,EAAYljC,QAASgxB,EAAS,GAAIn2B,EAAO,CAC3E0yB,QAAS54B,KAAK44B,QACdI,UAAWh5B,KAAKg5B,UAChBF,WAAY94B,KAAK84B,WACjBI,OAAQl5B,KAAKk5B,OACbC,UAAWn5B,KAAKm5B,UAChBC,SAAUp5B,KAAKo5B,aAIZqV,EAnJT,CAoJE3Y,EAAOzqB,QAAQgvB,WAEjBoU,EAAc9T,aAAe,CAC3B2U,WAAY,IAEdb,EAAc/T,UA2GT,GACL,IAAInoB,EAAWk8B,EACflxC,EAAQ8N,QAAUkH,EAClBirB,EAAOjgC,QAAUA,EAAO,S,6BCzWxB,IAAI2Y,EAAyB/N,EAAQ,KAErC5K,EAAQ0X,YAAa,EACrB1X,EAAQ8N,QAIR,SAAkB1E,EAASoc,GACrBpc,EAAQuJ,UAAWvJ,EAAQuJ,UAAU8S,IAAID,IAAqB,EAAI0sB,EAAUpkC,SAAS1E,EAASoc,KAA6C,kBAAtBpc,EAAQoc,UAAwBpc,EAAQoc,UAAYpc,EAAQoc,UAAY,IAAMA,EAAepc,EAAQwQ,aAAa,SAAUxQ,EAAQoc,WAAapc,EAAQoc,UAAU2sB,SAAW,IAAM,IAAM3sB,KAHrT,IAAI0sB,EAAYv5B,EAAuB/N,EAAQ,MAM/Cq1B,EAAOjgC,QAAUA,EAAO,S,cCPxBigC,EAAOjgC,QANP,SAAgCmC,GAC9B,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CACnC,QAAWA,IAKf89B,EAAOjgC,QAAiB,QAAIigC,EAAOjgC,QAASigC,EAAOjgC,QAAQ0X,YAAa,G,6BCLxE1X,EAAQ0X,YAAa,EACrB1X,EAAQ8N,QAER,SAAkB1E,EAASoc,GACzB,OAAIpc,EAAQuJ,YAAoB6S,GAAapc,EAAQuJ,UAAUC,SAAS4S,IAA0H,KAAlG,KAAOpc,EAAQoc,UAAU2sB,SAAW/oC,EAAQoc,WAAa,KAAKhf,QAAQ,IAAMgf,EAAY,MAG1Lya,EAAOjgC,QAAUA,EAAO,S,6BCPxB,SAASoyC,EAAiBC,EAAWC,GACnC,OAAOD,EAAU9mC,QAAQ,IAAIyP,OAAO,UAAYs3B,EAAgB,YAAa,KAAM,MAAM/mC,QAAQ,OAAQ,KAAKA,QAAQ,aAAc,IAGtI00B,EAAOjgC,QAAU,SAAqBoJ,EAASoc,GACzCpc,EAAQuJ,UAAWvJ,EAAQuJ,UAAUgT,OAAOH,GAAiD,kBAAtBpc,EAAQoc,UAAwBpc,EAAQoc,UAAY4sB,EAAiBhpC,EAAQoc,UAAWA,GAAgBpc,EAAQwQ,aAAa,QAASw4B,EAAiBhpC,EAAQoc,WAAapc,EAAQoc,UAAU2sB,SAAW,GAAI3sB,M,6BCL1RxlB,EAAQ0X,YAAa,EACrB1X,EAAQ8N,aAAU,EAED6K,EAAuB/N,EAAQ,IAAhD,IAEI2tB,EAAS5f,EAAuB/N,EAAQ,IAExC4tB,EAAY5tB,EAAQ,IAEpBmmC,EAAmBp4B,EAAuB/N,EAAQ,MAEtD,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAiBvF,IAAI8uC,EAEJ,SAAUtY,GAfV,IAAwBC,EAAUC,EAkBhC,SAASoY,IAGP,IAFA,IAAInY,EAEKwY,EAAOhvC,UAAUD,OAAQkwC,EAAQ,IAAIzpC,MAAMwoC,GAAOC,EAAO,EAAGA,EAAOD,EAAMC,IAChFgB,EAAMhB,GAAQjvC,UAAUivC,GAqD1B,OAlDAzY,EAAQH,EAAiBh1B,KAAKgmB,MAAMgP,EAAkB,CAACl2B,MAAMiP,OAAO6gC,KAAW9vC,MAEzE+vC,YAAc,WAClB,IAAK,IAAIC,EAAQnwC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAM2pC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IACpFnpB,EAAKmpB,GAASpwC,UAAUowC,GAG1B,OAAO5Z,EAAM6Z,gBAAgB,UAAW,EAAGppB,IAG7CuP,EAAM8Z,eAAiB,WACrB,IAAK,IAAIC,EAAQvwC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAM+pC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IACpFvpB,EAAKupB,GAASxwC,UAAUwwC,GAG1B,OAAOha,EAAM6Z,gBAAgB,aAAc,EAAGppB,IAGhDuP,EAAMia,cAAgB,WACpB,IAAK,IAAIC,EAAQ1wC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAMkqC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IACpF1pB,EAAK0pB,GAAS3wC,UAAU2wC,GAG1B,OAAOna,EAAM6Z,gBAAgB,YAAa,EAAGppB,IAG/CuP,EAAMoa,WAAa,WACjB,IAAK,IAAIC,EAAQ7wC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAMqqC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IACpF7pB,EAAK6pB,GAAS9wC,UAAU8wC,GAG1B,OAAOta,EAAM6Z,gBAAgB,SAAU,EAAGppB,IAG5CuP,EAAMua,cAAgB,WACpB,IAAK,IAAIC,EAAQhxC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAMwqC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IACpFhqB,EAAKgqB,GAASjxC,UAAUixC,GAG1B,OAAOza,EAAM6Z,gBAAgB,YAAa,EAAGppB,IAG/CuP,EAAMwG,aAAe,WACnB,IAAK,IAAIkU,EAAQlxC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAM0qC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IACpFlqB,EAAKkqB,GAASnxC,UAAUmxC,GAG1B,OAAO3a,EAAM6Z,gBAAgB,WAAY,EAAGppB,IAGvCuP,EA3EuBD,EAgBEF,GAhBZC,EAgBPqY,GAhBwCloC,UAAYjJ,OAAO65B,OAAOd,EAAW9vB,WAAY6vB,EAAS7vB,UAAU0D,YAAcmsB,EAAUA,EAASgB,UAAYf,EA8ExK,IAAIgB,EAASoX,EAAkBloC,UA0C/B,OAxCA8wB,EAAO8Y,gBAAkB,SAAyBxW,EAASuX,EAAKC,GAC9D,IAAIC,EAEA7nC,EAAWtJ,KAAKkG,MAAMoD,SAEtBmI,EAAQqkB,EAAOzqB,QAAQ6uB,SAASkX,QAAQ9nC,GAAU2nC,GAElDx/B,EAAMvL,MAAMwzB,KAAWyX,EAAe1/B,EAAMvL,OAAOwzB,GAASxS,MAAMiqB,EAAcD,GAChFlxC,KAAKkG,MAAMwzB,IAAU15B,KAAKkG,MAAMwzB,IAAS,EAAI3D,EAAUqC,aAAap4B,QAG1Eo3B,EAAO/M,OAAS,WACd,IAAIwP,EAAc75B,KAAKkG,MACnBoD,EAAWuwB,EAAYvwB,SACvB+nC,EAASxX,EAAYhD,GACrB3wB,EAjGR,SAAuCpG,EAAQi6B,GAAY,GAAc,MAAVj6B,EAAgB,MAAO,GAAI,IAA2D4hB,EAAK/hB,EAA5DoB,EAAS,GAAQi5B,EAAa38B,OAAOmlB,KAAK1iB,GAAqB,IAAKH,EAAI,EAAGA,EAAIq6B,EAAWp6B,OAAQD,IAAO+hB,EAAMsY,EAAWr6B,GAAQo6B,EAASh2B,QAAQ2d,IAAQ,IAAa3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAQ,OAAO3gB,EAiG1Rk5B,CAA8BJ,EAAa,CAAC,WAAY,OAEhEyX,EAAwBxb,EAAOzqB,QAAQ6uB,SAASkX,QAAQ9nC,GACxDulB,EAAQyiB,EAAsB,GAC9BC,EAASD,EAAsB,GAQnC,cANOprC,EAAM0yB,eACN1yB,EAAM4yB,kBACN5yB,EAAM8yB,iBACN9yB,EAAMgzB,cACNhzB,EAAMizB,iBACNjzB,EAAMkzB,SACNtD,EAAOzqB,QAAQ4L,cAAcq3B,EAAiBjjC,QAASnF,EAAOmrC,EAASvb,EAAOzqB,QAAQ+uB,aAAavL,EAAO,CAC/GnN,IAAK,QACLkX,QAAS54B,KAAK+vC,YACdjX,WAAY94B,KAAKmwC,eACjBnX,UAAWh5B,KAAKswC,gBACbxa,EAAOzqB,QAAQ+uB,aAAamX,EAAQ,CACvC7vB,IAAK,SACLkX,QAAS54B,KAAKywC,WACd3X,WAAY94B,KAAK4wC,cACjB5X,UAAWh5B,KAAK68B,iBAIb2R,EAzGT,CA0GE1Y,EAAOzqB,QAAQgvB,WAEjBmU,EAAkB9T,UAMd,GACJ,IAAInoB,EAAWi8B,EACfjxC,EAAQ8N,QAAUkH,EAClBirB,EAAOjgC,QAAUA,EAAO,S,6BCnJxBA,EAAQ0X,YAAa,EACrB1X,EAAQ8/B,gBAAkBA,EAC1B9/B,EAAQi0C,mBAAqBA,EAC7Bj0C,EAAQ2/B,uBA8FR,SAAgCh3B,EAAOkzB,GACrC,OAAOiE,EAAgBn3B,EAAMoD,UAAU,SAAUmI,GAC/C,OAAO,EAAIqkB,EAAOsE,cAAc3oB,EAAO,CACrC2nB,SAAUA,EAAS3rB,KAAK,KAAMgE,GAC9BolB,IAAI,EACJJ,OAAQgb,EAAQhgC,EAAO,SAAUvL,GACjCywB,MAAO8a,EAAQhgC,EAAO,QAASvL,GAC/B+xB,KAAMwZ,EAAQhgC,EAAO,OAAQvL,SApGnC3I,EAAQ4/B,oBAyGR,SAA6BpC,EAAWkC,EAAkB7D,GACxD,IAAIsY,EAAmBrU,EAAgBtC,EAAUzxB,UAC7CA,EAAWkoC,EAAmBvU,EAAkByU,GAmCpD,OAlCAr0C,OAAOmlB,KAAKlZ,GAAU3K,SAAQ,SAAU+iB,GACtC,IAAIjQ,EAAQnI,EAASoY,GACrB,IAAK,EAAIoU,EAAO6b,gBAAgBlgC,GAAhC,CACA,IAAImgC,EAAUlwB,KAAOub,EACjB4U,EAAUnwB,KAAOgwB,EACjBI,EAAY7U,EAAiBvb,GAC7BqwB,GAAY,EAAIjc,EAAO6b,gBAAgBG,KAAeA,EAAU5rC,MAAM2wB,IAEtEgb,GAAaD,IAAWG,EAQhBF,IAAWD,GAAYG,EAMxBF,GAAWD,IAAW,EAAI9b,EAAO6b,gBAAgBG,KAI1DxoC,EAASoY,IAAO,EAAIoU,EAAOsE,cAAc3oB,EAAO,CAC9C2nB,SAAUA,EAAS3rB,KAAK,KAAMgE,GAC9BolB,GAAIib,EAAU5rC,MAAM2wB,GACpBoB,KAAMwZ,EAAQhgC,EAAO,OAAQspB,GAC7BpE,MAAO8a,EAAQhgC,EAAO,QAASspB,MAXjCzxB,EAASoY,IAAO,EAAIoU,EAAOsE,cAAc3oB,EAAO,CAC9ColB,IAAI,IAVNvtB,EAASoY,IAAO,EAAIoU,EAAOsE,cAAc3oB,EAAO,CAC9C2nB,SAAUA,EAAS3rB,KAAK,KAAMgE,GAC9BolB,IAAI,EACJoB,KAAMwZ,EAAQhgC,EAAO,OAAQspB,GAC7BpE,MAAO8a,EAAQhgC,EAAO,QAASspB,SAoB9BzxB,GA5IT,IAAIwsB,EAAS3tB,EAAQ,GAQrB,SAASk1B,EAAgB/zB,EAAU0oC,GACjC,IAII7zC,EAASd,OAAO65B,OAAO,MAO3B,OANI5tB,GAAUwsB,EAAOoE,SAAS5sB,IAAIhE,GAAU,SAAUP,GACpD,OAAOA,KACNpK,SAAQ,SAAU8S,GAEnBtT,EAAOsT,EAAMiQ,KATF,SAAgBjQ,GAC3B,OAAOugC,IAAS,EAAIlc,EAAO6b,gBAAgBlgC,GAASugC,EAAMvgC,GAASA,EAQ/CwgC,CAAOxgC,MAEtBtT,EAqBT,SAASqzC,EAAmBpkB,EAAMD,GAIhC,SAAS+kB,EAAexwB,GACtB,OAAOA,KAAOyL,EAAOA,EAAKzL,GAAO0L,EAAK1L,GAJxC0L,EAAOA,GAAQ,GACfD,EAAOA,GAAQ,GAQf,IAcIxtB,EAdAwyC,EAAkB90C,OAAO65B,OAAO,MAChCkb,EAAc,GAElB,IAAK,IAAIC,KAAWjlB,EACdilB,KAAWllB,EACTilB,EAAYxyC,SACduyC,EAAgBE,GAAWD,EAC3BA,EAAc,IAGhBA,EAAYvwC,KAAKwwC,GAKrB,IAAIC,EAAe,GAEnB,IAAK,IAAIC,KAAWplB,EAAM,CACxB,GAAIglB,EAAgBI,GAClB,IAAK5yC,EAAI,EAAGA,EAAIwyC,EAAgBI,GAAS3yC,OAAQD,IAAK,CACpD,IAAI6yC,EAAiBL,EAAgBI,GAAS5yC,GAC9C2yC,EAAaH,EAAgBI,GAAS5yC,IAAMuyC,EAAeM,GAI/DF,EAAaC,GAAWL,EAAeK,GAIzC,IAAK5yC,EAAI,EAAGA,EAAIyyC,EAAYxyC,OAAQD,IAClC2yC,EAAaF,EAAYzyC,IAAMuyC,EAAeE,EAAYzyC,IAG5D,OAAO2yC,EAGT,SAASb,EAAQhgC,EAAO7S,EAAMsH,GAC5B,OAAsB,MAAfA,EAAMtH,GAAgBsH,EAAMtH,GAAQ6S,EAAMvL,MAAMtH,K,6BC9FzD,SAAS6zC,EAAQ/yC,GAAmV,OAAtO+yC,EAArD,oBAAXC,QAAoD,kBAApBA,OAAOC,SAAmC,SAAiBjzC,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,oBAAXgzC,QAAyBhzC,EAAIsK,cAAgB0oC,QAAUhzC,IAAQgzC,OAAOpsC,UAAY,gBAAkB5G,IAAyBA,GAEnXrC,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIyqB,EAYJ,SAAiCp2B,EAAKkzC,GAAe,IAAKA,GAAelzC,GAAOA,EAAIuV,WAAc,OAAOvV,EAAO,GAAY,OAARA,GAAiC,WAAjB+yC,EAAQ/yC,IAAoC,oBAARA,EAAsB,MAAO,CAAE2L,QAAS3L,GAAS,IAAImzC,EAAQC,EAAyBF,GAAc,GAAIC,GAASA,EAAME,IAAIrzC,GAAQ,OAAOmzC,EAAMhmB,IAAIntB,GAAQ,IAAIg2B,EAAS,GAAQsd,EAAwB31C,OAAOC,gBAAkBD,OAAOgE,yBAA0B,IAAK,IAAIqgB,KAAOhiB,EAAO,GAAY,YAARgiB,GAAqBrkB,OAAOiJ,UAAUsL,eAAe1Q,KAAKxB,EAAKgiB,GAAM,CAAE,IAAIiU,EAAOqd,EAAwB31C,OAAOgE,yBAAyB3B,EAAKgiB,GAAO,KAAUiU,IAASA,EAAK9I,KAAO8I,EAAKC,KAAQv4B,OAAOC,eAAeo4B,EAAQhU,EAAKiU,GAAgBD,EAAOhU,GAAOhiB,EAAIgiB,GAAYgU,EAAOrqB,QAAU3L,EAASmzC,GAASA,EAAMjd,IAAIl2B,EAAKg2B,GAAW,OAAOA,EAZhxBG,CAAwB1tB,EAAQ,IAEzCg0B,EAAajmB,EAAuB/N,EAAQ,IAE5CghB,EAASjT,EAAuB/N,EAAQ,MAExCw1B,EAASznB,EAAuB/N,EAAQ,MAE5C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,SAASozC,EAAyBF,GAAe,GAAuB,oBAAZK,QAAwB,OAAO,KAAM,IAAIC,EAAoB,IAAID,QAAeE,EAAmB,IAAIF,QAAW,OAAQH,EAA2B,SAAkCF,GAAe,OAAOA,EAAcO,EAAmBD,IAAsBN,GAIhU,SAASQ,EAAQ5Y,EAAQ6Y,GAAkB,IAAI7wB,EAAOnlB,OAAOmlB,KAAKgY,GAAS,GAAIn9B,OAAOi2C,sBAAuB,CAAE,IAAIC,EAAUl2C,OAAOi2C,sBAAsB9Y,GAAa6Y,IAAkBE,EAAUA,EAAQhtC,QAAO,SAAUitC,GAAO,OAAOn2C,OAAOgE,yBAAyBm5B,EAAQgZ,GAAK/V,eAAkBjb,EAAK3gB,KAAKqlB,MAAM1E,EAAM+wB,GAAY,OAAO/wB,EAMlV,SAASixB,EAAkB1yC,EAAQmF,GAAS,IAAK,IAAIvG,EAAI,EAAGA,EAAIuG,EAAMtG,OAAQD,IAAK,CAAE,IAAI+zC,EAAaxtC,EAAMvG,GAAI+zC,EAAWjW,WAAaiW,EAAWjW,aAAc,EAAOiW,EAAWC,cAAe,EAAU,UAAWD,IAAYA,EAAWE,UAAW,GAAMv2C,OAAOC,eAAeyD,EAAQ2yC,EAAWhyB,IAAKgyB,IAM7S,SAASG,EAAgBC,EAAGC,GAA+G,OAA1GF,EAAkBx2C,OAAO22C,gBAAkB,SAAyBF,EAAGC,GAAsB,OAAjBD,EAAE3c,UAAY4c,EAAUD,IAA6BA,EAAGC,GAErK,SAASE,EAAaC,GAAW,IAAIC,EAMrC,WAAuC,GAAuB,qBAAZC,UAA4BA,QAAQC,UAAW,OAAO,EAAO,GAAID,QAAQC,UAAUC,KAAM,OAAO,EAAO,GAAqB,oBAAVC,MAAsB,OAAO,EAAM,IAAsF,OAAhFC,QAAQluC,UAAUmuC,QAAQvzC,KAAKkzC,QAAQC,UAAUG,QAAS,IAAI,iBAAyB,EAAQ,MAAOriC,GAAK,OAAO,GAN9PuiC,GAA6B,OAAO,WAAkC,IAAsCv2C,EAAlCw2C,EAAQC,EAAgBV,GAAkB,GAAIC,EAA2B,CAAE,IAAIU,EAAYD,EAAgB50C,MAAMgK,YAAa7L,EAASi2C,QAAQC,UAAUM,EAAO90C,UAAWg1C,QAAqB12C,EAASw2C,EAAMztB,MAAMlnB,KAAMH,WAAc,OAAOi1C,EAA2B90C,KAAM7B,IAE5Z,SAAS22C,EAA2BtY,EAAMt7B,GAAQ,OAAIA,GAA2B,WAAlBuxC,EAAQvxC,IAAsC,oBAATA,EAA8Cq7B,EAAuBC,GAAtCt7B,EAEnI,SAASq7B,EAAuBC,GAAQ,QAAa,IAATA,EAAmB,MAAM,IAAIC,eAAe,6DAAgE,OAAOD,EAI/J,SAASoY,EAAgBd,GAAwJ,OAAnJc,EAAkBv3C,OAAO22C,eAAiB32C,OAAO03C,eAAiB,SAAyBjB,GAAK,OAAOA,EAAE3c,WAAa95B,OAAO03C,eAAejB,KAA8BA,GAExM,SAASkB,EAAgBt1C,EAAKgiB,EAAKlkB,GAAiK,OAApJkkB,KAAOhiB,EAAOrC,OAAOC,eAAeoC,EAAKgiB,EAAK,CAAElkB,MAAOA,EAAOigC,YAAY,EAAMkW,cAAc,EAAMC,UAAU,IAAkBl0C,EAAIgiB,GAAOlkB,EAAgBkC,EAI3M,IAAIu1C,EAAwB,SAAUC,IAlBtC,SAAmB/e,EAAUC,GAAc,GAA0B,oBAAfA,GAA4C,OAAfA,EAAuB,MAAM,IAAIhqB,UAAU,sDAAyD+pB,EAAS7vB,UAAYjJ,OAAO65B,OAAOd,GAAcA,EAAW9vB,UAAW,CAAE0D,YAAa,CAAExM,MAAO24B,EAAUyd,UAAU,EAAMD,cAAc,KAAevd,GAAYyd,EAAgB1d,EAAUC,GAmBjX+e,CAAUF,EAAUC,GAEpB,IAvBoBE,EAAaC,EAAYC,EAuBzCC,EAAStB,EAAagB,GAE1B,SAASA,EAAS/uC,GAChB,IAAImwB,EA+BJ,OA7DJ,SAAyBmf,EAAUJ,GAAe,KAAMI,aAAoBJ,GAAgB,MAAM,IAAIhpC,UAAU,qCAgC5GqpC,CAAgBz1C,KAAMi1C,GAItBD,EAAgBzY,EAFhBlG,EAAQkf,EAAOr0C,KAAKlB,KAAMkG,IAEqB,oBAAoB,SAAUwvC,GAC3E,IAAI7b,EAAcxD,EAAMnwB,MACpB3C,EAAWs2B,EAAYt2B,SACvBoyC,EAAkB9b,EAAY8b,gBAC9BC,EAAcF,GAAOA,EAAI5yC,MAEzBS,IAAaqyC,IACfvf,EAAM9yB,SAAWqyC,EACjBD,GAAmBA,EAAgBC,OAIvCZ,EAAgBzY,EAAuBlG,GAAQ,kBAAkB,SAAUkB,GACzE,IAAI7V,EAAM6V,EAAK7V,IACfA,GAAe,eAARA,GAAwB2U,EAAMwf,WACrCn0B,GAAe,cAARA,GAAuB2U,EAAMyf,cAGtCzf,EAAMW,MAAQ,CACZ+e,UAAU,EACV9U,IAAK,IAEP5K,EAAM2f,UAAyBlgB,EAAOzqB,QAAQ4qC,YAC9C5f,EAAM9yB,SAAW2C,EAAM3C,SACvB8yB,EAAM/M,KAAO+M,EAAMyJ,UAAYzJ,EAAMyf,SAAWzf,EAAMwf,SAAW,KAC1Dxf,EAkIT,OA3LoB+e,EA4DPH,GA5DoBI,EA4DV,CAAC,CACtB3zB,IAAK,oBACLlkB,MAAO,WACLwC,KAAKk2C,UAAS,GACd11C,SAASse,iBAAiB,QAAS9e,KAAKm2C,gBAAgB,KAEzD,CACDz0B,IAAK,WACLlkB,MAAO,WACL,IAAIg7B,EAASx4B,KAETo2C,EAAep2C,KAAKkG,MACpBe,EAAMmvC,EAAanvC,IACnBovC,EAAaD,EAAaC,WAC1BC,EAAkBF,EAAaE,gBAE/Bt2C,KAAKspB,MACPtpB,KAAKspB,KAAK/C,UAGZvmB,KAAKspB,KAAO,IAAIH,EAAO9d,QAAQpE,EAAKqvC,GACpCt2C,KAAKspB,KAAKoW,OAAOF,WAAW1e,MAAK,SAAUy1B,GACzC,IAAItV,EAAMsV,EAAMtV,IAEhBzI,EAAOD,SAAS,CACdwd,UAAU,EACV9U,IAAKA,IACJ,WACDoV,GAAcA,EAAWpV,GAEzBzI,EAAOge,qBAIZ,CACD90B,IAAK,uBACLlkB,MAAO,WACLwC,KAAKspB,KAAOtpB,KAAK8/B,UAAY9/B,KAAK81C,SAAW91C,KAAK61C,SAAW,KAC7Dr1C,SAAS+iB,oBAAoB,QAASvjB,KAAKm2C,gBAAgB,KAE5D,CACDz0B,IAAK,wBACLlkB,MAAO,SAA+Bu9B,GACpC,OAAQ/6B,KAAKg3B,MAAM+e,UAAYhb,EAAUx3B,WAAavD,KAAKkG,MAAM3C,UAAYw3B,EAAUx3B,WAAavD,KAAKkG,MAAM3C,WAEhH,CACDme,IAAK,qBACLlkB,MAAO,SAA4Bo6B,GAC7BA,EAAUr0B,WAAavD,KAAKkG,MAAM3C,UAAYvD,KAAKuD,WAAavD,KAAKkG,MAAM3C,UAC7EvD,KAAK8/B,UAAU5V,QAAQlqB,KAAKkG,MAAM3C,UAGhCq0B,EAAU3wB,MAAQjH,KAAKkG,MAAMe,KAC/BjH,KAAKk2C,aAGR,CACDx0B,IAAK,aACLlkB,MAAO,WACL,IAAIy7B,EAASj5B,KAETihC,EAAMjhC,KAAKg3B,MAAMiK,IACjBwV,EAAez2C,KAAKkG,MACpB3C,EAAWkzC,EAAalzC,SACxBmzC,EAAcD,EAAaC,YAC3BC,EAAeF,EAAaE,aAC5Bj1C,EAAO1B,KAAKg2C,UAAUhjB,QAC1BhzB,KAAK8/B,UAAY9/B,KAAKspB,KAAK4X,SAASx/B,EArI1C,SAAuBX,GAAU,IAAK,IAAIpB,EAAI,EAAGA,EAAIE,UAAUD,OAAQD,IAAK,CAAE,IAAIG,EAAyB,MAAhBD,UAAUF,GAAaE,UAAUF,GAAK,GAAQA,EAAI,EAAKyzC,EAAQ/1C,OAAOyC,IAAS,GAAMnB,SAAQ,SAAU+iB,GAAOszB,EAAgBj0C,EAAQ2gB,EAAK5hB,EAAO4hB,OAAsBrkB,OAAOu5C,0BAA6Bv5C,OAAOw5C,iBAAiB91C,EAAQ1D,OAAOu5C,0BAA0B92C,IAAmBszC,EAAQ/1C,OAAOyC,IAASnB,SAAQ,SAAU+iB,GAAOrkB,OAAOC,eAAeyD,EAAQ2gB,EAAKrkB,OAAOgE,yBAAyBvB,EAAQ4hB,OAAe,OAAO3gB,EAqI7d+1C,CAAc,CACtDC,WAAW,EACXt4C,MAAO,OACPC,OAAQ,QACPg4C,IAEH12C,KAAK81C,SAAW,WACd7c,EAAO6G,UAAU1S,QAGnBptB,KAAK61C,SAAW,WACd5c,EAAO6G,UAAU3S,QAGnBntB,KAAKg3C,iBACLL,GAAgBA,EAAa32C,KAAK8/B,WAEV,kBAAbv8B,GAA6C,kBAAbA,EACzCvD,KAAK8/B,UAAU5V,QAAQ3mB,GACd09B,EAAIrhC,OAAS,GAAKqhC,EAAI,GAAG1qB,KAClCvW,KAAK8/B,UAAU5V,QAAQ+W,EAAI,GAAG1qB,MAE9BvW,KAAK8/B,UAAU5V,YAGlB,CACDxI,IAAK,iBACLlkB,MAAO,WACL,IAAIy5C,EAAej3C,KAAKkG,MACpBiwC,EAAiBc,EAAad,eAC9Be,EAAqBD,EAAaC,mBACtCl3C,KAAK8/B,UAAU7T,GAAG,kBAAmBjsB,KAAKm3C,kBAC1Cn3C,KAAK8/B,UAAU7T,GAAG,QAASkqB,GAAkBn2C,KAAKm2C,gBAE9Ce,GACFl3C,KAAK8/B,UAAU7T,GAAG,WAAYirB,KAGjC,CACDx1B,IAAK,aACLlkB,MAAO,WACL,IAAIuqC,EAAS/nC,KAAKkG,MAAM6hC,OACxB,OAAoBjS,EAAOzqB,QAAQ4L,cAAc,MAAO,CACtDmgC,IAAKp3C,KAAKg2C,UACV13C,MAAOypC,EAAOve,SAGjB,CACD9H,IAAK,SACLlkB,MAAO,WACL,IAAIu4C,EAAW/1C,KAAKg3B,MAAM+e,SACtBsB,EAAer3C,KAAKkG,MACpBynC,EAAc0J,EAAa1J,YAC3B5F,EAASsP,EAAatP,OAC1B,OAAoBjS,EAAOzqB,QAAQ4L,cAAc,MAAO,CACtD3Y,MAAOypC,EAAOyD,YACbuK,GAAY/1C,KAAKs3C,cAAgB3J,QAvLoC8F,EAAkB2B,EAAY9uC,UAAW+uC,GAAiBC,GAAa7B,EAAkB2B,EAAaE,GA2L3KL,EAvKmB,CAwK1Bnf,EAAOuE,WAET4a,EAASta,aAAe,CACtBgT,YAAa,KACbgI,gBAAiB,KACjBU,WAAY,KACZtO,OAAQpK,EAAOtyB,QACfqrC,YAAa,GACbJ,gBAAiB,IAEnBrB,EAASva,UAAY,CACnBzzB,IAAKk1B,EAAW9wB,QAAQksC,UAAU,CAACpb,EAAW9wB,QAAQmsC,OAAQrb,EAAW9wB,QAAQosC,WAAW7Y,eAC5F+O,YAAaxR,EAAW9wB,QAAQ1E,QAChCpD,SAAU44B,EAAW9wB,QAAQksC,UAAU,CAACpb,EAAW9wB,QAAQmsC,OAAQrb,EAAW9wB,QAAQqsC,SACtF/B,gBAAiBxZ,EAAW9wB,QAAQhE,KACpCgvC,WAAYla,EAAW9wB,QAAQhE,KAC/B0gC,OAAQ5L,EAAW9wB,QAAQmvB,OAC3B8b,gBAAiBna,EAAW9wB,QAAQmvB,OACpCkc,YAAava,EAAW9wB,QAAQmvB,OAChCmc,aAAcxa,EAAW9wB,QAAQhE,KACjC8uC,eAAgBha,EAAW9wB,QAAQhE,KACnC6vC,mBAAoB/a,EAAW9wB,QAAQhE,MAEzC,IAAIkL,EAAW0iC,EACf13C,EAAQ8N,QAAUkH,G,6BCjPlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETH,OAAOC,eAAeC,EAAS,OAAQ,CACrCkgC,YAAY,EACZ5Q,IAAK,WACH,OAAO8qB,EAAMtsC,WAGjBhO,OAAOC,eAAeC,EAAS,WAAY,CACzCkgC,YAAY,EACZ5Q,IAAK,WACH,OAAOwX,EAAUh5B,WAGrBhO,OAAOC,eAAeC,EAAS,UAAW,CACxCkgC,YAAY,EACZ5Q,IAAK,WACH,OAAO5S,EAAS5O,WAGpBhO,OAAOC,eAAeC,EAAS,SAAU,CACvCkgC,YAAY,EACZ5Q,IAAK,WACH,OAAO9D,EAAQ1d,WAGnBhO,OAAOC,eAAeC,EAAS,YAAa,CAC1CkgC,YAAY,EACZ5Q,IAAK,WACH,OAAOuR,EAAW/yB,WAGtB9N,EAAQ8N,aAAU,EAElB,IAAIssC,EAAQzhC,EAAuB/N,EAAQ,MAEvC8R,EAAW/D,EAAuB/N,EAAQ,KAE1Ci2B,EAAaloB,EAAuB/N,EAAQ,MAE5Ck8B,EAAYnuB,EAAuB/N,EAAQ,KAE3C4gB,EAAU7S,EAAuB/N,EAAQ,MAI7C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,IAAI6S,EAJQ2D,EAAuB/N,EAAQ,MAItBkD,QACrB9N,EAAQ8N,QAAUkH,G,kDClDlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI4O,EAAW/D,EAAuB/N,EAAQ,KAE1C0gB,EAAQ3S,EAAuB/N,EAAQ,MAEvCyvC,EAAW1hC,EAAuB/N,EAAQ,MAE1CgS,EAAgBhS,EAAQ,IAE5B,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GA4QvF,IAAI6S,EAvQJ,MACEvI,cACEhK,KAAK63C,WAAa,GAClB73C,KAAK83C,YAAc,GACnB93C,KAAK+3C,UAAY,GACjB/3C,KAAKymB,MAAQ,GACbzmB,KAAKymB,MAAM0D,UAAY,IAAItB,EAAMxd,QACjCrL,KAAKymB,MAAMznB,QAAU,IAAI6pB,EAAMxd,QAE/BrL,KAAKymB,MAAMznB,QAAQ0nB,SAASvM,EAAcrD,aAC1C9W,KAAKymB,MAAMznB,QAAQ0nB,SAASvM,EAAc/C,kBAC1CpX,KAAKymB,MAAMznB,QAAQ0nB,SAASvM,EAAclC,aAC1CjY,KAAK8a,QAAU,IAAIb,EAAS5O,QAC5BrL,KAAK0/B,QAAS,EACd1/B,KAAKg4C,WAAQtvC,EACb1I,KAAKs/B,cAAW52B,EAChB1I,KAAKi4C,oBAAiBvvC,EACtB1I,KAAKk4C,aAAUxvC,EACf1I,KAAKJ,YAAS8I,EAUhB+3B,OAAO0X,EAAUvX,EAAUtpB,GACzBtX,KAAKg4C,MAAQG,EAASztB,MACtB1qB,KAAKs/B,SAAW6Y,EAAS7Y,SACzBt/B,KAAKi4C,eAAiBE,EAASF,eAC/Bj4C,KAAKk4C,QAAUC,EAASD,SAAWC,EAASC,UAAY,GACxDp4C,KAAKJ,OAASI,KAAKg4C,MAAMp4C,OACzBI,KAAKg4C,MAAMr5C,SAAQ,CAAC6D,EAAM+G,KACxB,IACI8uC,EADAC,EAAet4C,KAAKs/B,SAAS98B,EAAK2V,OAEtC3V,EAAK+G,MAAQA,EACb/G,EAAKoY,QAAU5a,KAAK8a,QAAQ1I,yBAAyBpS,KAAKi4C,eAAgBz1C,EAAK+G,MAAO/G,EAAK2V,OAEvF3V,EAAK+T,OACP/T,EAAKyE,IAAM25B,EAASp+B,EAAK+T,MAAM,GAC/B/T,EAAK8U,UAAYA,EAAU9U,EAAK+T,OAG9B+hC,IACF91C,EAAK+T,KAAO+hC,EAAa/hC,KACzB/T,EAAKyE,IAAM25B,EAASp+B,EAAK+T,MAAM,GAC/B/T,EAAK8U,UAAYA,EAAU9U,EAAK+T,MAE5B+hC,EAAa3yB,WAAW/lB,QAC1B4C,EAAKmjB,WAAW9jB,KAAKqlB,MAAM1kB,EAAKmjB,WAAY2yB,EAAa3yB,aAIzC,QAAhBnjB,EAAK+1C,QACP/1C,EAAK4qB,KAAO,WACV,IAAI1c,EAAYlO,EAAK+G,MAErB,KAAOmH,EAAY,GAAG,CACpB,IAAI0c,EAAOptB,KAAK6sB,IAAInc,EAAY,GAEhC,GAAI0c,GAAQA,EAAKmrB,OACf,OAAOnrB,EAGT1c,GAAa,IAIfjD,KAAKzN,MAEPwC,EAAK2qB,KAAO,WACV,IAAIqrB,EAAYh2C,EAAK+G,MAErB,KAAOivC,EAAYx4C,KAAK63C,WAAWj4C,OAAS,GAAG,CAC7C,IAAIutB,EAAOntB,KAAK6sB,IAAI2rB,EAAY,GAEhC,GAAIrrB,GAAQA,EAAKorB,OACf,OAAOprB,EAGTqrB,GAAa,IAIf/qC,KAAKzN,QAEPwC,EAAK4qB,KAAO,aAIZ5qB,EAAK2qB,KAAO,cAKdkrB,EAAY,IAAIT,EAASvsC,QAAQ7I,EAAMxC,KAAKymB,OAC5CzmB,KAAKoyB,OAAOimB,MAEdr4C,KAAK0/B,QAAS,EAahB7S,IAAI9rB,GACF,IAAIwI,EAAQ,EAEZ,GAAsB,qBAAXxI,EACT,KAAOwI,EAAQvJ,KAAK63C,WAAWj4C,QAAQ,CACrC,IAAIutB,EAAOntB,KAAK63C,WAAWtuC,GAE3B,GAAI4jB,GAAQA,EAAKorB,OACf,MAGFhvC,GAAS,OAEN,GAAIvJ,KAAK8a,QAAQxO,YAAYvL,GAAS,CAE3CwI,EADU,IAAI0Q,EAAS5O,QAAQtK,GACnB6K,aACe,kBAAX7K,IAAyC,IAAlBmI,MAAMnI,GAC7CwI,EAAQxI,EACmB,kBAAXA,GAA+C,IAAxBA,EAAOgD,QAAQ,KACtDwF,EAAQvJ,KAAK+3C,UAAUh3C,EAAOqgB,UAAU,IACb,kBAAXrgB,IAEhBA,EAASA,EAAOoM,MAAM,KAAK,GAC3B5D,EAAQvJ,KAAK83C,YAAY/2C,IAAWf,KAAK83C,YAAYW,UAAU13C,KAGjE,OAAOf,KAAK63C,WAAWtuC,IAAU,KASnC6oB,OAAOrb,GACL,IAAIxN,EAAQvJ,KAAK63C,WAAWj4C,OAS5B,OARAmX,EAAQxN,MAAQA,EAChBvJ,KAAK63C,WAAWh2C,KAAKkV,GAGrB/W,KAAK83C,YAAYY,UAAU3hC,EAAQR,OAAShN,EAC5CvJ,KAAK83C,YAAYW,UAAU1hC,EAAQR,OAAShN,EAC5CvJ,KAAK83C,YAAY/gC,EAAQR,MAAQhN,EACjCvJ,KAAK+3C,UAAUhhC,EAAQoB,OAAS5O,EACzBA,EASTipB,QAAQzb,GAQN,OANA/W,KAAK83C,YAAY/gC,EAAQR,MAAQ,EACjCvW,KAAK+3C,UAAUhhC,EAAQoB,OAAS,EAEhCnY,KAAK63C,WAAWl5C,SAAQ,SAAU6D,EAAM+G,GACtC/G,EAAK+G,MAAQA,KAER,EAYT2Z,OAAOnM,GACL,IAAIxN,EAAQvJ,KAAK63C,WAAW9zC,QAAQgT,GAEpC,GAAIxN,GAAS,EAGX,cAFOvJ,KAAK83C,YAAY/gC,EAAQR,aACzBvW,KAAK+3C,UAAUhhC,EAAQoB,OACvBnY,KAAK63C,WAAWp0C,OAAO8F,EAAO,GASzCovC,OACE,OAAO34C,KAAK63C,WAAWl5C,QAAQuoB,MAAMlnB,KAAK63C,WAAYh4C,WAQxDgvB,QACE,IAAItlB,EAAQ,EAEZ,EAAG,CACD,IAAI4jB,EAAOntB,KAAK6sB,IAAItjB,GAEpB,GAAI4jB,GAAQA,EAAKorB,OACf,OAAOprB,EAGT5jB,GAAS,QACFA,EAAQvJ,KAAK63C,WAAWj4C,QAQnC+uB,OACE,IAAIplB,EAAQvJ,KAAK63C,WAAWj4C,OAAS,EAErC,EAAG,CACD,IAAIwtB,EAAOptB,KAAK6sB,IAAItjB,GAEpB,GAAI6jB,GAAQA,EAAKmrB,OACf,OAAOnrB,EAGT7jB,GAAS,QACFA,GAAS,GAGpBgd,UACEvmB,KAAK24C,MAAK5hC,GAAWA,EAAQwP,YAC7BvmB,KAAK63C,gBAAanvC,EAClB1I,KAAK83C,iBAAcpvC,EACnB1I,KAAK+3C,eAAYrvC,EACjB1I,KAAKymB,MAAM0D,UAAU7C,QACrBtnB,KAAKymB,MAAMznB,QAAQsoB,QACnBtnB,KAAKymB,WAAQ/d,EACb1I,KAAK8a,aAAUpS,EACf1I,KAAK0/B,QAAS,EACd1/B,KAAKg4C,WAAQtvC,EACb1I,KAAKs/B,cAAW52B,EAChB1I,KAAKi4C,oBAAiBvvC,EACtB1I,KAAKk4C,aAAUxvC,EACf1I,KAAKJ,YAAS8I,IAMlBnL,EAAQ8N,QAAUkH,G,6BC1RlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IAEhB8R,EAAW/D,EAAuB/N,EAAQ,KAE1C0gB,EAAQ3S,EAAuB/N,EAAQ,MAEvCgS,EAAgBhS,EAAQ,IAExBm2B,EAAYpoB,EAAuB/N,EAAQ,KAE3ChD,EAAUgD,EAAQ,IAEtB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GA0UvF,IAAI6S,EAjUJ,MACEvI,YAAYxH,EAAMikB,GAChBzmB,KAAKmY,MAAQ3V,EAAK2V,MAClBnY,KAAKu4C,OAAyB,QAAhB/1C,EAAK+1C,OACnBv4C,KAAK2lB,WAAanjB,EAAKmjB,WACvB3lB,KAAKuJ,MAAQ/G,EAAK+G,MAClBvJ,KAAKuW,KAAO/T,EAAK+T,KACjBvW,KAAKiH,IAAMzE,EAAKyE,IAChBjH,KAAKsX,UAAY9U,EAAK8U,UACtBtX,KAAKmtB,KAAO3qB,EAAK2qB,KACjBntB,KAAKotB,KAAO5qB,EAAK4qB,KACjBptB,KAAK4a,QAAUpY,EAAKoY,QAEhB6L,EACFzmB,KAAKymB,MAAQA,GAEbzmB,KAAKymB,MAAQ,GACbzmB,KAAKymB,MAAM0D,UAAY,IAAItB,EAAMxd,QAAQrL,MACzCA,KAAKymB,MAAMznB,QAAU,IAAI6pB,EAAMxd,QAAQrL,OAGzCA,KAAKQ,cAAWkI,EAChB1I,KAAKyX,cAAW/O,EAChB1I,KAAKyQ,YAAS/H,EAShBojB,KAAK+V,GACH,IAAIhW,EAAUgW,GAAY7hC,KAAK6rB,SAAWyS,EAAUjzB,QAChDg0B,EAAU,IAAI/zB,EAAMvL,MACpB2/B,EAASL,EAAQl/B,QAiBrB,OAfIH,KAAKyX,SACP4nB,EAAQxhC,QAAQmC,KAAKyX,UAErBoU,EAAQ7rB,KAAKiH,KAAK6Z,KAAK,SAAU0f,GAI/B,OAFAxgC,KAAKQ,SAAWggC,EAChBxgC,KAAKyX,SAAW+oB,EAAI//B,gBACbT,KAAKymB,MAAMznB,QAAQ6nB,QAAQ7mB,KAAKQ,SAAUR,OACjDyN,KAAKzN,OAAO8gB,KAAK,WACjBue,EAAQxhC,QAAQmC,KAAKyX,WACrBhK,KAAKzN,OAAO+/B,OAAM,SAAUhoB,GAC5BsnB,EAAQvhC,OAAOia,MAIZ2nB,EAQTj0B,OACE,OAAO,EAAI0O,EAAcrD,aAAa9W,KAAKQ,SAAUR,MASvDqqB,OAAOwX,GACL,IAAI0F,EAAY,IAAIj8B,EAAMvL,MACtB2wB,EAAW6W,EAAUpnC,QAwBzB,OAvBAH,KAAKyQ,OAELzQ,KAAK8rB,KAAK+V,GAAU/gB,KAAK,SAAUrJ,GACjC,IACImhC,GADiC,qBAAdt+B,WAA6BA,UAAUG,WAAa,IACtD1W,QAAQ,YAAc,EASvC80C,EAAa,IANY,qBAAlBC,eAAiCF,EAC7BzzC,EAAQD,UAER4zC,eAKf,OADA94C,KAAKyQ,OAASooC,EAAWE,kBAAkBthC,GACpCzX,KAAKyQ,QACZhD,KAAKzN,OAAO8gB,KAAK,WACjB,OAAO9gB,KAAKymB,MAAM0D,UAAUtD,QAAQ7mB,KAAKyQ,OAAQzQ,OACjDyN,KAAKzN,OAAO8gB,KAAK,WACjBymB,EAAU1pC,QAAQmC,KAAKyQ,SACvBhD,KAAKzN,OAAO+/B,OAAM,SAAUhoB,GAC5BwvB,EAAUzpC,OAAOia,MAEZ2Y,EASToB,KAAKknB,GACH,IAAIjiC,EAAU/W,KACVsf,EAAU,GAEVzY,EAAQmyC,EAAOp3C,cA2CnB,OAHA,EAAI0J,EAAMnE,QAAQ4P,EAAQvW,UAAU,SAAUkB,IAtCnC,SAAUA,GASnB,IARA,IAEI2K,EACA2U,EAEAi4B,EALAhV,EAAOviC,EAAKwJ,YAAYtJ,cACxBiK,EAAQkL,EAAQvW,SAASkE,cAGzBiqB,GAAQ,GAIG,GAAR3N,IAIO,IAFZA,EAAMijB,EAAKlgC,QAAQ8C,EAAO8nB,EAAO,OAI/B9iB,EAAQkL,EAAQvW,SAASkE,eACnB6F,SAAS7I,EAAMsf,GACrBnV,EAAMjB,OAAOlJ,EAAMsf,EAAMna,EAAMjH,QAC/ByM,EAAM0K,EAAQmN,aAAarY,GAGzBotC,EADEv3C,EAAKwJ,YAAYtL,OAbb,IAcI8B,EAAKwJ,YAGL,OADV+tC,EAAUv3C,EAAKwJ,YAAYkW,UAAUJ,EAAMk4B,GAAWl4B,EAAMk4B,KAChC,MAI9B55B,EAAQzd,KAAK,CACXwK,IAAKA,EACL4sC,QAASA,KAIbtqB,EAAO3N,EAKT8Q,CAAKpwB,MAEA4d,EAST3I,OAAOqiC,EAAQG,EAAY,GACzB,GAAwC,oBAA7B34C,SAAS8G,iBAClB,OAAOtH,KAAK8xB,KAAKknB,GAGnB,IAAI15B,EAAU,GACd,MACMvI,EAAU/W,KAEV6G,EAAQmyC,EAAOp3C,cAEf+U,EAAS,SAAUyiC,GACvB,MAIMp4B,EAJeo4B,EAASC,QAAO,CAACC,EAAKtmB,IAClCsmB,EAAMtmB,EAAQ9nB,aACpB,IACuBtJ,cACTmC,QAAQ8C,GAEzB,IAAY,GAARma,EAAW,CACb,MAAMu4B,EAAiB,EACjB7lB,EAAS1S,EAAMna,EAAMjH,OAC3B,IAAI45C,EAAe,EACf7Q,EAAI,EAER,GAAI3nB,EAAMo4B,EAASG,GAAgB35C,OAAQ,CACzC,IAAIyM,EAEJ,KAAOmtC,EAAeJ,EAASx5C,OAAS,IACtC+oC,GAAKyQ,EAASI,GAAc55C,SAExB8zB,GAAUiV,KAId6Q,GAAgB,EAGlB,IAAIhvC,EAAY4uC,EAASG,GACrB1uC,EAAUuuC,EAASI,GACnB3tC,EAAQkL,EAAQvW,SAASkE,cAC7BmH,EAAMtB,SAASC,EAAWwW,GAC1B,IAAIy4B,EAAuBL,EAASn4C,MAAM,EAAGu4C,GAAcH,QAAO,CAACC,EAAKtmB,IAC/DsmB,EAAMtmB,EAAQ9nB,YAAYtL,QAChC,GACHiM,EAAMjB,OAAOC,EAAS4uC,EAAuB/lB,EAASA,EAASA,EAAS+lB,GACxEptC,EAAM0K,EAAQmN,aAAarY,GAC3B,IAAIotC,EAAUG,EAASn4C,MAAM,EAAGu4C,EAAe,GAAGH,QAAO,CAACC,EAAKtmB,IACtDsmB,EAAMtmB,EAAQ9nB,aACpB,IAEC+tC,EAAQr5C,OA5CG,MA6Cbq5C,EAAUA,EAAQ73B,UAAUJ,EAAM04B,GAAkB14B,EAAM04B,IAC1DT,EAAU,MAAQA,EAAU,OAG9B35B,EAAQzd,KAAK,CACXwK,IAAKA,EACL4sC,QAASA,OAMX1xC,EAAa/G,SAAS8G,iBAAiByP,EAAQvW,SAAUgH,WAAWC,UAAW,MAAM,GAC3F,IAAI/F,EACA03C,EAAW,GAEf,KAAO13C,EAAO6F,EAAWmC,YACvB0vC,EAASv3C,KAAKH,GAEV03C,EAASx5C,QAAUu5C,IACrBxiC,EAAOyiC,EAASn4C,MAAM,EAAGk4C,IACzBC,EAAWA,EAASn4C,MAAM,EAAGk4C,IAQjC,OAJIC,EAASx5C,OAAS,GACpB+W,EAAOyiC,GAGF95B,EAUTq6B,wBAAwBC,GAEtB,IAAIl9B,EAAW,CACb0H,OAAQw1B,EAAax1B,OACrBsF,OAAQkwB,EAAalwB,OACrBsD,YAAa4sB,EAAa5sB,aAc5B,OAXAhtB,KAAK2lB,WAAWhnB,SAAQ,SAAUC,GAChC,IAEIwd,EAAU5e,EAFVsiC,EAAYlhC,EAAKkK,QAAQ,aAAc,IACvCqE,EAAQ2yB,EAAU/7B,QAAQ,MAGhB,GAAVoJ,IACFiP,EAAW0jB,EAAU7+B,MAAM,EAAGkM,GAC9B3P,EAAQsiC,EAAU7+B,MAAMkM,EAAQ,GAChCuP,EAASN,GAAY5e,MAGlBkf,EASTwH,aAAa21B,GACX,OAAO,IAAI5/B,EAAS5O,QAAQwuC,EAAQ75C,KAAK4a,SAASjT,WASpDmyC,eAAez7C,GACb,OAAO,IAAI4b,EAAS5O,QAAQhN,EAAI2B,KAAK4a,SAASjT,WAOhDoyC,SACE/5C,KAAKQ,cAAWkI,EAChB1I,KAAKyX,cAAW/O,EAChB1I,KAAKyQ,YAAS/H,EAGhB6d,UACEvmB,KAAK+5C,SACL/5C,KAAKymB,MAAM0D,UAAU7C,QACrBtnB,KAAKymB,MAAMznB,QAAQsoB,QACnBtnB,KAAKymB,WAAQ/d,EACb1I,KAAKmY,WAAQzP,EACb1I,KAAKu4C,YAAS7vC,EACd1I,KAAK2lB,gBAAajd,EAClB1I,KAAKuJ,WAAQb,EACb1I,KAAKuW,UAAO7N,EACZ1I,KAAKiH,SAAMyB,EACX1I,KAAKmtB,UAAOzkB,EACZ1I,KAAKotB,UAAO1kB,EACZ1I,KAAK4a,aAAUlS,IAMnBnL,EAAQ8N,QAAUkH,G,6BC5VlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IAEhB2gB,EAAS5S,EAAuB/N,EAAQ,MAExC8R,EAAW/D,EAAuB/N,EAAQ,KAE1CiS,EAAajS,EAAQ,IAErB6R,EAAgB9D,EAAuB/N,EAAQ,KAEnD,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAQvF,MAAMs6C,EACJhwC,YAAY0gB,EAAOmB,EAASxD,GAC1BroB,KAAK0qB,MAAQA,EACb1qB,KAAK6rB,QAAUA,EACf7rB,KAAKqoB,MAAQA,GAAS,IACtBroB,KAAKmG,EAAI,IAAI2iB,EAAOzd,QAAQrL,MAC5BA,KAAK8a,QAAU,IAAIb,EAAS5O,QAC5BrL,KAAK+9B,WAAa,GAClB/9B,KAAKi6C,gBAAkB,GACvBj6C,KAAKiuB,MAAQ,EACbjuB,KAAKk6C,MAAQ,IACbl6C,KAAKm6C,SAAW,EAChBn6C,KAAKo6C,aAAe,EACpBp6C,KAAK4tB,gBAAkB,GACvB5tB,KAAKq6C,YAAc,GACnBr6C,KAAKs6C,uBAAoB5xC,EAS3B6xC,SAASC,GAWP,OAVIA,IACFx6C,KAAKk6C,MAAQM,GAGfx6C,KAAKmG,EAAEkiB,QACProB,KAAK0qB,MAAMiuB,KAAK,SAAU5hC,GACpBA,EAAQwhC,QACVv4C,KAAKmG,EAAE0hB,QAAQ7nB,KAAKy6C,QAAQhtC,KAAKzN,MAAO+W,IAE1CtJ,KAAKzN,OACAA,KAAKmG,EAAE4hB,MAAMjH,KAAK,WAOvB,OANA9gB,KAAKiuB,MAAQjuB,KAAK+9B,WAAWn+B,OAAS,EAElCI,KAAKq6C,cACPr6C,KAAK4tB,gBAAkB5tB,KAAKq6C,aAGvBr6C,KAAK+9B,YACZtwB,KAAKzN,OAGT0E,cACE,MAAO,CACL2F,oBAAgB3B,EAChB4B,iBAAa5B,EACbyB,kBAAczB,EACd0B,eAAW1B,GAIf+xC,QAAQ1jC,GACN,OAAOA,EAAQ+U,KAAK9rB,KAAK6rB,SAAS/K,KAAK,SAAUrJ,GAC/C,IAAIijC,EAAY,IAAIpvC,EAAMvL,MACtB4sB,EAAY3sB,KAAK8E,MAAM2S,EAAUV,EAAQ6D,SAI7C,OAHA5a,KAAK+9B,WAAa/9B,KAAK+9B,WAAW9uB,OAAO0d,GACzC5V,EAAQgjC,SACR/5C,KAAKs6C,kBAAoBz7B,YAAW,IAAM67B,EAAU78C,QAAQ8uB,IAAY3sB,KAAKqoB,OACtEqyB,EAAUv6C,SACjBsN,KAAKzN,OAGT8E,MAAM2S,EAAUmD,EAAS4/B,GACvB,IACI3uC,EAIAuhB,EALAT,EAAY,GAEZtoB,EAAMoT,EAASnT,cACf3D,GAAO,EAAI2K,EAAM5F,IAAIrB,EAAK,QAC1BouB,EAAU,EAGVkoB,EAASH,GAASx6C,KAAKk6C,MA8D3B,IAFA,EAAI5uC,EAAMnE,QAAQxG,EA1DL,SAAUe,GACrB,IACIk5C,EADA/qC,EAAMnO,EAAK9B,OAEXohB,EAAM,EAEV,GAAuC,IAAnCtf,EAAKwJ,YAAYo4B,OAAO1jC,OAC1B,OAAO,EAkBT,IAde,GAAX6yB,KACF5mB,EAAQ7L,KAAK0E,eACP2F,eAAiB3I,EACvBmK,EAAMvB,YAAc,IAGtBswC,EAAOD,EAASloB,GAGL5iB,IACT4iB,GAAW5iB,EACXmR,EAAMnR,GAGDmR,EAAMnR,GAaX,GAZA+qC,EAAOD,EAASloB,EAEA,IAAZA,IAEFzR,GAAO,GACPnV,EAAQ7L,KAAK0E,eACP2F,eAAiB3I,EACvBmK,EAAMvB,YAAc0W,GAKlBA,EAAM45B,GAAQ/qC,EAEhB4iB,GAAW5iB,EAAMmR,EAEjBA,EAAMnR,MACD,CAELmR,GAAO45B,EAEP/uC,EAAM1B,aAAezI,EACrBmK,EAAMzB,UAAY4W,EAElB,IAAI3U,EAAM,IAAI4N,EAAS5O,QAAQQ,EAAO+O,GAASjT,WAC/CglB,EAAU9qB,KAAKwK,GACfomB,EAAU,EAIdrF,EAAO1rB,GAGsB+L,KAAKzN,OAEhC6L,GAASA,EAAMxB,gBAAkB+iB,EAAM,CACzCvhB,EAAM1B,aAAeijB,EACrBvhB,EAAMzB,UAAYgjB,EAAKxtB,OACvB,IAAIyM,EAAM,IAAI4N,EAAS5O,QAAQQ,EAAO+O,GAASjT,WAC/CglB,EAAU9qB,KAAKwK,GACfomB,EAAU,EAGZ,OAAO9F,EAWTkuB,kBAAkBC,EAAUC,EAAWnnB,GACrC,IAAI9wB,EAAQg4C,EAAW,IAAI7gC,EAAS5O,QAAQyvC,QAAYpyC,EAexD,OAdA1I,KAAKmG,EAAEkiB,QACProB,KAAKi6C,gBAAkB,GACvBj6C,KAAKo6C,aAAe,EACpBp6C,KAAK0qB,MAAMiuB,KAAK,SAAU5hC,GACpBA,EAAQwhC,SACNz1C,EACEiU,EAAQxN,OAASzG,EAAM8I,UACzB5L,KAAKmG,EAAE0hB,QAAQ7nB,KAAKg7C,aAAavtC,KAAKzN,MAAO+W,EAASgkC,EAAWj4C,EAAO8wB,GAG1E5zB,KAAKmG,EAAE0hB,QAAQ7nB,KAAKg7C,aAAavtC,KAAKzN,MAAO+W,EAASgkC,EAAWj4C,EAAO8wB,KAG5EnmB,KAAKzN,OACAA,KAAKmG,EAAE4hB,MAAMjH,KAAK,WAKvB,OAJI9gB,KAAKq6C,cACPr6C,KAAK4tB,gBAAkB5tB,KAAKq6C,aAGvBr6C,KAAKi6C,iBACZxsC,KAAKzN,OAGTg7C,aAAajkC,EAASgkC,EAAWD,EAAUlnB,GACzC,OAAIA,GAAS5zB,KAAKi6C,gBAAgBr6C,QAAUg0B,EACnCh2B,QAAQC,UAGVkZ,EAAQ+U,KAAK9rB,KAAK6rB,SAAS/K,KAAK,SAAUrJ,GAC/C,IAAIijC,EAAY,IAAIpvC,EAAMvL,MACtB4sB,EAAY3sB,KAAKi7C,WAAWxjC,EAAUV,EAASgkC,EAAWD,GAC1DI,EAAiBtnB,EAAQ5zB,KAAKi6C,gBAAgBr6C,OAIlD,OAHAI,KAAKi6C,gBAAkBj6C,KAAKi6C,gBAAgBhrC,OAAO0d,EAAU/sB,QAAUg0B,EAAQjH,EAAU1rB,MAAM,EAAGi6C,GAAkBvuB,GACpH5V,EAAQgjC,SACR/5C,KAAKs6C,kBAAoBz7B,YAAW,IAAM67B,EAAU78C,QAAQ8uB,IAAY3sB,KAAKqoB,OACtEqyB,EAAUv6C,SACjBsN,KAAKzN,OAITm7C,WAAWC,GAOT,OAFAA,GAFAA,GAFAA,EAAIA,EAAEtyC,QAAQ,kBAAmB,KAE3BA,QAAQ,YAAa,MAErBA,QAAQ,MAAO,OAEZqE,MAAM,KAAKvN,OAGtBq7C,WAAWxjC,EAAUV,EAASgkC,EAAWD,GACvC,IAOItwC,EAPAoQ,EAAU7D,EAAQ6D,QAClB+R,EAAY,GACZtoB,EAAMoT,EAASnT,cACf3D,GAAO,EAAI2K,EAAM5F,IAAIrB,EAAK,QAE1Bs2C,EAASI,EACTM,GAAiBP,GAAWA,EAASlvC,WAAamL,EAAQxN,MAG1DuxC,GAAY/jC,EAAQxN,QAAUuxC,EAASlvC,WACzCpB,EAAYswC,EAAS3pC,SAAS2pC,EAASjvC,MAAQivC,EAAShvC,KAAKE,MAAMiD,OAAO6rC,EAASh4C,MAAMkJ,OAAS8uC,EAAShvC,KAAKE,MAAOyL,EAASnT,gBA0DlI,OADA,EAAIgH,EAAMnE,QAAQxG,EAtDL,SAAUe,GACrB,IAAK25C,EAAgB,CACnB,GAAI35C,IAAS8I,EAGX,OAAO,EAFP6wC,GAAiB,EAMrB,GAAI35C,EAAKwJ,YAAYtL,OAAS,IACW,IAAnC8B,EAAKwJ,YAAYo4B,OAAO1jC,OAC1B,OAAO,EAIX,IACIg7C,EADA/qC,EAAM7P,KAAKm7C,WAAWz5C,EAAKwJ,aAE3B8V,EAAM,EAEV,GAAY,IAARnR,EACF,OAAO,EAWT,KARA+qC,EAAOD,EAAS36C,KAAKo6C,cAGVvqC,IACT7P,KAAKo6C,cAAgBvqC,EACrBmR,EAAMnR,GAGDmR,EAAMnR,GAGX,GAAImR,GAFJ45B,EAAOD,EAAS36C,KAAKo6C,eAEHvqC,EAEhB7P,KAAKo6C,cAAgBvqC,EAAMmR,EAE3BA,EAAMnR,MACD,CAELmR,GAAO45B,EACP,IAAIvuC,EAAM,IAAI4N,EAAS5O,QAAQ3J,EAAMkZ,GACrC+R,EAAU9qB,KAAK,CACbwK,IAAKA,EAAI1E,WACTozC,UAAW/6C,KAAKo6C,eAElBp6C,KAAKo6C,aAAe,EAIjB14C,GAGsB+L,KAAKzN,OAC7B2sB,EASTyB,gBAAgB/hB,GACd,IAAIqpC,EAOJ,OALIz7B,EAAS5O,QAAQ/E,UAAUgG,YAAYD,KACzCA,EAAM,IAAI4N,EAAS5O,QAAQgB,IAIE,IAA3BrM,KAAK+9B,WAAWn+B,QACV,GAGV81C,GAAM,EAAIpqC,EAAM9H,YAAY6I,EAAKrM,KAAK+9B,WAAY/9B,KAAK8a,QAAQpM,SAE3DgnC,EAAM11C,KAAKiuB,MACNjuB,KAAKiuB,MAGPynB,GAST4F,kBAAkBjvC,GAChB,GAA+B,IAA3BrM,KAAK+9B,WAAWn+B,OAClB,OAAO,KAIT,IAAI81C,EAAM11C,KAAKouB,gBAAgB/hB,GAE/B,OAAOrM,KAAKsuB,uBAAuBonB,GASrCpnB,uBAAuBonB,GACrB,OAAKA,GAAQ11C,KAAKiuB,MAIXynB,EAAM11C,KAAKiuB,MAHT,EAYXstB,gBAAgB7F,GACd,IAAIrpC,GAAO,EAUX,MARkB,iBAAPqpC,IACTA,EAAMzyC,SAASyyC,IAGbA,GAAO,GAAKA,EAAM11C,KAAK+9B,WAAWn+B,SACpCyM,EAAMrM,KAAK+9B,WAAW2X,IAGjBrpC,EASTugB,kBAAkBkB,GAChB,IAAI4nB,EAOJ,GALI5nB,EAAa,GACf7b,QAAQupC,KAAK,sDAIX1tB,GAAc,EAAG,CACnB,IAAIzhB,EAAM,IAAI4N,EAAS5O,QAAQrL,KAAK+9B,WAAW/9B,KAAKiuB,QAEpD,OADA5hB,EAAI3B,WACG2B,EAAI1E,WAIb,OADA+tC,EAAMp1C,KAAKwzB,KAAK9zB,KAAKiuB,MAAQH,GACtB9tB,KAAKu7C,gBAAgB7F,GAQ9B5pB,KAAKa,GAQH,OANE3sB,KAAK+9B,WADkB,kBAAdpR,EACSjT,KAAK5U,MAAM6nB,GAEXA,EAGpB3sB,KAAKiuB,MAAQjuB,KAAK+9B,WAAWn+B,OAAS,EAC/BI,KAAK+9B,WAQd0d,OACE,OAAO/hC,KAAKgiC,UAAU17C,KAAK+9B,YAG7B4d,aACE,OAAO37C,KAAKm6C,SAGdyB,WAAWxrC,GACT,IAAIslC,EAEJ,GAAmB,iBAARtlC,EACTpQ,KAAKq6C,YAAcjqC,MACd,IAAmB,iBAARA,EAGhB,OAFApQ,KAAKm6C,SAAW/pC,EAKa,IAA3BpQ,KAAK+9B,WAAWn+B,SAID,iBAARwQ,GACTslC,EAAM11C,KAAKouB,gBAAgBhe,GAC3BpQ,KAAKm6C,SAAWzE,GAEhBA,EAAMtlC,EAGRpQ,KAAK0d,KAAKtD,EAAW5H,OAAOW,UAAUC,QAAS,CAC7C0a,WAAY9tB,KAAKsuB,uBAAuBonB,MAQzB,sBACjB,OAAO11C,KAAKm6C,SAOK,oBAAC/pC,GAClBpQ,KAAK47C,WAAWxrC,GAOlBxQ,SACE,OAAOI,KAAK+9B,WAAWn+B,OAGzB2mB,UACEvmB,KAAK0qB,WAAQhiB,EACb1I,KAAK6rB,aAAUnjB,EACf1I,KAAKqoB,WAAQ3f,EACb1I,KAAKmG,EAAEmiB,OACPtoB,KAAKmG,OAAIuC,EACT1I,KAAK8a,aAAUpS,EACf1I,KAAK+9B,gBAAar1B,EAClB1I,KAAKiuB,WAAQvlB,EACb1I,KAAKk6C,WAAQxxC,EACb1I,KAAKm6C,cAAWzxC,EAChB1I,KAAK4tB,qBAAkBllB,EACvB1I,KAAKq6C,iBAAc3xC,EACnB+V,aAAaze,KAAKs6C,qBAKtB,EAAItgC,EAAc3O,SAAS2uC,EAAU1zC,WACrC,IAAIiM,EAAWynC,EACfz8C,EAAQ8N,QAAUkH,G,6BCxflBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAIgC3L,EAJ5BsV,GAI4BtV,EAJUyI,EAAQ,MAIGzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAFnF4L,EAAQnD,EAAQ,IAoDpB,IAAIoK,EA3CJ,MACEvI,YAAY6xC,GACV77C,KAAKugC,YAAc,GACnBvgC,KAAKsV,UAAY,GACjBtV,KAAKg/B,SAAW,GAEZ6c,GACF77C,KAAK8E,MAAM+2C,GASf/2C,MAAM+2C,GAEJ,IAAIC,EAEJ,IAAKD,EACH,MAAM,IAAIh2C,MAAM,4BAKlB,KAFAi2C,GAAW,EAAIxwC,EAAM5F,IAAIm2C,EAAmB,aAG1C,MAAM,IAAIh2C,MAAM,qBAGlB7F,KAAKugC,YAAcub,EAASt1C,aAAa,aACzCxG,KAAKsV,UAAYN,EAAa3J,QAAQ0wC,QAAQ/7C,KAAKugC,aACnDvgC,KAAKg/B,SAAW6c,EAAkBG,YAGpCz1B,UACEvmB,KAAKugC,iBAAc73B,EACnB1I,KAAKsV,eAAY5M,EACjB1I,KAAKg/B,cAAWt2B,IAMpBnL,EAAQ8N,QAAUkH,G,6BC5DlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IA6WpB,IAAIoK,EAtWJ,MACEvI,YAAYiyC,GACVj8C,KAAKs/B,SAAW,GAChBt/B,KAAK+gC,QAAU,GACf/gC,KAAKghC,QAAU,GACfhhC,KAAK8gC,UAAY,GACjB9gC,KAAKi4C,eAAiB,EACtBj4C,KAAK0qB,MAAQ,GACb1qB,KAAKurB,SAAW,GAEZ0wB,GACFj8C,KAAK8E,MAAMm3C,GAUfn3C,MAAMm3C,GACJ,IAAIC,EAAcC,EAAcC,EAEhC,IAAKH,EACH,MAAM,IAAIp2C,MAAM,0BAKlB,KAFAq2C,GAAe,EAAI5wC,EAAM5F,IAAIu2C,EAAiB,aAG5C,MAAM,IAAIp2C,MAAM,qBAKlB,KAFAs2C,GAAe,EAAI7wC,EAAM5F,IAAIu2C,EAAiB,aAG5C,MAAM,IAAIp2C,MAAM,qBAKlB,KAFAu2C,GAAY,EAAI9wC,EAAM5F,IAAIu2C,EAAiB,UAGzC,MAAM,IAAIp2C,MAAM,kBAYlB,OATA7F,KAAKs/B,SAAWt/B,KAAKq8C,cAAcF,GACnCn8C,KAAK+gC,QAAU/gC,KAAKs8C,YAAYH,GAChCn8C,KAAKghC,QAAUhhC,KAAKu8C,YAAYJ,EAAcC,GAC9Cp8C,KAAK8gC,UAAY9gC,KAAKw8C,cAAcP,GACpCj8C,KAAKi4C,gBAAiB,EAAI3sC,EAAMlJ,oBAAoBg6C,GACpDp8C,KAAK0qB,MAAQ1qB,KAAKy8C,WAAWL,EAAWp8C,KAAKs/B,UAC7Ct/B,KAAK08C,iBAAmB18C,KAAK28C,qBAAqBV,GAClDj8C,KAAKurB,SAAWvrB,KAAK48C,cAAcV,GACnCl8C,KAAKurB,SAASvG,UAAYo3B,EAAU51C,aAAa,8BAC1C,CACL,SAAYxG,KAAKurB,SACjB,MAASvrB,KAAK0qB,MACd,SAAY1qB,KAAKs/B,SACjB,QAAWt/B,KAAK+gC,QAChB,QAAW/gC,KAAKghC,QAChB,UAAahhC,KAAK8gC,UAClB,eAAkB9gC,KAAKi4C,gBAW3B2E,cAAcpc,GACZ,IAAIjV,EAAW,GAiBf,OAhBAA,EAASsxB,MAAQ78C,KAAK88C,eAAetc,EAAK,SAC1CjV,EAASwxB,QAAU/8C,KAAK88C,eAAetc,EAAK,WAC5CjV,EAASyxB,YAAch9C,KAAK88C,eAAetc,EAAK,eAChDjV,EAAS0xB,QAAUj9C,KAAK88C,eAAetc,EAAK,QAC5CjV,EAAS2xB,UAAYl9C,KAAK88C,eAAetc,EAAK,aAC9CjV,EAASsE,WAAa7vB,KAAK88C,eAAetc,EAAK,cAC/CjV,EAAS4xB,SAAWn9C,KAAK88C,eAAetc,EAAK,YAC7CjV,EAAS6xB,OAASp9C,KAAK88C,eAAetc,EAAK,UAC3CjV,EAAS8xB,cAAgBr9C,KAAKs9C,gBAAgB9c,EAAK,oBACnDjV,EAASnH,OAASpkB,KAAKs9C,gBAAgB9c,EAAK,oBAC5CjV,EAASyB,YAAchtB,KAAKs9C,gBAAgB9c,EAAK,yBACjDjV,EAAS9B,KAAOzpB,KAAKs9C,gBAAgB9c,EAAK,kBAC1CjV,EAAS/O,SAAWxc,KAAKs9C,gBAAgB9c,EAAK,sBAC9CjV,EAASgyB,mBAAqBv9C,KAAKs9C,gBAAgB9c,EAAK,sBACxDjV,EAAS7B,OAAS1pB,KAAKs9C,gBAAgB9c,EAAK,oBAErCjV,EAUT8wB,cAAcmB,GACZ,IAAIle,EAAW,GAGXme,GAAW,EAAInyC,EAAMtF,KAAKw3C,EAAa,QAiB3C,OAhBYn3C,MAAMC,UAAUrF,MAAMC,KAAKu8C,GAEjC9+C,SAAQ,SAAU6D,GACtB,IAAIvC,EAAKuC,EAAKgE,aAAa,MACvB+P,EAAO/T,EAAKgE,aAAa,SAAW,GACpCI,EAAOpE,EAAKgE,aAAa,eAAiB,GAC1Ck3C,EAAUl7C,EAAKgE,aAAa,kBAAoB,GAChDmf,EAAanjB,EAAKgE,aAAa,eAAiB,GACpD84B,EAASr/B,GAAM,CACb,KAAQsW,EAER,KAAQ3P,EACR,QAAW82C,EACX,WAAc/3B,EAAW/lB,OAAS+lB,EAAWxY,MAAM,KAAO,OAGvDmyB,EAWTmd,WAAWkB,EAAUre,GACnB,IAAI5U,EAAQ,GACR+yB,GAAW,EAAInyC,EAAMtF,KAAK23C,EAAU,WAsBxC,OArBYt3C,MAAMC,UAAUrF,MAAMC,KAAKu8C,GAGjC9+C,SAAQ,SAAU6D,EAAM+G,GAC5B,IAAI4O,EAAQ3V,EAAKgE,aAAa,SAE1BN,EAAQ1D,EAAKgE,aAAa,eAAiB,GAC3Co3C,EAAY13C,EAAMtG,OAASsG,EAAMiH,MAAM,KAAO,GAG9C0wC,EAAU,CACZ,MAAS1lC,EACT,OAAU3V,EAAKgE,aAAa,WAAa,MACzC,WAAco3C,EAGd,MAASr0C,GAGXmhB,EAAM7oB,KAAKg8C,MAENnzB,EAUTiyB,qBAAqBmB,GACnB,IAAIC,EAAqBD,EAAWr9C,gBAAgB+F,aAAa,qBAEjE,IAAKu3C,EACH,MAAO,GAGT,IAAIluB,EAAaiuB,EAAW5sC,eAAe6sC,GAE3C,OAAKluB,GAIwB,eAAzBA,EAAWmuB,WAA0D,qCAA5BnuB,EAAWouB,cAC/CpuB,EAAWpuB,WAAW7B,OAAS,EAAIiwB,EAAWpuB,WAAW,GAAGy8C,UAAU5a,OAJtE,GAiBXgZ,YAAYH,GAIV,IAAIz6C,GAAO,EAAI4J,EAAMrF,KAAKk2C,EAAc,OAAQ,CAC9C,WAAc,QAEhB,QAAOz6C,GAAOA,EAAK8E,aAAa,QAYlC+1C,YAAYJ,EAAcC,GAExB,IAGI+B,EAHAz8C,GAAO,EAAI4J,EAAMrF,KAAKk2C,EAAc,OAAQ,CAC9C,aAAc,6BAehB,OATKz6C,IACHy8C,EAAQ/B,EAAU51C,aAAa,UAI7B9E,EAAOy6C,EAAar2C,cAAe,IAAGq4C,QAInCz8C,GAAOA,EAAK8E,aAAa,QAYlCg2C,cAAcsB,IACF,EAAIxyC,EAAM5F,IAAIo4C,EAAY,WACdt3C,aAAa,WADnC,IAII9E,GAAO,EAAI4J,EAAMrF,KAAK63C,EAAY,OAAQ,CAC5C,WAAc,gBAEhB,GAAIp8C,EAAM,OAAOA,EAAK8E,aAAa,QAEnC,IAAI43C,GAAY,EAAI9yC,EAAMrF,KAAK63C,EAAY,OAAQ,CACjD,KAAQ,UAGV,GAAIM,EAAW,CACb,IAAIC,EAAUD,EAAU53C,aAAa,WAEjC+4B,EAAQue,EAAW5sC,eAAemtC,GACtC,OAAO9e,EAAQA,EAAM/4B,aAAa,QAAU,GAE5C,OAAO,EAYXs2C,eAAetc,EAAK7P,GAClB,IACItyB,EADA4wB,EAAQuR,EAAI8d,uBAAuB,mCAAoC3tB,GAE3E,OAAK1B,GAA0B,IAAjBA,EAAMrvB,SACpBvB,EAAK4wB,EAAM,IAEJxtB,WAAW7B,OACTvB,EAAGoD,WAAW,GAAGy8C,UAJe,GAkB3CZ,gBAAgB9c,EAAKpkB,GACnB,IAAI/d,GAAK,EAAIiN,EAAMrF,KAAKu6B,EAAK,OAAQ,CACnC,SAAYpkB,IAGd,OAAI/d,GAAMA,EAAGoD,WAAW7B,OACfvB,EAAGoD,WAAW,GAAGy8C,UAGnB,GASTpyB,KAAK4U,GACH1gC,KAAKurB,SAAWmV,EAAKnV,SACrB,IAAIb,EAAQgW,EAAK6d,cAAgB7d,EAAKhW,MAkBtC,OAjBA1qB,KAAK0qB,MAAQA,EAAMpd,KAAI,CAAC9K,EAAM+G,KAC5B/G,EAAK+G,MAAQA,EACb/G,EAAK+1C,OAAS/1C,EAAK+1C,QAAU,MACtB/1C,KAETk+B,EAAKjB,UAAU9gC,SAAQ,CAAC6D,EAAM+G,KAC5BvJ,KAAKs/B,SAAS/1B,GAAS/G,EAEnBA,EAAKgf,KAAuB,UAAhBhf,EAAKgf,IAAI,KACvBxhB,KAAK8gC,UAAYt+B,EAAK+T,SAG1BvW,KAAKi4C,eAAiB,EACtBj4C,KAAKihC,IAAMP,EAAKO,IAAI3zB,KAAI,CAAC9K,EAAM+G,KAC7B/G,EAAKg8C,MAAQh8C,EAAKq6C,MACXr6C,KAEF,CACL,SAAYxC,KAAKurB,SACjB,MAASvrB,KAAK0qB,MACd,SAAY1qB,KAAKs/B,SACjB,QAAWt/B,KAAK+gC,QAChB,QAAW/gC,KAAKghC,QAChB,UAAahhC,KAAK8gC,UAClB,eAAkB9gC,KAAKi4C,eACvB,IAAOj4C,KAAKihC,KAIhB1a,UACEvmB,KAAKs/B,cAAW52B,EAChB1I,KAAK+gC,aAAUr4B,EACf1I,KAAKghC,aAAUt4B,EACf1I,KAAK8gC,eAAYp4B,EACjB1I,KAAKi4C,oBAAiBvvC,EACtB1I,KAAK0qB,WAAQhiB,EACb1I,KAAKurB,cAAW7iB,IAMpBnL,EAAQ8N,QAAUkH,G,6BCnXlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IA6WpB,IAAIoK,EAvWJ,MACEvI,YAAYw2B,GACVxgC,KAAKihC,IAAM,GACXjhC,KAAKy+C,UAAY,GACjBz+C,KAAK0+C,QAAU,GACf1+C,KAAK2+C,UAAY,GACjB3+C,KAAK4+C,gBAAkB,GACvB5+C,KAAKJ,OAAS,EAEV4gC,GACFxgC,KAAK8E,MAAM07B,GASf17B,MAAM07B,GACJ,IACI95B,EACAm4C,EAFA56C,EAAQu8B,EAAI7+B,SAIZsC,IACFyC,GAAO,EAAI4E,EAAM5F,IAAI86B,EAAK,QAC1Bqe,GAAM,EAAIvzC,EAAM5F,IAAI86B,EAAK,QAGtBv8B,EAEMyC,GACT1G,KAAKihC,IAAMjhC,KAAK8+C,SAASte,GACzBxgC,KAAK2+C,UAAY3+C,KAAK++C,eAAeve,IAC5Bqe,IACT7+C,KAAKihC,IAAMjhC,KAAKg/C,SAASxe,IALzBxgC,KAAKihC,IAAMjhC,KAAK8rB,KAAK0U,GAQvBxgC,KAAKJ,OAAS,EACdI,KAAKygC,OAAOzgC,KAAKihC,KASnBR,OAAOQ,GAGL,IAFA,IAAIz+B,EAEK7C,EAAI,EAAGA,EAAIshC,EAAIrhC,OAAQD,KAC9B6C,EAAOy+B,EAAIthC,IAEF4W,OACPvW,KAAKy+C,UAAUj8C,EAAK+T,MAAQ5W,GAG1B6C,EAAKvC,KACPD,KAAK0+C,QAAQl8C,EAAKvC,IAAMN,GAG1BK,KAAKJ,SAED4C,EAAKy8C,SAASr/C,QAChBI,KAAKygC,OAAOj+B,EAAKy8C,UAWvBpyB,IAAI9rB,GACF,IAAIwI,EAEJ,OAAKxI,GAIuB,IAAxBA,EAAOgD,QAAQ,KACjBwF,EAAQvJ,KAAK0+C,QAAQ39C,EAAOqgB,UAAU,IAC7BrgB,KAAUf,KAAKy+C,YACxBl1C,EAAQvJ,KAAKy+C,UAAU19C,IAGlBf,KAAKk/C,WAAWn+C,EAAQwI,EAAOvJ,KAAKihC,MATlCjhC,KAAKihC,IAoBhBie,WAAWn+C,EAAQwI,EAAO41C,GACxB,GAAwB,IAApBA,EAASv/C,OACX,OAGF,MAAM4C,EAAO28C,EAAS51C,GAEtB,IAAI/G,GAASzB,IAAWyB,EAAKvC,IAAMc,IAAWyB,EAAK+T,KAE5C,CACL,IAAIpY,EAEJ,IAAK,IAAIwB,EAAI,EAAGA,EAAIw/C,EAASv/C,SAC3BzB,EAAS6B,KAAKk/C,WAAWn+C,EAAQwI,EAAO41C,EAASx/C,GAAGs/C,WAEhD9gD,KAHiCwB,GAQvC,OAAOxB,EAZP,OAAOqE,EAuBX48C,SAASx4C,GACP,IAAI2C,EAEJ,OAAK3C,GAIL2C,EAAQvJ,KAAK4+C,gBAAgBh4C,GACtB5G,KAAK2+C,UAAUp1C,IAJbvJ,KAAK2+C,UAchBG,SAASO,GACP,IAAIC,GAAa,EAAIh0C,EAAM7E,qBAAqB44C,EAAS,MAAO,OAC5Dh4B,EAAO,GACX,IAAKi4B,EAAY,OAAOj4B,EACxB,IAAIk4B,GAAU,EAAIj0C,EAAMhK,gBAAgBg+C,EAAY,MAAM,GAC1D,OAAKC,EACLl4B,EAAOrnB,KAAKw/C,aAAaD,GADJl4B,EAYvBm4B,aAAaC,EAAax9C,GACxB,MAAM9D,EAAS,GACf,IAAKshD,EAAa,OAAOthD,EACzB,IAAKshD,EAAYn2C,SAAU,OAAOnL,EAElC,IAAK,IAAIwB,EAAI,EAAGA,EAAI8/C,EAAYn2C,SAAS1J,OAAQD,IAAK,CACpD,MAAM6C,EAAOxC,KAAK0/C,QAAQD,EAAYn2C,SAAS3J,GAAIsC,GAE/CO,GACFrE,EAAO0D,KAAKW,GAIhB,OAAOrE,EAUTuhD,QAAQl9C,EAAMP,GACZ,IAAIhC,EAAKuC,EAAKgE,aAAa,YAASkC,EAChC1J,GAAU,EAAIsM,EAAMhK,gBAAgBkB,EAAM,KAAK,GAEnD,IAAKxD,EACH,OAGF,IAAIsiB,EAAMtiB,EAAQwH,aAAa,SAAW,GAErCvG,IACHA,EAAKqhB,GAGP,IAAI2iB,EAAOjlC,EAAQkM,aAAe,GAC9B+zC,EAAW,GACXU,GAAS,EAAIr0C,EAAMhK,gBAAgBkB,EAAM,MAAM,GAMnD,OAJIm9C,IACFV,EAAWj/C,KAAKw/C,aAAaG,EAAQ1/C,IAGhC,CACL,GAAMA,EACN,KAAQqhB,EACR,MAAS2iB,EACT,SAAYgb,EACZ,OAAUh9C,GAWd88C,eAAeM,GACb,IAGI1/C,EAEA6C,EALA88C,GAAa,EAAIh0C,EAAM7E,qBAAqB44C,EAAS,MAAO,aAC5DF,EAAWG,GAAa,EAAIh0C,EAAMtF,KAAKs5C,EAAY,MAAQ,GAC3D1/C,EAASu/C,EAASv/C,OAElBynB,EAAO,GAEX,IAAK83B,GAAuB,IAAXv/C,EAAc,OAAOynB,EAEtC,IAAK1nB,EAAI,EAAGA,EAAIC,IAAUD,GACxB6C,EAAOxC,KAAK4/C,aAAaT,EAASx/C,OAGhC0nB,EAAKxlB,KAAKW,GACVxC,KAAK4+C,gBAAgBp8C,EAAKoE,MAAQjH,GAItC,OAAO0nB,EAUTu4B,aAAap9C,GACX,IAAIxD,GAAU,EAAIsM,EAAMhK,gBAAgBkB,EAAM,KAAK,GAEnD,IAAKxD,EACH,OAGF,IAAI4H,EAAO5H,EAAQ8H,eAAe,+BAAgC,cAAW4B,EAG7E,MAAO,CACL,KAHS1J,EAAQwH,aAAa,SAAW,GAIzC,MAHSxH,EAAQkM,aAAe,GAIhC,KAAQtE,GAWZo4C,SAASa,GACP,IAEIlgD,EAGA6C,EALAs9C,GAAY,EAAIx0C,EAAMtF,KAAK65C,EAAQ,YACnCjgD,EAASkgD,EAAUlgD,OAEnBqhC,EAAM,GACN5Z,EAAO,GAEX,IAAKy4B,GAAwB,IAAXlgD,EAAc,OAAOynB,EAEvC,IAAK1nB,EAAI,EAAGA,EAAIC,IAAUD,EAExBshC,GADAz+B,EAAOxC,KAAK+/C,QAAQD,EAAUngD,KACrBM,IAAMuC,EAEVA,EAAKP,OAGCg/B,EAAIz+B,EAAKP,QACXg9C,SAASp9C,KAAKW,GAHrB6kB,EAAKxlB,KAAKW,GAOd,OAAO6kB,EAUT04B,QAAQv9C,GACN,IAOIP,EAPAhC,EAAKuC,EAAKgE,aAAa,QAAS,EAEhC8a,GADU,EAAIhW,EAAM5F,IAAIlD,EAAM,WAChBgE,aAAa,OAC3Bw5C,GAAW,EAAI10C,EAAM5F,IAAIlD,EAAM,YAC/ByhC,EAAO+b,EAAS90C,YAAc80C,EAAS90C,YAAc,GAErDhJ,EAAaM,EAAKN,WAOtB,OAJIA,GAAuC,aAAxBA,EAAWX,UAA2E,aAAhDW,EAAWX,SAAS4L,MAAM,KAAKlM,OAAO,GAAG,KAChGgB,EAASC,EAAWsE,aAAa,OAG5B,CACL,GAAMvG,EACN,KAAQqhB,EACR,MAAS2iB,EACT,SAZa,GAab,OAAUhiC,GAUd6pB,KAAK4U,GACH,OAAOA,EAAKpzB,KAAI9K,IACdA,EAAKg8C,MAAQh8C,EAAKq6C,MAClBr6C,EAAKy8C,SAAWz8C,EAAK8G,SAAWtJ,KAAK8rB,KAAKtpB,EAAK8G,UAAY,GACpD9G,KAUX7D,QAAQ+Y,GACN,OAAO1X,KAAKihC,IAAItiC,QAAQ+Y,KAM5Bna,EAAQ8N,QAAUkH,G,6BCnXlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI8O,EAAgBhS,EAAQ,IAExBmD,EAAQnD,EAAQ,IAEhB2P,EAAO5B,EAAuB/N,EAAQ,KAEtC83C,EAAQ/pC,EAAuB/N,EAAQ,MAEvC8N,EAAQC,EAAuB/N,EAAQ,KAEvC6M,EAAekB,EAAuB/N,EAAQ,KAElD,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GA2SvF,IAAI6S,EAhSJ,MACEvI,YAAYs1B,EAAU7iB,GACpBzc,KAAK0c,SAAW,CACdpE,aAAcmE,GAAWA,EAAQnE,cAAgB,SACjDsnB,QAASnjB,GAAWA,EAAQmjB,QAC5BgB,SAAUnkB,GAAWA,EAAQmkB,SAC7B/U,QAASpP,GAAWA,EAAQoP,SAE9B7rB,KAAKy6C,QAAQnb,GAQfmb,QAAQnb,GACNt/B,KAAKs/B,SAAWA,EAChBt/B,KAAKy/B,UAAYpiC,OAAOmlB,KAAK8c,GAAUhyB,KAAI,SAAUoU,GACnD,OAAO4d,EAAS5d,MAElB1hB,KAAKkgD,gBAAkB,GACvBlgD,KAAK0G,KAAO,GACZ1G,KAAKmgD,OAAS,GACdngD,KAAKmc,IAAM,GACXnc,KAAKqY,KAAO,GACZrY,KAAKogD,QAAU,GACfpgD,KAAKmN,QACLnN,KAAKqgD,YAQPlzC,QAEEnN,KAAK0G,KAAO1G,KAAKy/B,UAAUl5B,QAAO,SAAU/D,GAC1C,GAAkB,0BAAdA,EAAKoE,MAAkD,cAAdpE,EAAKoE,KAChD,OAAO,KAIX5G,KAAKmgD,OAASngD,KAAKy/B,UAAUl5B,QAAO,SAAU/D,GAC5C,GAAkB,0BAAdA,EAAKoE,MAAkD,cAAdpE,EAAKoE,KAChD,OAAO,KAIX5G,KAAKmc,IAAMnc,KAAKy/B,UAAUl5B,QAAO,SAAU/D,GACzC,GAAkB,aAAdA,EAAKoE,KACP,OAAO,KAUby5C,YAEErgD,KAAKqY,KAAOrY,KAAKmgD,OAAO7yC,IAAI,SAAU9K,GACpC,OAAOA,EAAK+T,MACZ9I,KAAKzN,OAEPA,KAAKogD,QAAUpgD,KAAKmc,IAAI7O,KAAI,SAAU9K,GACpC,OAAOA,EAAK+T,QAUhBqrB,UAAU36B,GACR,IAAIq5C,EAAY,IAAIxoC,EAAKzM,QAAQpE,GAE7Bs5C,EAAWN,EAAM50C,QAAQsd,OAAO23B,EAAU9qC,UAE9C,OAAIxV,KAAK0c,SAASkjB,QACT5/B,KAAK0c,SAASkjB,QAAQgC,UAAU36B,EAAK,CAC1C,OAAyC,WAA/BjH,KAAK0c,SAASpE,eAGS,WAA/BtY,KAAK0c,SAASpE,aACTtY,KAAK0c,SAASmP,QAAQ5kB,EAAK,QAAQ6Z,MAAKnjB,IACtC,EAAI2N,EAAM5N,aAAaC,KAC7BmjB,MAAKnjB,IACC,EAAI2N,EAAMvM,iBAAiBpB,EAAM4iD,KAGnCvgD,KAAK0c,SAASmP,QAAQ5kB,EAAK,QAAQ6Z,MAAKnjB,IACtC,EAAI2N,EAAMhM,eAAe3B,EAAM4iD,KAW9CjoC,eACE,GAAmC,SAA/BtY,KAAK0c,SAASpE,aAChB,OAAO,IAAI1a,QAAQ,SAAUC,GAC3BA,EAAQmC,KAAKqY,OACb5K,KAAKzN,OAGT,IAAIsY,EAAetY,KAAKqY,KAAK/K,KAAIrG,IAC/B,IAAIoP,EAAWrW,KAAK0c,SAASkkB,SAAS35B,GACtC,OAAOjH,KAAK4hC,UAAUvrB,GAAU0pB,OAAM5Y,IACpClV,QAAQ8F,MAAMoP,GACP,WAGX,OAAOvpB,QAAQwpB,IAAI9O,GAAcwI,MAAKo/B,IACpClgD,KAAKkgD,gBAAkBA,EAAgB35C,QAAOU,GACtB,kBAARA,IAETi5C,KAYXxe,WAAW9B,EAASgB,GAClB,IAAI4f,EAAW,GAcf,OAbA5gB,EAAUA,GAAW5/B,KAAK0c,SAASkjB,QACnCgB,EAAWA,GAAY5gC,KAAK0c,SAASkkB,SACrC5gC,KAAKogD,QAAQzhD,QAAQ,SAAU4X,GAC7B,IAAIkqC,EAAczgD,KAAK0gD,cAAcnqC,EAAMqpB,EAASgB,GAAU9f,KAAK,SAAU6/B,GAE3E,IAAIC,EAAc5gD,KAAKqY,KAAKtU,QAAQwS,GAEhCqqC,GAAe,IACjB5gD,KAAKkgD,gBAAgBU,GAAeD,IAEtClzC,KAAKzN,OACPwgD,EAAS3+C,KAAK4+C,IACdhzC,KAAKzN,OACApC,QAAQwpB,IAAIo5B,GAUrBE,cAAcnqC,GAGZ,GAAIvB,EAAa3J,QAAQsK,WAAWY,GAClC,OAAO,IAAI3Y,SAAQ,SAAUC,GAC3BA,OAIJ,IAEIgjD,EAFAxqC,EAAWrW,KAAK0c,SAASkkB,SAASrqB,GAKpCsqC,EADE7gD,KAAK0c,SAASkjB,QACD5/B,KAAK0c,SAASkjB,QAAQkhB,QAAQzqC,GAE9BrW,KAAK0c,SAASmP,QAAQxV,EAAU,QAIjD,IAAI0qC,EAAU/gD,KAAKqY,KAAK/K,KAAI0zC,IAC1B,IAAIrgB,EAAW3gC,KAAK0c,SAASkkB,SAASogB,GAEtC,OADe,IAAI/qC,EAAM5K,QAAQgL,GAAUR,SAAS8qB,MAItD,OAAKkgB,EAOEA,EAAa//B,MAAKmjB,IAEvBA,GAAO,EAAI9pB,EAAc/B,YAAY6rB,EAAM8c,EAAS/gD,KAAKkgD,iBAEtB,WAA/BlgD,KAAK0c,SAASpE,cACP,EAAIhN,EAAMvM,iBAAiBklC,EAAM,aAEjC,EAAI34B,EAAMhM,eAAe2kC,EAAM,eAIzC9c,GAEM,IAAIvpB,SAAQ,SAAUC,GAC3BA,SAnBK,IAAID,SAAQ,SAAUC,GAC3BA,OA8BNojD,WAAW5qC,EAAUuqB,GAGnB,OAFAA,EAAWA,GAAY5gC,KAAK0c,SAASkkB,SAE9B5gC,KAAKqY,KAAK/K,IAAI,SAAUiJ,GAC7B,IAAIoqB,EAAWC,EAASrqB,GAExB,OADe,IAAIN,EAAM5K,QAAQgL,GAAUR,SAAS8qB,IAEpDlzB,KAAKzN,OAST6sB,IAAI/gB,GACF,IAAI80C,EAAc5gD,KAAKqY,KAAKtU,QAAQ+H,GAEpC,IAAqB,IAAjB80C,EAIJ,OAAI5gD,KAAKkgD,gBAAgBtgD,OAChB,IAAIhC,QAAQ,SAAUC,EAASC,GACpCD,EAAQmC,KAAKkgD,gBAAgBU,KAC7BnzC,KAAKzN,OAEAA,KAAK4hC,UAAU91B,GAY1BsM,WAAWpZ,EAASiI,GAClB,IAAI85C,EAQJ,OALEA,EADE95C,EACQjH,KAAKihD,WAAWh6C,GAEhBjH,KAAKqY,MAGV,EAAI8B,EAAc/B,YAAYpZ,EAAS+hD,EAAS/gD,KAAKkgD,iBAG9D35B,UACEvmB,KAAK0c,cAAWhU,EAChB1I,KAAKs/B,cAAW52B,EAChB1I,KAAKy/B,eAAY/2B,EACjB1I,KAAKkgD,qBAAkBx3C,EACvB1I,KAAK0G,UAAOgC,EACZ1I,KAAKmgD,YAASz3C,EACd1I,KAAKmc,SAAMzT,EACX1I,KAAKqY,UAAO3P,EACZ1I,KAAKogD,aAAU13C,IAMnBnL,EAAQ8N,QAAUkH,G,6BC7TlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAIgC3L,EAJ5Bua,GAI4Bva,EAJMyI,EAAQ,MAIOzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAFnF4L,EAAQnD,EAAQ,IA+QpB,IAAIoK,EAvQJ,MACEvI,YAAYw2B,GACVxgC,KAAKguB,MAAQ,GACbhuB,KAAK2sB,UAAY,GACjB3sB,KAAK8a,QAAU,IAAIb,EAAS5O,QAC5BrL,KAAKkhD,UAAY,EACjBlhD,KAAKmhD,SAAW,EAChBnhD,KAAKkuB,WAAa,EAClBluB,KAAKihC,SAAMv4B,EACX1I,KAAK6+C,SAAMn2C,EAEP83B,IACFxgC,KAAKwuB,SAAWxuB,KAAK8E,MAAM07B,IAGzBxgC,KAAKwuB,UAAYxuB,KAAKwuB,SAAS5uB,QACjCI,KAAKy6C,QAAQz6C,KAAKwuB,UAStB1pB,MAAM07B,GACJ,IAAI95B,GAAO,EAAI4E,EAAM5F,IAAI86B,EAAK,QAC1Bqe,GAAM,EAAIvzC,EAAM5F,IAAI86B,EAAK,OAE7B,OAAI95B,EACK1G,KAAK8+C,SAASte,GACZqe,EACF7+C,KAAKg/C,SAASxe,QADhB,EAYTse,SAASO,GACP,IAGI1/C,EAEA6C,EALA88C,GAAa,EAAIh0C,EAAM7E,qBAAqB44C,EAAS,MAAO,aAC5DF,EAAWG,GAAa,EAAIh0C,EAAMtF,KAAKs5C,EAAY,MAAQ,GAC3D1/C,EAASu/C,EAASv/C,OAElBynB,EAAO,GAEX,IAAK83B,GAAuB,IAAXv/C,EAAc,OAAOynB,EAEtC,IAAK1nB,EAAI,EAAGA,EAAIC,IAAUD,EACxB6C,EAAOxC,KAAKwC,KAAK28C,EAASx/C,IAC1B0nB,EAAKxlB,KAAKW,GAGZ,OAAO6kB,EAGT23B,SAASoC,GACP,IAEI5+C,EACAgsB,EACA6yB,EACAzhD,EALAynB,EAAO,GACP1nB,EAAI,EAMR,KADA6uB,GAAW,EAAIljB,EAAM5F,IAAI07C,EAAQ,aAClB,OAAO/5B,EAItB,GAFAznB,GADAyhD,GAAc,EAAI/1C,EAAMtF,KAAKwoB,EAAU,eAClB5uB,QAEhByhD,GAAsC,IAAvBA,EAAYzhD,OAC9B,OAAOynB,EAGT,IAAK1nB,EAAI,EAAGA,EAAIC,IAAUD,EACxB6C,EAAOxC,KAAK+/C,QAAQsB,EAAY1hD,IAChC0nB,EAAKxlB,KAAKW,GAGZ,OAAO6kB,EAGT04B,QAAQv9C,GACN,IAAIw9C,GAAW,EAAI10C,EAAM5F,IAAIlD,EAAM,YAE/B8+C,GADe,EAAIh2C,EAAM5F,IAAIs6C,EAAU,QACf90C,YAI5B,MAAO,CACL,MAJY,EAAII,EAAM5F,IAAIlD,EAAM,WACfgE,aAAa,OAI9B,KAHSvD,SAASq+C,EAAU,KAchC9+C,KAAKA,GACH,IAKI2K,EACAo0C,EANAviD,GAAU,EAAIsM,EAAM5F,IAAIlD,EAAM,KAC9B+T,EAAOvX,EAAQwH,aAAa,SAAW,GACvCy9B,EAAOjlC,EAAQkM,aAAe,GAC9B8a,EAAO/iB,SAASghC,GAMpB,OAAc,GALF1tB,EAAKxS,QAAQ,YAOvBw9C,GADAp0C,EAAQoJ,EAAKpJ,MAAM,MACA,GAEZ,CACL,IAFIA,EAAMvN,OAAS,GAAIuN,EAAM,GAG7B,KAAQoJ,EACR,WAAcgrC,EACd,KAAQv7B,IAGH,CACL,KAAQzP,EACR,KAAQyP,GAWdy0B,QAAQjsB,GACNA,EAAS7vB,SAAQ,SAAU6D,GACzBxC,KAAKguB,MAAMnsB,KAAKW,EAAKwjB,MAEjBxjB,EAAK6J,KACPrM,KAAK2sB,UAAU9qB,KAAKW,EAAK6J,OAE1BrM,MACHA,KAAKkhD,UAAYj+C,SAASjD,KAAKguB,MAAM,IACrChuB,KAAKmhD,SAAWl+C,SAASjD,KAAKguB,MAAMhuB,KAAKguB,MAAMpuB,OAAS,IACxDI,KAAKkuB,WAAaluB,KAAKmhD,SAAWnhD,KAAKkhD,UASzCzyB,YAAYpiB,GACV,IAAI4nB,GAAM,EAEV,GAA8B,IAA1Bj0B,KAAK2sB,UAAU/sB,OACjB,OAAQ,EAMV,IAAI2J,GAAQ,EAAI+B,EAAM/I,eAAe8J,EAAKrM,KAAK2sB,UAAW3sB,KAAK8a,QAAQpM,SAmBvE,OAjBc,GAAVnF,EACF0qB,EAAKj0B,KAAKguB,MAAMzkB,QASLb,KAFXurB,GAFA1qB,GAAQ,EAAI+B,EAAM9H,YAAY6I,EAAKrM,KAAK2sB,UAAW3sB,KAAK8a,QAAQpM,UAEnD,GAAK,EAAI1O,KAAKguB,MAAMzkB,EAAQ,GAAKvJ,KAAKguB,MAAM,MAKvDiG,GAAM,GAIHA,EASTutB,YAAYvtB,GACV,IAAI5nB,GAAO,EAEM,iBAAN4nB,IACTA,EAAKhxB,SAASgxB,IAKhB,IAAI1qB,EAAQvJ,KAAKguB,MAAMjqB,QAAQkwB,GAO/B,OALc,GAAV1qB,IACF8C,EAAMrM,KAAK2sB,UAAUpjB,IAIhB8C,EASTo1C,mBAAmBC,GAEjB,OADSphD,KAAKub,MAAM7b,KAAKkuB,WAAawzB,GAUxCC,mBAAmB1tB,GACjB,IAAInG,GAAcmG,EAAKj0B,KAAKkhD,WAAalhD,KAAKkuB,WAC9C,OAAO5tB,KAAKub,MAAmB,IAAbiS,GAAqB,IASzCwtB,kBAAkBjvC,GAChB,IAAI4nB,EAAKj0B,KAAKyuB,YAAYpiB,GAE1B,OADiBrM,KAAK2hD,mBAAmB1tB,GAQ3C1N,UACEvmB,KAAKguB,WAAQtlB,EACb1I,KAAK2sB,eAAYjkB,EACjB1I,KAAK8a,aAAUpS,EACf1I,KAAKwuB,cAAW9lB,EAChB1I,KAAKihC,SAAMv4B,EACX1I,KAAK6+C,SAAMn2C,IAMfnL,EAAQ8N,QAAUkH,G,6BCvRlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAEgC3L,EAF5BoY,GAE4BpY,EAFEyI,EAAQ,MAEWzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAkSvF,IAAI6S,EA3RJ,MACEvI,YAAY81B,GACV9/B,KAAK8/B,UAAYA,EACjB9/B,KAAKgpB,QAAU,CACb,QAAW,CACT,MAAS,GACT,IAAO,GACP,WAAc,KAGlBhpB,KAAK4hD,WAAa,GAClB5hD,KAAKm6C,SAAW,UAChBn6C,KAAK6hD,UAAY,GACjB7hD,KAAK8/B,UAAUrZ,MAAMznB,QAAQ0nB,SAAS1mB,KAAK8hD,OAAOr0C,KAAKzN,OACvDA,KAAK8/B,UAAUrZ,MAAMznB,QAAQ0nB,SAAS1mB,KAAK+hD,UAAUt0C,KAAKzN,OAW5D0mB,WACE,GAAyB,IAArB7mB,UAAUD,OAId,OAAyB,IAArBC,UAAUD,QAAwC,kBAAjBC,UAAU,GACtCG,KAAKgiD,eAAeniD,UAAU,IAGd,IAArBA,UAAUD,QAAwC,kBAAjBC,UAAU,GACtCG,KAAKqL,QAAQxL,UAAU,IAGP,IAArBA,UAAUD,QAAwC,kBAAjBC,UAAU,GACtCG,KAAKiiD,YAAYpiD,UAAU,GAAIA,UAAU,IAGzB,IAArBA,UAAUD,QAAwC,kBAAjBC,UAAU,GACtCG,KAAKkiD,cAAcriD,UAAU,GAAIA,UAAU,SADpD,EAYFwL,QAAQ82C,GACN,GAAKA,EAIL,MAAqB,kBAAVA,EACFniD,KAAKiiD,YAAY,UAAWE,GAGhB,kBAAVA,EACFniD,KAAKkiD,cAAc,UAAWC,QADvC,EAUFH,eAAel3B,GACb,IAAK,IAAIq3B,KAASr3B,EACZA,EAAOlZ,eAAeuwC,KACK,kBAAlBr3B,EAAOq3B,GAChBniD,KAAKiiD,YAAYE,EAAOr3B,EAAOq3B,IAE/BniD,KAAKkiD,cAAcC,EAAOr3B,EAAOq3B,KAYzCC,YAAYj8B,EAAMhK,GAChBnc,KAAKgpB,QAAQ7C,GAAQ,CACnB,WAAchK,IAGZnc,KAAK6hD,UAAU17B,IAAiB,WAARA,IAC1BnmB,KAAKoiC,OAAOjc,GAUhB87B,YAAY97B,EAAM6Z,GAChB,IAAI/4B,EAAM,IAAI6Q,EAAKzM,QAAQ20B,GAC3BhgC,KAAKgpB,QAAQ7C,GAAQ,CACnB,IAAOlf,EAAIU,aAGT3H,KAAK6hD,UAAU17B,IAAiB,WAARA,IAC1BnmB,KAAKoiC,OAAOjc,GAUhB+7B,cAAc/7B,EAAM3G,GAClBxf,KAAKgpB,QAAQ7C,GAAQ,CACnB,MAAS3G,IAGPxf,KAAK6hD,UAAU17B,IAAiB,WAARA,IAC1BnmB,KAAKoiC,OAAOjc,GAShBk8B,OAAOl8B,GACL,IAAIiH,EAAOptB,KAAKm6C,SAEhBn6C,KAAKm6C,SAAWh0B,EAChBnmB,KAAKoiC,OAAOjc,GACDnmB,KAAK8/B,UAAUrQ,cACjB9wB,SAAQK,IACfA,EAAQikB,YAAYmK,GACpBpuB,EAAQ8jB,SAASqD,MASrBic,OAAOjc,GACUnmB,KAAK8/B,UAAUrQ,cACrB9wB,SAAQK,IACfgB,KAAKgjB,IAAImD,EAAMnnB,MASnB8iD,OAAOrqC,GACL,IAEI0qC,EAFAxqC,EAAQ,GACRmT,EAAS9qB,KAAKgpB,QAGlB,IAAK,IAAI7C,KAAQ2E,GACXA,EAAOlZ,eAAeuU,IAAUA,IAASnmB,KAAKm6C,UAAqB,YAATh0B,MAC5Dg8B,EAAQr3B,EAAO3E,IAEL3G,OAASniB,OAAOmlB,KAAK2/B,EAAM3iC,OAAO5f,OAAS,GAAKuiD,EAAMl7C,MAAqC,IAA9B0Q,EAAM5T,QAAQo+C,EAAMl7C,OACzFjH,KAAKgjB,IAAImD,EAAM1O,GAGjBzX,KAAK6hD,UAAUhgD,KAAKskB,IAIH,WAAjBnmB,KAAKm6C,UACP1iC,EAASqL,SAAS9iB,KAAKm6C,UAU3Bn3B,IAAImD,EAAM1O,GACR,IAAI0qC,EAAQniD,KAAKgpB,QAAQ7C,GAEpBg8B,GAAU1qC,IAIX0qC,EAAMl7C,IACRwQ,EAAS4J,cAAc8gC,EAAMl7C,KACpBk7C,EAAMG,YACf7qC,EAASmK,iBAAiBugC,EAAMG,WAAYn8B,GAC5Cg8B,EAAMI,UAAW,GACRJ,EAAM3iC,QACf/H,EAASsK,mBAAmBogC,EAAM3iC,MAAO2G,GACzCg8B,EAAMI,UAAW,IAWrBC,SAASr8B,EAAM3oB,EAAO6e,GACpB,IAAI5E,EAAWzX,KAAK8/B,UAAUrQ,cAC9BzvB,KAAK4hD,WAAWz7B,GAAQ,CACtB3oB,MAAOA,EACP6e,UAAuB,IAAbA,GAEZ5E,EAAS9Y,SAAQK,IACfA,EAAQmd,IAAIgK,EAAMnmB,KAAK4hD,WAAWz7B,GAAM3oB,MAAOwC,KAAK4hD,WAAWz7B,GAAM9J,aAIzEomC,eAAet8B,GACb,IAAI1O,EAAWzX,KAAK8/B,UAAUrQ,qBACvBzvB,KAAK4hD,WAAWz7B,GACvB1O,EAAS9Y,SAAQK,IACfA,EAAQmd,IAAIgK,MAShB47B,UAAUtqC,GACR,IAAIsqC,EAAY/hD,KAAK4hD,WAErB,IAAK,IAAIz/B,KAAQ4/B,EACXA,EAAUnwC,eAAeuQ,IAC3B1K,EAAS0E,IAAIgG,EAAM4/B,EAAU5/B,GAAM3kB,MAAOukD,EAAU5/B,GAAM9F,UAUhEiwB,SAASjoB,GACPrkB,KAAKwiD,SAAS,YAAan+B,GAQ7Bq+B,KAAK7+C,GACH7D,KAAKwiD,SAAS,cAAe3+C,GAAG,GAGlC0iB,UACEvmB,KAAK8/B,eAAYp3B,EACjB1I,KAAKgpB,aAAUtgB,EACf1I,KAAK4hD,gBAAal5C,EAClB1I,KAAKm6C,cAAWzxC,EAChB1I,KAAK6hD,eAAYn5C,IAMrBnL,EAAQ8N,QAAUkH,G,6BC1SlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAI2O,EAAgB9D,EAAuB/N,EAAQ,KAE/C8R,EAAW/D,EAAuB/N,EAAQ,KAE1CiS,EAAajS,EAAQ,IAEzB,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAyNvF,MAAMijD,EACJ34C,aAAY,KACVpD,EADU,SAEVkmB,EAFU,KAGV5tB,EAHU,aAIV2b,EAJU,GAKVitB,EALU,UAMV/kB,EANU,OAOVglB,IAEA/nC,KAAK4G,KAAOA,EACZ5G,KAAK8sB,SAAWA,EAChB9sB,KAAKd,KAAOA,EACZc,KAAK6a,aAAeA,EACpB7a,KAAK2mC,UAAOj+B,EACZ1I,KAAK8nC,GAAKA,EACV9nC,KAAK+iB,UAAYA,EACjB/iB,KAAK+nC,OAASA,EAQhB3F,OAAOljC,GACLc,KAAKd,KAAOA,EAQd0jD,OAAOp5B,GACL,IASIrrB,GATA,SACF2uB,EADE,KAEF5tB,EAFE,KAGF0H,EAHE,KAIF+/B,EAJE,GAKFmB,EALE,UAMF/kB,EANE,OAOFglB,GACE/nC,KAaJ,MAVa,cAAT4G,EACFzI,EAASqrB,EAAKqe,UAAU/a,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GACrC,cAATnhC,EACTzI,EAASqrB,EAAK4e,UAAUtb,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GACrC,SAATnhC,IACTzI,EAASqrB,EAAKmd,KAAK7Z,EAAU5tB,EAAM4oC,IAGrC9nC,KAAK2mC,KAAOxoC,EACZ6B,KAAK0d,KAAKtD,EAAW5H,OAAOqC,WAAWC,OAAQ3W,GACxCA,EAQT0kD,OAAOr5B,GACL,IAIIrrB,GAJA,SACF2uB,EADE,KAEFlmB,GACE5G,KAeJ,OAZIwpB,IACW,cAAT5iB,EACFzI,EAASqrB,EAAKif,YAAY3b,GACR,cAATlmB,EACTzI,EAASqrB,EAAKof,YAAY9b,GACR,SAATlmB,IACTzI,EAASqrB,EAAKqf,OAAO/b,KAIzB9sB,KAAK2mC,UAAOj+B,EACZ1I,KAAK0d,KAAKtD,EAAW5H,OAAOqC,WAAWE,OAAQ5W,GACxCA,EAQT8lC,UAIF,EAAIjqB,EAAc3O,SAASs3C,EAAWr8C,WACtC,IAAIiM,EAlTJ,MACEvI,YAAY81B,GACV9/B,KAAK8/B,UAAYA,EACjB9/B,KAAK4kC,WAAa,GAClB5kC,KAAK6kC,WAAa,GAClB7kC,KAAK8kC,MAAQ,GACb9kC,KAAKipB,aAAe,GACpBjpB,KAAK8iD,2BAA6B,GAClC9iD,KAAK8/B,UAAUrZ,MAAM4D,OAAO3D,SAAS1mB,KAAK8hD,OAAOr0C,KAAKzN,OACtDA,KAAK8/B,UAAUrZ,MAAM2D,SAAS1D,SAAS1mB,KAAKsnB,MAAM7Z,KAAKzN,OAczDgjB,IAAIpc,EAAMkmB,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GACvC,IAAIrxB,EAAO+hC,UAAU3rB,EAAWlmB,GAE5BiU,EADM,IAAIZ,EAAS5O,QAAQyhB,GACRlhB,SACnBm3C,EAAa,IAAIJ,EAAW,CAC9B/7C,OACAkmB,WACA5tB,OACA2b,eACAitB,KACA/kB,YACAglB,WAgBF,OAdA/nC,KAAKipB,aAAavS,GAAQqsC,EAEtBloC,KAAgB7a,KAAK8iD,2BACvB9iD,KAAK8iD,2BAA2BjoC,GAAchZ,KAAK6U,GAEnD1W,KAAK8iD,2BAA2BjoC,GAAgB,CAACnE,GAGvC1W,KAAK8/B,UAAUpQ,QACrB/wB,SAAQ6qB,IACRu5B,EAAWloC,eAAiB2O,EAAKjgB,OACnCw5C,EAAWH,OAAOp5B,MAGfu5B,EAST7/B,OAAO4J,EAAUlmB,GACf,IAAI8P,EAAO+hC,UAAU3rB,EAAWlmB,GAEhC,GAAI8P,KAAQ1W,KAAKipB,aAAc,CAC7B,IAAI85B,EAAa/iD,KAAKipB,aAAavS,GAEnC,GAAI9P,GAAQm8C,EAAWn8C,OAASA,EAC9B,OAGU5G,KAAK8/B,UAAUpQ,QACrB/wB,SAAQ6qB,IACZxpB,KAAKgjD,oCAAoCD,EAAWloC,aAAcnE,GAE9DqsC,EAAWloC,eAAiB2O,EAAKjgB,OACnCw5C,EAAWF,OAAOr5B,aAGfxpB,KAAKipB,aAAavS,IAS7BssC,oCAAoCnoC,EAAcnE,GAChD1W,KAAK8iD,2BAA2BjoC,GAAgB7a,KAAKijD,eAAepoC,GAActU,QAAOgV,GAAKA,IAAM7E,IAQtGusC,eAAe15C,GACb,OAAOvJ,KAAK8iD,2BAA2Bv5C,GAYzCs+B,UAAU/a,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GACvC,OAAO/nC,KAAKgjB,IAAI,YAAa8J,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GAY9DK,UAAUtb,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GACvC,OAAO/nC,KAAKgjB,IAAI,YAAa8J,EAAU5tB,EAAM4oC,EAAI/kB,EAAWglB,GAU9DpB,KAAK7Z,EAAU5tB,EAAM4oC,GACnB,OAAO9nC,KAAKgjB,IAAI,OAAQ8J,EAAU5tB,EAAM4oC,GAO1C6Q,OACE,OAAO34C,KAAKipB,aAAatqB,QAAQuoB,MAAMlnB,KAAKipB,aAAcppB,WAS5DiiD,OAAOt4B,GACL,IAAI3O,EAAe2O,EAAKjgB,MAExB,GAAIsR,KAAgB7a,KAAK8iD,2BAA4B,CACjC9iD,KAAK8iD,2BAA2BjoC,GACtClc,SAAQ+X,IACD1W,KAAKipB,aAAavS,GACxBksC,OAAOp5B,OAWxBlC,MAAMkC,GACJ,IAAI3O,EAAe2O,EAAKjgB,MAExB,GAAIsR,KAAgB7a,KAAK8iD,2BAA4B,CACjC9iD,KAAK8iD,2BAA2BjoC,GACtClc,SAAQ+X,IACD1W,KAAKipB,aAAavS,GACxBmsC,OAAOr5B,OAUxBc,QAOA2I,UAmHF11B,EAAQ8N,QAAUkH,G,+BClSlB,SAAS2wC,IACP,IAAIC,EAAU3iD,SAASyW,cAAc,OACrCksC,EAAQ5tC,IAAM,MACd4tC,EAAQ7kD,MAAM4Q,SAAW,QACzBi0C,EAAQ7kD,MAAMG,MAAQ,MACtB0kD,EAAQ7kD,MAAMI,OAAS,MACvBykD,EAAQ7kD,MAAMyJ,IAAM,MACpBo7C,EAAQ7kD,MAAM0J,KAAO,MACrBm7C,EAAQ7kD,MAAM0d,SAAW,SACzB,IAAIonC,EAAW5iD,SAASyW,cAAc,OACtCmsC,EAAS9kD,MAAMG,MAAQ,MACvB,IAAI4kD,EAAQ7iD,SAASyW,cAAc,QACnCosC,EAAM/kD,MAAMG,MAAQ,MACpB4kD,EAAM/kD,MAAM4rB,QAAU,eACtB,IAAIo5B,EAAQ9iD,SAASyW,cAAc,QAMnC,OALAqsC,EAAMhlD,MAAMG,MAAQ,MACpB6kD,EAAMhlD,MAAM4rB,QAAU,eACtBk5B,EAAS7rC,YAAY8rC,GACrBD,EAAS7rC,YAAY+rC,GACrBH,EAAQ5rC,YAAY6rC,GACbD,EAvDT9lD,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ2lD,cAAgBA,EACxB3lD,EAAQ8N,QAIR,WACE,IAAIzE,EAAO,UACPu8C,EAAUD,IACd1iD,SAASG,KAAK4W,YAAY4rC,GAEtBA,EAAQtwB,WAAa,EACvBjsB,EAAO,UAEgB,qBAAZ28C,SAA2BA,QAAQj9C,UAAUk9C,gBACtDL,EAAQ75C,SAAS,GAAGA,SAAS,GAAGk6C,iBAE5BL,EAAQtwB,WAAa,IACvBjsB,EAAO,cAGTu8C,EAAQtwB,WAAa,EAEM,IAAvBswB,EAAQtwB,aACVjsB,EAAO,aAMb,OADApG,SAASG,KAAKmoC,YAAYqa,GACnBv8C,I,6BChCTvJ,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAIgC3L,EAJ5B4L,EAAQnD,EAAQ,IAEhBs7C,GAE4B/jD,EAFOyI,EAAQ,OAEMzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAkVvF,IAAI6S,EAhVJ,MACEvI,YAAY05C,GACV1jD,KAAK0c,SAAWgnC,GAAY,GAC5B1jD,KAAKC,GAAK,qBAAsB,EAAIqL,EAAMpL,QAC1CF,KAAK+Q,UAAY/Q,KAAKk3B,OAAOl3B,KAAK0c,UAE9B1c,KAAK0c,SAAS2T,SAChBrwB,KAAK2jD,QAAU3jD,KAAK4jD,KAAK5jD,KAAK+Q,YASlCmmB,OAAOza,GACL,IAAI/d,EAAS+d,EAAQ/d,OAEjBD,EAAQge,EAAQhe,MAEhBud,EAAWS,EAAQT,WAAY,EAC/B8I,EAAOrI,EAAQqI,MAAQ,WACvBE,EAAYvI,EAAQuI,WACxB,EAAI1Z,EAAMxK,QAAQd,KAAK0c,SAAUD,GAE7BA,EAAQ/d,SAAU,EAAI4M,EAAMxH,UAAU2Y,EAAQ/d,UAChDA,EAAS+d,EAAQ/d,OAAS,MAGxB+d,EAAQhe,QAAS,EAAI6M,EAAMxH,UAAU2Y,EAAQhe,SAC/CA,EAAQge,EAAQhe,MAAQ,MAI1B,IAAIsS,EAAYvQ,SAASyW,cAAc,OA8CvC,OA7CAlG,EAAU9Q,GAAKD,KAAKC,GACpB8Q,EAAUb,UAAU8S,IAAI,kBAGxBjS,EAAUzS,MAAMulD,YAAc,IAC9B9yC,EAAUzS,MAAMwlD,WAAa,IAC7B/yC,EAAUzS,MAAMylD,cAAgB,MAChChzC,EAAUzS,MAAM4Q,SAAW,WAEd,eAAT4V,IAEF/T,EAAUzS,MAAM4rB,QAAU,OAC1BnZ,EAAUzS,MAAM0lD,cAAgB,MAChCjzC,EAAUzS,MAAM2lD,SAAW,UAGzBxlD,IACFsS,EAAUzS,MAAMG,MAAQA,GAGtBC,IACFqS,EAAUzS,MAAMI,OAASA,GAGvBsd,IACe,WAAbA,GAAkC,aAAT8I,GAC3B/T,EAAUzS,MAAM,cAAgB0d,EAChCjL,EAAUzS,MAAM,cAAgB,UACV,WAAb0d,GAAkC,eAAT8I,GAClC/T,EAAUzS,MAAM,cAAgB,SAChCyS,EAAUzS,MAAM,cAAgB0d,GAEhCjL,EAAUzS,MAAV,SAA8B0d,GAI9BgJ,IACFjU,EAAUwE,IAAMyP,EAChBjU,EAAUzS,MAAV,UAA+B0mB,GAG7BA,GAAahlB,KAAK0c,SAAS4T,WAC7B9vB,SAASG,KAAKrC,MAAd,UAAmC0mB,GAG9BjU,EAGT6yC,KAAK7yC,GACH,IAAI4yC,EAAUnjD,SAASyW,cAAc,OAMrC,OALA0sC,EAAQrlD,MAAMgnC,WAAa,SAC3Bqe,EAAQrlD,MAAM0d,SAAW,SACzB2nC,EAAQrlD,MAAMG,MAAQ,IACtBklD,EAAQrlD,MAAMI,OAAS,IACvBilD,EAAQpsC,YAAYxG,GACb4yC,EAGTO,WAAWC,GACT,IAAIx9C,EAQJ,IANI,EAAI2E,EAAM5H,WAAWygD,GACvBx9C,EAAUw9C,EACmB,kBAAbA,IAChBx9C,EAAUnG,SAAS0Q,eAAeizC,KAG/Bx9C,EACH,MAAM,IAAId,MAAM,kBAGlB,OAAOc,EAGT4lB,SAAS7W,GACP,IACIjK,EADA9E,EAAU3G,KAAKkkD,WAAWxuC,GAG9B,GAAK/O,EAYL,OAPE8E,EADEzL,KAAK0c,SAAS2T,OACTrwB,KAAK2jD,QAEL3jD,KAAK+Q,UAGdpK,EAAQ4Q,YAAY9L,GACpBzL,KAAK2G,QAAUA,EACRA,EAGTmqB,eACE,OAAO9wB,KAAK+Q,UAGd6N,SAASvX,IAGF,EAAIiE,EAAMxH,UAAU9D,KAAK0c,SAASje,SAAW,EAAI6M,EAAMxH,UAAU9D,KAAK0c,SAAShe,UAClFsB,KAAKokD,YAAa,EAAIX,EAAUp4C,SAAShE,EAAM,IAC/C9I,OAAOugB,iBAAiB,SAAU9e,KAAKokD,YAAY,IAIvD/3B,oBAAoBhlB,GAClBrH,KAAKqkD,sBAAwBh9C,EAC7B9I,OAAOugB,iBAAiB,oBAAqB9e,KAAKqkD,uBAAuB,GAG3EhgC,KAAK5lB,EAAOC,GACV,IAAII,EAEJ,IAAIge,EAASre,GAASuB,KAAK0c,SAASje,MAEhCse,EAAUre,GAAUsB,KAAK0c,SAAShe,OAGxB,OAAVD,GACFK,EAASkB,KAAK2G,QAAQ/B,yBAEXnG,QACTA,EAAQ6B,KAAK0D,MAAMlF,EAAOL,OAC1BuB,KAAK+Q,UAAUzS,MAAMG,MAAQA,EAAQ,OAGnC,EAAI6M,EAAMxH,UAAUrF,GACtBuB,KAAK+Q,UAAUzS,MAAMG,MAAQA,EAAQ,KAErCuB,KAAK+Q,UAAUzS,MAAMG,MAAQA,EAIlB,OAAXC,GACFI,EAASA,GAAUkB,KAAK2G,QAAQ/B,yBAErBlG,SACTA,EAASI,EAAOJ,OAChBsB,KAAK+Q,UAAUzS,MAAMI,OAASA,EAAS,OAGrC,EAAI4M,EAAMxH,UAAUpF,GACtBsB,KAAK+Q,UAAUzS,MAAMI,OAASA,EAAS,KAEvCsB,KAAK+Q,UAAUzS,MAAMI,OAASA,GAI7B,EAAI4M,EAAMxH,UAAUrF,KACvBA,EAAQuB,KAAK+Q,UAAUuzC,cAGpB,EAAIh5C,EAAMxH,UAAUpF,KACvBA,EAASsB,KAAK+Q,UAAUrQ,cAG1BV,KAAKukD,gBAAkBhmD,OAAOC,iBAAiBwB,KAAK+Q,WACpD/Q,KAAKwkD,iBAAmB,CACtBx8C,KAAMnJ,WAAWmB,KAAKukD,gBAAgB,kBAAoB,EAC1Dt8C,MAAOpJ,WAAWmB,KAAKukD,gBAAgB,mBAAqB,EAC5Dx8C,IAAKlJ,WAAWmB,KAAKukD,gBAAgB,iBAAmB,EACxDr8C,OAAQrJ,WAAWmB,KAAKukD,gBAAgB,oBAAsB,GAGhE,IAAIE,GAAgB,EAAIn5C,EAAM1D,gBAE1B88C,EAAanmD,OAAOC,iBAAiBgC,SAASG,MAC9CgkD,EACI9lD,WAAW6lD,EAAW,kBAAoB,EAD9CC,EAEK9lD,WAAW6lD,EAAW,mBAAqB,EAFhDC,EAGG9lD,WAAW6lD,EAAW,iBAAmB,EAH5CC,EAIM9lD,WAAW6lD,EAAW,oBAAsB,EAWtD,OARK5nC,IACHre,EAAQgmD,EAAchmD,MAAQkmD,EAAmBA,IAG/C3kD,KAAK0c,SAAS4T,WAAavT,IAAYA,KACzCre,EAAS+lD,EAAc/lD,OAASimD,EAAkBA,GAG7C,CACLlmD,MAAOA,EAAQuB,KAAKwkD,iBAAiBx8C,KAAOhI,KAAKwkD,iBAAiBv8C,MAClEvJ,OAAQA,EAASsB,KAAKwkD,iBAAiBz8C,IAAM/H,KAAKwkD,iBAAiBt8C,QAIvEpJ,SACE,IAAI8lD,EAMJ,MAJsC,YAAlC5kD,KAAK+Q,UAAUzS,MAAM0d,WACvB4oC,EAAM5kD,KAAK+Q,WAAa/Q,KAAK+Q,UAAUnM,yBAGpCggD,GAAQA,EAAInmD,OAAUmmD,EAAIlmD,OAGtBkmD,GAFA,EAAIt5C,EAAM1D,gBAMrBi9C,WACE,IAAIvmD,EAAQkC,SAASyW,cAAc,SAInC,OAFA3Y,EAAMiZ,YAAY/W,SAASskD,eAAe,KAC1CtkD,SAASwW,KAAKO,YAAYjZ,GACnBA,EAAM2jB,MAGf8iC,cAAc3iC,EAAU4iC,GACtB,IAAIC,EAAQ,IAAMjlD,KAAKC,GAAK,IACxBuf,EAAQ,GAEPxf,KAAKiiB,QACRjiB,KAAKiiB,MAAQjiB,KAAK6kD,YAGpBG,EAAWrmD,SAAQ,SAAUi3B,GAC3B,IAAK,IAAIh3B,KAAQg3B,EACXA,EAAIhkB,eAAehT,KACrB4gB,GAAS5gB,EAAO,IAAMg3B,EAAIh3B,GAAQ,QAIxCoB,KAAKiiB,MAAMM,WAAW0iC,EAAQ7iC,EAAW,KAAO5C,EAAQ,IAAK,GAG/DsF,KAAKA,GACU,eAATA,GACF9kB,KAAK+Q,UAAUzS,MAAM4rB,QAAU,OAC/BlqB,KAAK+Q,UAAUzS,MAAM0lD,cAAgB,MACrChkD,KAAK+Q,UAAUzS,MAAM2lD,SAAW,UAEhCjkD,KAAK+Q,UAAUzS,MAAM4rB,QAAU,QAGjClqB,KAAK0c,SAASoI,KAAOA,EAYvBE,UAAUzP,GACJvV,KAAK+Q,YACP/Q,KAAK+Q,UAAUwE,IAAMA,EACrBvV,KAAK+Q,UAAUzS,MAAf,UAAoCiX,GAGlCvV,KAAK0c,SAAS4T,WAChB9vB,SAASG,KAAKrC,MAAd,UAAmCiX,GAGrCvV,KAAK0c,SAASnH,IAAMA,EAGtByG,SAASA,GACHhc,KAAK+Q,YACU,WAAbiL,GAAgD,aAAvBhc,KAAK0c,SAASoI,MACzC9kB,KAAK+Q,UAAUzS,MAAM,cAAgB0d,EACrChc,KAAK+Q,UAAUzS,MAAM,cAAgB,UACf,WAAb0d,GAAgD,eAAvBhc,KAAK0c,SAASoI,MAChD9kB,KAAK+Q,UAAUzS,MAAM,cAAgB,SACrC0B,KAAK+Q,UAAUzS,MAAM,cAAgB0d,GAErChc,KAAK+Q,UAAUzS,MAAf,SAAmC0d,GAIvChc,KAAK0c,SAASV,SAAWA,EAG3BuK,UAGMvmB,KAAK2G,UACH3G,KAAK0c,SAAS2T,OACTrwB,KAAK2jD,QAEL3jD,KAAK+Q,UAGV/Q,KAAK2G,QAAQwJ,SAASnQ,KAAK+Q,YAC7B/Q,KAAK2G,QAAQmiC,YAAY9oC,KAAK+Q,WAGhCxS,OAAOglB,oBAAoB,SAAUvjB,KAAKokD,YAC1C7lD,OAAOglB,oBAAoB,oBAAqBvjB,KAAKqkD,0BAO3D9mD,EAAQ8N,QAAUkH,G,uCC5VlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EA+KlB,IAAIkH,EA7KJ,MACEvI,YAAY+G,GACV/Q,KAAK+Q,UAAYA,EACjB/Q,KAAKgwB,OAAS,GACdhwB,KAAKJ,OAAS,EACdI,KAAKqwB,QAAS,EAGhBjJ,MACE,OAAOpnB,KAAKgwB,OAGdnB,QACE,OAAO7uB,KAAKgwB,OAAO,GAGrBrB,OACE,OAAO3uB,KAAKgwB,OAAOhwB,KAAKgwB,OAAOpwB,OAAS,GAG1CmE,QAAQylB,GACN,OAAOxpB,KAAKgwB,OAAOjsB,QAAQylB,GAG7BvoB,QACE,OAAOjB,KAAKgwB,OAAO/uB,MAAMimB,MAAMlnB,KAAKgwB,OAAQnwB,WAG9CgtB,IAAIltB,GACF,OAAOK,KAAKgwB,OAAOrwB,GAGrByyB,OAAO5I,GAQL,OAPAxpB,KAAKgwB,OAAOnuB,KAAK2nB,GAEbxpB,KAAK+Q,WACP/Q,KAAK+Q,UAAUwG,YAAYiS,EAAK7iB,SAGlC3G,KAAKJ,SACE4pB,EAGTgJ,QAAQhJ,GAQN,OAPAxpB,KAAKgwB,OAAOjmB,QAAQyf,GAEhBxpB,KAAK+Q,WACP/Q,KAAK+Q,UAAUmG,aAAasS,EAAK7iB,QAAS3G,KAAK+Q,UAAUnH,YAG3D5J,KAAKJ,SACE4pB,EAGTlmB,OAAOkmB,EAAMjgB,GAYX,OAXAvJ,KAAKgwB,OAAOvsB,OAAO8F,EAAO,EAAGigB,GAEzBxpB,KAAK+Q,YACHxH,EAAQvJ,KAAK+Q,UAAUzH,SAAS1J,OAClCI,KAAK+Q,UAAUmG,aAAasS,EAAK7iB,QAAS3G,KAAK+Q,UAAUzH,SAASC,IAElEvJ,KAAK+Q,UAAUwG,YAAYiS,EAAK7iB,UAIpC3G,KAAKJ,SACE4pB,EAGTtG,OAAOsG,GACL,IAAIjgB,EAAQvJ,KAAKgwB,OAAOjsB,QAAQylB,GAE5BjgB,GAAS,GACXvJ,KAAKgwB,OAAOvsB,OAAO8F,EAAO,GAG5BvJ,KAAKumB,QAAQiD,GACbxpB,KAAKJ,SAGP2mB,QAAQiD,GACFA,EAAKkD,WACPlD,EAAKjD,UAGHvmB,KAAK+Q,WACP/Q,KAAK+Q,UAAU+3B,YAAYtf,EAAK7iB,SAGlC6iB,EAAO,KAIT7qB,UACE,OAAOqB,KAAKgwB,OAAOrxB,QAAQuoB,MAAMlnB,KAAKgwB,OAAQnwB,WAGhDynB,QAEE,IAAIkC,EACA3Z,EAAM7P,KAAKJ,OACf,GAAKI,KAAKJ,OAAV,CAEA,IAAK,IAAID,EAAI,EAAGA,EAAIkQ,EAAKlQ,IACvB6pB,EAAOxpB,KAAKgwB,OAAOrwB,GACnBK,KAAKumB,QAAQiD,GAGfxpB,KAAKgwB,OAAS,GACdhwB,KAAKJ,OAAS,GAGhBkyB,KAAK/a,GAIH,IAHA,IAAIyS,EACA3Z,EAAM7P,KAAKJ,OAEND,EAAI,EAAGA,EAAIkQ,EAAKlQ,IAGvB,IAFA6pB,EAAOxpB,KAAKgwB,OAAOrwB,IAEV+sB,WAAalD,EAAKzS,QAAQxN,OAASwN,EAAQxN,MAClD,OAAOigB,EAKbkD,YAKE,IAJA,IACIlD,EADAkD,EAAY,GAEZ7c,EAAM7P,KAAKJ,OAEND,EAAI,EAAGA,EAAIkQ,EAAKlQ,KACvB6pB,EAAOxpB,KAAKgwB,OAAOrwB,IAEV+sB,WACPA,EAAU7qB,KAAK2nB,GAInB,OAAOkD,EAGTpC,OAIE,IAHA,IAAId,EACA3Z,EAAM7P,KAAKJ,OAEND,EAAI,EAAGA,EAAIkQ,EAAKlQ,KACvB6pB,EAAOxpB,KAAKgwB,OAAOrwB,IAEV+sB,WACPlD,EAAKc,OAITtqB,KAAKqwB,QAAS,EAGhB4C,OAIE,IAHA,IAAIzJ,EACA3Z,EAAM7P,KAAKJ,OAEND,EAAI,EAAGA,EAAIkQ,EAAKlQ,KACvB6pB,EAAOxpB,KAAKgwB,OAAOrwB,IAEV+sB,WACPlD,EAAKyJ,OAITjzB,KAAKqwB,QAAS,IAMlB9yB,EAAQ8N,QAAUkH,G,6BCnLlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAMgC3L,EAN5B4L,EAAQnD,EAAQ,IAEhBiS,EAAajS,EAAQ,IAErB6R,GAE4Bta,EAFWyI,EAAQ,MAEEzI,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAGvF,MAAMwlD,EAAQ5kD,KAAK6kD,GAAK,EAClBC,EAAmB,CACvBC,YAAa,SAAUrkC,GACrB,OAAO1gB,KAAKglD,IAAItkC,EAAMkkC,IAExBK,cAAe,SAAUvkC,GACvB,OAAQ,IAAO1gB,KAAKklD,IAAIllD,KAAK6kD,GAAKnkC,GAAO,IAE3CykC,eAAgB,SAAUzkC,GACxB,OAAKA,GAAO,IAAO,EACV,GAAM1gB,KAAKolD,IAAI1kC,EAAK,GAGtB,IAAO1gB,KAAKolD,IAAI1kC,EAAM,EAAG,GAAK,IAEvC2kC,YAAa,SAAU3kC,GACrB,OAAO1gB,KAAKolD,IAAI1kC,EAAK,KAIzB,MAAM4kC,EACJ57C,YAAYuf,EAAS9M,GACnBzc,KAAK0c,UAAW,EAAIpR,EAAMxK,QAAQ,CAChC+kD,SAAU,GACVC,YAAa,GACbC,YAAa,GACbC,OAAQZ,EAAgB,aACvB3oC,GAAW,IACdzc,KAAKsrC,cAAgBtrC,KAAKsrC,gBAEtBtrC,KAAKsrC,eACPtrC,KAAKimD,MAAM18B,GAIf08B,MAAM18B,GACJvpB,KAAKupB,QAAUA,EACfvpB,KAAKokB,OAASpkB,KAAKupB,QAAQnF,OAC3BpkB,KAAKswB,SAAWtwB,KAAKupB,QAAQ7M,SAAS4T,SAElCtwB,KAAKswB,UACPtwB,KAAK2G,QAAU3G,KAAKupB,QAAQsH,MAAMlqB,QAClC3G,KAAKixB,SAAW1yB,OAChByB,KAAKkmD,kBAELlmD,KAAK2G,QAAU3G,KAAKupB,QAAQsH,MAAM9f,UAClC/Q,KAAKixB,SAAWjxB,KAAK2G,QACrB3G,KAAK2G,QAAQrI,MAAb,wBAAgD,SAKlD0B,KAAKupB,QAAQ7M,SAAS1P,OAAShN,KAAKokB,OAAO3lB,MAC3CuB,KAAKupB,QAAQ7M,SAAS2sB,qBAAgD,EAAzBrpC,KAAK0c,SAASmpC,SAC3D7lD,KAAKmmD,WAA4C,aAA/BnmD,KAAKupB,QAAQ7M,SAASoI,KAEnC9kB,KAAKupB,QAAQ2I,cAAelyB,KAAKmmD,aAItCnmD,KAAKomD,eAAgB,EACrBpmD,KAAKqmD,gBAAiB,EACtBrmD,KAAKsmD,UAAW,EAChBtmD,KAAK6yB,WACL7yB,KAAK8yB,UACL9yB,KAAKumD,iBAAc79C,EACnB1I,KAAKwmD,iBAAc99C,EACnB1I,KAAKymD,eAAY/9C,EACjB1I,KAAK0mD,eAAYh+C,EACjB1I,KAAK2mD,eAAYj+C,EACjB1I,KAAK4mD,aAAUl+C,EACf1I,KAAK4lC,gBAGP0F,gBACE,SAAI,iBAAkB/sC,QAAUA,OAAOsoD,eAAiBrmD,oBAAoBqmD,eAO9EX,gBACElmD,KAAK2G,QAAQrI,MAAM0d,SAAW,SAGhC8qC,eACE9mD,KAAK2G,QAAQrI,MAAM0d,SAAW,GAGhC4pB,eACE5lC,KAAK+mD,UAAY/mD,KAAK4e,SAASnR,KAAKzN,MACpCzB,OAAOugB,iBAAiB,SAAU9e,KAAK+mD,WACvC/mD,KAAKkxB,UAAYlxB,KAAKmxB,SAAS1jB,KAAKzN,MACpCA,KAAKixB,SAASnS,iBAAiB,SAAU9e,KAAKkxB,WAC9ClxB,KAAKgnD,cAAgBhnD,KAAKinD,aAAax5C,KAAKzN,MAC5CA,KAAKixB,SAASnS,iBAAiB,aAAc9e,KAAKgnD,cAAe,CAC/D1jC,SAAS,IAEXtjB,KAAKisB,GAAG,aAAcjsB,KAAKgnD,eAC3BhnD,KAAKknD,aAAelnD,KAAKmnD,YAAY15C,KAAKzN,MAC1CA,KAAKixB,SAASnS,iBAAiB,YAAa9e,KAAKknD,aAAc,CAC7D5jC,SAAS,IAEXtjB,KAAKisB,GAAG,YAAajsB,KAAKknD,cAC1BlnD,KAAKonD,YAAcpnD,KAAKqnD,WAAW55C,KAAKzN,MACxCA,KAAKixB,SAASnS,iBAAiB,WAAY9e,KAAKonD,YAAa,CAC3D9jC,SAAS,IAEXtjB,KAAKisB,GAAG,WAAYjsB,KAAKonD,aACzBpnD,KAAKsnD,gBAAkBtnD,KAAKksB,eAAeze,KAAKzN,MAChDA,KAAKupB,QAAQ0C,GAAG7R,EAAW5H,OAAOa,SAASG,MAAOxT,KAAKsnD,iBAGzDlpC,kBACE7f,OAAOglB,oBAAoB,SAAUvjB,KAAK+mD,WAC1C/mD,KAAK+mD,eAAYr+C,EACjB1I,KAAKixB,SAAS1N,oBAAoB,SAAUvjB,KAAKkxB,WACjDlxB,KAAKkxB,eAAYxoB,EACjB1I,KAAKixB,SAAS1N,oBAAoB,aAAcvjB,KAAKgnD,cAAe,CAClE1jC,SAAS,IAEXtjB,KAAKunD,IAAI,aAAcvnD,KAAKgnD,eAC5BhnD,KAAKgnD,mBAAgBt+C,EACrB1I,KAAKixB,SAAS1N,oBAAoB,YAAavjB,KAAKknD,aAAc,CAChE5jC,SAAS,IAEXtjB,KAAKunD,IAAI,YAAavnD,KAAKknD,cAC3BlnD,KAAKknD,kBAAex+C,EACpB1I,KAAKixB,SAAS1N,oBAAoB,WAAYvjB,KAAKonD,YAAa,CAC9D9jC,SAAS,IAEXtjB,KAAKunD,IAAI,WAAYvnD,KAAKonD,aAC1BpnD,KAAKonD,iBAAc1+C,EACnB1I,KAAKupB,QAAQg+B,IAAIntC,EAAW5H,OAAOa,SAASG,MAAOxT,KAAKsnD,iBACxDtnD,KAAKsnD,qBAAkB5+C,EAGzBwjB,eAAe1C,GACb,IAAI/R,EAAW+R,EAAK/R,SACpB,CAAC,aAAc,YAAa,YAAY9Y,SAAQwT,IAC9CsF,EAASwU,GAAG9Z,GAAG4c,GAAM/uB,KAAKgvB,iBAAiBD,EAAItX,QAInDuX,iBAAiB7c,EAAGsF,GAClBzX,KAAK0d,KAAKvL,EAAEvL,KAAMuL,EAAGsF,GAGvB0Z,SAAShf,GACPnS,KAAK6yB,WAAa7yB,KAAKswB,SAAW/xB,OAAOi1B,QAAUxzB,KAAKixB,SAAS4B,WACjE7yB,KAAK8yB,UAAY9yB,KAAKswB,SAAW/xB,OAAOg1B,QAAUvzB,KAAKixB,SAAS6B,UAGlElU,SAASzM,GACPnS,KAAKqmD,gBAAiB,EAGxBY,aAAa90C,GACX,IAAI,QACFq1C,EADE,QAEFC,GACEt1C,EAAEu1C,QAAQ,GAEV1nD,KAAKswB,UACPtwB,KAAK8mD,eAGP9mD,KAAKomD,eAAgB,EAEhBpmD,KAAKumD,cACRvmD,KAAKumD,YAAciB,EACnBxnD,KAAKwmD,YAAciB,EACnBznD,KAAKymD,UAAYzmD,KAAK2nD,OAGxB3nD,KAAK0mD,UAAYc,EACjBxnD,KAAK2mD,UAAYc,EACjBznD,KAAK4mD,QAAU5mD,KAAK2nD,MAGtBR,YAAYh1C,GACV,IAAI,QACFq1C,EADE,QAEFC,GACEt1C,EAAEu1C,QAAQ,GACVE,EAAStnD,KAAK6zB,IAAIszB,EAAUznD,KAAK2mD,WACrC3mD,KAAKomD,eAAgB,GAEhBpmD,KAAKswB,UAAYs3B,EAAS,KAC7B5nD,KAAK2G,QAAQksB,YAAc20B,EAAUxnD,KAAK0mD,WAG5C1mD,KAAK0mD,UAAYc,EACjBxnD,KAAK2mD,UAAYc,EACjBznD,KAAK4mD,QAAU5mD,KAAK2nD,MAGtBN,WAAWl1C,GACLnS,KAAKswB,UACPtwB,KAAKkmD,gBAGPlmD,KAAKomD,eAAgB,EACrB,IAAIyB,EAAU7nD,KAAK8nD,YAEH,IAAZD,EACF7nD,KAAK+pB,KAAK89B,GAEV7nD,KAAK+pB,OAGP/pB,KAAKumD,iBAAc79C,EACnB1I,KAAKwmD,iBAAc99C,EACnB1I,KAAKymD,eAAY/9C,EACjB1I,KAAK0mD,eAAYh+C,EACjB1I,KAAK2mD,eAAYj+C,EACjB1I,KAAK4mD,aAAUl+C,EAGjBo/C,YACE,IAAIC,EAAY/nD,KAAKokB,OAAOiP,UAAYrzB,KAAKokB,OAAOyN,QAChDm2B,EAAWhoD,KAAK0mD,UAAY1mD,KAAKumD,YACjClwC,EAAW/V,KAAK6zB,IAAI6zB,GAEpBC,EAAWD,GADJhoD,KAAK4mD,QAAU5mD,KAAKymD,WAE3BX,EAAc9lD,KAAK0c,SAASopC,YAEhC,OAAIzvC,GAAYrW,KAAK0c,SAASqpC,aAAe1vC,GAAY0xC,EAChD,EAGLE,EAAWnC,GAEL,EACCmC,GAAYnC,EAEd,OAFF,EAMTva,YAGE,OAFWvrC,KAAK6yB,YACA7yB,KAAKokB,OAAOiP,UAAYrzB,KAAKokB,OAAOyN,WACxB,EAG9B9H,KAAKm+B,EAAU,GACb,IAAIlgD,EAAOhI,KAAK6yB,WACZk1B,EAAY/nD,KAAKokB,OAAOiP,UAAYrzB,KAAKokB,OAAOyN,QAChDs2B,EAAS7nD,KAAKub,MAAM7T,EAAO+/C,GAAaA,EAM5C,OAJIG,IACFC,GAAUD,EAAUH,GAGf/nD,KAAKooD,eAAeD,GAG7BC,eAAeC,GACb,MAAMxvC,EAAW,IAAIvN,EAAMvL,MACrB+C,EAAQ9C,KAAK6yB,WACb4zB,EAAYzmD,KAAK2nD,MACjB9B,EAAW7lD,KAAK0c,SAASmpC,SACzBG,EAAShmD,KAAK0c,SAASspC,OA0B7B,OAzBAhmD,KAAKsmD,UAAW,EAEhB,SAAS5+B,IACP,MAAMigC,EAAM3nD,KAAK2nD,MACXW,EAAOhoD,KAAKotB,IAAI,GAAIi6B,EAAMlB,GAAaZ,GAG7C,GAFqBG,EAAOsC,GAExBtoD,KAAKomD,eAAiBpmD,KAAKqmD,eAI7B,OAHArmD,KAAKqmD,gBAAiB,EACtBrmD,KAAKsmD,UAAW,OAChBztC,EAAShb,UAIPyqD,EAAO,GACT/pD,OAAOwI,sBAAsB2gB,EAAKja,KAAKzN,OACvCA,KAAKwd,SAAS1a,GAASulD,EAAcvlD,GAASwlD,EAAM,KAEpDtoD,KAAKwd,SAAS6qC,EAAa,GAC3BroD,KAAKsmD,UAAW,EAChBztC,EAAShb,YAIRqD,KAAKlB,MACH6Y,EAAS1Y,QAGlBqd,SAASxV,EAAO,EAAGD,EAAM,GACnB/H,KAAKswB,SACP/xB,OAAOgqD,OAAOvgD,EAAMD,IAEpB/H,KAAKixB,SAAS4B,WAAa7qB,EAC3BhI,KAAKixB,SAAS6B,UAAY/qB,GAI9B4/C,MACE,MAAO,QAASppD,OAAOiqD,YAAcA,YAAYb,OAAQ,IAAI/+C,MAAOC,UAGtE0d,UACOvmB,KAAKixB,WAINjxB,KAAKswB,UACPtwB,KAAK8mD,eAGP9mD,KAAKoe,kBACLpe,KAAKixB,cAAWvoB,KAKpB,EAAIsR,EAAc3O,SAASu6C,EAAKt/C,WAChC,IAAIiM,EAAWqzC,EACfroD,EAAQ8N,QAAUkH,G,6BCjVlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IAEhB05B,EAAW3rB,EAAuB/N,EAAQ,KAE1C83C,EAAQ/pC,EAAuB/N,EAAQ,MAEvC8N,EAAQC,EAAuB/N,EAAQ,KAEvCsgD,EAASvyC,EAAuB/N,EAAQ,MAE5C,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAgQvF,IAAI6S,EA1PJ,MACEvI,cACEhK,KAAK0oD,SAAMhgD,EACX1I,KAAK2oD,SAAW,GAChB3oD,KAAK4oD,oBASPA,oBACE,IACE5oD,KAAK0oD,IAAM,IAAID,EAAOp9C,QACtB,MAAO8G,GACP,MAAM,IAAItM,MAAM,yBAWpB+T,KAAKomB,EAAO6oB,GACV,OAAO7oD,KAAK0oD,IAAII,UAAU9oB,EAAO,CAC/B,OAAU6oB,IAWdE,QAAQC,EAAQH,GACd,OAAO,EAAIhnB,EAASx2B,SAAS29C,EAAQ,UAAUloC,KAAK,SAAU5hB,GAC5D,OAAOc,KAAK0oD,IAAII,UAAU5pD,EAAM,CAC9B,OAAU2pD,KAEZp7C,KAAKzN,OAUT6rB,QAAQ5kB,EAAKL,GACX,IACI2S,EADAV,EAAW,IAAIvN,EAAMvL,MAErB+L,EAAO,IAAImK,EAAM5K,QAAQpE,GAwB7B,OAtBKL,IACHA,EAAOkF,EAAK2J,YAIZ8D,EADU,QAAR3S,EACS5G,KAAKipD,QAAQhiD,GAEbjH,KAAK8gD,QAAQ75C,IAIxBsS,EAASuH,KAAK,SAAU9X,GACtB,IAAI7K,EAAS6B,KAAKkpD,eAAelgD,EAAGpC,GACpCiS,EAAShb,QAAQM,IACjBsP,KAAKzN,OAEP6Y,EAAS/a,OAAO,CACd0b,QAAS,+BAAiCvS,EAC1CwS,OAAO,IAAI5T,OAAQ4T,QAIhBZ,EAAS1Y,QAWlB+oD,eAAe3vC,EAAU3S,GAevB,MAZY,QAARA,EACE8S,KAAK5U,MAAMyU,IACN,EAAIjO,EAAMrH,OAAO2C,IACtB,EAAI0E,EAAMxG,OAAOyU,EAAU,YACd,SAAR3S,GACL,EAAI0E,EAAMxG,OAAOyU,EAAU,yBACd,QAAR3S,GAA0B,OAARA,GACvB,EAAI0E,EAAMxG,OAAOyU,EAAU,aAE3BA,EAaR0vC,QAAQhiD,EAAKs5C,GACX,IAAI4I,EAAe5qD,OAAO6qD,mBAAmBniD,EAAIoiD,OAAO,IAEpDC,EAAQtpD,KAAK0oD,IAAIa,KAAKJ,GAE1B,GAAIG,EAEF,OADA/I,EAAWA,GAAYN,EAAM50C,QAAQsd,OAAO2gC,EAAMnjC,MAC3CmjC,EAAMzmC,MAAM,cAAc/B,MAAK,SAAU0oC,GAC9C,OAAO,IAAIhgD,KAAK,CAACggD,GAAa,CAC5B5iD,KAAM25C,OAadO,QAAQ75C,EAAK+3B,GACX,IAAImqB,EAAe5qD,OAAO6qD,mBAAmBniD,EAAIoiD,OAAO,IAEpDC,EAAQtpD,KAAK0oD,IAAIa,KAAKJ,GAE1B,GAAIG,EACF,OAAOA,EAAMzmC,MAAM,UAAU/B,MAAK,SAAUmjB,GAC1C,OAAOA,KAYbwlB,UAAUxiD,EAAKs5C,GACb,IAAI4I,EAAe5qD,OAAO6qD,mBAAmBniD,EAAIoiD,OAAO,IAEpDC,EAAQtpD,KAAK0oD,IAAIa,KAAKJ,GAE1B,GAAIG,EAEF,OADA/I,EAAWA,GAAYN,EAAM50C,QAAQsd,OAAO2gC,EAAMnjC,MAC3CmjC,EAAMzmC,MAAM,UAAU/B,MAAK,SAAU5hB,GAC1C,MAAO,QAAUqhD,EAAW,WAAarhD,KAY/C0iC,UAAU36B,EAAKwV,GACb,IAIIitC,EACAnwC,EALAV,EAAW,IAAIvN,EAAMvL,MAErBR,EAAOhB,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,OAIhDkhD,EAAYltC,GAAWA,EAAQmtC,OAEnC,OAAI3iD,KAAOjH,KAAK2oD,UACd9vC,EAAShb,QAAQmC,KAAK2oD,SAAS1hD,IACxB4R,EAAS1Y,UAGdwpD,GACFpwC,EAAWvZ,KAAKypD,UAAUxiD,KAGxBsS,EAASuH,KAAK,SAAU4oC,GACtB1pD,KAAK2oD,SAAS1hD,GAAOyiD,EACrB7wC,EAAShb,QAAQ6rD,IACjBj8C,KAAKzN,QAGTuZ,EAAWvZ,KAAKipD,QAAQhiD,KAGtBsS,EAASuH,KAAK,SAAUnjB,GACtB+rD,EAAUnqD,EAAKC,gBAAgB7B,GAC/BqC,KAAK2oD,SAAS1hD,GAAOyiD,EACrB7wC,EAAShb,QAAQ6rD,IACjBj8C,KAAKzN,OAINuZ,GACHV,EAAS/a,OAAO,CACd0b,QAAS,+BAAiCvS,EAC1CwS,OAAO,IAAI5T,OAAQ4T,QAIhBZ,EAAS1Y,SAQlB0pD,UAAU5iD,GACR,IAAI1H,EAAOhB,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,OAEhDqhD,EAAY9pD,KAAK2oD,SAAS1hD,GAC1B6iD,GAAWvqD,EAAK2H,gBAAgB4iD,GAGtCvjC,UACE,IAAIhnB,EAAOhB,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,OAEpD,IAAK,IAAIqhD,KAAa9pD,KAAK2oD,SACzBppD,EAAK2H,gBAAgB4iD,GAGvB9pD,KAAK0oD,SAAMhgD,EACX1I,KAAK2oD,SAAW,KAMpBprD,EAAQ8N,QAAUkH,G,mCChRlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IAEhB05B,EAAW3rB,EAAuB/N,EAAQ,KAE1C83C,EAAQ/pC,EAAuB/N,EAAQ,MAEvC8N,EAAQC,EAAuB/N,EAAQ,KAEvC6R,EAAgB9D,EAAuB/N,EAAQ,KAE/C4hD,EAAe7zC,EAAuB/N,EAAQ,MAElD,SAAS+N,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GASvF,MAAMsqD,EACJhgD,YAAYmc,EAAMqb,EAAWZ,GAC3B5gC,KAAK2oD,SAAW,GAChB3oD,KAAK6/B,aAAUn3B,EACf1I,KAAKmmB,KAAOA,EACZnmB,KAAKwhC,UAAYA,GAAaK,EAASx2B,QACvCrL,KAAK4gC,SAAWA,EAChB5gC,KAAKiqD,QAAS,EACdjqD,KAAK4oD,oBACL5oD,KAAK4lC,eASPgjB,oBACE,IACE,IAAI1pB,EAEgC,qBAAzB6qB,EAAa1+C,UACtB6zB,EAAQ6qB,EAAa1+C,SAGvBrL,KAAK6/B,QAAUX,EAAMgrB,eAAe,CAClC/jC,KAAMnmB,KAAKmmB,OAEb,MAAOhU,GACP,MAAM,IAAItM,MAAM,+BASpB+/B,eACE5lC,KAAKmqD,QAAUnqD,KAAKsZ,OAAO7L,KAAKzN,MAChCzB,OAAOugB,iBAAiB,SAAU9e,KAAKmqD,SACvC5rD,OAAOugB,iBAAiB,UAAW9e,KAAKmqD,SAQ1C/rC,kBACE7f,OAAOglB,oBAAoB,SAAUvjB,KAAKmqD,SAC1C5rD,OAAOglB,oBAAoB,UAAWvjB,KAAKmqD,SAC3CnqD,KAAKmqD,aAAUzhD,EAQjB4Q,OAAOmgB,GACL,IAAIwwB,EAAS3vC,UAAU8vC,OACvBpqD,KAAKiqD,OAASA,EAEVA,EACFjqD,KAAK0d,KAAK,SAAU1d,MAEpBA,KAAK0d,KAAK,UAAW1d,MAWzBgjB,IAAIyc,EAAW+G,GACb,IAAI6jB,EAAS5qB,EAAUA,UAAUnyB,KAAI9K,IACnC,IAAI,KACF+T,GACE/T,EACAyE,EAAMjH,KAAK4gC,SAASrqB,GACpB+zC,EAAa/rD,OAAOa,mBAAmB6H,GAC3C,OAAOjH,KAAK6/B,QAAQ0qB,QAAQD,GAAYxpC,MAAKte,IACtCA,GAAQgkC,EACJxmC,KAAKwhC,UAAUv6B,EAAK,UAAU6Z,MAAK5hB,GACjCc,KAAK6/B,QAAQ2qB,QAAQF,EAAYprD,KAGnCsD,OAIb,OAAO5E,QAAQwpB,IAAIijC,GAWrBI,IAAIxjD,EAAKuR,EAAiBC,GACxB,IAAI6xC,EAAa/rD,OAAOa,mBAAmB6H,GAC3C,OAAOjH,KAAK6/B,QAAQ0qB,QAAQD,GAAYxpC,MAAK3iB,GACtCA,GACI6B,KAAKwhC,UAAUv6B,EAAK,SAAUuR,EAAiBC,GAASqI,MAAK5hB,GAC3Dc,KAAK6/B,QAAQ2qB,QAAQF,EAAYprD,OAiBhD2sB,QAAQ5kB,EAAKL,EAAM4R,EAAiBC,GAClC,OAAIzY,KAAKiqD,OAEAjqD,KAAKwhC,UAAUv6B,EAAKL,EAAM4R,EAAiBC,GAASqI,MAAK5hB,IAE9Dc,KAAKyqD,IAAIxjD,GACF/H,KAIFc,KAAK0qD,SAASzjD,EAAKL,GAW9B8jD,SAASzjD,EAAKL,GACG,IAAI0E,EAAMvL,MAAzB,IAEI+L,EAAO,IAAImK,EAAM5K,QAAQpE,GAY7B,OAVKL,IACHA,EAAOkF,EAAK2J,YAGF,QAAR7O,EACS5G,KAAKipD,QAAQhiD,GAEbjH,KAAK8gD,QAAQ75C,IAGV6Z,MAAK9X,IACnB,IACI7K,EADA0a,EAAW,IAAIvN,EAAMvL,MAazB,OAVIiJ,GACF7K,EAAS6B,KAAKkpD,eAAelgD,EAAGpC,GAChCiS,EAAShb,QAAQM,IAEjB0a,EAAS/a,OAAO,CACd0b,QAAS,8BAAgCvS,EACzCwS,OAAO,IAAI5T,OAAQ4T,QAIhBZ,EAAS1Y,WAYpB+oD,eAAe3vC,EAAU3S,GAevB,MAZY,QAARA,EACE8S,KAAK5U,MAAMyU,IACN,EAAIjO,EAAMrH,OAAO2C,IACtB,EAAI0E,EAAMxG,OAAOyU,EAAU,YACd,SAAR3S,GACL,EAAI0E,EAAMxG,OAAOyU,EAAU,yBACd,QAAR3S,GAA0B,OAARA,GACvB,EAAI0E,EAAMxG,OAAOyU,EAAU,aAE3BA,EAaR0vC,QAAQhiD,EAAKs5C,GACX,IAAI+J,EAAa/rD,OAAOa,mBAAmB6H,GAC3C,OAAOjH,KAAK6/B,QAAQ0qB,QAAQD,GAAYxpC,MAAK,SAAU0oC,GACrD,GAAKA,EAEL,OADAjJ,EAAWA,GAAYN,EAAM50C,QAAQsd,OAAO1hB,GACrC,IAAIuC,KAAK,CAACggD,GAAa,CAC5B5iD,KAAM25C,OAYZO,QAAQ75C,EAAKs5C,GACX,IAAI+J,EAAa/rD,OAAOa,mBAAmB6H,GAE3C,OADAs5C,EAAWA,GAAYN,EAAM50C,QAAQsd,OAAO1hB,GACrCjH,KAAK6/B,QAAQ0qB,QAAQD,GAAYxpC,MAAK,SAAU0oC,GACrD,IAEI7rD,EAFAkb,EAAW,IAAIvN,EAAMvL,MACrBhC,EAAS,IAAIC,WAEjB,GAAKwrD,EAQL,OAPA7rD,EAAO,IAAI6L,KAAK,CAACggD,GAAa,CAC5B5iD,KAAM25C,IAERxiD,EAAO+gB,iBAAiB,WAAW,KACjCjG,EAAShb,QAAQE,EAAOI,WAE1BJ,EAAO4sD,WAAWhtD,EAAM4iD,GACjB1nC,EAAS1Y,WAWpBspD,UAAUxiD,EAAKs5C,GACb,IAAI+J,EAAa/rD,OAAOa,mBAAmB6H,GAE3C,OADAs5C,EAAWA,GAAYN,EAAM50C,QAAQsd,OAAO1hB,GACrCjH,KAAK6/B,QAAQ0qB,QAAQD,GAAYxpC,MAAK0oC,IAC3C,IAEI7rD,EAFAkb,EAAW,IAAIvN,EAAMvL,MACrBhC,EAAS,IAAIC,WAEjB,GAAKwrD,EAQL,OAPA7rD,EAAO,IAAI6L,KAAK,CAACggD,GAAa,CAC5B5iD,KAAM25C,IAERxiD,EAAO+gB,iBAAiB,WAAW,KACjCjG,EAAShb,QAAQE,EAAOI,WAE1BJ,EAAOE,cAAcN,EAAM4iD,GACpB1nC,EAAS1Y,WAWpByhC,UAAU36B,EAAKwV,GACb,IAIIitC,EACAnwC,EALAV,EAAW,IAAIvN,EAAMvL,MAErBR,EAAOhB,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,OAIhDkhD,EAAYltC,GAAWA,EAAQmtC,OAEnC,OAAI3iD,KAAOjH,KAAK2oD,UACd9vC,EAAShb,QAAQmC,KAAK2oD,SAAS1hD,IACxB4R,EAAS1Y,UAGdwpD,GACFpwC,EAAWvZ,KAAKypD,UAAUxiD,KAGxBsS,EAASuH,KAAK,SAAU4oC,GACtB1pD,KAAK2oD,SAAS1hD,GAAOyiD,EACrB7wC,EAAShb,QAAQ6rD,IACjBj8C,KAAKzN,QAGTuZ,EAAWvZ,KAAKipD,QAAQhiD,KAGtBsS,EAASuH,KAAK,SAAUnjB,GACtB+rD,EAAUnqD,EAAKC,gBAAgB7B,GAC/BqC,KAAK2oD,SAAS1hD,GAAOyiD,EACrB7wC,EAAShb,QAAQ6rD,IACjBj8C,KAAKzN,OAINuZ,GACHV,EAAS/a,OAAO,CACd0b,QAAS,8BAAgCvS,EACzCwS,OAAO,IAAI5T,OAAQ4T,QAIhBZ,EAAS1Y,SAQlB0pD,UAAU5iD,GACR,IAAI1H,EAAOhB,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,OAEhDqhD,EAAY9pD,KAAK2oD,SAAS1hD,GAC1B6iD,GAAWvqD,EAAK2H,gBAAgB4iD,GAGtCvjC,UACE,IAAIhnB,EAAOhB,OAAOgK,KAAOhK,OAAOiK,WAAajK,OAAOkK,OAEpD,IAAK,IAAIqhD,KAAa9pD,KAAK2oD,SACzBppD,EAAK2H,gBAAgB4iD,GAGvB9pD,KAAK2oD,SAAW,GAChB3oD,KAAKoe,oBAKT,EAAIpE,EAAc3O,SAAS2+C,EAAM1jD,WACjC,IAAIiM,EAAWy3C,EACfzsD,EAAQ8N,QAAUkH,G,6BChYlBlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIC,EAAQnD,EAAQ,IA0EpB,IAAIoK,EAnEJ,MACEvI,YAAY4gD,GACV5qD,KAAK6qD,YAAc,GACnB7qD,KAAKyrB,YAAc,GACnBzrB,KAAK8qD,aAAe,GACpB9qD,KAAK+qD,gBAAkB,GAEnBH,GACF5qD,KAAK8E,MAAM8lD,GAUf9lD,MAAM8lD,GACJ,IAAKA,EACH,OAAO5qD,KAGT,MAAMgrD,GAAqB,EAAI1/C,EAAM5F,IAAIklD,EAAwB,mBAEjE,IAAKI,EACH,OAAOhrD,KA6BT,OA1BgB,EAAIsL,EAAMtF,KAAKglD,EAAoB,UAC3CrsD,SAAQN,IACd,IAAIb,EAAQ,GAMZ,OAJIa,EAAGoD,WAAW7B,SAChBpC,EAAQa,EAAGoD,WAAW,GAAGy8C,WAGnB7/C,EAAG8hB,WAAWgG,KAAK3oB,OACzB,IAAK,cACHwC,KAAK6qD,YAAcrtD,EACnB,MAEF,IAAK,eACHwC,KAAKyrB,YAAcjuB,EACnB,MAEF,IAAK,iBACHwC,KAAK8qD,aAAettD,EACpB,MAEF,IAAK,mBACHwC,KAAK+qD,gBAAkBvtD,MAItBwC,KAGTumB,UACEvmB,KAAK6qD,iBAAcniD,EACnB1I,KAAKyrB,iBAAc/iB,EACnB1I,KAAK8qD,kBAAepiD,EACpB1I,KAAK+qD,qBAAkBriD,IAM3BnL,EAAQ8N,QAAUkH,G,8BClFlB,YAEAlV,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIssC,EAAQzhC,EAAuB/N,EAAQ,MAEvCi2B,EAAaloB,EAAuB/N,EAAQ,MAE5C8R,EAAW/D,EAAuB/N,EAAQ,KAE1Ck8B,EAAYnuB,EAAuB/N,EAAQ,KAE3C8iD,EAYJ,SAAiCvrD,EAAKkzC,GAAe,IAAKA,GAAelzC,GAAOA,EAAIuV,WAAc,OAAOvV,EAAO,GAAY,OAARA,GAA+B,kBAARA,GAAmC,oBAARA,EAAsB,MAAO,CAAE2L,QAAS3L,GAAS,IAAImzC,EAAQC,EAAyBF,GAAc,GAAIC,GAASA,EAAME,IAAIrzC,GAAQ,OAAOmzC,EAAMhmB,IAAIntB,GAAQ,IAAIg2B,EAAS,GAAQsd,EAAwB31C,OAAOC,gBAAkBD,OAAOgE,yBAA0B,IAAK,IAAIqgB,KAAOhiB,EAAO,GAAY,YAARgiB,GAAqBrkB,OAAOiJ,UAAUsL,eAAe1Q,KAAKxB,EAAKgiB,GAAM,CAAE,IAAIiU,EAAOqd,EAAwB31C,OAAOgE,yBAAyB3B,EAAKgiB,GAAO,KAAUiU,IAASA,EAAK9I,KAAO8I,EAAKC,KAAQv4B,OAAOC,eAAeo4B,EAAQhU,EAAKiU,GAAgBD,EAAOhU,GAAOhiB,EAAIgiB,GAAYgU,EAAOrqB,QAAU3L,EAASmzC,GAASA,EAAMjd,IAAIl2B,EAAKg2B,GAAW,OAAOA,EAZ/wBG,CAAwB1tB,EAAQ,KAExCiS,EAAajS,EAAQ,IAEX+N,EAAuB/N,EAAQ,MAE7B+N,EAAuB/N,EAAQ,MAE7B+N,EAAuB/N,EAAQ,MAEjD,SAAS2qC,EAAyBF,GAAe,GAAuB,oBAAZK,QAAwB,OAAO,KAAM,IAAIC,EAAoB,IAAID,QAAeE,EAAmB,IAAIF,QAAW,OAAQH,EAA2B,SAAUF,GAAe,OAAOA,EAAcO,EAAmBD,IAAsBN,GAIxS,SAAS18B,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GASvF,SAASwrD,EAAKjkD,EAAKwV,GACjB,OAAO,IAAIk7B,EAAMtsC,QAAQpE,EAAKwV,GAGhCyuC,EAAKC,QAAU/wC,EAAW3H,eAEJ,qBAAX24C,IACTA,EAAO34C,eAAiB2H,EAAW3H,gBAGrCy4C,EAAKvsB,KAAOgZ,EAAMtsC,QAClB6/C,EAAK7hC,UAAY+U,EAAW/yB,QAC5B6/C,EAAKvwC,SAAW0pB,EAAUh5B,QAC1B6/C,EAAKG,IAAMpxC,EAAS5O,QACpB6/C,EAAKD,MAAQA,EACb,IAAI14C,EAAW24C,EACf3tD,EAAQ8N,QAAUkH,I,+CCpDlB,SAASkgC,EAAQ/yC,GAAmV,OAAtO+yC,EAArD,oBAAXC,QAAoD,kBAApBA,OAAOC,SAAmC,SAAiBjzC,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,oBAAXgzC,QAAyBhzC,EAAIsK,cAAgB0oC,QAAUhzC,IAAQgzC,OAAOpsC,UAAY,gBAAkB5G,IAAyBA,GAEnXrC,OAAOC,eAAeC,EAAS,aAAc,CAC3CC,OAAO,IAETD,EAAQ8N,aAAU,EAElB,IAAIyqB,EAiBJ,SAAiCp2B,EAAKkzC,GAAe,IAAKA,GAAelzC,GAAOA,EAAIuV,WAAc,OAAOvV,EAAO,GAAY,OAARA,GAAiC,WAAjB+yC,EAAQ/yC,IAAoC,oBAARA,EAAsB,MAAO,CAAE2L,QAAS3L,GAAS,IAAImzC,EAAQC,EAAyBF,GAAc,GAAIC,GAASA,EAAME,IAAIrzC,GAAQ,OAAOmzC,EAAMhmB,IAAIntB,GAAQ,IAAIg2B,EAAS,GAAQsd,EAAwB31C,OAAOC,gBAAkBD,OAAOgE,yBAA0B,IAAK,IAAIqgB,KAAOhiB,EAAO,GAAY,YAARgiB,GAAqBrkB,OAAOiJ,UAAUsL,eAAe1Q,KAAKxB,EAAKgiB,GAAM,CAAE,IAAIiU,EAAOqd,EAAwB31C,OAAOgE,yBAAyB3B,EAAKgiB,GAAO,KAAUiU,IAASA,EAAK9I,KAAO8I,EAAKC,KAAQv4B,OAAOC,eAAeo4B,EAAQhU,EAAKiU,GAAgBD,EAAOhU,GAAOhiB,EAAIgiB,GAAYgU,EAAOrqB,QAAU3L,EAASmzC,GAASA,EAAMjd,IAAIl2B,EAAKg2B,GAAW,OAAOA,EAjBhxBG,CAAwB1tB,EAAQ,IAEzCg0B,EAAajmB,EAAuB/N,EAAQ,IAE5CmjD,EAAkBnjD,EAAQ,KAE1BojD,EAAIpjD,EAAQ,KAEZw1B,EAASznB,EAAuB/N,EAAQ,MAExCqjD,EAAY,CAAC,YACbC,EAAa,CAAC,QAAS,UAAW,cAAe,SAAU,kBAAmB,YAAa,kBAE/F,SAASv1C,EAAuBxW,GAAO,OAAOA,GAAOA,EAAIuV,WAAavV,EAAM,CAAE2L,QAAS3L,GAEvF,SAASozC,EAAyBF,GAAe,GAAuB,oBAAZK,QAAwB,OAAO,KAAM,IAAIC,EAAoB,IAAID,QAAeE,EAAmB,IAAIF,QAAW,OAAQH,EAA2B,SAAkCF,GAAe,OAAOA,EAAcO,EAAmBD,IAAsBN,GAIhU,SAASvW,IAA2Q,OAA9PA,EAAWh/B,OAAOi/B,QAAU,SAAUv7B,GAAU,IAAK,IAAIpB,EAAI,EAAGA,EAAIE,UAAUD,OAAQD,IAAK,CAAE,IAAIG,EAASD,UAAUF,GAAI,IAAK,IAAI+hB,KAAO5hB,EAAczC,OAAOiJ,UAAUsL,eAAe1Q,KAAKpB,EAAQ4hB,KAAQ3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAY,OAAO3gB,IAA2BmmB,MAAMlnB,KAAMH,WAEhT,SAAS41C,EAAgBD,EAAUJ,GAAe,KAAMI,aAAoBJ,GAAgB,MAAM,IAAIhpC,UAAU,qCAEhH,SAASqnC,EAAkB1yC,EAAQmF,GAAS,IAAK,IAAIvG,EAAI,EAAGA,EAAIuG,EAAMtG,OAAQD,IAAK,CAAE,IAAI+zC,EAAaxtC,EAAMvG,GAAI+zC,EAAWjW,WAAaiW,EAAWjW,aAAc,EAAOiW,EAAWC,cAAe,EAAU,UAAWD,IAAYA,EAAWE,UAAW,GAAMv2C,OAAOC,eAAeyD,EAAQ2yC,EAAWhyB,IAAKgyB,IAE7S,SAASgY,EAAatW,EAAaC,EAAYC,GAAmJ,OAAhID,GAAY5B,EAAkB2B,EAAY9uC,UAAW+uC,GAAiBC,GAAa7B,EAAkB2B,EAAaE,GAAqBF,EAEzM,SAASD,EAAUhf,EAAUC,GAAc,GAA0B,oBAAfA,GAA4C,OAAfA,EAAuB,MAAM,IAAIhqB,UAAU,sDAAyD+pB,EAAS7vB,UAAYjJ,OAAO65B,OAAOd,GAAcA,EAAW9vB,UAAW,CAAE0D,YAAa,CAAExM,MAAO24B,EAAUyd,UAAU,EAAMD,cAAc,KAAevd,GAAYyd,EAAgB1d,EAAUC,GAEnX,SAASyd,EAAgBC,EAAGC,GAA+G,OAA1GF,EAAkBx2C,OAAO22C,gBAAkB,SAAyBF,EAAGC,GAAsB,OAAjBD,EAAE3c,UAAY4c,EAAUD,IAA6BA,EAAGC,GAErK,SAASE,EAAaC,GAAW,IAAIC,EAMrC,WAAuC,GAAuB,qBAAZC,UAA4BA,QAAQC,UAAW,OAAO,EAAO,GAAID,QAAQC,UAAUC,KAAM,OAAO,EAAO,GAAqB,oBAAVC,MAAsB,OAAO,EAAM,IAAsF,OAAhFC,QAAQluC,UAAUmuC,QAAQvzC,KAAKkzC,QAAQC,UAAUG,QAAS,IAAI,iBAAyB,EAAQ,MAAOriC,GAAK,OAAO,GAN9PuiC,GAA6B,OAAO,WAAkC,IAAsCv2C,EAAlCw2C,EAAQC,EAAgBV,GAAkB,GAAIC,EAA2B,CAAE,IAAIU,EAAYD,EAAgB50C,MAAMgK,YAAa7L,EAASi2C,QAAQC,UAAUM,EAAO90C,UAAWg1C,QAAqB12C,EAASw2C,EAAMztB,MAAMlnB,KAAMH,WAAc,OAAOi1C,EAA2B90C,KAAM7B,IAE5Z,SAAS22C,EAA2BtY,EAAMt7B,GAAQ,OAAIA,GAA2B,WAAlBuxC,EAAQvxC,IAAsC,oBAATA,EAA8Cq7B,EAAuBC,GAAtCt7B,EAEnI,SAASq7B,EAAuBC,GAAQ,QAAa,IAATA,EAAmB,MAAM,IAAIC,eAAe,6DAAgE,OAAOD,EAI/J,SAASoY,EAAgBd,GAAwJ,OAAnJc,EAAkBv3C,OAAO22C,eAAiB32C,OAAO03C,eAAiB,SAAyBjB,GAAK,OAAOA,EAAE3c,WAAa95B,OAAO03C,eAAejB,KAA8BA,GAExM,SAASkB,EAAgBt1C,EAAKgiB,EAAKlkB,GAAiK,OAApJkkB,KAAOhiB,EAAOrC,OAAOC,eAAeoC,EAAKgiB,EAAK,CAAElkB,MAAOA,EAAOigC,YAAY,EAAMkW,cAAc,EAAMC,UAAU,IAAkBl0C,EAAIgiB,GAAOlkB,EAAgBkC,EAE3M,SAASisD,EAAyB7rD,EAAQi6B,GAAY,GAAc,MAAVj6B,EAAgB,MAAO,GAAI,IAAkE4hB,EAAK/hB,EAAnEoB,EAEzF,SAAuCjB,EAAQi6B,GAAY,GAAc,MAAVj6B,EAAgB,MAAO,GAAI,IAA2D4hB,EAAK/hB,EAA5DoB,EAAS,GAAQi5B,EAAa38B,OAAOmlB,KAAK1iB,GAAqB,IAAKH,EAAI,EAAGA,EAAIq6B,EAAWp6B,OAAQD,IAAO+hB,EAAMsY,EAAWr6B,GAAQo6B,EAASh2B,QAAQ2d,IAAQ,IAAa3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAQ,OAAO3gB,EAFxMk5B,CAA8Bn6B,EAAQi6B,GAAuB,GAAI18B,OAAOi2C,sBAAuB,CAAE,IAAIsY,EAAmBvuD,OAAOi2C,sBAAsBxzC,GAAS,IAAKH,EAAI,EAAGA,EAAIisD,EAAiBhsD,OAAQD,IAAO+hB,EAAMkqC,EAAiBjsD,GAAQo6B,EAASh2B,QAAQ2d,IAAQ,GAAkBrkB,OAAOiJ,UAAUulD,qBAAqB3qD,KAAKpB,EAAQ4hB,KAAgB3gB,EAAO2gB,GAAO5hB,EAAO4hB,IAAU,OAAO3gB,EAIne,IAAI+qD,EAAY,SAAmBv0B,GACjC,IAAIjuB,EAAWiuB,EAAKjuB,SAChBpD,EAAQylD,EAAyBp0B,EAAMi0B,GAEvCO,GAAW,EAAIT,EAAgBU,cAAc9lD,GACjD,OAAoB4vB,EAAOzqB,QAAQ4L,cAAc,MAAO80C,EAAUziD,IAGhE2iD,EAAuB,SAAUC,GACnC/W,EAAU8W,EAASC,GAEnB,IAAI3W,EAAStB,EAAagY,GAE1B,SAASA,IACP,IAAI51B,EAEJof,EAAgBz1C,KAAMisD,GAEtB,IAAK,IAAIpd,EAAOhvC,UAAUD,OAAQknB,EAAO,IAAIzgB,MAAMwoC,GAAOC,EAAO,EAAGA,EAAOD,EAAMC,IAC/EhoB,EAAKgoB,GAAQjvC,UAAUivC,GASzB,OAJAkG,EAAgBzY,EAFhBlG,EAAQkf,EAAOr0C,KAAKgmB,MAAMquB,EAAQ,CAACv1C,MAAMiP,OAAO6X,KAED,eAAe,WAC5DuP,EAAMnwB,MAAMimD,YAAY91B,EAAMnwB,MAAMqQ,SAG/B8f,EAgBT,OAbAq1B,EAAaO,EAAS,CAAC,CACrBvqC,IAAK,SACLlkB,MAAO,WACL,IAAIq8B,EAAc75B,KAAKkG,MACnBs4C,EAAQ3kB,EAAY2kB,MACpBzW,EAASlO,EAAYkO,OACzB,OAAoBjS,EAAOzqB,QAAQ4L,cAAc,SAAU,CACzDm1C,QAASpsD,KAAKmsD,YACd7tD,MAAOypC,GACNyW,OAIAyN,EApCkB,CAqCzBn2B,EAAOu2B,eAETJ,EAAQvxB,UAAY,CAClB8jB,MAAOriB,EAAW9wB,QAAQmsC,OAC1BjhC,KAAM4lB,EAAW9wB,QAAQmsC,OACzB2U,YAAahwB,EAAW9wB,QAAQhE,KAChC0gC,OAAQ5L,EAAW9wB,QAAQmvB,QAG7B,IAAI8xB,EAA2B,SAAUC,GACvCpX,EAAUmX,EAAaC,GAEvB,IAAIC,EAAUvY,EAAaqY,GAE3B,SAASA,EAAYpmD,GACnB,IAAIsyB,EA+CJ,OA7CAid,EAAgBz1C,KAAMssD,GAItBtX,EAAgBzY,EAFhB/D,EAASg0B,EAAQtrD,KAAKlB,KAAMkG,IAEoB,aAAa,WAC3DsyB,EAAOD,SAAS,CACdk0B,aAAcj0B,EAAOxB,MAAMy1B,iBAI/BzX,EAAgBzY,EAAuB/D,GAAS,QAAQ,WAC3CA,EAAOk0B,UAAU15B,QACvB6iB,cAGPb,EAAgBzY,EAAuB/D,GAAS,QAAQ,WAC3CA,EAAOk0B,UAAU15B,QACvB8iB,cAGPd,EAAgBzY,EAAuB/D,GAAS,eAAe,SAAUyI,GACvE,IAAIoV,EAAa7d,EAAOtyB,MAAMmwC,WAE9B7d,EAAOD,SAAS,CACd0I,IAAKA,IACJ,WACD,OAAOoV,GAAcA,EAAWpV,SAIpC+T,EAAgBzY,EAAuB/D,GAAS,eAAe,SAAUkd,GACvE,IAAIC,EAAkBnd,EAAOtyB,MAAMyvC,gBAEnCnd,EAAOD,SAAS,CACdk0B,aAAa,IACZ,WACD,OAAO9W,GAAmBA,EAAgBD,SAI9Cld,EAAOk0B,UAAyB52B,EAAOzqB,QAAQ4qC,YAC/Czd,EAAOxB,MAAQ,CACby1B,aAAa,EACbxrB,KAAK,GAEAzI,EAwFT,OArFAkzB,EAAaY,EAAa,CAAC,CACzB5qC,IAAK,YACLlkB,MAAO,WACL,IAAIy7B,EAASj5B,KAET2sD,EAAc3sD,KAAKg3B,MACnBiK,EAAM0rB,EAAY1rB,IAClBwrB,EAAcE,EAAYF,YAC1B1kB,EAAS/nC,KAAKkG,MAAM6hC,OACxB,OAAoBjS,EAAOzqB,QAAQ4L,cAAc,MAAO,KAAmB6e,EAAOzqB,QAAQ4L,cAAc,MAAO,CAC7G3Y,MAAOypC,EAAOgF,SACAjX,EAAOzqB,QAAQ4L,cAAc,MAAO,CAClD3Y,MAAOypC,EAAO9G,KACbA,EAAI3zB,KAAI,SAAU9K,EAAM7C,GACzB,OAAoBm2B,EAAOzqB,QAAQ4L,cAAcg1C,EAAS5vB,EAAS,GAAI75B,EAAM,CAC3Ekf,IAAK/hB,EACLwsD,YAAalzB,EAAOkzB,YACpBpkB,OAAQA,EAAOkF,sBAEbwf,GAA4B32B,EAAOzqB,QAAQ4L,cAAc,MAAO,CACpE3Y,MAAOypC,EAAO+E,cACdsf,QAASpsD,KAAK4sD,eAGjB,CACDlrC,IAAK,kBACLlkB,MAAO,WACL,IAAIivD,EAAczsD,KAAKg3B,MAAMy1B,YACzB1kB,EAAS/nC,KAAKkG,MAAM6hC,OACxB,OAAoBjS,EAAOzqB,QAAQ4L,cAAc,SAAU,CACzD3Y,MAAOjB,OAAOi/B,OAAO,GAAIyL,EAAOqF,UAAWqf,EAAc1kB,EAAOuF,kBAAoB,IACpF8e,QAASpsD,KAAK4sD,WACA92B,EAAOzqB,QAAQ4L,cAAc,OAAQ,CACnD3Y,MAAOjB,OAAOi/B,OAAO,GAAIyL,EAAOwF,aAAcxF,EAAO0F,mBACtC3X,EAAOzqB,QAAQ4L,cAAc,OAAQ,CACpD3Y,MAAOjB,OAAOi/B,OAAO,GAAIyL,EAAOwF,aAAcxF,EAAO2F,sBAGxD,CACDhsB,IAAK,SACLlkB,MAAO,WACL,IAAI44C,EAAep2C,KAAKkG,MACpB22C,EAAQzG,EAAayG,MACrBgQ,EAAUzW,EAAayW,QACvBlf,EAAcyI,EAAazI,YAC3B5F,EAASqO,EAAarO,OACtB4N,EAAkBS,EAAaT,gBAC/BmX,EAAY1W,EAAa0W,UACzBC,EAAiB3W,EAAa2W,eAC9B7mD,EAAQylD,EAAyBvV,EAAcqV,GAE/CuB,EAAehtD,KAAKg3B,MACpBiK,EAAM+rB,EAAa/rB,IACnBwrB,EAAcO,EAAaP,YAC/B,OAAoB32B,EAAOzqB,QAAQ4L,cAAc,MAAO,CACtD3Y,MAAOypC,EAAOh3B,WACA+kB,EAAOzqB,QAAQ4L,cAAc,MAAO,CAClD3Y,MAAOjB,OAAOi/B,OAAO,GAAIyL,EAAO0D,WAAYghB,EAAc1kB,EAAO8D,kBAAoB,KACpFghB,GAAW7sD,KAAKitD,kBAAgCn3B,EAAOzqB,QAAQ4L,cAAc,MAAO,CACrF3Y,MAAOypC,EAAO+D,WACb+Q,GAAqB/mB,EAAOzqB,QAAQ4L,cAAc60C,EAAW,CAC9DoB,cAAeltD,KAAKotB,KACpB+/B,aAAcntD,KAAKmtB,KACnBigC,YAAY,GACEt3B,EAAOzqB,QAAQ4L,cAAc,MAAO,CAClD3Y,MAAOypC,EAAOhqC,QACA+3B,EAAOzqB,QAAQ4L,cAAcs0C,EAAEtW,SAAU5Y,EAAS,CAChE+a,IAAKp3C,KAAK0sD,UACV/e,YAAaA,EACb5F,OAAQglB,GACP7mD,EAAO,CACRmwC,WAAYr2C,KAAKqtD,YACjB1X,gBAAiBA,KACdmX,GAA0Bh3B,EAAOzqB,QAAQ4L,cAAc,MAAO,CACjE3Y,MAAOypC,EAAOkE,iBACGnW,EAAOzqB,QAAQ4L,cAAc,SAAU,CACxD3Y,MAAOjB,OAAOi/B,OAAO,GAAIyL,EAAOmE,MAAOnE,EAAO3a,MAC9Cg/B,QAASpsD,KAAKotB,MACb,UAAwB0I,EAAOzqB,QAAQ4L,cAAc,SAAU,CAChE3Y,MAAOjB,OAAOi/B,OAAO,GAAIyL,EAAOmE,MAAOnE,EAAO5a,MAC9Ci/B,QAASpsD,KAAKmtB,MACb,WAAY0/B,GAAW5rB,GAAOjhC,KAAKstD,iBAInChB,EA7IsB,CA8I7Bx2B,EAAOu2B,eAETC,EAAY3xB,aAAe,CACzBgT,YAA0B7X,EAAOzqB,QAAQ4L,cAAc,MAAO,CAC5D3Y,MAAOq/B,EAAOtyB,QAAQsiC,aACrB,iBACHgI,gBAAiB,KACjBU,WAAY,KACZwW,SAAS,EACT9kB,OAAQpK,EAAOtyB,SAEjBihD,EAAY5xB,UAAY,CACtBmiB,MAAO1gB,EAAW9wB,QAAQmsC,OAC1B7J,YAAaxR,EAAW9wB,QAAQ1E,QAChCkmD,QAAS1wB,EAAW9wB,QAAQkiD,KAC5B5X,gBAAiBxZ,EAAW9wB,QAAQhE,KACpCgvC,WAAYla,EAAW9wB,QAAQhE,KAC/B0gC,OAAQ5L,EAAW9wB,QAAQmvB,OAC3BuyB,eAAgB5wB,EAAW9wB,QAAQmvB,OACnCsyB,UAAW3wB,EAAW9wB,QAAQkiD,MAEhC,IAAIh7C,EAAW+5C,EACf/uD,EAAQ8N,QAAUkH,G,6gBChRLi7C,EAAO,OACPC,EAAQ,QACRC,EAAK,KACLC,EAAO,OC+BdhzB,EAAe,CACnBxI,MADmB,GAEnBy7B,8BAFmB,EAGnBC,cAHmB,EAInBT,YAJmB,EAKnBU,YAAY,GAERC,EAA+B,CACnCl/B,OADmC,EAEnCm/B,QAAS,CAAC,EAFyB,GAGnClrD,MAHmC,EAInCmrD,SAJmC,EAKnCC,GAAI,CAAC,EAAG,IAEJC,EAAN,YACMC,EAAN,UACMC,EAAN,WACMC,EAAN,YACMC,EAAN,aAEA,oBAME,OAAIC,EAAJ,EACMC,EAAJ,EACE,EAEF,EACS7G,EAAJ,EACL,EAEF,EAGF,gBACE,OAAI8G,EAAa,OAAO1tC,EACxB,IAAM2tC,EAAkBruD,QAAD,IAAvB,EAKA,MAAO,CAHL0gB,KAAS1gB,SAAT0gB,GAAoCA,KAAS1gB,SAD/C,GAGE0gB,KAAS1gB,SAAT0gB,GAAoCA,KAAS1gB,SAD/C,IAKF,gBAUE,IAAMsuD,EAAU,SAACn1B,GAEXA,GAAS,YAATA,GAA+BA,iBAAnC,GAEA7D,GAAI,cAEE1vB,EAAJ,aACE1F,+BACAA,gC,MAGA,YAAai5B,EAAQA,UAArB,GAAwCA,EACpCy0B,EAAKW,EAAgB,CAFnBC,UAASC,WAE8B7oD,EAA/C,eACA,iBAGE8nD,QAAS,GAAF,OAHT,GAIEE,GAJF,EAKEprD,MAAO22B,aAAmB,QAK1Bu1B,EAAS,SAACv1B,GACd7D,GAAI,cAGF,GAAI,YAAa6D,GAASA,iBAA1B,EACE,S,MAGA,YAAaA,EAAQA,UAArB,GAAwCA,E,EAC3Bo1B,EAAgB,CAFvBC,UAASC,WAEkC7oD,EAArB,eAAvBwuB,OAAGC,OACJ85B,EAAS/5B,EAAIsC,KAAnB,GACM4wB,EAASjzB,EAAIqC,KAAnB,GACMw3B,EAAOluD,SAAb,GACM2uD,EAAO3uD,SAAb,GACMgoD,GAAQ7uB,aAAD,GAAyBzC,EAAtC,MACMixB,EAAW3nD,UAAUkuD,IAAcS,EAAxB3uD,IAAwCgoD,GAAzD,GACM4G,EAAgB,CAACT,GAAUnG,GAAX,GAAuBV,GAAUU,GAAvD,IAEM/yC,EAAM45C,EAAaX,EAAMS,EAAMR,EAArC,GAGMt8B,EACJ,kBAAOjsB,EAAP,MACIA,EADJ,MAEIA,QAAYqP,EAAZrP,gBACAy0B,EAJN,MAKA,GAAI6zB,KAAgBS,EAAhBT,IAAiCx3B,EAArC,QAAoD,OAAOA,EAE3D,IAAMo4B,EAAY,CAChBZ,KADgB,EAEhBS,KAFgB,EAGhBR,OAHgB,EAIhB7G,OAJgB,EAKhBryC,IALgB,EAMhBkkB,MANgB,EAOhB5K,MAAOmI,EAPS,MAQhBg3B,QAASh3B,EARO,QAShBixB,SATgB,EAUhBiH,QAIFE,SAAmBlpD,EAAnBkpD,cAAyClpD,eAAzCkpD,GAGAlpD,aAAmBA,YAAnBA,GAIA,IAAImpD,GAAJ,EAaA,OAZInpD,aAAmBA,EAAnBA,UAAqC,gBAAzC,KACEmpD,MAIAA,GACAnpD,EADAmpD,8BAEAnpD,EAFAmpD,YAGA51B,EAJF,YAMEA,mBAEF,QAGE5K,OAHF,EAIEugC,UAJF,EAKEnB,SAAS,QAKTqB,EAAQ,SAAC71B,GACb7D,GAAI,cACF,MACA,GAAIoB,WAAiBA,EAArB,UAAsC,CACpCo4B,EAAY,EAAH,GAAQp4B,EAAR,WAAyByC,UAClCvzB,YAAkBA,WAAlBA,GAEA,IAAMqpD,EACJrpD,EAAM,WAAWkpD,EADnB,KAEAG,GAAeA,EAAfA,QAEArpD,SAAeA,EAAA,MAAY,CAAEuzB,UAE/B,iBAAoC21B,kBAIlCI,EAAe,WAEnBhvD,kCACAA,mCAGIivD,EAAO,SAACt9C,GACZq9C,IACAF,MAWII,EAA2B,SAACrxD,EAAIilB,GACpC,IAAIqsC,EAAU,aACd,GAAItxD,GAAMA,EAAV,iBAA+B,CAE7B,IAAMuxD,EAGA,CACJ,CAACrB,EADG,GAEJ,CAACD,EAFG,GAGJ,CAACD,EANH,IAQAuB,WAAY,gBAAEz9C,EAAF,KAAKoJ,EAAL,YAAYld,EAAA,iBAAA8T,EAAA,EAA0B,CAAEmR,eAEpDqsC,EAAU,kBAAMC,EAAA,SAAY,gBAAEz9C,EAAF,KAAKoJ,EAAL,YAAYld,wBAAZ,OAE9B,UA+BIoS,EAA8D,CAClE2mC,IA7BY,SAAC/4C,GAGb,OAAIA,GACJu3B,GAAI,cAEF,GAAIoB,OAAJ,EAAqB,OAAOA,EAE5B,IAAM64B,EAAN,GAeA,OAbI74B,MAAYA,OAAZA,GAA+BA,EAAnC,eACEA,iBACA64B,uBAGE3pD,cAAJ,IACE2pD,eAAwBH,EAAY,GAEjCxpD,EAFH2pD,+BAOF,QAAmBxxD,MAAnB,QAcJ,OAJIyxD,EAAJ,aACEr/C,iBAGK,CAACA,EAAR,GAGF,kBAKE,IAAMo/C,EAAN,GAcA,OAZK3pD,EAAD,YAAqB8wB,EAAzB,cACEA,iBACA64B,uBACS3pD,eAAqB8wB,EAAzB,cAEDA,EAAJ,KACE64B,eAAwBH,EACtB14B,EADiC,IAEhC9wB,EAFH2pD,+BAMJ,U,SAGc7D,EAAavvC,G,IACnB2wC,EAAe3wC,EAAf2wC,WACF2C,EAAiBC,cAAvB,IACMC,EAAiBD,cAAvB,IAGAC,oB,MAEgC,WAC9B,kBACEC,GACE,mBACGH,UAAyBI,EACxBJ,EADmC,QAEnCE,EAHJ,WAKA,CAAE7C,iBAEN,CAV8B,IAAzBrB,OAAU2D,OAmBjB,OANAK,UAAyBK,EACvBL,EAD2C,QAE3CE,EAF2C,QAA7CF,GAMA,E","file":"static/js/9.dd5a9583.chunk.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RangeObject = void 0;\nexports.blob2base64 = blob2base64;\nexports.borders = borders;\nexports.bounds = bounds;\nexports.createBase64Url = createBase64Url;\nexports.createBlob = createBlob;\nexports.createBlobUrl = createBlobUrl;\nexports.defaults = defaults;\nexports.defer = defer;\nexports.documentHeight = documentHeight;\nexports.extend = extend;\nexports.filterChildren = filterChildren;\nexports.findChildren = findChildren;\nexports.getParentByTagName = getParentByTagName;\nexports.indexOfElementNode = indexOfElementNode;\nexports.indexOfNode = indexOfNode;\nexports.indexOfSorted = indexOfSorted;\nexports.indexOfTextNode = indexOfTextNode;\nexports.insert = insert;\nexports.isElement = isElement;\nexports.isFloat = isFloat;\nexports.isNumber = isNumber;\nexports.isXml = isXml;\nexports.locationOf = locationOf;\nexports.nodeBounds = nodeBounds;\nexports.parents = parents;\nexports.parse = parse;\nexports.prefixed = prefixed;\nexports.qs = qs;\nexports.qsa = qsa;\nexports.qsp = qsp;\nexports.querySelectorByType = querySelectorByType;\nexports.requestAnimationFrame = void 0;\nexports.revokeBlobUrl = revokeBlobUrl;\nexports.sprint = sprint;\nexports.treeWalker = treeWalker;\nexports.type = type;\nexports.uuid = uuid;\nexports.walk = walk;\nexports.windowBounds = windowBounds;\n\nvar _xmldom = require(\"@xmldom/xmldom\");\n\n/**\n * Core Utilities and Helpers\n * @module Core\n*/\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nconst requestAnimationFrame = typeof window != \"undefined\" ? window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame : false;\nexports.requestAnimationFrame = requestAnimationFrame;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n\nconst _URL = typeof URL != \"undefined\" ? URL : typeof window != \"undefined\" ? window.URL || window.webkitURL || window.mozURL : undefined;\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\n\n\nfunction uuid() {\n  var d = new Date().getTime();\n  var uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == \"x\" ? r : r & 0x7 | 0x8).toString(16);\n  });\n  return uuid;\n}\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\n\n\nfunction documentHeight() {\n  return Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight);\n}\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isElement(obj) {\n  return !!(obj && obj.nodeType == 1);\n}\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isNumber(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isFloat(n) {\n  let f = parseFloat(n);\n\n  if (isNumber(n) === false) {\n    return false;\n  }\n\n  if (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n    return true;\n  }\n\n  return Math.floor(f) !== f;\n}\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\n\n\nfunction prefixed(unprefixed) {\n  var vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\"];\n  var prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n  var lower = unprefixed.toLowerCase();\n  var length = vendors.length;\n\n  if (typeof document === \"undefined\" || typeof document.body.style[lower] != \"undefined\") {\n    return unprefixed;\n  }\n\n  for (var i = 0; i < length; i++) {\n    if (typeof document.body.style[prefixes[i] + lower] != \"undefined\") {\n      return prefixes[i] + lower;\n    }\n  }\n\n  return unprefixed;\n}\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\n\n\nfunction defaults(obj) {\n  for (var i = 1, length = arguments.length; i < length; i++) {\n    var source = arguments[i];\n\n    for (var prop in source) {\n      if (obj[prop] === void 0) obj[prop] = source[prop];\n    }\n  }\n\n  return obj;\n}\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\n\n\nfunction extend(target) {\n  var sources = [].slice.call(arguments, 1);\n  sources.forEach(function (source) {\n    if (!source) return;\n    Object.getOwnPropertyNames(source).forEach(function (propName) {\n      Object.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n    });\n  });\n  return target;\n}\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\n\n\nfunction insert(item, array, compareFunction) {\n  var location = locationOf(item, array, compareFunction);\n  array.splice(location, 0, item);\n  return location;\n}\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\n\n\nfunction locationOf(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n\n  if (!compareFunction) {\n    compareFunction = function (a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n\n  if (end - start <= 0) {\n    return pivot;\n  }\n\n  compared = compareFunction(array[pivot], item);\n\n  if (end - start === 1) {\n    return compared >= 0 ? pivot : pivot + 1;\n  }\n\n  if (compared === 0) {\n    return pivot;\n  }\n\n  if (compared === -1) {\n    return locationOf(item, array, compareFunction, pivot, end);\n  } else {\n    return locationOf(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\n\n\nfunction indexOfSorted(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n\n  if (!compareFunction) {\n    compareFunction = function (a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n\n  if (end - start <= 0) {\n    return -1; // Not found\n  }\n\n  compared = compareFunction(array[pivot], item);\n\n  if (end - start === 1) {\n    return compared === 0 ? pivot : -1;\n  }\n\n  if (compared === 0) {\n    return pivot; // Found\n  }\n\n  if (compared === -1) {\n    return indexOfSorted(item, array, compareFunction, pivot, end);\n  } else {\n    return indexOfSorted(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\n\n\nfunction bounds(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\n\n\nfunction borders(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\n\n\nfunction nodeBounds(node) {\n  let elPos;\n  let doc = node.ownerDocument;\n\n  if (node.nodeType == Node.TEXT_NODE) {\n    let elRange = doc.createRange();\n    elRange.selectNodeContents(node);\n    elPos = elRange.getBoundingClientRect();\n  } else {\n    elPos = node.getBoundingClientRect();\n  }\n\n  return elPos;\n}\n/**\n * Find the equivelent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\n\n\nfunction windowBounds() {\n  var width = window.innerWidth;\n  var height = window.innerHeight;\n  return {\n    top: 0,\n    left: 0,\n    right: width,\n    bottom: height,\n    width: width,\n    height: height\n  };\n}\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\n\n\nfunction indexOfNode(node, typeId) {\n  var parent = node.parentNode;\n  var children = parent.childNodes;\n  var sib;\n  var index = -1;\n\n  for (var i = 0; i < children.length; i++) {\n    sib = children[i];\n\n    if (sib.nodeType === typeId) {\n      index++;\n    }\n\n    if (sib == node) break;\n  }\n\n  return index;\n}\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\n\n\nfunction indexOfTextNode(textNode) {\n  return indexOfNode(textNode, TEXT_NODE);\n}\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\n\n\nfunction indexOfElementNode(elementNode) {\n  return indexOfNode(elementNode, ELEMENT_NODE);\n}\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\n\n\nfunction isXml(ext) {\n  return [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\n\n\nfunction createBlob(content, mime) {\n  return new Blob([content], {\n    type: mime\n  });\n}\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\n\n\nfunction createBlobUrl(content, mime) {\n  var tempUrl;\n  var blob = createBlob(content, mime);\n  tempUrl = _URL.createObjectURL(blob);\n  return tempUrl;\n}\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\n\n\nfunction revokeBlobUrl(url) {\n  return _URL.revokeObjectURL(url);\n}\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\n\n\nfunction createBase64Url(content, mime) {\n  var data;\n  var datauri;\n\n  if (typeof content !== \"string\") {\n    // Only handles strings\n    return;\n  }\n\n  data = btoa(encodeURIComponent(content));\n  datauri = \"data:\" + mime + \";base64,\" + data;\n  return datauri;\n}\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\n\n\nfunction type(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1);\n}\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\n\n\nfunction parse(markup, mime, forceXMLDom) {\n  var doc;\n  var Parser;\n\n  if (typeof DOMParser === \"undefined\" || forceXMLDom) {\n    Parser = _xmldom.DOMParser;\n  } else {\n    Parser = DOMParser;\n  } // Remove byte order mark before parsing\n  // https://www.w3.org/International/questions/qa-byte-order-mark\n\n\n  if (markup.charCodeAt(0) === 0xFEFF) {\n    markup = markup.slice(1);\n  }\n\n  doc = new Parser().parseFromString(markup, mime);\n  return doc;\n}\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\n\n\nfunction qs(el, sel) {\n  var elements;\n\n  if (!el) {\n    throw new Error(\"No Element Provided\");\n  }\n\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelector(sel);\n  } else {\n    elements = el.getElementsByTagName(sel);\n\n    if (elements.length) {\n      return elements[0];\n    }\n  }\n}\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction qsa(el, sel) {\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelectorAll(sel);\n  } else {\n    return el.getElementsByTagName(sel);\n  }\n}\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction qsp(el, sel, props) {\n  var q, filtered;\n\n  if (typeof el.querySelector != \"undefined\") {\n    sel += \"[\";\n\n    for (var prop in props) {\n      sel += prop + \"~='\" + props[prop] + \"'\";\n    }\n\n    sel += \"]\";\n    return el.querySelector(sel);\n  } else {\n    q = el.getElementsByTagName(sel);\n    filtered = Array.prototype.slice.call(q, 0).filter(function (el) {\n      for (var prop in props) {\n        if (el.getAttribute(prop) === props[prop]) {\n          return true;\n        }\n      }\n\n      return false;\n    });\n\n    if (filtered) {\n      return filtered[0];\n    }\n  }\n}\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\n\n\nfunction sprint(root, func) {\n  var doc = root.ownerDocument || root;\n\n  if (typeof doc.createTreeWalker !== \"undefined\") {\n    treeWalker(root, func, NodeFilter.SHOW_TEXT);\n  } else {\n    walk(root, function (node) {\n      if (node && node.nodeType === 3) {\n        // Node.TEXT_NODE\n        func(node);\n      }\n    }, true);\n  }\n}\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter funtion or object to filter with\n */\n\n\nfunction treeWalker(root, func, filter) {\n  var treeWalker = document.createTreeWalker(root, filter, null, false);\n  let node;\n\n  while (node = treeWalker.nextNode()) {\n    func(node);\n  }\n}\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\n\n\nfunction walk(node, callback) {\n  if (callback(node)) {\n    return true;\n  }\n\n  node = node.firstChild;\n\n  if (node) {\n    do {\n      let walked = walk(node, callback);\n\n      if (walked) {\n        return true;\n      }\n\n      node = node.nextSibling;\n    } while (node);\n  }\n}\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\n\n\nfunction blob2base64(blob) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.readAsDataURL(blob);\n\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n  });\n}\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\n\n\nfunction defer() {\n  /* A method to resolve the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} value : This value is used to resolve the promise\n   * If the value is a Promise then the associated promise assumes the state\n   * of Promise passed as value.\n   */\n  this.resolve = null;\n  /* A method to reject the assocaited Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} reason: The reason for the rejection of the Promise.\n   * Generally its an Error object. If however a Promise is passed, then the Promise\n   * itself will be the reason for rejection no matter the state of the Promise.\n   */\n\n  this.reject = null;\n  this.id = uuid();\n  /* A newly created Pomise object.\n   * Initially in pending state.\n   */\n\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n  Object.freeze(this);\n}\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\n\n\nfunction querySelectorByType(html, element, type) {\n  var query;\n\n  if (typeof html.querySelector != \"undefined\") {\n    query = html.querySelector(`${element}[*|type=\"${type}\"]`);\n  } // Handle IE not supporting namespaced epub:type in querySelector\n\n\n  if (!query || query.length === 0) {\n    query = qsa(html, element);\n\n    for (var i = 0; i < query.length; i++) {\n      if (query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type || query[i].getAttribute(\"epub:type\") === type) {\n        return query[i];\n      }\n    }\n  } else {\n    return query;\n  }\n}\n/**\n * Find direct decendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\n\n\nfunction findChildren(el) {\n  var result = [];\n  var childNodes = el.childNodes;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    let node = childNodes[i];\n\n    if (node.nodeType === 1) {\n      result.push(node);\n    }\n  }\n\n  return result;\n}\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\n\n\nfunction parents(node) {\n  var nodes = [node];\n\n  for (; node; node = node.parentNode) {\n    nodes.unshift(node);\n  }\n\n  return nodes;\n}\n/**\n * Find all direct decendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\n\n\nfunction filterChildren(el, nodeName, single) {\n  var result = [];\n  var childNodes = el.childNodes;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    let node = childNodes[i];\n\n    if (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n      if (single) {\n        return node;\n      } else {\n        result.push(node);\n      }\n    }\n  }\n\n  if (!single) {\n    return result;\n  }\n}\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\n\n\nfunction getParentByTagName(node, tagname) {\n  let parent;\n  if (node === null || tagname === '') return;\n  parent = node.parentNode;\n\n  while (parent.nodeType === 1) {\n    if (parent.tagName.toLowerCase() === tagname) {\n      return parent;\n    }\n\n    parent = parent.parentNode;\n  }\n}\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\n\n\nclass RangeObject {\n  constructor() {\n    this.collapsed = false;\n    this.commonAncestorContainer = undefined;\n    this.endContainer = undefined;\n    this.endOffset = undefined;\n    this.startContainer = undefined;\n    this.startOffset = undefined;\n  }\n\n  setStart(startNode, startOffset) {\n    this.startContainer = startNode;\n    this.startOffset = startOffset;\n\n    if (!this.endContainer) {\n      this.collapse(true);\n    } else {\n      this.commonAncestorContainer = this._commonAncestorContainer();\n    }\n\n    this._checkCollapsed();\n  }\n\n  setEnd(endNode, endOffset) {\n    this.endContainer = endNode;\n    this.endOffset = endOffset;\n\n    if (!this.startContainer) {\n      this.collapse(false);\n    } else {\n      this.collapsed = false;\n      this.commonAncestorContainer = this._commonAncestorContainer();\n    }\n\n    this._checkCollapsed();\n  }\n\n  collapse(toStart) {\n    this.collapsed = true;\n\n    if (toStart) {\n      this.endContainer = this.startContainer;\n      this.endOffset = this.startOffset;\n      this.commonAncestorContainer = this.startContainer.parentNode;\n    } else {\n      this.startContainer = this.endContainer;\n      this.startOffset = this.endOffset;\n      this.commonAncestorContainer = this.endOffset.parentNode;\n    }\n  }\n\n  selectNode(referenceNode) {\n    let parent = referenceNode.parentNode;\n    let index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n    this.setStart(parent, index);\n    this.setEnd(parent, index + 1);\n  }\n\n  selectNodeContents(referenceNode) {\n    let end = referenceNode.childNodes[referenceNode.childNodes - 1];\n    let endIndex = referenceNode.nodeType === 3 ? referenceNode.textContent.length : parent.childNodes.length;\n    this.setStart(referenceNode, 0);\n    this.setEnd(referenceNode, endIndex);\n  }\n\n  _commonAncestorContainer(startContainer, endContainer) {\n    var startParents = parents(startContainer || this.startContainer);\n    var endParents = parents(endContainer || this.endContainer);\n    if (startParents[0] != endParents[0]) return undefined;\n\n    for (var i = 0; i < startParents.length; i++) {\n      if (startParents[i] != endParents[i]) {\n        return startParents[i - 1];\n      }\n    }\n  }\n\n  _checkCollapsed() {\n    if (this.startContainer === this.endContainer && this.startOffset === this.endOffset) {\n      this.collapsed = true;\n    } else {\n      this.collapsed = false;\n    }\n  }\n\n  toString() {// TODO: implement walking between start and end to find text\n  }\n\n}\n\nexports.RangeObject = RangeObject;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\n/**\n\t* Parsing and creation of EpubCFIs: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\n\n\t* Implements:\n\t* - Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\n\t* - Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\n\n\t* Does Not Implement:\n\t* - Temporal Offset (~)\n\t* - Spatial Offset (@)\n\t* - Temporal-Spatial Offset (~ + @)\n\t* - Text Location Assertion ([)\n\t* @class\n\t@param {string | Range | Node } [cfiFrom]\n\t@param {string | object} [base]\n\t@param {string} [ignoreClass] class to ignore when parsing DOM\n*/\n\nclass EpubCFI {\n  constructor(cfiFrom, base, ignoreClass) {\n    var type;\n    this.str = \"\";\n    this.base = {};\n    this.spinePos = 0; // For compatibility\n\n    this.range = false; // true || false;\n\n    this.path = {};\n    this.start = null;\n    this.end = null; // Allow instantiation without the \"new\" keyword\n\n    if (!(this instanceof EpubCFI)) {\n      return new EpubCFI(cfiFrom, base, ignoreClass);\n    }\n\n    if (typeof base === \"string\") {\n      this.base = this.parseComponent(base);\n    } else if (typeof base === \"object\" && base.steps) {\n      this.base = base;\n    }\n\n    type = this.checkType(cfiFrom);\n\n    if (type === \"string\") {\n      this.str = cfiFrom;\n      return (0, _core.extend)(this, this.parse(cfiFrom));\n    } else if (type === \"range\") {\n      return (0, _core.extend)(this, this.fromRange(cfiFrom, this.base, ignoreClass));\n    } else if (type === \"node\") {\n      return (0, _core.extend)(this, this.fromNode(cfiFrom, this.base, ignoreClass));\n    } else if (type === \"EpubCFI\" && cfiFrom.path) {\n      return cfiFrom;\n    } else if (!cfiFrom) {\n      return this;\n    } else {\n      throw new TypeError(\"not a valid argument for EpubCFI\");\n    }\n  }\n  /**\n   * Check the type of constructor input\n   * @private\n   */\n\n\n  checkType(cfi) {\n    if (this.isCfiString(cfi)) {\n      return \"string\"; // Is a range object\n    } else if (cfi && typeof cfi === \"object\" && ((0, _core.type)(cfi) === \"Range\" || typeof cfi.startContainer != \"undefined\")) {\n      return \"range\";\n    } else if (cfi && typeof cfi === \"object\" && typeof cfi.nodeType != \"undefined\") {\n      // || typeof cfi === \"function\"\n      return \"node\";\n    } else if (cfi && typeof cfi === \"object\" && cfi instanceof EpubCFI) {\n      return \"EpubCFI\";\n    } else {\n      return false;\n    }\n  }\n  /**\n   * Parse a cfi string to a CFI object representation\n   * @param {string} cfiStr\n   * @returns {object} cfi\n   */\n\n\n  parse(cfiStr) {\n    var cfi = {\n      spinePos: -1,\n      range: false,\n      base: {},\n      path: {},\n      start: null,\n      end: null\n    };\n    var baseComponent, pathComponent, range;\n\n    if (typeof cfiStr !== \"string\") {\n      return {\n        spinePos: -1\n      };\n    }\n\n    if (cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length - 1] === \")\") {\n      // Remove intial epubcfi( and ending )\n      cfiStr = cfiStr.slice(8, cfiStr.length - 1);\n    }\n\n    baseComponent = this.getChapterComponent(cfiStr); // Make sure this is a valid cfi or return\n\n    if (!baseComponent) {\n      return {\n        spinePos: -1\n      };\n    }\n\n    cfi.base = this.parseComponent(baseComponent);\n    pathComponent = this.getPathComponent(cfiStr);\n    cfi.path = this.parseComponent(pathComponent);\n    range = this.getRange(cfiStr);\n\n    if (range) {\n      cfi.range = true;\n      cfi.start = this.parseComponent(range[0]);\n      cfi.end = this.parseComponent(range[1]);\n    } // Get spine node position\n    // cfi.spineSegment = cfi.base.steps[1];\n    // Chapter segment is always the second step\n\n\n    cfi.spinePos = cfi.base.steps[1].index;\n    return cfi;\n  }\n\n  parseComponent(componentStr) {\n    var component = {\n      steps: [],\n      terminal: {\n        offset: null,\n        assertion: null\n      }\n    };\n    var parts = componentStr.split(\":\");\n    var steps = parts[0].split(\"/\");\n    var terminal;\n\n    if (parts.length > 1) {\n      terminal = parts[1];\n      component.terminal = this.parseTerminal(terminal);\n    }\n\n    if (steps[0] === \"\") {\n      steps.shift(); // Ignore the first slash\n    }\n\n    component.steps = steps.map(function (step) {\n      return this.parseStep(step);\n    }.bind(this));\n    return component;\n  }\n\n  parseStep(stepStr) {\n    var type, num, index, has_brackets, id;\n    has_brackets = stepStr.match(/\\[(.*)\\]/);\n\n    if (has_brackets && has_brackets[1]) {\n      id = has_brackets[1];\n    } //-- Check if step is a text node or element\n\n\n    num = parseInt(stepStr);\n\n    if (isNaN(num)) {\n      return;\n    }\n\n    if (num % 2 === 0) {\n      // Even = is an element\n      type = \"element\";\n      index = num / 2 - 1;\n    } else {\n      type = \"text\";\n      index = (num - 1) / 2;\n    }\n\n    return {\n      \"type\": type,\n      \"index\": index,\n      \"id\": id || null\n    };\n  }\n\n  parseTerminal(termialStr) {\n    var characterOffset, textLocationAssertion;\n    var assertion = termialStr.match(/\\[(.*)\\]/);\n\n    if (assertion && assertion[1]) {\n      characterOffset = parseInt(termialStr.split(\"[\")[0]);\n      textLocationAssertion = assertion[1];\n    } else {\n      characterOffset = parseInt(termialStr);\n    }\n\n    if (!(0, _core.isNumber)(characterOffset)) {\n      characterOffset = null;\n    }\n\n    return {\n      \"offset\": characterOffset,\n      \"assertion\": textLocationAssertion\n    };\n  }\n\n  getChapterComponent(cfiStr) {\n    var indirection = cfiStr.split(\"!\");\n    return indirection[0];\n  }\n\n  getPathComponent(cfiStr) {\n    var indirection = cfiStr.split(\"!\");\n\n    if (indirection[1]) {\n      let ranges = indirection[1].split(\",\");\n      return ranges[0];\n    }\n  }\n\n  getRange(cfiStr) {\n    var ranges = cfiStr.split(\",\");\n\n    if (ranges.length === 3) {\n      return [ranges[1], ranges[2]];\n    }\n\n    return false;\n  }\n\n  getCharecterOffsetComponent(cfiStr) {\n    var splitStr = cfiStr.split(\":\");\n    return splitStr[1] || \"\";\n  }\n\n  joinSteps(steps) {\n    if (!steps) {\n      return \"\";\n    }\n\n    return steps.map(function (part) {\n      var segment = \"\";\n\n      if (part.type === \"element\") {\n        segment += (part.index + 1) * 2;\n      }\n\n      if (part.type === \"text\") {\n        segment += 1 + 2 * part.index; // TODO: double check that this is odd\n      }\n\n      if (part.id) {\n        segment += \"[\" + part.id + \"]\";\n      }\n\n      return segment;\n    }).join(\"/\");\n  }\n\n  segmentString(segment) {\n    var segmentString = \"/\";\n    segmentString += this.joinSteps(segment.steps);\n\n    if (segment.terminal && segment.terminal.offset != null) {\n      segmentString += \":\" + segment.terminal.offset;\n    }\n\n    if (segment.terminal && segment.terminal.assertion != null) {\n      segmentString += \"[\" + segment.terminal.assertion + \"]\";\n    }\n\n    return segmentString;\n  }\n  /**\n   * Convert CFI to a epubcfi(...) string\n   * @returns {string} epubcfi\n   */\n\n\n  toString() {\n    var cfiString = \"epubcfi(\";\n    cfiString += this.segmentString(this.base);\n    cfiString += \"!\";\n    cfiString += this.segmentString(this.path); // Add Range, if present\n\n    if (this.range && this.start) {\n      cfiString += \",\";\n      cfiString += this.segmentString(this.start);\n    }\n\n    if (this.range && this.end) {\n      cfiString += \",\";\n      cfiString += this.segmentString(this.end);\n    }\n\n    cfiString += \")\";\n    return cfiString;\n  }\n  /**\n   * Compare which of two CFIs is earlier in the text\n   * @returns {number} First is earlier = -1, Second is earlier = 1, They are equal = 0\n   */\n\n\n  compare(cfiOne, cfiTwo) {\n    var stepsA, stepsB;\n    var terminalA, terminalB;\n    var rangeAStartSteps, rangeAEndSteps;\n    var rangeBEndSteps, rangeBEndSteps;\n    var rangeAStartTerminal, rangeAEndTerminal;\n    var rangeBStartTerminal, rangeBEndTerminal;\n\n    if (typeof cfiOne === \"string\") {\n      cfiOne = new EpubCFI(cfiOne);\n    }\n\n    if (typeof cfiTwo === \"string\") {\n      cfiTwo = new EpubCFI(cfiTwo);\n    } // Compare Spine Positions\n\n\n    if (cfiOne.spinePos > cfiTwo.spinePos) {\n      return 1;\n    }\n\n    if (cfiOne.spinePos < cfiTwo.spinePos) {\n      return -1;\n    }\n\n    if (cfiOne.range) {\n      stepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\n      terminalA = cfiOne.start.terminal;\n    } else {\n      stepsA = cfiOne.path.steps;\n      terminalA = cfiOne.path.terminal;\n    }\n\n    if (cfiTwo.range) {\n      stepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\n      terminalB = cfiTwo.start.terminal;\n    } else {\n      stepsB = cfiTwo.path.steps;\n      terminalB = cfiTwo.path.terminal;\n    } // Compare Each Step in the First item\n\n\n    for (var i = 0; i < stepsA.length; i++) {\n      if (!stepsA[i]) {\n        return -1;\n      }\n\n      if (!stepsB[i]) {\n        return 1;\n      }\n\n      if (stepsA[i].index > stepsB[i].index) {\n        return 1;\n      }\n\n      if (stepsA[i].index < stepsB[i].index) {\n        return -1;\n      } // Otherwise continue checking\n\n    } // All steps in First equal to Second and First is Less Specific\n\n\n    if (stepsA.length < stepsB.length) {\n      return -1;\n    } // Compare the charecter offset of the text node\n\n\n    if (terminalA.offset > terminalB.offset) {\n      return 1;\n    }\n\n    if (terminalA.offset < terminalB.offset) {\n      return -1;\n    } // CFI's are equal\n\n\n    return 0;\n  }\n\n  step(node) {\n    var nodeType = node.nodeType === TEXT_NODE ? \"text\" : \"element\";\n    return {\n      \"id\": node.id,\n      \"tagName\": node.tagName,\n      \"type\": nodeType,\n      \"index\": this.position(node)\n    };\n  }\n\n  filteredStep(node, ignoreClass) {\n    var filteredNode = this.filter(node, ignoreClass);\n    var nodeType; // Node filtered, so ignore\n\n    if (!filteredNode) {\n      return;\n    } // Otherwise add the filter node in\n\n\n    nodeType = filteredNode.nodeType === TEXT_NODE ? \"text\" : \"element\";\n    return {\n      \"id\": filteredNode.id,\n      \"tagName\": filteredNode.tagName,\n      \"type\": nodeType,\n      \"index\": this.filteredPosition(filteredNode, ignoreClass)\n    };\n  }\n\n  pathTo(node, offset, ignoreClass) {\n    var segment = {\n      steps: [],\n      terminal: {\n        offset: null,\n        assertion: null\n      }\n    };\n    var currentNode = node;\n    var step;\n\n    while (currentNode && currentNode.parentNode && currentNode.parentNode.nodeType != DOCUMENT_NODE) {\n      if (ignoreClass) {\n        step = this.filteredStep(currentNode, ignoreClass);\n      } else {\n        step = this.step(currentNode);\n      }\n\n      if (step) {\n        segment.steps.unshift(step);\n      }\n\n      currentNode = currentNode.parentNode;\n    }\n\n    if (offset != null && offset >= 0) {\n      segment.terminal.offset = offset; // Make sure we are getting to a textNode if there is an offset\n\n      if (segment.steps[segment.steps.length - 1].type != \"text\") {\n        segment.steps.push({\n          \"type\": \"text\",\n          \"index\": 0\n        });\n      }\n    }\n\n    return segment;\n  }\n\n  equalStep(stepA, stepB) {\n    if (!stepA || !stepB) {\n      return false;\n    }\n\n    if (stepA.index === stepB.index && stepA.id === stepB.id && stepA.type === stepB.type) {\n      return true;\n    }\n\n    return false;\n  }\n  /**\n   * Create a CFI object from a Range\n   * @param {Range} range\n   * @param {string | object} base\n   * @param {string} [ignoreClass]\n   * @returns {object} cfi\n   */\n\n\n  fromRange(range, base, ignoreClass) {\n    var cfi = {\n      range: false,\n      base: {},\n      path: {},\n      start: null,\n      end: null\n    };\n    var start = range.startContainer;\n    var end = range.endContainer;\n    var startOffset = range.startOffset;\n    var endOffset = range.endOffset;\n    var needsIgnoring = false;\n\n    if (ignoreClass) {\n      // Tell pathTo if / what to ignore\n      needsIgnoring = start.ownerDocument.querySelector(\".\" + ignoreClass) != null;\n    }\n\n    if (typeof base === \"string\") {\n      cfi.base = this.parseComponent(base);\n      cfi.spinePos = cfi.base.steps[1].index;\n    } else if (typeof base === \"object\") {\n      cfi.base = base;\n    }\n\n    if (range.collapsed) {\n      if (needsIgnoring) {\n        startOffset = this.patchOffset(start, startOffset, ignoreClass);\n      }\n\n      cfi.path = this.pathTo(start, startOffset, ignoreClass);\n    } else {\n      cfi.range = true;\n\n      if (needsIgnoring) {\n        startOffset = this.patchOffset(start, startOffset, ignoreClass);\n      }\n\n      cfi.start = this.pathTo(start, startOffset, ignoreClass);\n\n      if (needsIgnoring) {\n        endOffset = this.patchOffset(end, endOffset, ignoreClass);\n      }\n\n      cfi.end = this.pathTo(end, endOffset, ignoreClass); // Create a new empty path\n\n      cfi.path = {\n        steps: [],\n        terminal: null\n      }; // Push steps that are shared between start and end to the common path\n\n      var len = cfi.start.steps.length;\n      var i;\n\n      for (i = 0; i < len; i++) {\n        if (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\n          if (i === len - 1) {\n            // Last step is equal, check terminals\n            if (cfi.start.terminal === cfi.end.terminal) {\n              // CFI's are equal\n              cfi.path.steps.push(cfi.start.steps[i]); // Not a range\n\n              cfi.range = false;\n            }\n          } else {\n            cfi.path.steps.push(cfi.start.steps[i]);\n          }\n        } else {\n          break;\n        }\n      }\n\n      cfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\n      cfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length); // TODO: Add Sanity check to make sure that the end if greater than the start\n    }\n\n    return cfi;\n  }\n  /**\n   * Create a CFI object from a Node\n   * @param {Node} anchor\n   * @param {string | object} base\n   * @param {string} [ignoreClass]\n   * @returns {object} cfi\n   */\n\n\n  fromNode(anchor, base, ignoreClass) {\n    var cfi = {\n      range: false,\n      base: {},\n      path: {},\n      start: null,\n      end: null\n    };\n\n    if (typeof base === \"string\") {\n      cfi.base = this.parseComponent(base);\n      cfi.spinePos = cfi.base.steps[1].index;\n    } else if (typeof base === \"object\") {\n      cfi.base = base;\n    }\n\n    cfi.path = this.pathTo(anchor, null, ignoreClass);\n    return cfi;\n  }\n\n  filter(anchor, ignoreClass) {\n    var needsIgnoring;\n    var sibling; // to join with\n\n    var parent, previousSibling, nextSibling;\n    var isText = false;\n\n    if (anchor.nodeType === TEXT_NODE) {\n      isText = true;\n      parent = anchor.parentNode;\n      needsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\n    } else {\n      isText = false;\n      needsIgnoring = anchor.classList.contains(ignoreClass);\n    }\n\n    if (needsIgnoring && isText) {\n      previousSibling = parent.previousSibling;\n      nextSibling = parent.nextSibling; // If the sibling is a text node, join the nodes\n\n      if (previousSibling && previousSibling.nodeType === TEXT_NODE) {\n        sibling = previousSibling;\n      } else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\n        sibling = nextSibling;\n      }\n\n      if (sibling) {\n        return sibling;\n      } else {\n        // Parent will be ignored on next step\n        return anchor;\n      }\n    } else if (needsIgnoring && !isText) {\n      // Otherwise just skip the element node\n      return false;\n    } else {\n      // No need to filter\n      return anchor;\n    }\n  }\n\n  patchOffset(anchor, offset, ignoreClass) {\n    if (anchor.nodeType != TEXT_NODE) {\n      throw new Error(\"Anchor must be a text node\");\n    }\n\n    var curr = anchor;\n    var totalOffset = offset; // If the parent is a ignored node, get offset from it's start\n\n    if (anchor.parentNode.classList.contains(ignoreClass)) {\n      curr = anchor.parentNode;\n    }\n\n    while (curr.previousSibling) {\n      if (curr.previousSibling.nodeType === ELEMENT_NODE) {\n        // Originally a text node, so join\n        if (curr.previousSibling.classList.contains(ignoreClass)) {\n          totalOffset += curr.previousSibling.textContent.length;\n        } else {\n          break; // Normal node, dont join\n        }\n      } else {\n        // If the previous sibling is a text node, join the nodes\n        totalOffset += curr.previousSibling.textContent.length;\n      }\n\n      curr = curr.previousSibling;\n    }\n\n    return totalOffset;\n  }\n\n  normalizedMap(children, nodeType, ignoreClass) {\n    var output = {};\n    var prevIndex = -1;\n    var i,\n        len = children.length;\n    var currNodeType;\n    var prevNodeType;\n\n    for (i = 0; i < len; i++) {\n      currNodeType = children[i].nodeType; // Check if needs ignoring\n\n      if (currNodeType === ELEMENT_NODE && children[i].classList.contains(ignoreClass)) {\n        currNodeType = TEXT_NODE;\n      }\n\n      if (i > 0 && currNodeType === TEXT_NODE && prevNodeType === TEXT_NODE) {\n        // join text nodes\n        output[i] = prevIndex;\n      } else if (nodeType === currNodeType) {\n        prevIndex = prevIndex + 1;\n        output[i] = prevIndex;\n      }\n\n      prevNodeType = currNodeType;\n    }\n\n    return output;\n  }\n\n  position(anchor) {\n    var children, index;\n\n    if (anchor.nodeType === ELEMENT_NODE) {\n      children = anchor.parentNode.children;\n\n      if (!children) {\n        children = (0, _core.findChildren)(anchor.parentNode);\n      }\n\n      index = Array.prototype.indexOf.call(children, anchor);\n    } else {\n      children = this.textNodes(anchor.parentNode);\n      index = children.indexOf(anchor);\n    }\n\n    return index;\n  }\n\n  filteredPosition(anchor, ignoreClass) {\n    var children, index, map;\n\n    if (anchor.nodeType === ELEMENT_NODE) {\n      children = anchor.parentNode.children;\n      map = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\n    } else {\n      children = anchor.parentNode.childNodes; // Inside an ignored node\n\n      if (anchor.parentNode.classList.contains(ignoreClass)) {\n        anchor = anchor.parentNode;\n        children = anchor.parentNode.childNodes;\n      }\n\n      map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n    }\n\n    index = Array.prototype.indexOf.call(children, anchor);\n    return map[index];\n  }\n\n  stepsToXpath(steps) {\n    var xpath = [\".\", \"*\"];\n    steps.forEach(function (step) {\n      var position = step.index + 1;\n\n      if (step.id) {\n        xpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\n      } else if (step.type === \"text\") {\n        xpath.push(\"text()[\" + position + \"]\");\n      } else {\n        xpath.push(\"*[\" + position + \"]\");\n      }\n    });\n    return xpath.join(\"/\");\n  }\n  /*\n  \tTo get the last step if needed:\n  \t// Get the terminal step\n  lastStep = steps[steps.length-1];\n  // Get the query string\n  query = this.stepsToQuery(steps);\n  // Find the containing element\n  startContainerParent = doc.querySelector(query);\n  // Find the text node within that element\n  if(startContainerParent && lastStep.type == \"text\") {\n  \tcontainer = startContainerParent.childNodes[lastStep.index];\n  }\n  */\n\n\n  stepsToQuerySelector(steps) {\n    var query = [\"html\"];\n    steps.forEach(function (step) {\n      var position = step.index + 1;\n\n      if (step.id) {\n        query.push(\"#\" + step.id);\n      } else if (step.type === \"text\") {// unsupported in querySelector\n        // query.push(\"text()[\" + position + \"]\");\n      } else {\n        query.push(\"*:nth-child(\" + position + \")\");\n      }\n    });\n    return query.join(\">\");\n  }\n\n  textNodes(container, ignoreClass) {\n    return Array.prototype.slice.call(container.childNodes).filter(function (node) {\n      if (node.nodeType === TEXT_NODE) {\n        return true;\n      } else if (ignoreClass && node.classList.contains(ignoreClass)) {\n        return true;\n      }\n\n      return false;\n    });\n  }\n\n  walkToNode(steps, _doc, ignoreClass) {\n    var doc = _doc || document;\n    var container = doc.documentElement;\n    var children;\n    var step;\n    var len = steps.length;\n    var i;\n\n    for (i = 0; i < len; i++) {\n      step = steps[i];\n\n      if (step.type === \"element\") {\n        //better to get a container using id as some times step.index may not be correct\n        //For ex.https://github.com/futurepress/epub.js/issues/561\n        if (step.id) {\n          container = doc.getElementById(step.id);\n        } else {\n          children = container.children || (0, _core.findChildren)(container);\n          container = children[step.index];\n        }\n      } else if (step.type === \"text\") {\n        container = this.textNodes(container, ignoreClass)[step.index];\n      }\n\n      if (!container) {\n        //Break the for loop as due to incorrect index we can get error if\n        //container is undefined so that other functionailties works fine\n        //like navigation\n        break;\n      }\n    }\n\n    return container;\n  }\n\n  findNode(steps, _doc, ignoreClass) {\n    var doc = _doc || document;\n    var container;\n    var xpath;\n\n    if (!ignoreClass && typeof doc.evaluate != \"undefined\") {\n      xpath = this.stepsToXpath(steps);\n      container = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n    } else if (ignoreClass) {\n      container = this.walkToNode(steps, doc, ignoreClass);\n    } else {\n      container = this.walkToNode(steps, doc);\n    }\n\n    return container;\n  }\n\n  fixMiss(steps, offset, _doc, ignoreClass) {\n    var container = this.findNode(steps.slice(0, -1), _doc, ignoreClass);\n    var children = container.childNodes;\n    var map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\n    var child;\n    var len;\n    var lastStepIndex = steps[steps.length - 1].index;\n\n    for (let childIndex in map) {\n      if (!map.hasOwnProperty(childIndex)) return;\n\n      if (map[childIndex] === lastStepIndex) {\n        child = children[childIndex];\n        len = child.textContent.length;\n\n        if (offset > len) {\n          offset = offset - len;\n        } else {\n          if (child.nodeType === ELEMENT_NODE) {\n            container = child.childNodes[0];\n          } else {\n            container = child;\n          }\n\n          break;\n        }\n      }\n    }\n\n    return {\n      container: container,\n      offset: offset\n    };\n  }\n  /**\n   * Creates a DOM range representing a CFI\n   * @param {document} _doc document referenced in the base\n   * @param {string} [ignoreClass]\n   * @return {Range}\n   */\n\n\n  toRange(_doc, ignoreClass) {\n    var doc = _doc || document;\n    var range;\n    var start, end, startContainer, endContainer;\n    var cfi = this;\n    var startSteps, endSteps;\n    var needsIgnoring = ignoreClass ? doc.querySelector(\".\" + ignoreClass) != null : false;\n    var missed;\n\n    if (typeof doc.createRange !== \"undefined\") {\n      range = doc.createRange();\n    } else {\n      range = new _core.RangeObject();\n    }\n\n    if (cfi.range) {\n      start = cfi.start;\n      startSteps = cfi.path.steps.concat(start.steps);\n      startContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\n      end = cfi.end;\n      endSteps = cfi.path.steps.concat(end.steps);\n      endContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\n    } else {\n      start = cfi.path;\n      startSteps = cfi.path.steps;\n      startContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\n    }\n\n    if (startContainer) {\n      try {\n        if (start.terminal.offset != null) {\n          range.setStart(startContainer, start.terminal.offset);\n        } else {\n          range.setStart(startContainer, 0);\n        }\n      } catch (e) {\n        missed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n        range.setStart(missed.container, missed.offset);\n      }\n    } else {\n      console.log(\"No startContainer found for\", this.toString()); // No start found\n\n      return null;\n    }\n\n    if (endContainer) {\n      try {\n        if (end.terminal.offset != null) {\n          range.setEnd(endContainer, end.terminal.offset);\n        } else {\n          range.setEnd(endContainer, 0);\n        }\n      } catch (e) {\n        missed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\n        range.setEnd(missed.container, missed.offset);\n      }\n    } // doc.defaultView.getSelection().addRange(range);\n\n\n    return range;\n  }\n  /**\n   * Check if a string is wrapped with \"epubcfi()\"\n   * @param {string} str\n   * @returns {boolean}\n   */\n\n\n  isCfiString(str) {\n    if (typeof str === \"string\" && str.indexOf(\"epubcfi(\") === 0 && str[str.length - 1] === \")\") {\n      return true;\n    }\n\n    return false;\n  }\n\n  generateChapterComponent(_spineNodeIndex, _pos, id) {\n    var pos = parseInt(_pos),\n        spineNodeIndex = (_spineNodeIndex + 1) * 2,\n        cfi = \"/\" + spineNodeIndex + \"/\";\n    cfi += (pos + 1) * 2;\n\n    if (id) {\n      cfi += \"[\" + id + \"]\";\n    }\n\n    return cfi;\n  }\n  /**\n   * Collapse a CFI Range to a single CFI Position\n   * @param {boolean} [toStart=false]\n   */\n\n\n  collapse(toStart) {\n    if (!this.range) {\n      return;\n    }\n\n    this.range = false;\n\n    if (toStart) {\n      this.path.steps = this.path.steps.concat(this.start.steps);\n      this.path.terminal = this.start.terminal;\n    } else {\n      this.path.steps = this.path.steps.concat(this.end.steps);\n      this.path.terminal = this.end.terminal;\n    }\n  }\n\n}\n\nvar _default = EpubCFI;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EVENTS = exports.EPUBJS_VERSION = exports.DOM_EVENTS = void 0;\nconst EPUBJS_VERSION = \"0.3\"; // Dom events to listen for\n\nexports.EPUBJS_VERSION = EPUBJS_VERSION;\nconst DOM_EVENTS = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"mousemove\", \"click\", \"touchend\", \"touchstart\", \"touchmove\"];\nexports.DOM_EVENTS = DOM_EVENTS;\nconst EVENTS = {\n  BOOK: {\n    OPEN_FAILED: \"openFailed\"\n  },\n  CONTENTS: {\n    EXPAND: \"expand\",\n    RESIZE: \"resize\",\n    SELECTED: \"selected\",\n    SELECTED_RANGE: \"selectedRange\",\n    LINK_CLICKED: \"linkClicked\"\n  },\n  LOCATIONS: {\n    CHANGED: \"changed\"\n  },\n  MANAGERS: {\n    RESIZE: \"resize\",\n    RESIZED: \"resized\",\n    ORIENTATION_CHANGE: \"orientationchange\",\n    ADDED: \"added\",\n    SCROLL: \"scroll\",\n    SCROLLED: \"scrolled\",\n    REMOVED: \"removed\"\n  },\n  VIEWS: {\n    AXIS: \"axis\",\n    WRITING_MODE: \"writingMode\",\n    LOAD_ERROR: \"loaderror\",\n    RENDERED: \"rendered\",\n    RESIZED: \"resized\",\n    DISPLAYED: \"displayed\",\n    SHOWN: \"shown\",\n    HIDDEN: \"hidden\",\n    MARK_CLICKED: \"markClicked\"\n  },\n  RENDITION: {\n    STARTED: \"started\",\n    ATTACHED: \"attached\",\n    DISPLAYED: \"displayed\",\n    DISPLAY_ERROR: \"displayerror\",\n    RENDERED: \"rendered\",\n    REMOVED: \"removed\",\n    RESIZED: \"resized\",\n    ORIENTATION_CHANGE: \"orientationchange\",\n    LOCATION_CHANGED: \"locationChanged\",\n    RELOCATED: \"relocated\",\n    MARK_CLICKED: \"markClicked\",\n    SELECTED: \"selected\",\n    LAYOUT: \"layout\"\n  },\n  LAYOUT: {\n    UPDATED: \"updated\"\n  },\n  ANNOTATION: {\n    ATTACH: \"attach\",\n    DETACH: \"detach\"\n  }\n};\nexports.EVENTS = EVENTS;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _pathWebpack = _interopRequireDefault(require(\"path-webpack\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Creates a Path object for parsing and manipulation of a path strings\n *\n * Uses a polyfill for Nodejs path: https://nodejs.org/api/path.html\n * @param\t{string} pathString\ta url string (relative or absolute)\n * @class\n */\nclass Path {\n  constructor(pathString) {\n    var protocol;\n    var parsed;\n    protocol = pathString.indexOf(\"://\");\n\n    if (protocol > -1) {\n      pathString = new URL(pathString).pathname;\n    }\n\n    parsed = this.parse(pathString);\n    this.path = pathString;\n\n    if (this.isDirectory(pathString)) {\n      this.directory = pathString;\n    } else {\n      this.directory = parsed.dir + \"/\";\n    }\n\n    this.filename = parsed.base;\n    this.extension = parsed.ext.slice(1);\n  }\n  /**\n   * Parse the path: https://nodejs.org/api/path.html#path_path_parse_path\n   * @param\t{string} what\n   * @returns {object}\n   */\n\n\n  parse(what) {\n    return _pathWebpack.default.parse(what);\n  }\n  /**\n   * @param\t{string} what\n   * @returns {boolean}\n   */\n\n\n  isAbsolute(what) {\n    return _pathWebpack.default.isAbsolute(what || this.path);\n  }\n  /**\n   * Check if path ends with a directory\n   * @param\t{string} what\n   * @returns {boolean}\n   */\n\n\n  isDirectory(what) {\n    return what.charAt(what.length - 1) === \"/\";\n  }\n  /**\n   * Resolve a path against the directory of the Path\n   *\n   * https://nodejs.org/api/path.html#path_path_resolve_paths\n   * @param\t{string} what\n   * @returns {string} resolved\n   */\n\n\n  resolve(what) {\n    return _pathWebpack.default.resolve(this.directory, what);\n  }\n  /**\n   * Resolve a path relative to the directory of the Path\n   *\n   * https://nodejs.org/api/path.html#path_path_relative_from_to\n   * @param\t{string} what\n   * @returns {string} relative\n   */\n\n\n  relative(what) {\n    var isAbsolute = what && what.indexOf(\"://\") > -1;\n\n    if (isAbsolute) {\n      return what;\n    }\n\n    return _pathWebpack.default.relative(this.directory, what);\n  }\n\n  splitPath(filename) {\n    return this.splitPathRe.exec(filename).slice(1);\n  }\n  /**\n   * Return the path string\n   * @returns {string} path\n   */\n\n\n  toString() {\n    return this.path;\n  }\n\n}\n\nvar _default = Path;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _path = _interopRequireDefault(require(\"./path\"));\n\nvar _pathWebpack = _interopRequireDefault(require(\"path-webpack\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * creates a Url object for parsing and manipulation of a url string\n * @param\t{string} urlString\ta url string (relative or absolute)\n * @param\t{string} [baseString] optional base for the url,\n * default to window.location.href\n */\nclass Url {\n  constructor(urlString, baseString) {\n    var absolute = urlString.indexOf(\"://\") > -1;\n    var pathname = urlString;\n    var basePath;\n    this.Url = undefined;\n    this.href = urlString;\n    this.protocol = \"\";\n    this.origin = \"\";\n    this.hash = \"\";\n    this.hash = \"\";\n    this.search = \"\";\n    this.base = baseString;\n\n    if (!absolute && baseString !== false && typeof baseString !== \"string\" && window && window.location) {\n      this.base = window.location.href;\n    } // URL Polyfill doesn't throw an error if base is empty\n\n\n    if (absolute || this.base) {\n      try {\n        if (this.base) {\n          // Safari doesn't like an undefined base\n          this.Url = new URL(urlString, this.base);\n        } else {\n          this.Url = new URL(urlString);\n        }\n\n        this.href = this.Url.href;\n        this.protocol = this.Url.protocol;\n        this.origin = this.Url.origin;\n        this.hash = this.Url.hash;\n        this.search = this.Url.search;\n        pathname = this.Url.pathname + (this.Url.search ? this.Url.search : '');\n      } catch (e) {\n        // Skip URL parsing\n        this.Url = undefined; // resolve the pathname from the base\n\n        if (this.base) {\n          basePath = new _path.default(this.base);\n          pathname = basePath.resolve(pathname);\n        }\n      }\n    }\n\n    this.Path = new _path.default(pathname);\n    this.directory = this.Path.directory;\n    this.filename = this.Path.filename;\n    this.extension = this.Path.extension;\n  }\n  /**\n   * @returns {Path}\n   */\n\n\n  path() {\n    return this.Path;\n  }\n  /**\n   * Resolves a relative path to a absolute url\n   * @param {string} what\n   * @returns {string} url\n   */\n\n\n  resolve(what) {\n    var isAbsolute = what.indexOf(\"://\") > -1;\n    var fullpath;\n\n    if (isAbsolute) {\n      return what;\n    }\n\n    fullpath = _pathWebpack.default.resolve(this.directory, what);\n    return this.origin + fullpath;\n  }\n  /**\n   * Resolve a path relative to the url\n   * @param {string} what\n   * @returns {string} path\n   */\n\n\n  relative(what) {\n    return _pathWebpack.default.relative(what, this.directory);\n  }\n  /**\n   * @returns {string}\n   */\n\n\n  toString() {\n    return this.href;\n  }\n\n}\n\nvar _default = Url;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.replaceBase = replaceBase;\nexports.replaceCanonical = replaceCanonical;\nexports.replaceLinks = replaceLinks;\nexports.replaceMeta = replaceMeta;\nexports.substitute = substitute;\n\nvar _core = require(\"./core\");\n\nvar _url = _interopRequireDefault(require(\"./url\"));\n\nvar _path = _interopRequireDefault(require(\"./path\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction replaceBase(doc, section) {\n  var base;\n  var head;\n  var url = section.url;\n  var absolute = url.indexOf(\"://\") > -1;\n\n  if (!doc) {\n    return;\n  }\n\n  head = (0, _core.qs)(doc, \"head\");\n  base = (0, _core.qs)(head, \"base\");\n\n  if (!base) {\n    base = doc.createElement(\"base\");\n    head.insertBefore(base, head.firstChild);\n  } // Fix for Safari crashing if the url doesn't have an origin\n\n\n  if (!absolute && window && window.location) {\n    url = window.location.origin + url;\n  }\n\n  base.setAttribute(\"href\", url);\n}\n\nfunction replaceCanonical(doc, section) {\n  var head;\n  var link;\n  var url = section.canonical;\n\n  if (!doc) {\n    return;\n  }\n\n  head = (0, _core.qs)(doc, \"head\");\n  link = (0, _core.qs)(head, \"link[rel='canonical']\");\n\n  if (link) {\n    link.setAttribute(\"href\", url);\n  } else {\n    link = doc.createElement(\"link\");\n    link.setAttribute(\"rel\", \"canonical\");\n    link.setAttribute(\"href\", url);\n    head.appendChild(link);\n  }\n}\n\nfunction replaceMeta(doc, section) {\n  var head;\n  var meta;\n  var id = section.idref;\n\n  if (!doc) {\n    return;\n  }\n\n  head = (0, _core.qs)(doc, \"head\");\n  meta = (0, _core.qs)(head, \"link[property='dc.identifier']\");\n\n  if (meta) {\n    meta.setAttribute(\"content\", id);\n  } else {\n    meta = doc.createElement(\"meta\");\n    meta.setAttribute(\"name\", \"dc.identifier\");\n    meta.setAttribute(\"content\", id);\n    head.appendChild(meta);\n  }\n} // TODO: move me to Contents\n\n\nfunction replaceLinks(contents, fn) {\n  var links = contents.querySelectorAll(\"a[href]\");\n\n  if (!links.length) {\n    return;\n  }\n\n  var base = (0, _core.qs)(contents.ownerDocument, \"base\");\n  var location = base ? base.getAttribute(\"href\") : undefined;\n\n  var replaceLink = function (link) {\n    var href = link.getAttribute(\"href\");\n\n    if (href.indexOf(\"mailto:\") === 0) {\n      return;\n    }\n\n    var absolute = href.indexOf(\"://\") > -1;\n\n    if (absolute) {\n      link.setAttribute(\"target\", \"_blank\");\n    } else {\n      var linkUrl;\n\n      try {\n        linkUrl = new _url.default(href, location);\n      } catch (error) {// NOOP\n      }\n\n      link.onclick = function () {\n        if (linkUrl && linkUrl.hash) {\n          fn(linkUrl.Path.path + linkUrl.hash);\n        } else if (linkUrl) {\n          fn(linkUrl.Path.path);\n        } else {\n          fn(href);\n        }\n\n        return false;\n      };\n    }\n  }.bind(this);\n\n  for (var i = 0; i < links.length; i++) {\n    replaceLink(links[i]);\n  }\n}\n\nfunction substitute(content, urls, replacements) {\n  urls.forEach(function (url, i) {\n    if (url && replacements[i]) {\n      // Account for special characters in the file name.\n      // See https://stackoverflow.com/a/6318729.\n      url = url.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n      content = content.replace(new RegExp(url, \"g\"), replacements[i]);\n    }\n  });\n  return content;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./core\");\n\nvar _path = _interopRequireDefault(require(\"./path\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction request(url, type, withCredentials, headers) {\n  var supportsURL = typeof window != \"undefined\" ? window.URL : false; // TODO: fallback for url if window isn't defined\n\n  var BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\n  var deferred = new _core.defer();\n  var xhr = new XMLHttpRequest(); //-- Check from PDF.js:\n  //   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\n\n  var xhrPrototype = XMLHttpRequest.prototype;\n  var header;\n\n  if (!(\"overrideMimeType\" in xhrPrototype)) {\n    // IE10 might have response, but not overrideMimeType\n    Object.defineProperty(xhrPrototype, \"overrideMimeType\", {\n      value: function xmlHttpRequestOverrideMimeType() {}\n    });\n  }\n\n  if (withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.onreadystatechange = handler;\n  xhr.onerror = err;\n  xhr.open(\"GET\", url, true);\n\n  for (header in headers) {\n    xhr.setRequestHeader(header, headers[header]);\n  }\n\n  if (type == \"json\") {\n    xhr.setRequestHeader(\"Accept\", \"application/json\");\n  } // If type isn\"t set, determine it from the file extension\n\n\n  if (!type) {\n    type = new _path.default(url).extension;\n  }\n\n  if (type == \"blob\") {\n    xhr.responseType = BLOB_RESPONSE;\n  }\n\n  if ((0, _core.isXml)(type)) {\n    // xhr.responseType = \"document\";\n    xhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n  }\n\n  if (type == \"xhtml\") {// xhr.responseType = \"document\";\n  }\n\n  if (type == \"html\" || type == \"htm\") {// xhr.responseType = \"document\";\n  }\n\n  if (type == \"binary\") {\n    xhr.responseType = \"arraybuffer\";\n  }\n\n  xhr.send();\n\n  function err(e) {\n    deferred.reject(e);\n  }\n\n  function handler() {\n    if (this.readyState === XMLHttpRequest.DONE) {\n      var responseXML = false;\n\n      if (this.responseType === \"\" || this.responseType === \"document\") {\n        responseXML = this.responseXML;\n      }\n\n      if (this.status === 200 || this.status === 0 || responseXML) {\n        //-- Firefox is reporting 0 for blob urls\n        var r;\n\n        if (!this.response && !responseXML) {\n          deferred.reject({\n            status: this.status,\n            message: \"Empty Response\",\n            stack: new Error().stack\n          });\n          return deferred.promise;\n        }\n\n        if (this.status === 403) {\n          deferred.reject({\n            status: this.status,\n            response: this.response,\n            message: \"Forbidden\",\n            stack: new Error().stack\n          });\n          return deferred.promise;\n        }\n\n        if (responseXML) {\n          r = this.responseXML;\n        } else if ((0, _core.isXml)(type)) {\n          // xhr.overrideMimeType(\"text/xml\"); // for OPF parsing\n          // If this.responseXML wasn't set, try to parse using a DOMParser from text\n          r = (0, _core.parse)(this.response, \"text/xml\");\n        } else if (type == \"xhtml\") {\n          r = (0, _core.parse)(this.response, \"application/xhtml+xml\");\n        } else if (type == \"html\" || type == \"htm\") {\n          r = (0, _core.parse)(this.response, \"text/html\");\n        } else if (type == \"json\") {\n          r = JSON.parse(this.response);\n        } else if (type == \"blob\") {\n          if (supportsURL) {\n            r = this.response;\n          } else {\n            //-- Safari doesn't support responseType blob, so create a blob from arraybuffer\n            r = new Blob([this.response]);\n          }\n        } else {\n          r = this.response;\n        }\n\n        deferred.resolve(r);\n      } else {\n        deferred.reject({\n          status: this.status,\n          message: this.response,\n          stack: new Error().stack\n        });\n      }\n    }\n  }\n\n  return deferred.promise;\n}\n\nvar _default = request;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _core = require(\"./utils/core\");\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _mapping = _interopRequireDefault(require(\"./mapping\"));\n\nvar _replacements = require(\"./utils/replacements\");\n\nvar _constants = require(\"./utils/constants\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst hasNavigator = typeof navigator !== \"undefined\";\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\n\nclass Contents {\n  constructor(doc, content, cfiBase, sectionIndex) {\n    // Blank Cfi for Parsing\n    this.epubcfi = new _epubcfi.default();\n    this.document = doc;\n    this.documentElement = this.document.documentElement;\n    this.content = content || this.document.body;\n    this.window = this.document.defaultView;\n    this._size = {\n      width: 0,\n      height: 0\n    };\n    this.sectionIndex = sectionIndex || 0;\n    this.cfiBase = cfiBase || \"\";\n    this.epubReadingSystem(\"epub.js\", _constants.EPUBJS_VERSION);\n    this.called = 0;\n    this.active = true;\n    this.listeners();\n  }\n  /**\n  \t* Get DOM events that are listened for and passed along\n  \t*/\n\n\n  static get listenedEvents() {\n    return _constants.DOM_EVENTS;\n  }\n  /**\n  \t* Get or Set width\n  \t* @param {number} [w]\n  \t* @returns {number} width\n  \t*/\n\n\n  width(w) {\n    // var frame = this.documentElement;\n    var frame = this.content;\n\n    if (w && (0, _core.isNumber)(w)) {\n      w = w + \"px\";\n    }\n\n    if (w) {\n      frame.style.width = w; // this.content.style.width = w;\n    }\n\n    return parseInt(this.window.getComputedStyle(frame)[\"width\"]);\n  }\n  /**\n  \t* Get or Set height\n  \t* @param {number} [h]\n  \t* @returns {number} height\n  \t*/\n\n\n  height(h) {\n    // var frame = this.documentElement;\n    var frame = this.content;\n\n    if (h && (0, _core.isNumber)(h)) {\n      h = h + \"px\";\n    }\n\n    if (h) {\n      frame.style.height = h; // this.content.style.height = h;\n    }\n\n    return parseInt(this.window.getComputedStyle(frame)[\"height\"]);\n  }\n  /**\n  \t* Get or Set width of the contents\n  \t* @param {number} [w]\n  \t* @returns {number} width\n  \t*/\n\n\n  contentWidth(w) {\n    var content = this.content || this.document.body;\n\n    if (w && (0, _core.isNumber)(w)) {\n      w = w + \"px\";\n    }\n\n    if (w) {\n      content.style.width = w;\n    }\n\n    return parseInt(this.window.getComputedStyle(content)[\"width\"]);\n  }\n  /**\n  \t* Get or Set height of the contents\n  \t* @param {number} [h]\n  \t* @returns {number} height\n  \t*/\n\n\n  contentHeight(h) {\n    var content = this.content || this.document.body;\n\n    if (h && (0, _core.isNumber)(h)) {\n      h = h + \"px\";\n    }\n\n    if (h) {\n      content.style.height = h;\n    }\n\n    return parseInt(this.window.getComputedStyle(content)[\"height\"]);\n  }\n  /**\n  \t* Get the width of the text using Range\n  \t* @returns {number} width\n  \t*/\n\n\n  textWidth() {\n    let rect;\n    let width;\n    let range = this.document.createRange();\n    let content = this.content || this.document.body;\n    let border = (0, _core.borders)(content); // Select the contents of frame\n\n    range.selectNodeContents(content); // get the width of the text content\n\n    rect = range.getBoundingClientRect();\n    width = rect.width;\n\n    if (border && border.width) {\n      width += border.width;\n    }\n\n    return Math.round(width);\n  }\n  /**\n  \t* Get the height of the text using Range\n  \t* @returns {number} height\n  \t*/\n\n\n  textHeight() {\n    let rect;\n    let height;\n    let range = this.document.createRange();\n    let content = this.content || this.document.body;\n    range.selectNodeContents(content);\n    rect = range.getBoundingClientRect();\n    height = rect.bottom;\n    return Math.round(height);\n  }\n  /**\n  \t* Get documentElement scrollWidth\n  \t* @returns {number} width\n  \t*/\n\n\n  scrollWidth() {\n    var width = this.documentElement.scrollWidth;\n    return width;\n  }\n  /**\n  \t* Get documentElement scrollHeight\n  \t* @returns {number} height\n  \t*/\n\n\n  scrollHeight() {\n    var height = this.documentElement.scrollHeight;\n    return height;\n  }\n  /**\n  \t* Set overflow css style of the contents\n  \t* @param {string} [overflow]\n  \t*/\n\n\n  overflow(overflow) {\n    if (overflow) {\n      this.documentElement.style.overflow = overflow;\n    }\n\n    return this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n  }\n  /**\n  \t* Set overflowX css style of the documentElement\n  \t* @param {string} [overflow]\n  \t*/\n\n\n  overflowX(overflow) {\n    if (overflow) {\n      this.documentElement.style.overflowX = overflow;\n    }\n\n    return this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n  }\n  /**\n  \t* Set overflowY css style of the documentElement\n  \t* @param {string} [overflow]\n  \t*/\n\n\n  overflowY(overflow) {\n    if (overflow) {\n      this.documentElement.style.overflowY = overflow;\n    }\n\n    return this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n  }\n  /**\n  \t* Set Css styles on the contents element (typically Body)\n  \t* @param {string} property\n  \t* @param {string} value\n  \t* @param {boolean} [priority] set as \"important\"\n  \t*/\n\n\n  css(property, value, priority) {\n    var content = this.content || this.document.body;\n\n    if (value) {\n      content.style.setProperty(property, value, priority ? \"important\" : \"\");\n    } else {\n      content.style.removeProperty(property);\n    }\n\n    return this.window.getComputedStyle(content)[property];\n  }\n  /**\n  \t* Get or Set the viewport element\n  \t* @param {object} [options]\n  \t* @param {string} [options.width]\n  \t* @param {string} [options.height]\n  \t* @param {string} [options.scale]\n  \t* @param {string} [options.minimum]\n  \t* @param {string} [options.maximum]\n  \t* @param {string} [options.scalable]\n  \t*/\n\n\n  viewport(options) {\n    var _width, _height, _scale, _minimum, _maximum, _scalable; // var width, height, scale, minimum, maximum, scalable;\n\n\n    var $viewport = this.document.querySelector(\"meta[name='viewport']\");\n    var parsed = {\n      \"width\": undefined,\n      \"height\": undefined,\n      \"scale\": undefined,\n      \"minimum\": undefined,\n      \"maximum\": undefined,\n      \"scalable\": undefined\n    };\n    var newContent = [];\n    var settings = {};\n    /*\n    * check for the viewport size\n    * <meta name=\"viewport\" content=\"width=1024,height=697\" />\n    */\n\n    if ($viewport && $viewport.hasAttribute(\"content\")) {\n      let content = $viewport.getAttribute(\"content\");\n\n      let _width = content.match(/width\\s*=\\s*([^,]*)/);\n\n      let _height = content.match(/height\\s*=\\s*([^,]*)/);\n\n      let _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\n      let _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\n      let _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\n      let _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n      if (_width && _width.length && typeof _width[1] !== \"undefined\") {\n        parsed.width = _width[1];\n      }\n\n      if (_height && _height.length && typeof _height[1] !== \"undefined\") {\n        parsed.height = _height[1];\n      }\n\n      if (_scale && _scale.length && typeof _scale[1] !== \"undefined\") {\n        parsed.scale = _scale[1];\n      }\n\n      if (_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\") {\n        parsed.minimum = _minimum[1];\n      }\n\n      if (_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\") {\n        parsed.maximum = _maximum[1];\n      }\n\n      if (_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\") {\n        parsed.scalable = _scalable[1];\n      }\n    }\n\n    settings = (0, _core.defaults)(options || {}, parsed);\n\n    if (options) {\n      if (settings.width) {\n        newContent.push(\"width=\" + settings.width);\n      }\n\n      if (settings.height) {\n        newContent.push(\"height=\" + settings.height);\n      }\n\n      if (settings.scale) {\n        newContent.push(\"initial-scale=\" + settings.scale);\n      }\n\n      if (settings.scalable === \"no\") {\n        newContent.push(\"minimum-scale=\" + settings.scale);\n        newContent.push(\"maximum-scale=\" + settings.scale);\n        newContent.push(\"user-scalable=\" + settings.scalable);\n      } else {\n        if (settings.scalable) {\n          newContent.push(\"user-scalable=\" + settings.scalable);\n        }\n\n        if (settings.minimum) {\n          newContent.push(\"minimum-scale=\" + settings.minimum);\n        }\n\n        if (settings.maximum) {\n          newContent.push(\"minimum-scale=\" + settings.maximum);\n        }\n      }\n\n      if (!$viewport) {\n        $viewport = this.document.createElement(\"meta\");\n        $viewport.setAttribute(\"name\", \"viewport\");\n        this.document.querySelector(\"head\").appendChild($viewport);\n      }\n\n      $viewport.setAttribute(\"content\", newContent.join(\", \"));\n      this.window.scrollTo(0, 0);\n    }\n\n    return settings;\n  }\n  /**\n   * Event emitter for when the contents has expanded\n   * @private\n   */\n\n\n  expand() {\n    this.emit(_constants.EVENTS.CONTENTS.EXPAND);\n  }\n  /**\n   * Add DOM listeners\n   * @private\n   */\n\n\n  listeners() {\n    this.imageLoadListeners();\n    this.mediaQueryListeners(); // this.fontLoadListeners();\n\n    this.addEventListeners();\n    this.addSelectionListeners(); // this.transitionListeners();\n\n    if (typeof ResizeObserver === \"undefined\") {\n      this.resizeListeners();\n      this.visibilityListeners();\n    } else {\n      this.resizeObservers();\n    } // this.mutationObservers();\n\n\n    this.linksHandler();\n  }\n  /**\n   * Remove DOM listeners\n   * @private\n   */\n\n\n  removeListeners() {\n    this.removeEventListeners();\n    this.removeSelectionListeners();\n\n    if (this.observer) {\n      this.observer.disconnect();\n    }\n\n    clearTimeout(this.expanding);\n  }\n  /**\n   * Check if size of contents has changed and\n   * emit 'resize' event if it has.\n   * @private\n   */\n\n\n  resizeCheck() {\n    let width = this.textWidth();\n    let height = this.textHeight();\n\n    if (width != this._size.width || height != this._size.height) {\n      this._size = {\n        width: width,\n        height: height\n      };\n      this.onResize && this.onResize(this._size);\n      this.emit(_constants.EVENTS.CONTENTS.RESIZE, this._size);\n    }\n  }\n  /**\n   * Poll for resize detection\n   * @private\n   */\n\n\n  resizeListeners() {\n    var width, height; // Test size again\n\n    clearTimeout(this.expanding);\n    requestAnimationFrame(this.resizeCheck.bind(this));\n    this.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n  }\n  /**\n   * Listen for visibility of tab to change\n   * @private\n   */\n\n\n  visibilityListeners() {\n    document.addEventListener(\"visibilitychange\", () => {\n      if (document.visibilityState === \"visible\" && this.active === false) {\n        this.active = true;\n        this.resizeListeners();\n      } else {\n        this.active = false;\n        clearTimeout(this.expanding);\n      }\n    });\n  }\n  /**\n   * Use css transitions to detect resize\n   * @private\n   */\n\n\n  transitionListeners() {\n    let body = this.content;\n    body.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n    body.style['transitionDuration'] = \"0.001ms\";\n    body.style['transitionTimingFunction'] = \"linear\";\n    body.style['transitionDelay'] = \"0\";\n    this._resizeCheck = this.resizeCheck.bind(this);\n    this.document.addEventListener('transitionend', this._resizeCheck);\n  }\n  /**\n   * Listen for media query changes and emit 'expand' event\n   * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n   * @private\n   */\n\n\n  mediaQueryListeners() {\n    var sheets = this.document.styleSheets;\n\n    var mediaChangeHandler = function (m) {\n      if (m.matches && !this._expanding) {\n        setTimeout(this.expand.bind(this), 1);\n      }\n    }.bind(this);\n\n    for (var i = 0; i < sheets.length; i += 1) {\n      var rules; // Firefox errors if we access cssRules cross-domain\n\n      try {\n        rules = sheets[i].cssRules;\n      } catch (e) {\n        return;\n      }\n\n      if (!rules) return; // Stylesheets changed\n\n      for (var j = 0; j < rules.length; j += 1) {\n        //if (rules[j].constructor === CSSMediaRule) {\n        if (rules[j].media) {\n          var mql = this.window.matchMedia(rules[j].media.mediaText);\n          mql.addListener(mediaChangeHandler); //mql.onchange = mediaChangeHandler;\n        }\n      }\n    }\n  }\n  /**\n   * Use ResizeObserver to listen for changes in the DOM and check for resize\n   * @private\n   */\n\n\n  resizeObservers() {\n    // create an observer instance\n    this.observer = new ResizeObserver(e => {\n      requestAnimationFrame(this.resizeCheck.bind(this));\n    }); // pass in the target node\n\n    this.observer.observe(this.document.documentElement);\n  }\n  /**\n   * Use MutationObserver to listen for changes in the DOM and check for resize\n   * @private\n   */\n\n\n  mutationObservers() {\n    // create an observer instance\n    this.observer = new MutationObserver(mutations => {\n      this.resizeCheck();\n    }); // configuration of the observer:\n\n    let config = {\n      attributes: true,\n      childList: true,\n      characterData: true,\n      subtree: true\n    }; // pass in the target node, as well as the observer options\n\n    this.observer.observe(this.document, config);\n  }\n  /**\n   * Test if images are loaded or add listener for when they load\n   * @private\n   */\n\n\n  imageLoadListeners() {\n    var images = this.document.querySelectorAll(\"img\");\n    var img;\n\n    for (var i = 0; i < images.length; i++) {\n      img = images[i];\n\n      if (typeof img.naturalWidth !== \"undefined\" && img.naturalWidth === 0) {\n        img.onload = this.expand.bind(this);\n      }\n    }\n  }\n  /**\n   * Listen for font load and check for resize when loaded\n   * @private\n   */\n\n\n  fontLoadListeners() {\n    if (!this.document || !this.document.fonts) {\n      return;\n    }\n\n    this.document.fonts.ready.then(function () {\n      this.resizeCheck();\n    }.bind(this));\n  }\n  /**\n   * Get the documentElement\n   * @returns {element} documentElement\n   */\n\n\n  root() {\n    if (!this.document) return null;\n    return this.document.documentElement;\n  }\n  /**\n   * Get the location offset of a EpubCFI or an #id\n   * @param {string | EpubCFI} target\n   * @param {string} [ignoreClass] for the cfi\n   * @returns { {left: Number, top: Number }\n   */\n\n\n  locationOf(target, ignoreClass) {\n    var position;\n    var targetPos = {\n      \"left\": 0,\n      \"top\": 0\n    };\n    if (!this.document) return targetPos;\n\n    if (this.epubcfi.isCfiString(target)) {\n      let range = new _epubcfi.default(target).toRange(this.document, ignoreClass);\n\n      if (range) {\n        try {\n          if (!range.endContainer || range.startContainer == range.endContainer && range.startOffset == range.endOffset) {\n            // If the end for the range is not set, it results in collapsed becoming\n            // true. This in turn leads to inconsistent behaviour when calling\n            // getBoundingRect. Wrong bounds lead to the wrong page being displayed.\n            // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/\n            let pos = range.startContainer.textContent.indexOf(\" \", range.startOffset);\n\n            if (pos == -1) {\n              pos = range.startContainer.textContent.length;\n            }\n\n            range.setEnd(range.startContainer, pos);\n          }\n        } catch (e) {\n          console.error(\"setting end offset to start container length failed\", e);\n        }\n\n        if (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n          position = range.startContainer.getBoundingClientRect();\n          targetPos.left = position.left;\n          targetPos.top = position.top;\n        } else {\n          // Webkit does not handle collapsed range bounds correctly\n          // https://bugs.webkit.org/show_bug.cgi?id=138949\n          // Construct a new non-collapsed range\n          if (isWebkit) {\n            let container = range.startContainer;\n            let newRange = new Range();\n\n            try {\n              if (container.nodeType === ELEMENT_NODE) {\n                position = container.getBoundingClientRect();\n              } else if (range.startOffset + 2 < container.length) {\n                newRange.setStart(container, range.startOffset);\n                newRange.setEnd(container, range.startOffset + 2);\n                position = newRange.getBoundingClientRect();\n              } else if (range.startOffset - 2 > 0) {\n                newRange.setStart(container, range.startOffset - 2);\n                newRange.setEnd(container, range.startOffset);\n                position = newRange.getBoundingClientRect();\n              } else {\n                // empty, return the parent element\n                position = container.parentNode.getBoundingClientRect();\n              }\n            } catch (e) {\n              console.error(e, e.stack);\n            }\n          } else {\n            position = range.getBoundingClientRect();\n          }\n        }\n      }\n    } else if (typeof target === \"string\" && target.indexOf(\"#\") > -1) {\n      let id = target.substring(target.indexOf(\"#\") + 1);\n      let el = this.document.getElementById(id);\n\n      if (el) {\n        if (isWebkit) {\n          // Webkit reports incorrect bounding rects in Columns\n          let newRange = new Range();\n          newRange.selectNode(el);\n          position = newRange.getBoundingClientRect();\n        } else {\n          position = el.getBoundingClientRect();\n        }\n      }\n    }\n\n    if (position) {\n      targetPos.left = position.left;\n      targetPos.top = position.top;\n    }\n\n    return targetPos;\n  }\n  /**\n   * Append a stylesheet link to the document head\n   * @param {string} src url\n   */\n\n\n  addStylesheet(src) {\n    return new Promise(function (resolve, reject) {\n      var $stylesheet;\n      var ready = false;\n\n      if (!this.document) {\n        resolve(false);\n        return;\n      } // Check if link already exists\n\n\n      $stylesheet = this.document.querySelector(\"link[href='\" + src + \"']\");\n\n      if ($stylesheet) {\n        resolve(true);\n        return; // already present\n      }\n\n      $stylesheet = this.document.createElement(\"link\");\n      $stylesheet.type = \"text/css\";\n      $stylesheet.rel = \"stylesheet\";\n      $stylesheet.href = src;\n\n      $stylesheet.onload = $stylesheet.onreadystatechange = function () {\n        if (!ready && (!this.readyState || this.readyState == \"complete\")) {\n          ready = true; // Let apply\n\n          setTimeout(() => {\n            resolve(true);\n          }, 1);\n        }\n      };\n\n      this.document.head.appendChild($stylesheet);\n    }.bind(this));\n  }\n\n  _getStylesheetNode(key) {\n    var styleEl;\n    key = \"epubjs-inserted-css-\" + (key || '');\n    if (!this.document) return false; // Check if link already exists\n\n    styleEl = this.document.getElementById(key);\n\n    if (!styleEl) {\n      styleEl = this.document.createElement(\"style\");\n      styleEl.id = key; // Append style element to head\n\n      this.document.head.appendChild(styleEl);\n    }\n\n    return styleEl;\n  }\n  /**\n   * Append stylesheet css\n   * @param {string} serializedCss\n   * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n   */\n\n\n  addStylesheetCss(serializedCss, key) {\n    if (!this.document || !serializedCss) return false;\n    var styleEl;\n    styleEl = this._getStylesheetNode(key);\n    styleEl.innerHTML = serializedCss;\n    return true;\n  }\n  /**\n   * Append stylesheet rules to a generate stylesheet\n   * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n   * Object: https://github.com/desirable-objects/json-to-css\n   * @param {array | object} rules\n   * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n   */\n\n\n  addStylesheetRules(rules, key) {\n    var styleSheet;\n    if (!this.document || !rules || rules.length === 0) return; // Grab style sheet\n\n    styleSheet = this._getStylesheetNode(key).sheet;\n\n    if (Object.prototype.toString.call(rules) === \"[object Array]\") {\n      for (var i = 0, rl = rules.length; i < rl; i++) {\n        var j = 1,\n            rule = rules[i],\n            selector = rules[i][0],\n            propStr = \"\"; // If the second argument of a rule is an array of arrays, correct our variables.\n\n        if (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n          rule = rule[1];\n          j = 0;\n        }\n\n        for (var pl = rule.length; j < pl; j++) {\n          var prop = rule[j];\n          propStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n        } // Insert CSS Rule\n\n\n        styleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n      }\n    } else {\n      const selectors = Object.keys(rules);\n      selectors.forEach(selector => {\n        const definition = rules[selector];\n\n        if (Array.isArray(definition)) {\n          definition.forEach(item => {\n            const _rules = Object.keys(item);\n\n            const result = _rules.map(rule => {\n              return `${rule}:${item[rule]}`;\n            }).join(';');\n\n            styleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n          });\n        } else {\n          const _rules = Object.keys(definition);\n\n          const result = _rules.map(rule => {\n            return `${rule}:${definition[rule]}`;\n          }).join(';');\n\n          styleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n        }\n      });\n    }\n  }\n  /**\n   * Append a script tag to the document head\n   * @param {string} src url\n   * @returns {Promise} loaded\n   */\n\n\n  addScript(src) {\n    return new Promise(function (resolve, reject) {\n      var $script;\n      var ready = false;\n\n      if (!this.document) {\n        resolve(false);\n        return;\n      }\n\n      $script = this.document.createElement(\"script\");\n      $script.type = \"text/javascript\";\n      $script.async = true;\n      $script.src = src;\n\n      $script.onload = $script.onreadystatechange = function () {\n        if (!ready && (!this.readyState || this.readyState == \"complete\")) {\n          ready = true;\n          setTimeout(function () {\n            resolve(true);\n          }, 1);\n        }\n      };\n\n      this.document.head.appendChild($script);\n    }.bind(this));\n  }\n  /**\n   * Add a class to the contents container\n   * @param {string} className\n   */\n\n\n  addClass(className) {\n    var content;\n    if (!this.document) return;\n    content = this.content || this.document.body;\n\n    if (content) {\n      content.classList.add(className);\n    }\n  }\n  /**\n   * Remove a class from the contents container\n   * @param {string} removeClass\n   */\n\n\n  removeClass(className) {\n    var content;\n    if (!this.document) return;\n    content = this.content || this.document.body;\n\n    if (content) {\n      content.classList.remove(className);\n    }\n  }\n  /**\n   * Add DOM event listeners\n   * @private\n   */\n\n\n  addEventListeners() {\n    if (!this.document) {\n      return;\n    }\n\n    this._triggerEvent = this.triggerEvent.bind(this);\n\n    _constants.DOM_EVENTS.forEach(function (eventName) {\n      this.document.addEventListener(eventName, this._triggerEvent, {\n        passive: true\n      });\n    }, this);\n  }\n  /**\n   * Remove DOM event listeners\n   * @private\n   */\n\n\n  removeEventListeners() {\n    if (!this.document) {\n      return;\n    }\n\n    _constants.DOM_EVENTS.forEach(function (eventName) {\n      this.document.removeEventListener(eventName, this._triggerEvent, {\n        passive: true\n      });\n    }, this);\n\n    this._triggerEvent = undefined;\n  }\n  /**\n   * Emit passed browser events\n   * @private\n   */\n\n\n  triggerEvent(e) {\n    this.emit(e.type, e);\n  }\n  /**\n   * Add listener for text selection\n   * @private\n   */\n\n\n  addSelectionListeners() {\n    if (!this.document) {\n      return;\n    }\n\n    this._onSelectionChange = this.onSelectionChange.bind(this);\n    this.document.addEventListener(\"selectionchange\", this._onSelectionChange, {\n      passive: true\n    });\n  }\n  /**\n   * Remove listener for text selection\n   * @private\n   */\n\n\n  removeSelectionListeners() {\n    if (!this.document) {\n      return;\n    }\n\n    this.document.removeEventListener(\"selectionchange\", this._onSelectionChange, {\n      passive: true\n    });\n    this._onSelectionChange = undefined;\n  }\n  /**\n   * Handle getting text on selection\n   * @private\n   */\n\n\n  onSelectionChange(e) {\n    if (this.selectionEndTimeout) {\n      clearTimeout(this.selectionEndTimeout);\n    }\n\n    this.selectionEndTimeout = setTimeout(function () {\n      var selection = this.window.getSelection();\n      this.triggerSelectedEvent(selection);\n    }.bind(this), 250);\n  }\n  /**\n   * Emit event on text selection\n   * @private\n   */\n\n\n  triggerSelectedEvent(selection) {\n    var range, cfirange;\n\n    if (selection && selection.rangeCount > 0) {\n      range = selection.getRangeAt(0);\n\n      if (!range.collapsed) {\n        // cfirange = this.section.cfiFromRange(range);\n        cfirange = new _epubcfi.default(range, this.cfiBase).toString();\n        this.emit(_constants.EVENTS.CONTENTS.SELECTED, cfirange);\n        this.emit(_constants.EVENTS.CONTENTS.SELECTED_RANGE, range);\n      }\n    }\n  }\n  /**\n   * Get a Dom Range from EpubCFI\n   * @param {EpubCFI} _cfi\n   * @param {string} [ignoreClass]\n   * @returns {Range} range\n   */\n\n\n  range(_cfi, ignoreClass) {\n    var cfi = new _epubcfi.default(_cfi);\n    return cfi.toRange(this.document, ignoreClass);\n  }\n  /**\n   * Get an EpubCFI from a Dom Range\n   * @param {Range} range\n   * @param {string} [ignoreClass]\n   * @returns {EpubCFI} cfi\n   */\n\n\n  cfiFromRange(range, ignoreClass) {\n    return new _epubcfi.default(range, this.cfiBase, ignoreClass).toString();\n  }\n  /**\n   * Get an EpubCFI from a Dom node\n   * @param {node} node\n   * @param {string} [ignoreClass]\n   * @returns {EpubCFI} cfi\n   */\n\n\n  cfiFromNode(node, ignoreClass) {\n    return new _epubcfi.default(node, this.cfiBase, ignoreClass).toString();\n  } // TODO: find where this is used - remove?\n\n\n  map(layout) {\n    var map = new _mapping.default(layout);\n    return map.section();\n  }\n  /**\n   * Size the contents to a given width and height\n   * @param {number} [width]\n   * @param {number} [height]\n   */\n\n\n  size(width, height) {\n    var viewport = {\n      scale: 1.0,\n      scalable: \"no\"\n    };\n    this.layoutStyle(\"scrolling\");\n\n    if (width >= 0) {\n      this.width(width);\n      viewport.width = width;\n      this.css(\"padding\", \"0 \" + width / 12 + \"px\");\n    }\n\n    if (height >= 0) {\n      this.height(height);\n      viewport.height = height;\n    }\n\n    this.css(\"margin\", \"0\");\n    this.css(\"box-sizing\", \"border-box\");\n    this.viewport(viewport);\n  }\n  /**\n   * Apply columns to the contents for pagination\n   * @param {number} width\n   * @param {number} height\n   * @param {number} columnWidth\n   * @param {number} gap\n   */\n\n\n  columns(width, height, columnWidth, gap, dir) {\n    let COLUMN_AXIS = (0, _core.prefixed)(\"column-axis\");\n    let COLUMN_GAP = (0, _core.prefixed)(\"column-gap\");\n    let COLUMN_WIDTH = (0, _core.prefixed)(\"column-width\");\n    let COLUMN_FILL = (0, _core.prefixed)(\"column-fill\");\n    let writingMode = this.writingMode();\n    let axis = writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n    this.layoutStyle(\"paginated\");\n\n    if (dir === \"rtl\" && axis === \"horizontal\") {\n      this.direction(dir);\n    }\n\n    this.width(width);\n    this.height(height); // Deal with Mobile trying to scale to viewport\n\n    this.viewport({\n      width: width,\n      height: height,\n      scale: 1.0,\n      scalable: \"no\"\n    }); // TODO: inline-block needs more testing\n    // Fixes Safari column cut offs, but causes RTL issues\n    // this.css(\"display\", \"inline-block\");\n\n    this.css(\"overflow-y\", \"hidden\");\n    this.css(\"margin\", \"0\", true);\n\n    if (axis === \"vertical\") {\n      this.css(\"padding-top\", gap / 2 + \"px\", true);\n      this.css(\"padding-bottom\", gap / 2 + \"px\", true);\n      this.css(\"padding-left\", \"20px\");\n      this.css(\"padding-right\", \"20px\");\n      this.css(COLUMN_AXIS, \"vertical\");\n    } else {\n      this.css(\"padding-top\", \"20px\");\n      this.css(\"padding-bottom\", \"20px\");\n      this.css(\"padding-left\", gap / 2 + \"px\", true);\n      this.css(\"padding-right\", gap / 2 + \"px\", true);\n      this.css(COLUMN_AXIS, \"horizontal\");\n    }\n\n    this.css(\"box-sizing\", \"border-box\");\n    this.css(\"max-width\", \"inherit\");\n    this.css(COLUMN_FILL, \"auto\");\n    this.css(COLUMN_GAP, gap + \"px\");\n    this.css(COLUMN_WIDTH, columnWidth + \"px\"); // Fix glyph clipping in WebKit\n    // https://github.com/futurepress/epub.js/issues/983\n\n    this.css(\"-webkit-line-box-contain\", \"block glyphs replaced\");\n  }\n  /**\n   * Scale contents from center\n   * @param {number} scale\n   * @param {number} offsetX\n   * @param {number} offsetY\n   */\n\n\n  scaler(scale, offsetX, offsetY) {\n    var scaleStr = \"scale(\" + scale + \")\";\n    var translateStr = \"\"; // this.css(\"position\", \"absolute\"));\n\n    this.css(\"transform-origin\", \"top left\");\n\n    if (offsetX >= 0 || offsetY >= 0) {\n      translateStr = \" translate(\" + (offsetX || 0) + \"px, \" + (offsetY || 0) + \"px )\";\n    }\n\n    this.css(\"transform\", scaleStr + translateStr);\n  }\n  /**\n   * Fit contents into a fixed width and height\n   * @param {number} width\n   * @param {number} height\n   */\n\n\n  fit(width, height, section) {\n    var viewport = this.viewport();\n    var viewportWidth = parseInt(viewport.width);\n    var viewportHeight = parseInt(viewport.height);\n    var widthScale = width / viewportWidth;\n    var heightScale = height / viewportHeight;\n    var scale = widthScale < heightScale ? widthScale : heightScale; // the translate does not work as intended, elements can end up unaligned\n    // var offsetY = (height - (viewportHeight * scale)) / 2;\n    // var offsetX = 0;\n    // if (this.sectionIndex % 2 === 1) {\n    // \toffsetX = width - (viewportWidth * scale);\n    // }\n\n    this.layoutStyle(\"paginated\"); // scale needs width and height to be set\n\n    this.width(viewportWidth);\n    this.height(viewportHeight);\n    this.overflow(\"hidden\"); // Scale to the correct size\n\n    this.scaler(scale, 0, 0); // this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n    // background images are not scaled by transform\n\n    this.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n    this.css(\"background-color\", \"transparent\");\n\n    if (section && section.properties.includes(\"page-spread-left\")) {\n      // set margin since scale is weird\n      var marginLeft = width - viewportWidth * scale;\n      this.css(\"margin-left\", marginLeft + \"px\");\n    }\n  }\n  /**\n   * Set the direction of the text\n   * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n   */\n\n\n  direction(dir) {\n    if (this.documentElement) {\n      this.documentElement.style[\"direction\"] = dir;\n    }\n  }\n\n  mapPage(cfiBase, layout, start, end, dev) {\n    var mapping = new _mapping.default(layout, dev);\n    return mapping.page(this, cfiBase, start, end);\n  }\n  /**\n   * Emit event when link in content is clicked\n   * @private\n   */\n\n\n  linksHandler() {\n    (0, _replacements.replaceLinks)(this.content, href => {\n      this.emit(_constants.EVENTS.CONTENTS.LINK_CLICKED, href);\n    });\n  }\n  /**\n   * Set the writingMode of the text\n   * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n   */\n\n\n  writingMode(mode) {\n    let WRITING_MODE = (0, _core.prefixed)(\"writing-mode\");\n\n    if (mode && this.documentElement) {\n      this.documentElement.style[WRITING_MODE] = mode;\n    }\n\n    return this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n  }\n  /**\n   * Set the layoutStyle of the content\n   * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n   * @private\n   */\n\n\n  layoutStyle(style) {\n    if (style) {\n      this._layoutStyle = style;\n      navigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n    }\n\n    return this._layoutStyle || \"paginated\";\n  }\n  /**\n   * Add the epubReadingSystem object to the navigator\n   * @param {string} name\n   * @param {string} version\n   * @private\n   */\n\n\n  epubReadingSystem(name, version) {\n    navigator.epubReadingSystem = {\n      name: name,\n      version: version,\n      layoutStyle: this.layoutStyle(),\n      hasFeature: function (feature) {\n        switch (feature) {\n          case \"dom-manipulation\":\n            return true;\n\n          case \"layout-changes\":\n            return true;\n\n          case \"touch-events\":\n            return true;\n\n          case \"mouse-events\":\n            return true;\n\n          case \"keyboard-events\":\n            return true;\n\n          case \"spine-scripting\":\n            return false;\n\n          default:\n            return false;\n        }\n      }\n    };\n    return navigator.epubReadingSystem;\n  }\n\n  destroy() {\n    // this.document.removeEventListener('transitionend', this._resizeCheck);\n    this.removeListeners();\n  }\n\n}\n\n(0, _eventEmitter.default)(Contents.prototype);\nvar _default = Contents;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n/**\n * Hooks allow for injecting functions that must all complete in order before finishing\n * They will execute in parallel but all must finish before continuing\n * Functions may return a promise if they are asycn.\n * @param {any} context scope of this\n * @example this.content = new EPUBJS.Hook(this);\n */\nclass Hook {\n  constructor(context) {\n    this.context = context || this;\n    this.hooks = [];\n  }\n  /**\n   * Adds a function to be run before a hook completes\n   * @example this.content.register(function(){...});\n   */\n\n\n  register() {\n    for (var i = 0; i < arguments.length; ++i) {\n      if (typeof arguments[i] === \"function\") {\n        this.hooks.push(arguments[i]);\n      } else {\n        // unpack array\n        for (var j = 0; j < arguments[i].length; ++j) {\n          this.hooks.push(arguments[i][j]);\n        }\n      }\n    }\n  }\n  /**\n   * Removes a function\n   * @example this.content.deregister(function(){...});\n   */\n\n\n  deregister(func) {\n    let hook;\n\n    for (let i = 0; i < this.hooks.length; i++) {\n      hook = this.hooks[i];\n\n      if (hook === func) {\n        this.hooks.splice(i, 1);\n        break;\n      }\n    }\n  }\n  /**\n   * Triggers a hook to run all functions\n   * @example this.content.trigger(args).then(function(){...});\n   */\n\n\n  trigger() {\n    var args = arguments;\n    var context = this.context;\n    var promises = [];\n    this.hooks.forEach(function (task) {\n      try {\n        var executing = task.apply(context, args);\n      } catch (err) {\n        console.log(err);\n      }\n\n      if (executing && typeof executing[\"then\"] === \"function\") {\n        // Task is a function that returns a promise\n        promises.push(executing);\n      } // Otherwise Task resolves immediately, continue\n\n    });\n    return Promise.all(promises);\n  } // Adds a function to be run before a hook completes\n\n\n  list() {\n    return this.hooks;\n  }\n\n  clear() {\n    return this.hooks = [];\n  }\n\n}\n\nvar _default = Hook;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.Task = void 0;\n\nvar _core = require(\"./core\");\n\n/**\n * Queue for handling tasks one at a time\n * @class\n * @param {scope} context what this will resolve to in the tasks\n */\nclass Queue {\n  constructor(context) {\n    this._q = [];\n    this.context = context;\n    this.tick = _core.requestAnimationFrame;\n    this.running = false;\n    this.paused = false;\n  }\n  /**\n   * Add an item to the queue\n   * @return {Promise}\n   */\n\n\n  enqueue() {\n    var deferred, promise;\n    var queued;\n    var task = [].shift.call(arguments);\n    var args = arguments; // Handle single args without context\n    // if(args && !Array.isArray(args)) {\n    //   args = [args];\n    // }\n\n    if (!task) {\n      throw new Error(\"No Task Provided\");\n    }\n\n    if (typeof task === \"function\") {\n      deferred = new _core.defer();\n      promise = deferred.promise;\n      queued = {\n        \"task\": task,\n        \"args\": args,\n        //\"context\"  : context,\n        \"deferred\": deferred,\n        \"promise\": promise\n      };\n    } else {\n      // Task is a promise\n      queued = {\n        \"promise\": task\n      };\n    }\n\n    this._q.push(queued); // Wait to start queue flush\n\n\n    if (this.paused == false && !this.running) {\n      // setTimeout(this.flush.bind(this), 0);\n      // this.tick.call(window, this.run.bind(this));\n      this.run();\n    }\n\n    return queued.promise;\n  }\n  /**\n   * Run one item\n   * @return {Promise}\n   */\n\n\n  dequeue() {\n    var inwait, task, result;\n\n    if (this._q.length && !this.paused) {\n      inwait = this._q.shift();\n      task = inwait.task;\n\n      if (task) {\n        // console.log(task)\n        result = task.apply(this.context, inwait.args);\n\n        if (result && typeof result[\"then\"] === \"function\") {\n          // Task is a function that returns a promise\n          return result.then(function () {\n            inwait.deferred.resolve.apply(this.context, arguments);\n          }.bind(this), function () {\n            inwait.deferred.reject.apply(this.context, arguments);\n          }.bind(this));\n        } else {\n          // Task resolves immediately\n          inwait.deferred.resolve.apply(this.context, result);\n          return inwait.promise;\n        }\n      } else if (inwait.promise) {\n        // Task is a promise\n        return inwait.promise;\n      }\n    } else {\n      inwait = new _core.defer();\n      inwait.deferred.resolve();\n      return inwait.promise;\n    }\n  } // Run All Immediately\n\n\n  dump() {\n    while (this._q.length) {\n      this.dequeue();\n    }\n  }\n  /**\n   * Run all tasks sequentially, at convince\n   * @return {Promise}\n   */\n\n\n  run() {\n    if (!this.running) {\n      this.running = true;\n      this.defered = new _core.defer();\n    }\n\n    this.tick.call(window, () => {\n      if (this._q.length) {\n        this.dequeue().then(function () {\n          this.run();\n        }.bind(this));\n      } else {\n        this.defered.resolve();\n        this.running = undefined;\n      }\n    }); // Unpause\n\n    if (this.paused == true) {\n      this.paused = false;\n    }\n\n    return this.defered.promise;\n  }\n  /**\n   * Flush all, as quickly as possible\n   * @return {Promise}\n   */\n\n\n  flush() {\n    if (this.running) {\n      return this.running;\n    }\n\n    if (this._q.length) {\n      this.running = this.dequeue().then(function () {\n        this.running = undefined;\n        return this.flush();\n      }.bind(this));\n      return this.running;\n    }\n  }\n  /**\n   * Clear all items in wait\n   */\n\n\n  clear() {\n    this._q = [];\n  }\n  /**\n   * Get the number of tasks in the queue\n   * @return {number} tasks\n   */\n\n\n  length() {\n    return this._q.length;\n  }\n  /**\n   * Pause a running queue\n   */\n\n\n  pause() {\n    this.paused = true;\n  }\n  /**\n   * End the queue\n   */\n\n\n  stop() {\n    this._q = [];\n    this.running = false;\n    this.paused = true;\n  }\n\n}\n/**\n * Create a new task from a callback\n * @class\n * @private\n * @param {function} task\n * @param {array} args\n * @param {scope} context\n * @return {function} task\n */\n\n\nclass Task {\n  constructor(task, args, context) {\n    return function () {\n      var toApply = arguments || [];\n      return new Promise((resolve, reject) => {\n        var callback = function (value, err) {\n          if (!value && err) {\n            reject(err);\n          } else {\n            resolve(value);\n          }\n        }; // Add the callback to the arguments list\n\n\n        toApply.push(callback); // Apply all arguments to the functions\n\n        task.apply(context || this, toApply);\n      });\n    };\n  }\n\n}\n\nexports.Task = Task;\nvar _default = Queue;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n/*\n From Zip.js, by Gildas Lormeau\nedited down\n */\nvar table = {\n  \"application\": {\n    \"ecmascript\": [\"es\", \"ecma\"],\n    \"javascript\": \"js\",\n    \"ogg\": \"ogx\",\n    \"pdf\": \"pdf\",\n    \"postscript\": [\"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\"],\n    \"rdf+xml\": \"rdf\",\n    \"smil\": [\"smi\", \"smil\"],\n    \"xhtml+xml\": [\"xhtml\", \"xht\"],\n    \"xml\": [\"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\"],\n    \"zip\": \"zip\",\n    \"x-httpd-eruby\": \"rhtml\",\n    \"x-latex\": \"latex\",\n    \"x-maker\": [\"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\"],\n    \"x-object\": \"o\",\n    \"x-shockwave-flash\": [\"swf\", \"swfl\"],\n    \"x-silverlight\": \"scr\",\n    \"epub+zip\": \"epub\",\n    \"font-tdpfr\": \"pfr\",\n    \"inkml+xml\": [\"ink\", \"inkml\"],\n    \"json\": \"json\",\n    \"jsonml+json\": \"jsonml\",\n    \"mathml+xml\": \"mathml\",\n    \"metalink+xml\": \"metalink\",\n    \"mp4\": \"mp4s\",\n    // \"oebps-package+xml\" : \"opf\",\n    \"omdoc+xml\": \"omdoc\",\n    \"oxps\": \"oxps\",\n    \"vnd.amazon.ebook\": \"azw\",\n    \"widget\": \"wgt\",\n    // \"x-dtbncx+xml\" : \"ncx\",\n    \"x-dtbook+xml\": \"dtb\",\n    \"x-dtbresource+xml\": \"res\",\n    \"x-font-bdf\": \"bdf\",\n    \"x-font-ghostscript\": \"gsf\",\n    \"x-font-linux-psf\": \"psf\",\n    \"x-font-otf\": \"otf\",\n    \"x-font-pcf\": \"pcf\",\n    \"x-font-snf\": \"snf\",\n    \"x-font-ttf\": [\"ttf\", \"ttc\"],\n    \"x-font-type1\": [\"pfa\", \"pfb\", \"pfm\", \"afm\"],\n    \"x-font-woff\": \"woff\",\n    \"x-mobipocket-ebook\": [\"prc\", \"mobi\"],\n    \"x-mspublisher\": \"pub\",\n    \"x-nzb\": \"nzb\",\n    \"x-tgif\": \"obj\",\n    \"xaml+xml\": \"xaml\",\n    \"xml-dtd\": \"dtd\",\n    \"xproc+xml\": \"xpl\",\n    \"xslt+xml\": \"xslt\",\n    \"internet-property-stream\": \"acx\",\n    \"x-compress\": \"z\",\n    \"x-compressed\": \"tgz\",\n    \"x-gzip\": \"gz\"\n  },\n  \"audio\": {\n    \"flac\": \"flac\",\n    \"midi\": [\"mid\", \"midi\", \"kar\", \"rmi\"],\n    \"mpeg\": [\"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\"],\n    \"mpegurl\": \"m3u\",\n    \"ogg\": [\"oga\", \"ogg\", \"spx\"],\n    \"x-aiff\": [\"aif\", \"aiff\", \"aifc\"],\n    \"x-ms-wma\": \"wma\",\n    \"x-wav\": \"wav\",\n    \"adpcm\": \"adp\",\n    \"mp4\": \"mp4a\",\n    \"webm\": \"weba\",\n    \"x-aac\": \"aac\",\n    \"x-caf\": \"caf\",\n    \"x-matroska\": \"mka\",\n    \"x-pn-realaudio-plugin\": \"rmp\",\n    \"xm\": \"xm\",\n    \"mid\": [\"mid\", \"rmi\"]\n  },\n  \"image\": {\n    \"gif\": \"gif\",\n    \"ief\": \"ief\",\n    \"jpeg\": [\"jpeg\", \"jpg\", \"jpe\"],\n    \"pcx\": \"pcx\",\n    \"png\": \"png\",\n    \"svg+xml\": [\"svg\", \"svgz\"],\n    \"tiff\": [\"tiff\", \"tif\"],\n    \"x-icon\": \"ico\",\n    \"bmp\": \"bmp\",\n    \"webp\": \"webp\",\n    \"x-pict\": [\"pic\", \"pct\"],\n    \"x-tga\": \"tga\",\n    \"cis-cod\": \"cod\"\n  },\n  \"text\": {\n    \"cache-manifest\": [\"manifest\", \"appcache\"],\n    \"css\": \"css\",\n    \"csv\": \"csv\",\n    \"html\": [\"html\", \"htm\", \"shtml\", \"stm\"],\n    \"mathml\": \"mml\",\n    \"plain\": [\"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\"],\n    \"richtext\": \"rtx\",\n    \"tab-separated-values\": \"tsv\",\n    \"x-bibtex\": \"bib\"\n  },\n  \"video\": {\n    \"mpeg\": [\"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\"],\n    \"mp4\": [\"mp4\", \"mp4v\", \"mpg4\"],\n    \"quicktime\": [\"qt\", \"mov\"],\n    \"ogg\": \"ogv\",\n    \"vnd.mpegurl\": [\"mxu\", \"m4u\"],\n    \"x-flv\": \"flv\",\n    \"x-la-asf\": [\"lsf\", \"lsx\"],\n    \"x-mng\": \"mng\",\n    \"x-ms-asf\": [\"asf\", \"asx\", \"asr\"],\n    \"x-ms-wm\": \"wm\",\n    \"x-ms-wmv\": \"wmv\",\n    \"x-ms-wmx\": \"wmx\",\n    \"x-ms-wvx\": \"wvx\",\n    \"x-msvideo\": \"avi\",\n    \"x-sgi-movie\": \"movie\",\n    \"x-matroska\": [\"mpv\", \"mkv\", \"mk3d\", \"mks\"],\n    \"3gpp2\": \"3g2\",\n    \"h261\": \"h261\",\n    \"h263\": \"h263\",\n    \"h264\": \"h264\",\n    \"jpeg\": \"jpgv\",\n    \"jpm\": [\"jpm\", \"jpgm\"],\n    \"mj2\": [\"mj2\", \"mjp2\"],\n    \"vnd.ms-playready.media.pyv\": \"pyv\",\n    \"vnd.uvvu.mp4\": [\"uvu\", \"uvvu\"],\n    \"vnd.vivo\": \"viv\",\n    \"webm\": \"webm\",\n    \"x-f4v\": \"f4v\",\n    \"x-m4v\": \"m4v\",\n    \"x-ms-vob\": \"vob\",\n    \"x-smv\": \"smv\"\n  }\n};\n\nvar mimeTypes = function () {\n  var type,\n      subtype,\n      val,\n      index,\n      mimeTypes = {};\n\n  for (type in table) {\n    if (table.hasOwnProperty(type)) {\n      for (subtype in table[type]) {\n        if (table[type].hasOwnProperty(subtype)) {\n          val = table[type][subtype];\n\n          if (typeof val == \"string\") {\n            mimeTypes[val] = type + \"/\" + subtype;\n          } else {\n            for (index = 0; index < val.length; index++) {\n              mimeTypes[val[index]] = type + \"/\" + subtype;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return mimeTypes;\n}();\n\nvar defaultValue = \"text/plain\"; //\"application/octet-stream\";\n\nfunction lookup(filename) {\n  return filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\n}\n\n;\nvar _default = {\n  lookup\n};\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _core = require(\"./utils/core\");\n\nvar _hook = _interopRequireDefault(require(\"./utils/hook\"));\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _queue = _interopRequireDefault(require(\"./utils/queue\"));\n\nvar _layout = _interopRequireDefault(require(\"./layout\"));\n\nvar _themes = _interopRequireDefault(require(\"./themes\"));\n\nvar _contents = _interopRequireDefault(require(\"./contents\"));\n\nvar _annotations = _interopRequireDefault(require(\"./annotations\"));\n\nvar _constants = require(\"./utils/constants\");\n\nvar _iframe = _interopRequireDefault(require(\"./managers/views/iframe\"));\n\nvar _index = _interopRequireDefault(require(\"./managers/default/index\"));\n\nvar _index2 = _interopRequireDefault(require(\"./managers/continuous/index\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import Mapping from \"./mapping\";\n// Default Views\n// Default View Managers\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n * @param {string} [options.defaultDirection='ltr'] default text direction\n * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content\n */\nclass Rendition {\n  constructor(book, options) {\n    this.settings = (0, _core.extend)(this.settings || {}, {\n      width: null,\n      height: null,\n      ignoreClass: \"\",\n      manager: \"default\",\n      view: \"iframe\",\n      flow: null,\n      layout: null,\n      spread: null,\n      minSpreadWidth: 800,\n      stylesheet: null,\n      resizeOnOrientationChange: true,\n      script: null,\n      snap: false,\n      defaultDirection: \"ltr\",\n      allowScriptedContent: false\n    });\n    (0, _core.extend)(this.settings, options);\n\n    if (typeof this.settings.manager === \"object\") {\n      this.manager = this.settings.manager;\n    }\n\n    this.book = book;\n    /**\n     * Adds Hook methods to the Rendition prototype\n     * @member {object} hooks\n     * @property {Hook} hooks.content\n     * @memberof Rendition\n     */\n\n    this.hooks = {};\n    this.hooks.display = new _hook.default(this);\n    this.hooks.serialize = new _hook.default(this);\n    this.hooks.content = new _hook.default(this);\n    this.hooks.unloaded = new _hook.default(this);\n    this.hooks.layout = new _hook.default(this);\n    this.hooks.render = new _hook.default(this);\n    this.hooks.show = new _hook.default(this);\n    this.hooks.content.register(this.handleLinks.bind(this));\n    this.hooks.content.register(this.passEvents.bind(this));\n    this.hooks.content.register(this.adjustImages.bind(this));\n    this.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n\n    if (this.settings.stylesheet) {\n      this.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n    }\n\n    if (this.settings.script) {\n      this.book.spine.hooks.content.register(this.injectScript.bind(this));\n    }\n    /**\n     * @member {Themes} themes\n     * @memberof Rendition\n     */\n\n\n    this.themes = new _themes.default(this);\n    /**\n     * @member {Annotations} annotations\n     * @memberof Rendition\n     */\n\n    this.annotations = new _annotations.default(this);\n    this.epubcfi = new _epubcfi.default();\n    this.q = new _queue.default(this);\n    /**\n     * A Rendered Location Range\n     * @typedef location\n     * @type {Object}\n     * @property {object} start\n     * @property {string} start.index\n     * @property {string} start.href\n     * @property {object} start.displayed\n     * @property {EpubCFI} start.cfi\n     * @property {number} start.location\n     * @property {number} start.percentage\n     * @property {number} start.displayed.page\n     * @property {number} start.displayed.total\n     * @property {object} end\n     * @property {string} end.index\n     * @property {string} end.href\n     * @property {object} end.displayed\n     * @property {EpubCFI} end.cfi\n     * @property {number} end.location\n     * @property {number} end.percentage\n     * @property {number} end.displayed.page\n     * @property {number} end.displayed.total\n     * @property {boolean} atStart\n     * @property {boolean} atEnd\n     * @memberof Rendition\n     */\n\n    this.location = undefined; // Hold queue until book is opened\n\n    this.q.enqueue(this.book.opened);\n    this.starting = new _core.defer();\n    /**\n     * @member {promise} started returns after the rendition has started\n     * @memberof Rendition\n     */\n\n    this.started = this.starting.promise; // Block the queue until rendering is started\n\n    this.q.enqueue(this.start);\n  }\n  /**\n   * Set the manager function\n   * @param {function} manager\n   */\n\n\n  setManager(manager) {\n    this.manager = manager;\n  }\n  /**\n   * Require the manager from passed string, or as a class function\n   * @param  {string|object} manager [description]\n   * @return {method}\n   */\n\n\n  requireManager(manager) {\n    var viewManager; // If manager is a string, try to load from imported managers\n\n    if (typeof manager === \"string\" && manager === \"default\") {\n      viewManager = _index.default;\n    } else if (typeof manager === \"string\" && manager === \"continuous\") {\n      viewManager = _index2.default;\n    } else {\n      // otherwise, assume we were passed a class function\n      viewManager = manager;\n    }\n\n    return viewManager;\n  }\n  /**\n   * Require the view from passed string, or as a class function\n   * @param  {string|object} view\n   * @return {view}\n   */\n\n\n  requireView(view) {\n    var View; // If view is a string, try to load from imported views,\n\n    if (typeof view == \"string\" && view === \"iframe\") {\n      View = _iframe.default;\n    } else {\n      // otherwise, assume we were passed a class function\n      View = view;\n    }\n\n    return View;\n  }\n  /**\n   * Start the rendering\n   * @return {Promise} rendering has started\n   */\n\n\n  start() {\n    if (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\n      this.settings.layout = \"pre-paginated\";\n    }\n\n    switch (this.book.package.metadata.spread) {\n      case 'none':\n        this.settings.spread = 'none';\n        break;\n\n      case 'both':\n        this.settings.spread = true;\n        break;\n    }\n\n    if (!this.manager) {\n      this.ViewManager = this.requireManager(this.settings.manager);\n      this.View = this.requireView(this.settings.view);\n      this.manager = new this.ViewManager({\n        view: this.View,\n        queue: this.q,\n        request: this.book.load.bind(this.book),\n        settings: this.settings\n      });\n    }\n\n    this.direction(this.book.package.metadata.direction || this.settings.defaultDirection); // Parse metadata to get layout props\n\n    this.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n    this.flow(this.settings.globalLayoutProperties.flow);\n    this.layout(this.settings.globalLayoutProperties); // Listen for displayed views\n\n    this.manager.on(_constants.EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n    this.manager.on(_constants.EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this)); // Listen for resizing\n\n    this.manager.on(_constants.EVENTS.MANAGERS.RESIZED, this.onResized.bind(this)); // Listen for rotation\n\n    this.manager.on(_constants.EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this)); // Listen for scroll changes\n\n    this.manager.on(_constants.EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n    /**\n     * Emit that rendering has started\n     * @event started\n     * @memberof Rendition\n     */\n\n    this.emit(_constants.EVENTS.RENDITION.STARTED); // Start processing queue\n\n    this.starting.resolve();\n  }\n  /**\n   * Call to attach the container to an element in the dom\n   * Container must be attached before rendering can begin\n   * @param  {element} element to attach to\n   * @return {Promise}\n   */\n\n\n  attachTo(element) {\n    return this.q.enqueue(function () {\n      // Start rendering\n      this.manager.render(element, {\n        \"width\": this.settings.width,\n        \"height\": this.settings.height\n      });\n      /**\n       * Emit that rendering has attached to an element\n       * @event attached\n       * @memberof Rendition\n       */\n\n      this.emit(_constants.EVENTS.RENDITION.ATTACHED);\n    }.bind(this));\n  }\n  /**\n   * Display a point in the book\n   * The request will be added to the rendering Queue,\n   * so it will wait until book is opened, rendering started\n   * and all other rendering tasks have finished to be called.\n   * @param  {string} target Url or EpubCFI\n   * @return {Promise}\n   */\n\n\n  display(target) {\n    if (this.displaying) {\n      this.displaying.resolve();\n    }\n\n    return this.q.enqueue(this._display, target);\n  }\n  /**\n   * Tells the manager what to display immediately\n   * @private\n   * @param  {string} target Url or EpubCFI\n   * @return {Promise}\n   */\n\n\n  _display(target) {\n    if (!this.book) {\n      return;\n    }\n\n    var isCfiString = this.epubcfi.isCfiString(target);\n    var displaying = new _core.defer();\n    var displayed = displaying.promise;\n    var section;\n    var moveTo;\n    this.displaying = displaying; // Check if this is a book percentage\n\n    if (this.book.locations.length() && (0, _core.isFloat)(target)) {\n      target = this.book.locations.cfiFromPercentage(parseFloat(target));\n    }\n\n    section = this.book.spine.get(target);\n\n    if (!section) {\n      displaying.reject(new Error(\"No Section Found\"));\n      return displayed;\n    }\n\n    this.manager.display(section, target).then(() => {\n      displaying.resolve(section);\n      this.displaying = undefined;\n      /**\n       * Emit that a section has been displayed\n       * @event displayed\n       * @param {Section} section\n       * @memberof Rendition\n       */\n\n      this.emit(_constants.EVENTS.RENDITION.DISPLAYED, section);\n      this.reportLocation();\n    }, err => {\n      /**\n       * Emit that has been an error displaying\n       * @event displayError\n       * @param {Section} section\n       * @memberof Rendition\n       */\n      this.emit(_constants.EVENTS.RENDITION.DISPLAY_ERROR, err);\n    });\n    return displayed;\n  }\n  /*\n  render(view, show) {\n  \t\t// view.onLayout = this.layout.format.bind(this.layout);\n  \tview.create();\n  \t\t// Fit to size of the container, apply padding\n  \tthis.manager.resizeView(view);\n  \t\t// Render Chain\n  \treturn view.section.render(this.book.request)\n  \t\t.then(function(contents){\n  \t\t\treturn view.load(contents);\n  \t\t}.bind(this))\n  \t\t.then(function(doc){\n  \t\t\treturn this.hooks.content.trigger(view, this);\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\tthis.layout.format(view.contents);\n  \t\t\treturn this.hooks.layout.trigger(view, this);\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\treturn view.display();\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\treturn this.hooks.render.trigger(view, this);\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\tif(show !== false) {\n  \t\t\t\tthis.q.enqueue(function(view){\n  \t\t\t\t\tview.show();\n  \t\t\t\t}, view);\n  \t\t\t}\n  \t\t\t// this.map = new Map(view, this.layout);\n  \t\t\tthis.hooks.show.trigger(view, this);\n  \t\t\tthis.trigger(\"rendered\", view.section);\n  \t\t\t}.bind(this))\n  \t\t.catch(function(e){\n  \t\t\tthis.trigger(\"loaderror\", e);\n  \t\t}.bind(this));\n  \t}\n  */\n\n  /**\n   * Report what section has been displayed\n   * @private\n   * @param  {*} view\n   */\n\n\n  afterDisplayed(view) {\n    view.on(_constants.EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view.contents));\n    this.hooks.render.trigger(view, this).then(() => {\n      if (view.contents) {\n        this.hooks.content.trigger(view.contents, this).then(() => {\n          /**\n           * Emit that a section has been rendered\n           * @event rendered\n           * @param {Section} section\n           * @param {View} view\n           * @memberof Rendition\n           */\n          this.emit(_constants.EVENTS.RENDITION.RENDERED, view.section, view);\n        });\n      } else {\n        this.emit(_constants.EVENTS.RENDITION.RENDERED, view.section, view);\n      }\n    });\n  }\n  /**\n   * Report what has been removed\n   * @private\n   * @param  {*} view\n   */\n\n\n  afterRemoved(view) {\n    this.hooks.unloaded.trigger(view, this).then(() => {\n      /**\n       * Emit that a section has been removed\n       * @event removed\n       * @param {Section} section\n       * @param {View} view\n       * @memberof Rendition\n       */\n      this.emit(_constants.EVENTS.RENDITION.REMOVED, view.section, view);\n    });\n  }\n  /**\n   * Report resize events and display the last seen location\n   * @private\n   */\n\n\n  onResized(size, epubcfi) {\n    /**\n     * Emit that the rendition has been resized\n     * @event resized\n     * @param {number} width\n     * @param {height} height\n     * @param {string} epubcfi (optional)\n     * @memberof Rendition\n     */\n    this.emit(_constants.EVENTS.RENDITION.RESIZED, {\n      width: size.width,\n      height: size.height\n    }, epubcfi);\n\n    if (this.location && this.location.start) {\n      this.display(epubcfi || this.location.start.cfi);\n    }\n  }\n  /**\n   * Report orientation events and display the last seen location\n   * @private\n   */\n\n\n  onOrientationChange(orientation) {\n    /**\n     * Emit that the rendition has been rotated\n     * @event orientationchange\n     * @param {string} orientation\n     * @memberof Rendition\n     */\n    this.emit(_constants.EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n  }\n  /**\n   * Move the Rendition to a specific offset\n   * Usually you would be better off calling display()\n   * @param {object} offset\n   */\n\n\n  moveTo(offset) {\n    this.manager.moveTo(offset);\n  }\n  /**\n   * Trigger a resize of the views\n   * @param {number} [width]\n   * @param {number} [height]\n   * @param {string} [epubcfi] (optional)\n   */\n\n\n  resize(width, height, epubcfi) {\n    if (width) {\n      this.settings.width = width;\n    }\n\n    if (height) {\n      this.settings.height = height;\n    }\n\n    this.manager.resize(width, height, epubcfi);\n  }\n  /**\n   * Clear all rendered views\n   */\n\n\n  clear() {\n    this.manager.clear();\n  }\n  /**\n   * Go to the next \"page\" in the rendition\n   * @return {Promise}\n   */\n\n\n  next() {\n    return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this));\n  }\n  /**\n   * Go to the previous \"page\" in the rendition\n   * @return {Promise}\n   */\n\n\n  prev() {\n    return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this));\n  } //-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\n  /**\n   * Determine the Layout properties from metadata and settings\n   * @private\n   * @param  {object} metadata\n   * @return {object} properties\n   */\n\n\n  determineLayoutProperties(metadata) {\n    var properties;\n    var layout = this.settings.layout || metadata.layout || \"reflowable\";\n    var spread = this.settings.spread || metadata.spread || \"auto\";\n    var orientation = this.settings.orientation || metadata.orientation || \"auto\";\n    var flow = this.settings.flow || metadata.flow || \"auto\";\n    var viewport = metadata.viewport || \"\";\n    var minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n    var direction = this.settings.direction || metadata.direction || \"ltr\";\n\n    if ((this.settings.width === 0 || this.settings.width > 0) && (this.settings.height === 0 || this.settings.height > 0)) {// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n    }\n\n    properties = {\n      layout: layout,\n      spread: spread,\n      orientation: orientation,\n      flow: flow,\n      viewport: viewport,\n      minSpreadWidth: minSpreadWidth,\n      direction: direction\n    };\n    return properties;\n  }\n  /**\n   * Adjust the flow of the rendition to paginated or scrolled\n   * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n   * @param  {string} flow\n   */\n\n\n  flow(flow) {\n    var _flow = flow;\n\n    if (flow === \"scrolled\" || flow === \"scrolled-doc\" || flow === \"scrolled-continuous\") {\n      _flow = \"scrolled\";\n    }\n\n    if (flow === \"auto\" || flow === \"paginated\") {\n      _flow = \"paginated\";\n    }\n\n    this.settings.flow = flow;\n\n    if (this._layout) {\n      this._layout.flow(_flow);\n    }\n\n    if (this.manager && this._layout) {\n      this.manager.applyLayout(this._layout);\n    }\n\n    if (this.manager) {\n      this.manager.updateFlow(_flow);\n    }\n\n    if (this.manager && this.manager.isRendered() && this.location) {\n      this.manager.clear();\n      this.display(this.location.start.cfi);\n    }\n  }\n  /**\n   * Adjust the layout of the rendition to reflowable or pre-paginated\n   * @param  {object} settings\n   */\n\n\n  layout(settings) {\n    if (settings) {\n      this._layout = new _layout.default(settings);\n\n      this._layout.spread(settings.spread, this.settings.minSpreadWidth); // this.mapping = new Mapping(this._layout.props);\n\n\n      this._layout.on(_constants.EVENTS.LAYOUT.UPDATED, (props, changed) => {\n        this.emit(_constants.EVENTS.RENDITION.LAYOUT, props, changed);\n      });\n    }\n\n    if (this.manager && this._layout) {\n      this.manager.applyLayout(this._layout);\n    }\n\n    return this._layout;\n  }\n  /**\n   * Adjust if the rendition uses spreads\n   * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n   * @param  {int} [min] min width to use spreads at\n   */\n\n\n  spread(spread, min) {\n    this.settings.spread = spread;\n\n    if (min) {\n      this.settings.minSpreadWidth = min;\n    }\n\n    if (this._layout) {\n      this._layout.spread(spread, min);\n    }\n\n    if (this.manager && this.manager.isRendered()) {\n      this.manager.updateLayout();\n    }\n  }\n  /**\n   * Adjust the direction of the rendition\n   * @param  {string} dir\n   */\n\n\n  direction(dir) {\n    this.settings.direction = dir || \"ltr\";\n\n    if (this.manager) {\n      this.manager.direction(this.settings.direction);\n    }\n\n    if (this.manager && this.manager.isRendered() && this.location) {\n      this.manager.clear();\n      this.display(this.location.start.cfi);\n    }\n  }\n  /**\n   * Report the current location\n   * @fires relocated\n   * @fires locationChanged\n   */\n\n\n  reportLocation() {\n    return this.q.enqueue(function reportedLocation() {\n      requestAnimationFrame(function reportedLocationAfterRAF() {\n        var location = this.manager.currentLocation();\n\n        if (location && location.then && typeof location.then === \"function\") {\n          location.then(function (result) {\n            let located = this.located(result);\n\n            if (!located || !located.start || !located.end) {\n              return;\n            }\n\n            this.location = located;\n            this.emit(_constants.EVENTS.RENDITION.LOCATION_CHANGED, {\n              index: this.location.start.index,\n              href: this.location.start.href,\n              start: this.location.start.cfi,\n              end: this.location.end.cfi,\n              percentage: this.location.start.percentage\n            });\n            this.emit(_constants.EVENTS.RENDITION.RELOCATED, this.location);\n          }.bind(this));\n        } else if (location) {\n          let located = this.located(location);\n\n          if (!located || !located.start || !located.end) {\n            return;\n          }\n\n          this.location = located;\n          /**\n           * @event locationChanged\n           * @deprecated\n           * @type {object}\n           * @property {number} index\n           * @property {string} href\n           * @property {EpubCFI} start\n           * @property {EpubCFI} end\n           * @property {number} percentage\n           * @memberof Rendition\n           */\n\n          this.emit(_constants.EVENTS.RENDITION.LOCATION_CHANGED, {\n            index: this.location.start.index,\n            href: this.location.start.href,\n            start: this.location.start.cfi,\n            end: this.location.end.cfi,\n            percentage: this.location.start.percentage\n          });\n          /**\n           * @event relocated\n           * @type {displayedLocation}\n           * @memberof Rendition\n           */\n\n          this.emit(_constants.EVENTS.RENDITION.RELOCATED, this.location);\n        }\n      }.bind(this));\n    }.bind(this));\n  }\n  /**\n   * Get the Current Location object\n   * @return {displayedLocation | promise} location (may be a promise)\n   */\n\n\n  currentLocation() {\n    var location = this.manager.currentLocation();\n\n    if (location && location.then && typeof location.then === \"function\") {\n      location.then(function (result) {\n        let located = this.located(result);\n        return located;\n      }.bind(this));\n    } else if (location) {\n      let located = this.located(location);\n      return located;\n    }\n  }\n  /**\n   * Creates a Rendition#locationRange from location\n   * passed by the Manager\n   * @returns {displayedLocation}\n   * @private\n   */\n\n\n  located(location) {\n    if (!location.length) {\n      return {};\n    }\n\n    let start = location[0];\n    let end = location[location.length - 1];\n    let located = {\n      start: {\n        index: start.index,\n        href: start.href,\n        cfi: start.mapping.start,\n        displayed: {\n          page: start.pages[0] || 1,\n          total: start.totalPages\n        }\n      },\n      end: {\n        index: end.index,\n        href: end.href,\n        cfi: end.mapping.end,\n        displayed: {\n          page: end.pages[end.pages.length - 1] || 1,\n          total: end.totalPages\n        }\n      }\n    };\n    let locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n    let locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n    if (locationStart != null) {\n      located.start.location = locationStart;\n      located.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n    }\n\n    if (locationEnd != null) {\n      located.end.location = locationEnd;\n      located.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n    }\n\n    let pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n    let pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n    if (pageStart != -1) {\n      located.start.page = pageStart;\n    }\n\n    if (pageEnd != -1) {\n      located.end.page = pageEnd;\n    }\n\n    if (end.index === this.book.spine.last().index && located.end.displayed.page >= located.end.displayed.total) {\n      located.atEnd = true;\n    }\n\n    if (start.index === this.book.spine.first().index && located.start.displayed.page === 1) {\n      located.atStart = true;\n    }\n\n    return located;\n  }\n  /**\n   * Remove and Clean Up the Rendition\n   */\n\n\n  destroy() {\n    // Clear the queue\n    // this.q.clear();\n    // this.q = undefined;\n    this.manager && this.manager.destroy();\n    this.book = undefined; // this.views = null;\n    // this.hooks.display.clear();\n    // this.hooks.serialize.clear();\n    // this.hooks.content.clear();\n    // this.hooks.layout.clear();\n    // this.hooks.render.clear();\n    // this.hooks.show.clear();\n    // this.hooks = {};\n    // this.themes.destroy();\n    // this.themes = undefined;\n    // this.epubcfi = undefined;\n    // this.starting = undefined;\n    // this.started = undefined;\n  }\n  /**\n   * Pass the events from a view's Contents\n   * @private\n   * @param  {Contents} view contents\n   */\n\n\n  passEvents(contents) {\n    _constants.DOM_EVENTS.forEach(e => {\n      contents.on(e, ev => this.triggerViewEvent(ev, contents));\n    });\n\n    contents.on(_constants.EVENTS.CONTENTS.SELECTED, e => this.triggerSelectedEvent(e, contents));\n  }\n  /**\n   * Emit events passed by a view\n   * @private\n   * @param  {event} e\n   */\n\n\n  triggerViewEvent(e, contents) {\n    this.emit(e.type, e, contents);\n  }\n  /**\n   * Emit a selection event's CFI Range passed from a a view\n   * @private\n   * @param  {string} cfirange\n   */\n\n\n  triggerSelectedEvent(cfirange, contents) {\n    /**\n     * Emit that a text selection has occured\n     * @event selected\n     * @param {string} cfirange\n     * @param {Contents} contents\n     * @memberof Rendition\n     */\n    this.emit(_constants.EVENTS.RENDITION.SELECTED, cfirange, contents);\n  }\n  /**\n   * Emit a markClicked event with the cfiRange and data from a mark\n   * @private\n   * @param  {EpubCFI} cfirange\n   */\n\n\n  triggerMarkEvent(cfiRange, data, contents) {\n    /**\n     * Emit that a mark was clicked\n     * @event markClicked\n     * @param {EpubCFI} cfirange\n     * @param {object} data\n     * @param {Contents} contents\n     * @memberof Rendition\n     */\n    this.emit(_constants.EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n  }\n  /**\n   * Get a Range from a Visible CFI\n   * @param  {string} cfi EpubCfi String\n   * @param  {string} ignoreClass\n   * @return {range}\n   */\n\n\n  getRange(cfi, ignoreClass) {\n    var _cfi = new _epubcfi.default(cfi);\n\n    var found = this.manager.visible().filter(function (view) {\n      if (_cfi.spinePos === view.index) return true;\n    }); // Should only every return 1 item\n\n    if (found.length) {\n      return found[0].contents.range(_cfi, ignoreClass);\n    }\n  }\n  /**\n   * Hook to adjust images to fit in columns\n   * @param  {Contents} contents\n   * @private\n   */\n\n\n  adjustImages(contents) {\n    if (this._layout.name === \"pre-paginated\") {\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n\n    let computed = contents.window.getComputedStyle(contents.content, null);\n    let height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n    let horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\n    contents.addStylesheetRules({\n      \"img\": {\n        \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth - horizontalPadding + \"px\" : \"100%\") + \"!important\",\n        \"max-height\": height + \"px\" + \"!important\",\n        \"object-fit\": \"contain\",\n        \"page-break-inside\": \"avoid\",\n        \"break-inside\": \"avoid\",\n        \"box-sizing\": \"border-box\"\n      },\n      \"svg\": {\n        \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth - horizontalPadding + \"px\" : \"100%\") + \"!important\",\n        \"max-height\": height + \"px\" + \"!important\",\n        \"page-break-inside\": \"avoid\",\n        \"break-inside\": \"avoid\"\n      }\n    });\n    return new Promise(function (resolve, reject) {\n      // Wait to apply\n      setTimeout(function () {\n        resolve();\n      }, 1);\n    });\n  }\n  /**\n   * Get the Contents object of each rendered view\n   * @returns {Contents[]}\n   */\n\n\n  getContents() {\n    return this.manager ? this.manager.getContents() : [];\n  }\n  /**\n   * Get the views member from the manager\n   * @returns {Views}\n   */\n\n\n  views() {\n    let views = this.manager ? this.manager.views : undefined;\n    return views || [];\n  }\n  /**\n   * Hook to handle link clicks in rendered content\n   * @param  {Contents} contents\n   * @private\n   */\n\n\n  handleLinks(contents) {\n    if (contents) {\n      contents.on(_constants.EVENTS.CONTENTS.LINK_CLICKED, href => {\n        let relative = this.book.path.relative(href);\n        this.display(relative);\n      });\n    }\n  }\n  /**\n   * Hook to handle injecting stylesheet before\n   * a Section is serialized\n   * @param  {document} doc\n   * @param  {Section} section\n   * @private\n   */\n\n\n  injectStylesheet(doc, section) {\n    let style = doc.createElement(\"link\");\n    style.setAttribute(\"type\", \"text/css\");\n    style.setAttribute(\"rel\", \"stylesheet\");\n    style.setAttribute(\"href\", this.settings.stylesheet);\n    doc.getElementsByTagName(\"head\")[0].appendChild(style);\n  }\n  /**\n   * Hook to handle injecting scripts before\n   * a Section is serialized\n   * @param  {document} doc\n   * @param  {Section} section\n   * @private\n   */\n\n\n  injectScript(doc, section) {\n    let script = doc.createElement(\"script\");\n    script.setAttribute(\"type\", \"text/javascript\");\n    script.setAttribute(\"src\", this.settings.script);\n    script.textContent = \" \"; // Needed to prevent self closing tag\n\n    doc.getElementsByTagName(\"head\")[0].appendChild(script);\n  }\n  /**\n   * Hook to handle the document identifier before\n   * a Section is serialized\n   * @param  {document} doc\n   * @param  {Section} section\n   * @private\n   */\n\n\n  injectIdentifier(doc, section) {\n    let ident = this.book.packaging.metadata.identifier;\n    let meta = doc.createElement(\"meta\");\n    meta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\n    if (ident) {\n      meta.setAttribute(\"content\", ident);\n    }\n\n    doc.getElementsByTagName(\"head\")[0].appendChild(meta);\n  }\n\n} //-- Enable binding events to Renderer\n\n\n(0, _eventEmitter.default)(Rendition.prototype);\nvar _default = Rendition;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _core = require(\"../../utils/core\");\n\nvar _scrolltype = _interopRequireDefault(require(\"../../utils/scrolltype\"));\n\nvar _mapping = _interopRequireDefault(require(\"../../mapping\"));\n\nvar _queue = _interopRequireDefault(require(\"../../utils/queue\"));\n\nvar _stage = _interopRequireDefault(require(\"../helpers/stage\"));\n\nvar _views = _interopRequireDefault(require(\"../helpers/views\"));\n\nvar _constants = require(\"../../utils/constants\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass DefaultViewManager {\n  constructor(options) {\n    this.name = \"default\";\n    this.optsSettings = options.settings;\n    this.View = options.view;\n    this.request = options.request;\n    this.renditionQueue = options.queue;\n    this.q = new _queue.default(this);\n    this.settings = (0, _core.extend)(this.settings || {}, {\n      infinite: true,\n      hidden: false,\n      width: undefined,\n      height: undefined,\n      axis: undefined,\n      writingMode: undefined,\n      flow: \"scrolled\",\n      ignoreClass: \"\",\n      fullsize: undefined,\n      allowScriptedContent: false\n    });\n    (0, _core.extend)(this.settings, options.settings || {});\n    this.viewSettings = {\n      ignoreClass: this.settings.ignoreClass,\n      axis: this.settings.axis,\n      flow: this.settings.flow,\n      layout: this.layout,\n      method: this.settings.method,\n      // srcdoc, blobUrl, write\n      width: 0,\n      height: 0,\n      forceEvenPages: true,\n      allowScriptedContent: this.settings.allowScriptedContent\n    };\n    this.rendered = false;\n  }\n\n  render(element, size) {\n    let tag = element.tagName;\n\n    if (typeof this.settings.fullsize === \"undefined\" && tag && (tag.toLowerCase() == \"body\" || tag.toLowerCase() == \"html\")) {\n      this.settings.fullsize = true;\n    }\n\n    if (this.settings.fullsize) {\n      this.settings.overflow = \"visible\";\n      this.overflow = this.settings.overflow;\n    }\n\n    this.settings.size = size;\n    this.settings.rtlScrollType = (0, _scrolltype.default)(); // Save the stage\n\n    this.stage = new _stage.default({\n      width: size.width,\n      height: size.height,\n      overflow: this.overflow,\n      hidden: this.settings.hidden,\n      axis: this.settings.axis,\n      fullsize: this.settings.fullsize,\n      direction: this.settings.direction\n    });\n    this.stage.attachTo(element); // Get this stage container div\n\n    this.container = this.stage.getContainer(); // Views array methods\n\n    this.views = new _views.default(this.container); // Calculate Stage Size\n\n    this._bounds = this.bounds();\n    this._stageSize = this.stage.size(); // Set the dimensions for views\n\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height; // Function to handle a resize event.\n    // Will only attach if width and height are both fixed.\n\n    this.stage.onResize(this.onResized.bind(this));\n    this.stage.onOrientationChange(this.onOrientationChange.bind(this)); // Add Event Listeners\n\n    this.addEventListeners(); // Add Layout method\n    // this.applyLayoutMethod();\n\n    if (this.layout) {\n      this.updateLayout();\n    }\n\n    this.rendered = true;\n  }\n\n  addEventListeners() {\n    var scroller;\n    window.addEventListener(\"unload\", function (e) {\n      this.destroy();\n    }.bind(this));\n\n    if (!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    this._onScroll = this.onScroll.bind(this);\n    scroller.addEventListener(\"scroll\", this._onScroll);\n  }\n\n  removeEventListeners() {\n    var scroller;\n\n    if (!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this._onScroll);\n    this._onScroll = undefined;\n  }\n\n  destroy() {\n    clearTimeout(this.orientationTimeout);\n    clearTimeout(this.resizeTimeout);\n    clearTimeout(this.afterScrolled);\n    this.clear();\n    this.removeEventListeners();\n    this.stage.destroy();\n    this.rendered = false;\n    /*\n    \t\tclearTimeout(this.trimTimeout);\n    \tif(this.settings.hidden) {\n    \t\tthis.element.removeChild(this.wrapper);\n    \t} else {\n    \t\tthis.element.removeChild(this.container);\n    \t}\n    */\n  }\n\n  onOrientationChange(e) {\n    let {\n      orientation\n    } = window;\n\n    if (this.optsSettings.resizeOnOrientationChange) {\n      this.resize();\n    } // Per ampproject:\n    // In IOS 10.3, the measured size of an element is incorrect if the\n    // element size depends on window size directly and the measurement\n    // happens in window.resize event. Adding a timeout for correct\n    // measurement. See https://github.com/ampproject/amphtml/issues/8479\n\n\n    clearTimeout(this.orientationTimeout);\n    this.orientationTimeout = setTimeout(function () {\n      this.orientationTimeout = undefined;\n\n      if (this.optsSettings.resizeOnOrientationChange) {\n        this.resize();\n      }\n\n      this.emit(_constants.EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n    }.bind(this), 500);\n  }\n\n  onResized(e) {\n    this.resize();\n  }\n\n  resize(width, height, epubcfi) {\n    let stageSize = this.stage.size(width, height); // For Safari, wait for orientation to catch up\n    // if the window is a square\n\n    this.winBounds = (0, _core.windowBounds)();\n\n    if (this.orientationTimeout && this.winBounds.width === this.winBounds.height) {\n      // reset the stage size for next resize\n      this._stageSize = undefined;\n      return;\n    }\n\n    if (this._stageSize && this._stageSize.width === stageSize.width && this._stageSize.height === stageSize.height) {\n      // Size is the same, no need to resize\n      return;\n    }\n\n    this._stageSize = stageSize;\n    this._bounds = this.bounds(); // Clear current views\n\n    this.clear(); // Update for new views\n\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n    this.updateLayout();\n    this.emit(_constants.EVENTS.MANAGERS.RESIZED, {\n      width: this._stageSize.width,\n      height: this._stageSize.height\n    }, epubcfi);\n  }\n\n  createView(section, forceRight) {\n    return new this.View(section, (0, _core.extend)(this.viewSettings, {\n      forceRight\n    }));\n  }\n\n  handleNextPrePaginated(forceRight, section, action) {\n    let next;\n\n    if (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n      if (forceRight || section.index === 0) {\n        // First page (cover) should stand alone for pre-paginated books\n        return;\n      }\n\n      next = section.next();\n\n      if (next && !next.properties.includes(\"page-spread-left\")) {\n        return action.call(this, next);\n      }\n    }\n  }\n\n  display(section, target) {\n    var displaying = new _core.defer();\n    var displayed = displaying.promise; // Check if moving to target is needed\n\n    if (target === section.href || (0, _core.isNumber)(target)) {\n      target = undefined;\n    } // Check to make sure the section we want isn't already shown\n\n\n    var visible = this.views.find(section); // View is already shown, just move to correct location in view\n\n    if (visible && section && this.layout.name !== \"pre-paginated\") {\n      let offset = visible.offset();\n\n      if (this.settings.direction === \"ltr\") {\n        this.scrollTo(offset.left, offset.top, true);\n      } else {\n        let width = visible.width();\n        this.scrollTo(offset.left + width, offset.top, true);\n      }\n\n      if (target) {\n        let offset = visible.locationOf(target);\n        let width = visible.width();\n        this.moveTo(offset, width);\n      }\n\n      displaying.resolve();\n      return displayed;\n    } // Hide all current views\n\n\n    this.clear();\n    let forceRight = false;\n\n    if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\n      forceRight = true;\n    }\n\n    this.add(section, forceRight).then(function (view) {\n      // Move to correct place within the section, if needed\n      if (target) {\n        let offset = view.locationOf(target);\n        let width = view.width();\n        this.moveTo(offset, width);\n      }\n    }.bind(this), err => {\n      displaying.reject(err);\n    }).then(function () {\n      return this.handleNextPrePaginated(forceRight, section, this.add);\n    }.bind(this)).then(function () {\n      this.views.show();\n      displaying.resolve();\n    }.bind(this)); // .then(function(){\n    // \treturn this.hooks.display.trigger(view);\n    // }.bind(this))\n    // .then(function(){\n    // \tthis.views.show();\n    // }.bind(this));\n\n    return displayed;\n  }\n\n  afterDisplayed(view) {\n    this.emit(_constants.EVENTS.MANAGERS.ADDED, view);\n  }\n\n  afterResized(view) {\n    this.emit(_constants.EVENTS.MANAGERS.RESIZE, view.section);\n  }\n\n  moveTo(offset, width) {\n    var distX = 0,\n        distY = 0;\n\n    if (!this.isPaginated) {\n      distY = offset.top;\n    } else {\n      distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n      if (distX + this.layout.delta > this.container.scrollWidth) {\n        distX = this.container.scrollWidth - this.layout.delta;\n      }\n\n      distY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\n\n      if (distY + this.layout.delta > this.container.scrollHeight) {\n        distY = this.container.scrollHeight - this.layout.delta;\n      }\n    }\n\n    if (this.settings.direction === 'rtl') {\n      /***\n      \tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta` \n      \tto distX or use `Math.ceil` function, or multiply offset.left by -1\n      \tbefore `Math.floor`\n      */\n      distX = distX + this.layout.delta;\n      distX = distX - width;\n    }\n\n    this.scrollTo(distX, distY, true);\n  }\n\n  add(section, forceRight) {\n    var view = this.createView(section, forceRight);\n    this.views.append(view); // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    view.on(_constants.EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(_constants.EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    return view.display(this.request);\n  }\n\n  append(section, forceRight) {\n    var view = this.createView(section, forceRight);\n    this.views.append(view);\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    view.on(_constants.EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(_constants.EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    return view.display(this.request);\n  }\n\n  prepend(section, forceRight) {\n    var view = this.createView(section, forceRight);\n    view.on(_constants.EVENTS.VIEWS.RESIZED, bounds => {\n      this.counter(bounds);\n    });\n    this.views.prepend(view);\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    view.on(_constants.EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(_constants.EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    return view.display(this.request);\n  }\n\n  counter(bounds) {\n    if (this.settings.axis === \"vertical\") {\n      this.scrollBy(0, bounds.heightDelta, true);\n    } else {\n      this.scrollBy(bounds.widthDelta, 0, true);\n    }\n  } // resizeView(view) {\n  //\n  // \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n  // \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n  // \t} else {\n  // \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n  // \t}\n  //\n  // };\n\n\n  next() {\n    var next;\n    var left;\n    let dir = this.settings.direction;\n    if (!this.views.length) return;\n\n    if (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n      this.scrollLeft = this.container.scrollLeft;\n      left = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n      if (left <= this.container.scrollWidth) {\n        this.scrollBy(this.layout.delta, 0, true);\n      } else {\n        next = this.views.last().section.next();\n      }\n    } else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n      this.scrollLeft = this.container.scrollLeft;\n\n      if (this.settings.rtlScrollType === \"default\") {\n        left = this.container.scrollLeft;\n\n        if (left > 0) {\n          this.scrollBy(this.layout.delta, 0, true);\n        } else {\n          next = this.views.last().section.next();\n        }\n      } else {\n        left = this.container.scrollLeft + this.layout.delta * -1;\n\n        if (left > this.container.scrollWidth * -1) {\n          this.scrollBy(this.layout.delta, 0, true);\n        } else {\n          next = this.views.last().section.next();\n        }\n      }\n    } else if (this.isPaginated && this.settings.axis === \"vertical\") {\n      this.scrollTop = this.container.scrollTop;\n      let top = this.container.scrollTop + this.container.offsetHeight;\n\n      if (top < this.container.scrollHeight) {\n        this.scrollBy(0, this.layout.height, true);\n      } else {\n        next = this.views.last().section.next();\n      }\n    } else {\n      next = this.views.last().section.next();\n    }\n\n    if (next) {\n      this.clear(); // The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\n      this.updateLayout();\n      let forceRight = false;\n\n      if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\n        forceRight = true;\n      }\n\n      return this.append(next, forceRight).then(function () {\n        return this.handleNextPrePaginated(forceRight, next, this.append);\n      }.bind(this), err => {\n        return err;\n      }).then(function () {\n        // Reset position to start for scrolled-doc vertical-rl in default mode\n        if (!this.isPaginated && this.settings.axis === \"horizontal\" && this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\") {\n          this.scrollTo(this.container.scrollWidth, 0, true);\n        }\n\n        this.views.show();\n      }.bind(this));\n    }\n  }\n\n  prev() {\n    var prev;\n    var left;\n    let dir = this.settings.direction;\n    if (!this.views.length) return;\n\n    if (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n      this.scrollLeft = this.container.scrollLeft;\n      left = this.container.scrollLeft;\n\n      if (left > 0) {\n        this.scrollBy(-this.layout.delta, 0, true);\n      } else {\n        prev = this.views.first().section.prev();\n      }\n    } else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n      this.scrollLeft = this.container.scrollLeft;\n\n      if (this.settings.rtlScrollType === \"default\") {\n        left = this.container.scrollLeft + this.container.offsetWidth;\n\n        if (left < this.container.scrollWidth) {\n          this.scrollBy(-this.layout.delta, 0, true);\n        } else {\n          prev = this.views.first().section.prev();\n        }\n      } else {\n        left = this.container.scrollLeft;\n\n        if (left < 0) {\n          this.scrollBy(-this.layout.delta, 0, true);\n        } else {\n          prev = this.views.first().section.prev();\n        }\n      }\n    } else if (this.isPaginated && this.settings.axis === \"vertical\") {\n      this.scrollTop = this.container.scrollTop;\n      let top = this.container.scrollTop;\n\n      if (top > 0) {\n        this.scrollBy(0, -this.layout.height, true);\n      } else {\n        prev = this.views.first().section.prev();\n      }\n    } else {\n      prev = this.views.first().section.prev();\n    }\n\n    if (prev) {\n      this.clear(); // The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\n      this.updateLayout();\n      let forceRight = false;\n\n      if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\n        forceRight = true;\n      }\n\n      return this.prepend(prev, forceRight).then(function () {\n        var left;\n\n        if (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n          left = prev.prev();\n\n          if (left) {\n            return this.prepend(left);\n          }\n        }\n      }.bind(this), err => {\n        return err;\n      }).then(function () {\n        if (this.isPaginated && this.settings.axis === \"horizontal\") {\n          if (this.settings.direction === \"rtl\") {\n            if (this.settings.rtlScrollType === \"default\") {\n              this.scrollTo(0, 0, true);\n            } else {\n              this.scrollTo(this.container.scrollWidth * -1 + this.layout.delta, 0, true);\n            }\n          } else {\n            this.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n          }\n        }\n\n        this.views.show();\n      }.bind(this));\n    }\n  }\n\n  current() {\n    var visible = this.visible();\n\n    if (visible.length) {\n      // Current is the last visible view\n      return visible[visible.length - 1];\n    }\n\n    return null;\n  }\n\n  clear() {\n    // this.q.clear();\n    if (this.views) {\n      this.views.hide();\n      this.scrollTo(0, 0, true);\n      this.views.clear();\n    }\n  }\n\n  currentLocation() {\n    this.updateLayout();\n\n    if (this.isPaginated && this.settings.axis === \"horizontal\") {\n      this.location = this.paginatedLocation();\n    } else {\n      this.location = this.scrolledLocation();\n    }\n\n    return this.location;\n  }\n\n  scrolledLocation() {\n    let visible = this.visible();\n    let container = this.container.getBoundingClientRect();\n    let pageHeight = container.height < window.innerHeight ? container.height : window.innerHeight;\n    let pageWidth = container.width < window.innerWidth ? container.width : window.innerWidth;\n    let vertical = this.settings.axis === \"vertical\";\n    let rtl = this.settings.direction === \"rtl\";\n    let offset = 0;\n    let used = 0;\n\n    if (this.settings.fullsize) {\n      offset = vertical ? window.scrollY : window.scrollX;\n    }\n\n    let sections = visible.map(view => {\n      let {\n        index,\n        href\n      } = view.section;\n      let position = view.position();\n      let width = view.width();\n      let height = view.height();\n      let startPos;\n      let endPos;\n      let stopPos;\n      let totalPages;\n\n      if (vertical) {\n        startPos = offset + container.top - position.top + used;\n        endPos = startPos + pageHeight - used;\n        totalPages = this.layout.count(height, pageHeight).pages;\n        stopPos = pageHeight;\n      } else {\n        startPos = offset + container.left - position.left + used;\n        endPos = startPos + pageWidth - used;\n        totalPages = this.layout.count(width, pageWidth).pages;\n        stopPos = pageWidth;\n      }\n\n      let currPage = Math.ceil(startPos / stopPos);\n      let pages = [];\n      let endPage = Math.ceil(endPos / stopPos); // Reverse page counts for horizontal rtl\n\n      if (this.settings.direction === \"rtl\" && !vertical) {\n        let tempStartPage = currPage;\n        currPage = totalPages - endPage;\n        endPage = totalPages - tempStartPage;\n      }\n\n      pages = [];\n\n      for (var i = currPage; i <= endPage; i++) {\n        let pg = i + 1;\n        pages.push(pg);\n      }\n\n      let mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n      return {\n        index,\n        href,\n        pages,\n        totalPages,\n        mapping\n      };\n    });\n    return sections;\n  }\n\n  paginatedLocation() {\n    let visible = this.visible();\n    let container = this.container.getBoundingClientRect();\n    let left = 0;\n    let used = 0;\n\n    if (this.settings.fullsize) {\n      left = window.scrollX;\n    }\n\n    let sections = visible.map(view => {\n      let {\n        index,\n        href\n      } = view.section;\n      let offset;\n      let position = view.position();\n      let width = view.width(); // Find mapping\n\n      let start;\n      let end;\n      let pageWidth;\n\n      if (this.settings.direction === \"rtl\") {\n        offset = container.right - left;\n        pageWidth = Math.min(Math.abs(offset - position.left), this.layout.width) - used;\n        end = position.width - (position.right - offset) - used;\n        start = end - pageWidth;\n      } else {\n        offset = container.left + left;\n        pageWidth = Math.min(position.right - offset, this.layout.width) - used;\n        start = offset - position.left + used;\n        end = start + pageWidth;\n      }\n\n      used += pageWidth;\n      let mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n      let totalPages = this.layout.count(width).pages;\n      let startPage = Math.floor(start / this.layout.pageWidth);\n      let pages = [];\n      let endPage = Math.floor(end / this.layout.pageWidth); // start page should not be negative\n\n      if (startPage < 0) {\n        startPage = 0;\n        endPage = endPage + 1;\n      } // Reverse page counts for rtl\n\n\n      if (this.settings.direction === \"rtl\") {\n        let tempStartPage = startPage;\n        startPage = totalPages - endPage;\n        endPage = totalPages - tempStartPage;\n      }\n\n      for (var i = startPage + 1; i <= endPage; i++) {\n        let pg = i;\n        pages.push(pg);\n      }\n\n      return {\n        index,\n        href,\n        pages,\n        totalPages,\n        mapping\n      };\n    });\n    return sections;\n  }\n\n  isVisible(view, offsetPrev, offsetNext, _container) {\n    var position = view.position();\n\n    var container = _container || this.bounds();\n\n    if (this.settings.axis === \"horizontal\" && position.right > container.left - offsetPrev && position.left < container.right + offsetNext) {\n      return true;\n    } else if (this.settings.axis === \"vertical\" && position.bottom > container.top - offsetPrev && position.top < container.bottom + offsetNext) {\n      return true;\n    }\n\n    return false;\n  }\n\n  visible() {\n    var container = this.bounds();\n    var views = this.views.displayed();\n    var viewsLength = views.length;\n    var visible = [];\n    var isVisible;\n    var view;\n\n    for (var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      isVisible = this.isVisible(view, 0, 0, container);\n\n      if (isVisible === true) {\n        visible.push(view);\n      }\n    }\n\n    return visible;\n  }\n\n  scrollBy(x, y, silent) {\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n    if (silent) {\n      this.ignore = true;\n    }\n\n    if (!this.settings.fullsize) {\n      if (x) this.container.scrollLeft += x * dir;\n      if (y) this.container.scrollTop += y;\n    } else {\n      window.scrollBy(x * dir, y * dir);\n    }\n\n    this.scrolled = true;\n  }\n\n  scrollTo(x, y, silent) {\n    if (silent) {\n      this.ignore = true;\n    }\n\n    if (!this.settings.fullsize) {\n      this.container.scrollLeft = x;\n      this.container.scrollTop = y;\n    } else {\n      window.scrollTo(x, y);\n    }\n\n    this.scrolled = true;\n  }\n\n  onScroll() {\n    let scrollTop;\n    let scrollLeft;\n\n    if (!this.settings.fullsize) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY;\n      scrollLeft = window.scrollX;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if (!this.ignore) {\n      this.emit(_constants.EVENTS.MANAGERS.SCROLL, {\n        top: scrollTop,\n        left: scrollLeft\n      });\n      clearTimeout(this.afterScrolled);\n      this.afterScrolled = setTimeout(function () {\n        this.emit(_constants.EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 20);\n    } else {\n      this.ignore = false;\n    }\n  }\n\n  bounds() {\n    var bounds;\n    bounds = this.stage.bounds();\n    return bounds;\n  }\n\n  applyLayout(layout) {\n    this.layout = layout;\n    this.updateLayout();\n\n    if (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\n      this.display(this.views.first().section);\n    } // this.manager.layout(this.layout.format);\n\n  }\n\n  updateLayout() {\n    if (!this.stage) {\n      return;\n    }\n\n    this._stageSize = this.stage.size();\n\n    if (!this.isPaginated) {\n      this.layout.calculate(this._stageSize.width, this._stageSize.height);\n    } else {\n      this.layout.calculate(this._stageSize.width, this._stageSize.height, this.settings.gap); // Set the look ahead offset for what is visible\n\n      this.settings.offset = this.layout.delta / this.layout.divisor; // this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n    } // Set the dimensions for views\n\n\n    this.viewSettings.width = this.layout.width;\n    this.viewSettings.height = this.layout.height;\n    this.setLayout(this.layout);\n  }\n\n  setLayout(layout) {\n    this.viewSettings.layout = layout;\n    this.mapping = new _mapping.default(layout.props, this.settings.direction, this.settings.axis);\n\n    if (this.views) {\n      this.views.forEach(function (view) {\n        if (view) {\n          view.setLayout(layout);\n        }\n      });\n    }\n  }\n\n  updateWritingMode(mode) {\n    this.writingMode = mode;\n  }\n\n  updateAxis(axis, forceUpdate) {\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n\n    this.settings.axis = axis;\n    this.stage && this.stage.axis(axis);\n    this.viewSettings.axis = axis;\n\n    if (this.mapping) {\n      this.mapping = new _mapping.default(this.layout.props, this.settings.direction, this.settings.axis);\n    }\n\n    if (this.layout) {\n      if (axis === \"vertical\") {\n        this.layout.spread(\"none\");\n      } else {\n        this.layout.spread(this.layout.settings.spread);\n      }\n    }\n  }\n\n  updateFlow(flow, defaultScrolledOverflow = \"auto\") {\n    let isPaginated = flow === \"paginated\" || flow === \"auto\";\n    this.isPaginated = isPaginated;\n\n    if (flow === \"scrolled-doc\" || flow === \"scrolled-continuous\" || flow === \"scrolled\") {\n      this.updateAxis(\"vertical\");\n    } else {\n      this.updateAxis(\"horizontal\");\n    }\n\n    this.viewSettings.flow = flow;\n\n    if (!this.settings.overflow) {\n      this.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\n    } else {\n      this.overflow = this.settings.overflow;\n    }\n\n    this.stage && this.stage.overflow(this.overflow);\n    this.updateLayout();\n  }\n\n  getContents() {\n    var contents = [];\n\n    if (!this.views) {\n      return contents;\n    }\n\n    this.views.forEach(function (view) {\n      const viewContents = view && view.contents;\n\n      if (viewContents) {\n        contents.push(viewContents);\n      }\n    });\n    return contents;\n  }\n\n  direction(dir = \"ltr\") {\n    this.settings.direction = dir;\n    this.stage && this.stage.direction(dir);\n    this.viewSettings.direction = dir;\n    this.updateLayout();\n  }\n\n  isRendered() {\n    return this.rendered;\n  }\n\n} //-- Enable binding events to Manager\n\n\n(0, _eventEmitter.default)(DefaultViewManager.prototype);\nvar _default = DefaultViewManager;\nexports.default = _default;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = exports.EXITING = exports.ENTERED = exports.ENTERING = exports.EXITED = exports.UNMOUNTED = void 0;\n\nvar PropTypes = _interopRequireWildcard(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\n\nvar _reactLifecyclesCompat = require(\"react-lifecycles-compat\");\n\nvar _PropTypes = require(\"./utils/PropTypes\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nvar UNMOUNTED = 'unmounted';\nexports.UNMOUNTED = UNMOUNTED;\nvar EXITED = 'exited';\nexports.EXITED = EXITED;\nvar ENTERING = 'entering';\nexports.ENTERING = ENTERING;\nvar ENTERED = 'entered';\nexports.ENTERED = ENTERED;\nvar EXITING = 'exiting';\n/**\n * The Transition component lets you describe a transition from one component\n * state to another _over time_ with a simple declarative API. Most commonly\n * it's used to animate the mounting and unmounting of a component, but can also\n * be used to describe in-place transition states as well.\n *\n * ---\n *\n * **Note**: `Transition` is a platform-agnostic base component. If you're using\n * transitions in CSS, you'll probably want to use\n * [`CSSTransition`](https://reactcommunity.org/react-transition-group/css-transition)\n * instead. It inherits all the features of `Transition`, but contains\n * additional features necessary to play nice with CSS transitions (hence the\n * name of the component).\n *\n * ---\n *\n * By default the `Transition` component does not alter the behavior of the\n * component it renders, it only tracks \"enter\" and \"exit\" states for the\n * components. It's up to you to give meaning and effect to those states. For\n * example we can add styles to a component when it enters or exits:\n *\n * ```jsx\n * import { Transition } from 'react-transition-group';\n *\n * const duration = 300;\n *\n * const defaultStyle = {\n *   transition: `opacity ${duration}ms ease-in-out`,\n *   opacity: 0,\n * }\n *\n * const transitionStyles = {\n *   entering: { opacity: 0 },\n *   entered:  { opacity: 1 },\n * };\n *\n * const Fade = ({ in: inProp }) => (\n *   <Transition in={inProp} timeout={duration}>\n *     {state => (\n *       <div style={{\n *         ...defaultStyle,\n *         ...transitionStyles[state]\n *       }}>\n *         I'm a fade Transition!\n *       </div>\n *     )}\n *   </Transition>\n * );\n * ```\n *\n * There are 4 main states a Transition can be in:\n *  - `'entering'`\n *  - `'entered'`\n *  - `'exiting'`\n *  - `'exited'`\n *\n * Transition state is toggled via the `in` prop. When `true` the component\n * begins the \"Enter\" stage. During this stage, the component will shift from\n * its current transition state, to `'entering'` for the duration of the\n * transition and then to the `'entered'` stage once it's complete. Let's take\n * the following example (we'll use the\n * [useState](https://reactjs.org/docs/hooks-reference.html#usestate) hook):\n *\n * ```jsx\n * function App() {\n *   const [inProp, setInProp] = useState(false);\n *   return (\n *     <div>\n *       <Transition in={inProp} timeout={500}>\n *         {state => (\n *           // ...\n *         )}\n *       </Transition>\n *       <button onClick={() => setInProp(true)}>\n *         Click to Enter\n *       </button>\n *     </div>\n *   );\n * }\n * ```\n *\n * When the button is clicked the component will shift to the `'entering'` state\n * and stay there for 500ms (the value of `timeout`) before it finally switches\n * to `'entered'`.\n *\n * When `in` is `false` the same thing happens except the state moves from\n * `'exiting'` to `'exited'`.\n */\n\nexports.EXITING = EXITING;\n\nvar Transition =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(Transition, _React$Component);\n\n  function Transition(props, context) {\n    var _this;\n\n    _this = _React$Component.call(this, props, context) || this;\n    var parentGroup = context.transitionGroup; // In the context of a TransitionGroup all enters are really appears\n\n    var appear = parentGroup && !parentGroup.isMounting ? props.enter : props.appear;\n    var initialStatus;\n    _this.appearStatus = null;\n\n    if (props.in) {\n      if (appear) {\n        initialStatus = EXITED;\n        _this.appearStatus = ENTERING;\n      } else {\n        initialStatus = ENTERED;\n      }\n    } else {\n      if (props.unmountOnExit || props.mountOnEnter) {\n        initialStatus = UNMOUNTED;\n      } else {\n        initialStatus = EXITED;\n      }\n    }\n\n    _this.state = {\n      status: initialStatus\n    };\n    _this.nextCallback = null;\n    return _this;\n  }\n\n  var _proto = Transition.prototype;\n\n  _proto.getChildContext = function getChildContext() {\n    return {\n      transitionGroup: null // allows for nested Transitions\n\n    };\n  };\n\n  Transition.getDerivedStateFromProps = function getDerivedStateFromProps(_ref, prevState) {\n    var nextIn = _ref.in;\n\n    if (nextIn && prevState.status === UNMOUNTED) {\n      return {\n        status: EXITED\n      };\n    }\n\n    return null;\n  }; // getSnapshotBeforeUpdate(prevProps) {\n  //   let nextStatus = null\n  //   if (prevProps !== this.props) {\n  //     const { status } = this.state\n  //     if (this.props.in) {\n  //       if (status !== ENTERING && status !== ENTERED) {\n  //         nextStatus = ENTERING\n  //       }\n  //     } else {\n  //       if (status === ENTERING || status === ENTERED) {\n  //         nextStatus = EXITING\n  //       }\n  //     }\n  //   }\n  //   return { nextStatus }\n  // }\n\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.updateStatus(true, this.appearStatus);\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    var nextStatus = null;\n\n    if (prevProps !== this.props) {\n      var status = this.state.status;\n\n      if (this.props.in) {\n        if (status !== ENTERING && status !== ENTERED) {\n          nextStatus = ENTERING;\n        }\n      } else {\n        if (status === ENTERING || status === ENTERED) {\n          nextStatus = EXITING;\n        }\n      }\n    }\n\n    this.updateStatus(false, nextStatus);\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    this.cancelNextCallback();\n  };\n\n  _proto.getTimeouts = function getTimeouts() {\n    var timeout = this.props.timeout;\n    var exit, enter, appear;\n    exit = enter = appear = timeout;\n\n    if (timeout != null && typeof timeout !== 'number') {\n      exit = timeout.exit;\n      enter = timeout.enter; // TODO: remove fallback for next major\n\n      appear = timeout.appear !== undefined ? timeout.appear : enter;\n    }\n\n    return {\n      exit: exit,\n      enter: enter,\n      appear: appear\n    };\n  };\n\n  _proto.updateStatus = function updateStatus(mounting, nextStatus) {\n    if (mounting === void 0) {\n      mounting = false;\n    }\n\n    if (nextStatus !== null) {\n      // nextStatus will always be ENTERING or EXITING.\n      this.cancelNextCallback();\n\n      var node = _reactDom.default.findDOMNode(this);\n\n      if (nextStatus === ENTERING) {\n        this.performEnter(node, mounting);\n      } else {\n        this.performExit(node);\n      }\n    } else if (this.props.unmountOnExit && this.state.status === EXITED) {\n      this.setState({\n        status: UNMOUNTED\n      });\n    }\n  };\n\n  _proto.performEnter = function performEnter(node, mounting) {\n    var _this2 = this;\n\n    var enter = this.props.enter;\n    var appearing = this.context.transitionGroup ? this.context.transitionGroup.isMounting : mounting;\n    var timeouts = this.getTimeouts();\n    var enterTimeout = appearing ? timeouts.appear : timeouts.enter; // no enter animation skip right to ENTERED\n    // if we are mounting and running this it means appear _must_ be set\n\n    if (!mounting && !enter) {\n      this.safeSetState({\n        status: ENTERED\n      }, function () {\n        _this2.props.onEntered(node);\n      });\n      return;\n    }\n\n    this.props.onEnter(node, appearing);\n    this.safeSetState({\n      status: ENTERING\n    }, function () {\n      _this2.props.onEntering(node, appearing);\n\n      _this2.onTransitionEnd(node, enterTimeout, function () {\n        _this2.safeSetState({\n          status: ENTERED\n        }, function () {\n          _this2.props.onEntered(node, appearing);\n        });\n      });\n    });\n  };\n\n  _proto.performExit = function performExit(node) {\n    var _this3 = this;\n\n    var exit = this.props.exit;\n    var timeouts = this.getTimeouts(); // no exit animation skip right to EXITED\n\n    if (!exit) {\n      this.safeSetState({\n        status: EXITED\n      }, function () {\n        _this3.props.onExited(node);\n      });\n      return;\n    }\n\n    this.props.onExit(node);\n    this.safeSetState({\n      status: EXITING\n    }, function () {\n      _this3.props.onExiting(node);\n\n      _this3.onTransitionEnd(node, timeouts.exit, function () {\n        _this3.safeSetState({\n          status: EXITED\n        }, function () {\n          _this3.props.onExited(node);\n        });\n      });\n    });\n  };\n\n  _proto.cancelNextCallback = function cancelNextCallback() {\n    if (this.nextCallback !== null) {\n      this.nextCallback.cancel();\n      this.nextCallback = null;\n    }\n  };\n\n  _proto.safeSetState = function safeSetState(nextState, callback) {\n    // This shouldn't be necessary, but there are weird race conditions with\n    // setState callbacks and unmounting in testing, so always make sure that\n    // we can cancel any pending setState callbacks after we unmount.\n    callback = this.setNextCallback(callback);\n    this.setState(nextState, callback);\n  };\n\n  _proto.setNextCallback = function setNextCallback(callback) {\n    var _this4 = this;\n\n    var active = true;\n\n    this.nextCallback = function (event) {\n      if (active) {\n        active = false;\n        _this4.nextCallback = null;\n        callback(event);\n      }\n    };\n\n    this.nextCallback.cancel = function () {\n      active = false;\n    };\n\n    return this.nextCallback;\n  };\n\n  _proto.onTransitionEnd = function onTransitionEnd(node, timeout, handler) {\n    this.setNextCallback(handler);\n    var doesNotHaveTimeoutOrListener = timeout == null && !this.props.addEndListener;\n\n    if (!node || doesNotHaveTimeoutOrListener) {\n      setTimeout(this.nextCallback, 0);\n      return;\n    }\n\n    if (this.props.addEndListener) {\n      this.props.addEndListener(node, this.nextCallback);\n    }\n\n    if (timeout != null) {\n      setTimeout(this.nextCallback, timeout);\n    }\n  };\n\n  _proto.render = function render() {\n    var status = this.state.status;\n\n    if (status === UNMOUNTED) {\n      return null;\n    }\n\n    var _this$props = this.props,\n        children = _this$props.children,\n        childProps = _objectWithoutPropertiesLoose(_this$props, [\"children\"]); // filter props for Transtition\n\n\n    delete childProps.in;\n    delete childProps.mountOnEnter;\n    delete childProps.unmountOnExit;\n    delete childProps.appear;\n    delete childProps.enter;\n    delete childProps.exit;\n    delete childProps.timeout;\n    delete childProps.addEndListener;\n    delete childProps.onEnter;\n    delete childProps.onEntering;\n    delete childProps.onEntered;\n    delete childProps.onExit;\n    delete childProps.onExiting;\n    delete childProps.onExited;\n\n    if (typeof children === 'function') {\n      return children(status, childProps);\n    }\n\n    var child = _react.default.Children.only(children);\n\n    return _react.default.cloneElement(child, childProps);\n  };\n\n  return Transition;\n}(_react.default.Component);\n\nTransition.contextTypes = {\n  transitionGroup: PropTypes.object\n};\nTransition.childContextTypes = {\n  transitionGroup: function transitionGroup() {}\n};\nTransition.propTypes = process.env.NODE_ENV !== \"production\" ? {\n  /**\n   * A `function` child can be used instead of a React element. This function is\n   * called with the current transition status (`'entering'`, `'entered'`,\n   * `'exiting'`, `'exited'`, `'unmounted'`), which can be used to apply context\n   * specific props to a component.\n   *\n   * ```jsx\n   * <Transition in={this.state.in} timeout={150}>\n   *   {state => (\n   *     <MyComponent className={`fade fade-${state}`} />\n   *   )}\n   * </Transition>\n   * ```\n   */\n  children: PropTypes.oneOfType([PropTypes.func.isRequired, PropTypes.element.isRequired]).isRequired,\n\n  /**\n   * Show the component; triggers the enter or exit states\n   */\n  in: PropTypes.bool,\n\n  /**\n   * By default the child component is mounted immediately along with\n   * the parent `Transition` component. If you want to \"lazy mount\" the component on the\n   * first `in={true}` you can set `mountOnEnter`. After the first enter transition the component will stay\n   * mounted, even on \"exited\", unless you also specify `unmountOnExit`.\n   */\n  mountOnEnter: PropTypes.bool,\n\n  /**\n   * By default the child component stays mounted after it reaches the `'exited'` state.\n   * Set `unmountOnExit` if you'd prefer to unmount the component after it finishes exiting.\n   */\n  unmountOnExit: PropTypes.bool,\n\n  /**\n   * Normally a component is not transitioned if it is shown when the `<Transition>` component mounts.\n   * If you want to transition on the first mount set `appear` to `true`, and the\n   * component will transition in as soon as the `<Transition>` mounts.\n   *\n   * > Note: there are no specific \"appear\" states. `appear` only adds an additional `enter` transition.\n   */\n  appear: PropTypes.bool,\n\n  /**\n   * Enable or disable enter transitions.\n   */\n  enter: PropTypes.bool,\n\n  /**\n   * Enable or disable exit transitions.\n   */\n  exit: PropTypes.bool,\n\n  /**\n   * The duration of the transition, in milliseconds.\n   * Required unless `addEndListener` is provided.\n   *\n   * You may specify a single timeout for all transitions:\n   *\n   * ```jsx\n   * timeout={500}\n   * ```\n   *\n   * or individually:\n   *\n   * ```jsx\n   * timeout={{\n   *  appear: 500,\n   *  enter: 300,\n   *  exit: 500,\n   * }}\n   * ```\n   *\n   * - `appear` defaults to the value of `enter`\n   * - `enter` defaults to `0`\n   * - `exit` defaults to `0`\n   *\n   * @type {number | { enter?: number, exit?: number, appear?: number }}\n   */\n  timeout: function timeout(props) {\n    var pt = _PropTypes.timeoutsShape;\n    if (!props.addEndListener) pt = pt.isRequired;\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    return pt.apply(void 0, [props].concat(args));\n  },\n\n  /**\n   * Add a custom transition end trigger. Called with the transitioning\n   * DOM node and a `done` callback. Allows for more fine grained transition end\n   * logic. **Note:** Timeouts are still used as a fallback if provided.\n   *\n   * ```jsx\n   * addEndListener={(node, done) => {\n   *   // use the css transitionend event to mark the finish of a transition\n   *   node.addEventListener('transitionend', done, false);\n   * }}\n   * ```\n   */\n  addEndListener: PropTypes.func,\n\n  /**\n   * Callback fired before the \"entering\" status is applied. An extra parameter\n   * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool) -> void\n   */\n  onEnter: PropTypes.func,\n\n  /**\n   * Callback fired after the \"entering\" status is applied. An extra parameter\n   * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEntering: PropTypes.func,\n\n  /**\n   * Callback fired after the \"entered\" status is applied. An extra parameter\n   * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool) -> void\n   */\n  onEntered: PropTypes.func,\n\n  /**\n   * Callback fired before the \"exiting\" status is applied.\n   *\n   * @type Function(node: HtmlElement) -> void\n   */\n  onExit: PropTypes.func,\n\n  /**\n   * Callback fired after the \"exiting\" status is applied.\n   *\n   * @type Function(node: HtmlElement) -> void\n   */\n  onExiting: PropTypes.func,\n\n  /**\n   * Callback fired after the \"exited\" status is applied.\n   *\n   * @type Function(node: HtmlElement) -> void\n   */\n  onExited: PropTypes.func // Name the function so it is clearer in the documentation\n\n} : {};\n\nfunction noop() {}\n\nTransition.defaultProps = {\n  in: false,\n  mountOnEnter: false,\n  unmountOnExit: false,\n  appear: false,\n  enter: true,\n  exit: true,\n  onEnter: noop,\n  onEntering: noop,\n  onEntered: noop,\n  onExit: noop,\n  onExiting: noop,\n  onExited: noop\n};\nTransition.UNMOUNTED = 0;\nTransition.EXITED = 1;\nTransition.ENTERING = 2;\nTransition.ENTERED = 3;\nTransition.EXITING = 4;\n\nvar _default = (0, _reactLifecyclesCompat.polyfill)(Transition);\n\nexports.default = _default;","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction componentWillMount() {\n  // Call this.constructor.gDSFP to support sub-classes.\n  var state = this.constructor.getDerivedStateFromProps(this.props, this.state);\n  if (state !== null && state !== undefined) {\n    this.setState(state);\n  }\n}\n\nfunction componentWillReceiveProps(nextProps) {\n  // Call this.constructor.gDSFP to support sub-classes.\n  // Use the setState() updater to ensure state isn't stale in certain edge cases.\n  function updater(prevState) {\n    var state = this.constructor.getDerivedStateFromProps(nextProps, prevState);\n    return state !== null && state !== undefined ? state : null;\n  }\n  // Binding \"this\" is important for shallow renderer support.\n  this.setState(updater.bind(this));\n}\n\nfunction componentWillUpdate(nextProps, nextState) {\n  try {\n    var prevProps = this.props;\n    var prevState = this.state;\n    this.props = nextProps;\n    this.state = nextState;\n    this.__reactInternalSnapshotFlag = true;\n    this.__reactInternalSnapshot = this.getSnapshotBeforeUpdate(\n      prevProps,\n      prevState\n    );\n  } finally {\n    this.props = prevProps;\n    this.state = prevState;\n  }\n}\n\n// React may warn about cWM/cWRP/cWU methods being deprecated.\n// Add a flag to suppress these warnings for this special case.\ncomponentWillMount.__suppressDeprecationWarning = true;\ncomponentWillReceiveProps.__suppressDeprecationWarning = true;\ncomponentWillUpdate.__suppressDeprecationWarning = true;\n\nfunction polyfill(Component) {\n  var prototype = Component.prototype;\n\n  if (!prototype || !prototype.isReactComponent) {\n    throw new Error('Can only polyfill class components');\n  }\n\n  if (\n    typeof Component.getDerivedStateFromProps !== 'function' &&\n    typeof prototype.getSnapshotBeforeUpdate !== 'function'\n  ) {\n    return Component;\n  }\n\n  // If new component APIs are defined, \"unsafe\" lifecycles won't be called.\n  // Error if any of these lifecycles are present,\n  // Because they would work differently between older and newer (16.3+) versions of React.\n  var foundWillMountName = null;\n  var foundWillReceivePropsName = null;\n  var foundWillUpdateName = null;\n  if (typeof prototype.componentWillMount === 'function') {\n    foundWillMountName = 'componentWillMount';\n  } else if (typeof prototype.UNSAFE_componentWillMount === 'function') {\n    foundWillMountName = 'UNSAFE_componentWillMount';\n  }\n  if (typeof prototype.componentWillReceiveProps === 'function') {\n    foundWillReceivePropsName = 'componentWillReceiveProps';\n  } else if (typeof prototype.UNSAFE_componentWillReceiveProps === 'function') {\n    foundWillReceivePropsName = 'UNSAFE_componentWillReceiveProps';\n  }\n  if (typeof prototype.componentWillUpdate === 'function') {\n    foundWillUpdateName = 'componentWillUpdate';\n  } else if (typeof prototype.UNSAFE_componentWillUpdate === 'function') {\n    foundWillUpdateName = 'UNSAFE_componentWillUpdate';\n  }\n  if (\n    foundWillMountName !== null ||\n    foundWillReceivePropsName !== null ||\n    foundWillUpdateName !== null\n  ) {\n    var componentName = Component.displayName || Component.name;\n    var newApiName =\n      typeof Component.getDerivedStateFromProps === 'function'\n        ? 'getDerivedStateFromProps()'\n        : 'getSnapshotBeforeUpdate()';\n\n    throw Error(\n      'Unsafe legacy lifecycles will not be called for components using new component APIs.\\n\\n' +\n        componentName +\n        ' uses ' +\n        newApiName +\n        ' but also contains the following legacy lifecycles:' +\n        (foundWillMountName !== null ? '\\n  ' + foundWillMountName : '') +\n        (foundWillReceivePropsName !== null\n          ? '\\n  ' + foundWillReceivePropsName\n          : '') +\n        (foundWillUpdateName !== null ? '\\n  ' + foundWillUpdateName : '') +\n        '\\n\\nThe above lifecycles should be removed. Learn more about this warning here:\\n' +\n        'https://fb.me/react-async-component-lifecycle-hooks'\n    );\n  }\n\n  // React <= 16.2 does not support static getDerivedStateFromProps.\n  // As a workaround, use cWM and cWRP to invoke the new static lifecycle.\n  // Newer versions of React will ignore these lifecycles if gDSFP exists.\n  if (typeof Component.getDerivedStateFromProps === 'function') {\n    prototype.componentWillMount = componentWillMount;\n    prototype.componentWillReceiveProps = componentWillReceiveProps;\n  }\n\n  // React <= 16.2 does not support getSnapshotBeforeUpdate.\n  // As a workaround, use cWU to invoke the new lifecycle.\n  // Newer versions of React will ignore that lifecycle if gSBU exists.\n  if (typeof prototype.getSnapshotBeforeUpdate === 'function') {\n    if (typeof prototype.componentDidUpdate !== 'function') {\n      throw new Error(\n        'Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype'\n      );\n    }\n\n    prototype.componentWillUpdate = componentWillUpdate;\n\n    var componentDidUpdate = prototype.componentDidUpdate;\n\n    prototype.componentDidUpdate = function componentDidUpdatePolyfill(\n      prevProps,\n      prevState,\n      maybeSnapshot\n    ) {\n      // 16.3+ will not execute our will-update method;\n      // It will pass a snapshot value to did-update though.\n      // Older versions will require our polyfilled will-update value.\n      // We need to handle both cases, but can't just check for the presence of \"maybeSnapshot\",\n      // Because for <= 15.x versions this might be a \"prevContext\" object.\n      // We also can't just check \"__reactInternalSnapshot\",\n      // Because get-snapshot might return a falsy value.\n      // So check for the explicit __reactInternalSnapshotFlag flag to determine behavior.\n      var snapshot = this.__reactInternalSnapshotFlag\n        ? this.__reactInternalSnapshot\n        : maybeSnapshot;\n\n      componentDidUpdate.call(this, prevProps, prevState, snapshot);\n    };\n  }\n\n  return Component;\n}\n\nexport { polyfill };\n","\"use strict\";\n\nexports.__esModule = true;\nexports.classNamesShape = exports.timeoutsShape = void 0;\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar timeoutsShape = process.env.NODE_ENV !== 'production' ? _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.shape({\n  enter: _propTypes.default.number,\n  exit: _propTypes.default.number,\n  appear: _propTypes.default.number\n}).isRequired]) : null;\nexports.timeoutsShape = timeoutsShape;\nvar classNamesShape = process.env.NODE_ENV !== 'production' ? _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.shape({\n  enter: _propTypes.default.string,\n  exit: _propTypes.default.string,\n  active: _propTypes.default.string\n}), _propTypes.default.shape({\n  enter: _propTypes.default.string,\n  enterDone: _propTypes.default.string,\n  enterActive: _propTypes.default.string,\n  exit: _propTypes.default.string,\n  exitDone: _propTypes.default.string,\n  exitActive: _propTypes.default.string\n})]) : null;\nexports.classNamesShape = classNamesShape;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactLifecyclesCompat = require(\"react-lifecycles-compat\");\n\nvar _ChildMapping = require(\"./utils/ChildMapping\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nvar values = Object.values || function (obj) {\n  return Object.keys(obj).map(function (k) {\n    return obj[k];\n  });\n};\n\nvar defaultProps = {\n  component: 'div',\n  childFactory: function childFactory(child) {\n    return child;\n  }\n  /**\n   * The `<TransitionGroup>` component manages a set of transition components\n   * (`<Transition>` and `<CSSTransition>`) in a list. Like with the transition\n   * components, `<TransitionGroup>` is a state machine for managing the mounting\n   * and unmounting of components over time.\n   *\n   * Consider the example below. As items are removed or added to the TodoList the\n   * `in` prop is toggled automatically by the `<TransitionGroup>`.\n   *\n   * Note that `<TransitionGroup>`  does not define any animation behavior!\n   * Exactly _how_ a list item animates is up to the individual transition\n   * component. This means you can mix and match animations across different list\n   * items.\n   */\n\n};\n\nvar TransitionGroup =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(TransitionGroup, _React$Component);\n\n  function TransitionGroup(props, context) {\n    var _this;\n\n    _this = _React$Component.call(this, props, context) || this;\n\n    var handleExited = _this.handleExited.bind(_assertThisInitialized(_assertThisInitialized(_this))); // Initial children should all be entering, dependent on appear\n\n\n    _this.state = {\n      handleExited: handleExited,\n      firstRender: true\n    };\n    return _this;\n  }\n\n  var _proto = TransitionGroup.prototype;\n\n  _proto.getChildContext = function getChildContext() {\n    return {\n      transitionGroup: {\n        isMounting: !this.appeared\n      }\n    };\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    this.appeared = true;\n    this.mounted = true;\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    this.mounted = false;\n  };\n\n  TransitionGroup.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, _ref) {\n    var prevChildMapping = _ref.children,\n        handleExited = _ref.handleExited,\n        firstRender = _ref.firstRender;\n    return {\n      children: firstRender ? (0, _ChildMapping.getInitialChildMapping)(nextProps, handleExited) : (0, _ChildMapping.getNextChildMapping)(nextProps, prevChildMapping, handleExited),\n      firstRender: false\n    };\n  };\n\n  _proto.handleExited = function handleExited(child, node) {\n    var currentChildMapping = (0, _ChildMapping.getChildMapping)(this.props.children);\n    if (child.key in currentChildMapping) return;\n\n    if (child.props.onExited) {\n      child.props.onExited(node);\n    }\n\n    if (this.mounted) {\n      this.setState(function (state) {\n        var children = _extends({}, state.children);\n\n        delete children[child.key];\n        return {\n          children: children\n        };\n      });\n    }\n  };\n\n  _proto.render = function render() {\n    var _this$props = this.props,\n        Component = _this$props.component,\n        childFactory = _this$props.childFactory,\n        props = _objectWithoutPropertiesLoose(_this$props, [\"component\", \"childFactory\"]);\n\n    var children = values(this.state.children).map(childFactory);\n    delete props.appear;\n    delete props.enter;\n    delete props.exit;\n\n    if (Component === null) {\n      return children;\n    }\n\n    return _react.default.createElement(Component, props, children);\n  };\n\n  return TransitionGroup;\n}(_react.default.Component);\n\nTransitionGroup.childContextTypes = {\n  transitionGroup: _propTypes.default.object.isRequired\n};\nTransitionGroup.propTypes = process.env.NODE_ENV !== \"production\" ? {\n  /**\n   * `<TransitionGroup>` renders a `<div>` by default. You can change this\n   * behavior by providing a `component` prop.\n   * If you use React v16+ and would like to avoid a wrapping `<div>` element\n   * you can pass in `component={null}`. This is useful if the wrapping div\n   * borks your css styles.\n   */\n  component: _propTypes.default.any,\n\n  /**\n   * A set of `<Transition>` components, that are toggled `in` and out as they\n   * leave. the `<TransitionGroup>` will inject specific transition props, so\n   * remember to spread them through if you are wrapping the `<Transition>` as\n   * with our `<Fade>` example.\n   *\n   * While this component is meant for multiple `Transition` or `CSSTransition`\n   * children, sometimes you may want to have a single transition child with\n   * content that you want to be transitioned out and in when you change it\n   * (e.g. routes, images etc.) In that case you can change the `key` prop of\n   * the transition child as you change its content, this will cause\n   * `TransitionGroup` to transition the child out and back in.\n   */\n  children: _propTypes.default.node,\n\n  /**\n   * A convenience prop that enables or disables appear animations\n   * for all children. Note that specifying this will override any defaults set\n   * on individual children Transitions.\n   */\n  appear: _propTypes.default.bool,\n\n  /**\n   * A convenience prop that enables or disables enter animations\n   * for all children. Note that specifying this will override any defaults set\n   * on individual children Transitions.\n   */\n  enter: _propTypes.default.bool,\n\n  /**\n   * A convenience prop that enables or disables exit animations\n   * for all children. Note that specifying this will override any defaults set\n   * on individual children Transitions.\n   */\n  exit: _propTypes.default.bool,\n\n  /**\n   * You may need to apply reactive updates to a child as it is exiting.\n   * This is generally done by using `cloneElement` however in the case of an exiting\n   * child the element has already been removed and not accessible to the consumer.\n   *\n   * If you do need to update a child as it leaves you can provide a `childFactory`\n   * to wrap every child, even the ones that are leaving.\n   *\n   * @type Function(child: ReactElement) -> ReactElement\n   */\n  childFactory: _propTypes.default.func\n} : {};\nTransitionGroup.defaultProps = defaultProps;\n\nvar _default = (0, _reactLifecyclesCompat.polyfill)(TransitionGroup);\n\nexports.default = _default;\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"EpubView\", {\n  enumerable: true,\n  get: function get() {\n    return _EpubView.default;\n  }\n});\nObject.defineProperty(exports, \"EpubViewStyle\", {\n  enumerable: true,\n  get: function get() {\n    return _style.default;\n  }\n});\nObject.defineProperty(exports, \"ReactReader\", {\n  enumerable: true,\n  get: function get() {\n    return _ReactReader.default;\n  }\n});\nObject.defineProperty(exports, \"ReactReaderStyle\", {\n  enumerable: true,\n  get: function get() {\n    return _style2.default;\n  }\n});\n\nvar _EpubView = _interopRequireDefault(require(\"./EpubView/EpubView\"));\n\nvar _style = _interopRequireDefault(require(\"./EpubView/style\"));\n\nvar _ReactReader = _interopRequireDefault(require(\"./ReactReader/ReactReader\"));\n\nvar _style2 = _interopRequireDefault(require(\"./ReactReader/style\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _core = require(\"./utils/core\");\n\nvar _url = _interopRequireDefault(require(\"./utils/url\"));\n\nvar _path = _interopRequireDefault(require(\"./utils/path\"));\n\nvar _spine = _interopRequireDefault(require(\"./spine\"));\n\nvar _locations = _interopRequireDefault(require(\"./locations\"));\n\nvar _container = _interopRequireDefault(require(\"./container\"));\n\nvar _packaging = _interopRequireDefault(require(\"./packaging\"));\n\nvar _navigation = _interopRequireDefault(require(\"./navigation\"));\n\nvar _resources = _interopRequireDefault(require(\"./resources\"));\n\nvar _pagelist = _interopRequireDefault(require(\"./pagelist\"));\n\nvar _rendition = _interopRequireDefault(require(\"./rendition\"));\n\nvar _archive = _interopRequireDefault(require(\"./archive\"));\n\nvar _request2 = _interopRequireDefault(require(\"./utils/request\"));\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _store = _interopRequireDefault(require(\"./store\"));\n\nvar _displayoptions = _interopRequireDefault(require(\"./displayoptions\"));\n\nvar _constants = require(\"./utils/constants\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst CONTAINER_PATH = \"META-INF/container.xml\";\nconst IBOOKS_DISPLAY_OPTIONS_PATH = \"META-INF/com.apple.ibooks.display-options.xml\";\nconst INPUT_TYPE = {\n  BINARY: \"binary\",\n  BASE64: \"base64\",\n  EPUB: \"epub\",\n  OPF: \"opf\",\n  MANIFEST: \"json\",\n  DIRECTORY: \"directory\"\n};\n/**\n * An Epub representation with methods for the loading, parsing and manipulation\n * of its contents.\n * @class\n * @param {string} [url]\n * @param {object} [options]\n * @param {method} [options.requestMethod] a request function to use instead of the default\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\n * @param {string} [options.replacements=none] use base64, blobUrl, or none for replacing assets in archived Epubs\n * @param {method} [options.canonical] optional function to determine canonical urls for a path\n * @param {string} [options.openAs] optional string to determine the input type\n * @param {string} [options.store=false] cache the contents in local storage, value should be the name of the reader\n * @returns {Book}\n * @example new Book(\"/path/to/book.epub\", {})\n * @example new Book({ replacements: \"blobUrl\" })\n */\n\nclass Book {\n  constructor(url, options) {\n    // Allow passing just options to the Book\n    if (typeof options === \"undefined\" && typeof url !== \"string\" && url instanceof Blob === false && url instanceof ArrayBuffer === false) {\n      options = url;\n      url = undefined;\n    }\n\n    this.settings = (0, _core.extend)(this.settings || {}, {\n      requestMethod: undefined,\n      requestCredentials: undefined,\n      requestHeaders: undefined,\n      encoding: undefined,\n      replacements: undefined,\n      canonical: undefined,\n      openAs: undefined,\n      store: undefined\n    });\n    (0, _core.extend)(this.settings, options); // Promises\n\n    this.opening = new _core.defer();\n    /**\n     * @member {promise} opened returns after the book is loaded\n     * @memberof Book\n     */\n\n    this.opened = this.opening.promise;\n    this.isOpen = false;\n    this.loading = {\n      manifest: new _core.defer(),\n      spine: new _core.defer(),\n      metadata: new _core.defer(),\n      cover: new _core.defer(),\n      navigation: new _core.defer(),\n      pageList: new _core.defer(),\n      resources: new _core.defer(),\n      displayOptions: new _core.defer()\n    };\n    this.loaded = {\n      manifest: this.loading.manifest.promise,\n      spine: this.loading.spine.promise,\n      metadata: this.loading.metadata.promise,\n      cover: this.loading.cover.promise,\n      navigation: this.loading.navigation.promise,\n      pageList: this.loading.pageList.promise,\n      resources: this.loading.resources.promise,\n      displayOptions: this.loading.displayOptions.promise\n    };\n    /**\n     * @member {promise} ready returns after the book is loaded and parsed\n     * @memberof Book\n     * @private\n     */\n\n    this.ready = Promise.all([this.loaded.manifest, this.loaded.spine, this.loaded.metadata, this.loaded.cover, this.loaded.navigation, this.loaded.resources, this.loaded.displayOptions]); // Queue for methods used before opening\n\n    this.isRendered = false; // this._q = queue(this);\n\n    /**\n     * @member {method} request\n     * @memberof Book\n     * @private\n     */\n\n    this.request = this.settings.requestMethod || _request2.default;\n    /**\n     * @member {Spine} spine\n     * @memberof Book\n     */\n\n    this.spine = new _spine.default();\n    /**\n     * @member {Locations} locations\n     * @memberof Book\n     */\n\n    this.locations = new _locations.default(this.spine, this.load.bind(this));\n    /**\n     * @member {Navigation} navigation\n     * @memberof Book\n     */\n\n    this.navigation = undefined;\n    /**\n     * @member {PageList} pagelist\n     * @memberof Book\n     */\n\n    this.pageList = undefined;\n    /**\n     * @member {Url} url\n     * @memberof Book\n     * @private\n     */\n\n    this.url = undefined;\n    /**\n     * @member {Path} path\n     * @memberof Book\n     * @private\n     */\n\n    this.path = undefined;\n    /**\n     * @member {boolean} archived\n     * @memberof Book\n     * @private\n     */\n\n    this.archived = false;\n    /**\n     * @member {Archive} archive\n     * @memberof Book\n     * @private\n     */\n\n    this.archive = undefined;\n    /**\n     * @member {Store} storage\n     * @memberof Book\n     * @private\n     */\n\n    this.storage = undefined;\n    /**\n     * @member {Resources} resources\n     * @memberof Book\n     * @private\n     */\n\n    this.resources = undefined;\n    /**\n     * @member {Rendition} rendition\n     * @memberof Book\n     * @private\n     */\n\n    this.rendition = undefined;\n    /**\n     * @member {Container} container\n     * @memberof Book\n     * @private\n     */\n\n    this.container = undefined;\n    /**\n     * @member {Packaging} packaging\n     * @memberof Book\n     * @private\n     */\n\n    this.packaging = undefined;\n    /**\n     * @member {DisplayOptions} displayOptions\n     * @memberof DisplayOptions\n     * @private\n     */\n\n    this.displayOptions = undefined; // this.toc = undefined;\n\n    if (this.settings.store) {\n      this.store(this.settings.store);\n    }\n\n    if (url) {\n      this.open(url, this.settings.openAs).catch(error => {\n        var err = new Error(\"Cannot load book at \" + url);\n        this.emit(_constants.EVENTS.BOOK.OPEN_FAILED, err);\n      });\n    }\n  }\n  /**\n   * Open a epub or url\n   * @param {string | ArrayBuffer} input Url, Path or ArrayBuffer\n   * @param {string} [what=\"binary\", \"base64\", \"epub\", \"opf\", \"json\", \"directory\"] force opening as a certain type\n   * @returns {Promise} of when the book has been loaded\n   * @example book.open(\"/path/to/book.epub\")\n   */\n\n\n  open(input, what) {\n    var opening;\n    var type = what || this.determineType(input);\n\n    if (type === INPUT_TYPE.BINARY) {\n      this.archived = true;\n      this.url = new _url.default(\"/\", \"\");\n      opening = this.openEpub(input);\n    } else if (type === INPUT_TYPE.BASE64) {\n      this.archived = true;\n      this.url = new _url.default(\"/\", \"\");\n      opening = this.openEpub(input, type);\n    } else if (type === INPUT_TYPE.EPUB) {\n      this.archived = true;\n      this.url = new _url.default(\"/\", \"\");\n      opening = this.request(input, \"binary\", this.settings.requestCredentials, this.settings.requestHeaders).then(this.openEpub.bind(this));\n    } else if (type == INPUT_TYPE.OPF) {\n      this.url = new _url.default(input);\n      opening = this.openPackaging(this.url.Path.toString());\n    } else if (type == INPUT_TYPE.MANIFEST) {\n      this.url = new _url.default(input);\n      opening = this.openManifest(this.url.Path.toString());\n    } else {\n      this.url = new _url.default(input);\n      opening = this.openContainer(CONTAINER_PATH).then(this.openPackaging.bind(this));\n    }\n\n    return opening;\n  }\n  /**\n   * Open an archived epub\n   * @private\n   * @param  {binary} data\n   * @param  {string} [encoding]\n   * @return {Promise}\n   */\n\n\n  openEpub(data, encoding) {\n    return this.unarchive(data, encoding || this.settings.encoding).then(() => {\n      return this.openContainer(CONTAINER_PATH);\n    }).then(packagePath => {\n      return this.openPackaging(packagePath);\n    });\n  }\n  /**\n   * Open the epub container\n   * @private\n   * @param  {string} url\n   * @return {string} packagePath\n   */\n\n\n  openContainer(url) {\n    return this.load(url).then(xml => {\n      this.container = new _container.default(xml);\n      return this.resolve(this.container.packagePath);\n    });\n  }\n  /**\n   * Open the Open Packaging Format Xml\n   * @private\n   * @param  {string} url\n   * @return {Promise}\n   */\n\n\n  openPackaging(url) {\n    this.path = new _path.default(url);\n    return this.load(url).then(xml => {\n      this.packaging = new _packaging.default(xml);\n      return this.unpack(this.packaging);\n    });\n  }\n  /**\n   * Open the manifest JSON\n   * @private\n   * @param  {string} url\n   * @return {Promise}\n   */\n\n\n  openManifest(url) {\n    this.path = new _path.default(url);\n    return this.load(url).then(json => {\n      this.packaging = new _packaging.default();\n      this.packaging.load(json);\n      return this.unpack(this.packaging);\n    });\n  }\n  /**\n   * Load a resource from the Book\n   * @param  {string} path path to the resource to load\n   * @return {Promise}     returns a promise with the requested resource\n   */\n\n\n  load(path) {\n    var resolved = this.resolve(path);\n\n    if (this.archived) {\n      return this.archive.request(resolved);\n    } else {\n      return this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\n    }\n  }\n  /**\n   * Resolve a path to it's absolute position in the Book\n   * @param  {string} path\n   * @param  {boolean} [absolute] force resolving the full URL\n   * @return {string}          the resolved path string\n   */\n\n\n  resolve(path, absolute) {\n    if (!path) {\n      return;\n    }\n\n    var resolved = path;\n    var isAbsolute = path.indexOf(\"://\") > -1;\n\n    if (isAbsolute) {\n      return path;\n    }\n\n    if (this.path) {\n      resolved = this.path.resolve(path);\n    }\n\n    if (absolute != false && this.url) {\n      resolved = this.url.resolve(resolved);\n    }\n\n    return resolved;\n  }\n  /**\n   * Get a canonical link to a path\n   * @param  {string} path\n   * @return {string} the canonical path string\n   */\n\n\n  canonical(path) {\n    var url = path;\n\n    if (!path) {\n      return \"\";\n    }\n\n    if (this.settings.canonical) {\n      url = this.settings.canonical(path);\n    } else {\n      url = this.resolve(path, true);\n    }\n\n    return url;\n  }\n  /**\n   * Determine the type of they input passed to open\n   * @private\n   * @param  {string} input\n   * @return {string}  binary | directory | epub | opf\n   */\n\n\n  determineType(input) {\n    var url;\n    var path;\n    var extension;\n\n    if (this.settings.encoding === \"base64\") {\n      return INPUT_TYPE.BASE64;\n    }\n\n    if (typeof input != \"string\") {\n      return INPUT_TYPE.BINARY;\n    }\n\n    url = new _url.default(input);\n    path = url.path();\n    extension = path.extension; // If there's a search string, remove it before determining type\n\n    if (extension) {\n      extension = extension.replace(/\\?.*$/, \"\");\n    }\n\n    if (!extension) {\n      return INPUT_TYPE.DIRECTORY;\n    }\n\n    if (extension === \"epub\") {\n      return INPUT_TYPE.EPUB;\n    }\n\n    if (extension === \"opf\") {\n      return INPUT_TYPE.OPF;\n    }\n\n    if (extension === \"json\") {\n      return INPUT_TYPE.MANIFEST;\n    }\n  }\n  /**\n   * unpack the contents of the Books packaging\n   * @private\n   * @param {Packaging} packaging object\n   */\n\n\n  unpack(packaging) {\n    this.package = packaging; //TODO: deprecated this\n\n    if (this.packaging.metadata.layout === \"\") {\n      // rendition:layout not set - check display options if book is pre-paginated\n      this.load(this.url.resolve(IBOOKS_DISPLAY_OPTIONS_PATH)).then(xml => {\n        this.displayOptions = new _displayoptions.default(xml);\n        this.loading.displayOptions.resolve(this.displayOptions);\n      }).catch(err => {\n        this.displayOptions = new _displayoptions.default();\n        this.loading.displayOptions.resolve(this.displayOptions);\n      });\n    } else {\n      this.displayOptions = new _displayoptions.default();\n      this.loading.displayOptions.resolve(this.displayOptions);\n    }\n\n    this.spine.unpack(this.packaging, this.resolve.bind(this), this.canonical.bind(this));\n    this.resources = new _resources.default(this.packaging.manifest, {\n      archive: this.archive,\n      resolver: this.resolve.bind(this),\n      request: this.request.bind(this),\n      replacements: this.settings.replacements || (this.archived ? \"blobUrl\" : \"base64\")\n    });\n    this.loadNavigation(this.packaging).then(() => {\n      // this.toc = this.navigation.toc;\n      this.loading.navigation.resolve(this.navigation);\n    });\n\n    if (this.packaging.coverPath) {\n      this.cover = this.resolve(this.packaging.coverPath);\n    } // Resolve promises\n\n\n    this.loading.manifest.resolve(this.packaging.manifest);\n    this.loading.metadata.resolve(this.packaging.metadata);\n    this.loading.spine.resolve(this.spine);\n    this.loading.cover.resolve(this.cover);\n    this.loading.resources.resolve(this.resources);\n    this.loading.pageList.resolve(this.pageList);\n    this.isOpen = true;\n\n    if (this.archived || this.settings.replacements && this.settings.replacements != \"none\") {\n      this.replacements().then(() => {\n        this.loaded.displayOptions.then(() => {\n          this.opening.resolve(this);\n        });\n      }).catch(err => {\n        console.error(err);\n      });\n    } else {\n      // Resolve book opened promise\n      this.loaded.displayOptions.then(() => {\n        this.opening.resolve(this);\n      });\n    }\n  }\n  /**\n   * Load Navigation and PageList from package\n   * @private\n   * @param {Packaging} packaging\n   */\n\n\n  loadNavigation(packaging) {\n    let navPath = packaging.navPath || packaging.ncxPath;\n    let toc = packaging.toc; // From json manifest\n\n    if (toc) {\n      return new Promise((resolve, reject) => {\n        this.navigation = new _navigation.default(toc);\n\n        if (packaging.pageList) {\n          this.pageList = new _pagelist.default(packaging.pageList); // TODO: handle page lists from Manifest\n        }\n\n        resolve(this.navigation);\n      });\n    }\n\n    if (!navPath) {\n      return new Promise((resolve, reject) => {\n        this.navigation = new _navigation.default();\n        this.pageList = new _pagelist.default();\n        resolve(this.navigation);\n      });\n    }\n\n    return this.load(navPath, \"xml\").then(xml => {\n      this.navigation = new _navigation.default(xml);\n      this.pageList = new _pagelist.default(xml);\n      return this.navigation;\n    });\n  }\n  /**\n   * Gets a Section of the Book from the Spine\n   * Alias for `book.spine.get`\n   * @param {string} target\n   * @return {Section}\n   */\n\n\n  section(target) {\n    return this.spine.get(target);\n  }\n  /**\n   * Sugar to render a book to an element\n   * @param  {element | string} element element or string to add a rendition to\n   * @param  {object} [options]\n   * @return {Rendition}\n   */\n\n\n  renderTo(element, options) {\n    this.rendition = new _rendition.default(this, options);\n    this.rendition.attachTo(element);\n    return this.rendition;\n  }\n  /**\n   * Set if request should use withCredentials\n   * @param {boolean} credentials\n   */\n\n\n  setRequestCredentials(credentials) {\n    this.settings.requestCredentials = credentials;\n  }\n  /**\n   * Set headers request should use\n   * @param {object} headers\n   */\n\n\n  setRequestHeaders(headers) {\n    this.settings.requestHeaders = headers;\n  }\n  /**\n   * Unarchive a zipped epub\n   * @private\n   * @param  {binary} input epub data\n   * @param  {string} [encoding]\n   * @return {Archive}\n   */\n\n\n  unarchive(input, encoding) {\n    this.archive = new _archive.default();\n    return this.archive.open(input, encoding);\n  }\n  /**\n   * Store the epubs contents\n   * @private\n   * @param  {binary} input epub data\n   * @param  {string} [encoding]\n   * @return {Store}\n   */\n\n\n  store(name) {\n    // Use \"blobUrl\" or \"base64\" for replacements\n    let replacementsSetting = this.settings.replacements && this.settings.replacements !== \"none\"; // Save original url\n\n    let originalUrl = this.url; // Save original request method\n\n    let requester = this.settings.requestMethod || _request2.default.bind(this); // Create new Store\n\n\n    this.storage = new _store.default(name, requester, this.resolve.bind(this)); // Replace request method to go through store\n\n    this.request = this.storage.request.bind(this.storage);\n    this.opened.then(() => {\n      if (this.archived) {\n        this.storage.requester = this.archive.request.bind(this.archive);\n      } // Substitute hook\n\n\n      let substituteResources = (output, section) => {\n        section.output = this.resources.substitute(output, section.url);\n      }; // Set to use replacements\n\n\n      this.resources.settings.replacements = replacementsSetting || \"blobUrl\"; // Create replacement urls\n\n      this.resources.replacements().then(() => {\n        return this.resources.replaceCss();\n      });\n      this.storage.on(\"offline\", () => {\n        // Remove url to use relative resolving for hrefs\n        this.url = new _url.default(\"/\", \"\"); // Add hook to replace resources in contents\n\n        this.spine.hooks.serialize.register(substituteResources);\n      });\n      this.storage.on(\"online\", () => {\n        // Restore original url\n        this.url = originalUrl; // Remove hook\n\n        this.spine.hooks.serialize.deregister(substituteResources);\n      });\n    });\n    return this.storage;\n  }\n  /**\n   * Get the cover url\n   * @return {Promise<?string>} coverUrl\n   */\n\n\n  coverUrl() {\n    return this.loaded.cover.then(() => {\n      if (!this.cover) {\n        return null;\n      }\n\n      if (this.archived) {\n        return this.archive.createUrl(this.cover);\n      } else {\n        return this.cover;\n      }\n    });\n  }\n  /**\n   * Load replacement urls\n   * @private\n   * @return {Promise} completed loading urls\n   */\n\n\n  replacements() {\n    this.spine.hooks.serialize.register((output, section) => {\n      section.output = this.resources.substitute(output, section.url);\n    });\n    return this.resources.replacements().then(() => {\n      return this.resources.replaceCss();\n    });\n  }\n  /**\n   * Find a DOM Range for a given CFI Range\n   * @param  {EpubCFI} cfiRange a epub cfi range\n   * @return {Promise}\n   */\n\n\n  getRange(cfiRange) {\n    var cfi = new _epubcfi.default(cfiRange);\n    var item = this.spine.get(cfi.spinePos);\n\n    var _request = this.load.bind(this);\n\n    if (!item) {\n      return new Promise((resolve, reject) => {\n        reject(\"CFI could not be found\");\n      });\n    }\n\n    return item.load(_request).then(function (contents) {\n      var range = cfi.toRange(item.document);\n      return range;\n    });\n  }\n  /**\n   * Generates the Book Key using the identifer in the manifest or other string provided\n   * @param  {string} [identifier] to use instead of metadata identifier\n   * @return {string} key\n   */\n\n\n  key(identifier) {\n    var ident = identifier || this.packaging.metadata.identifier || this.url.filename;\n    return `epubjs:${_constants.EPUBJS_VERSION}:${ident}`;\n  }\n  /**\n   * Destroy the Book and all associated objects\n   */\n\n\n  destroy() {\n    this.opened = undefined;\n    this.loading = undefined;\n    this.loaded = undefined;\n    this.ready = undefined;\n    this.isOpen = false;\n    this.isRendered = false;\n    this.spine && this.spine.destroy();\n    this.locations && this.locations.destroy();\n    this.pageList && this.pageList.destroy();\n    this.archive && this.archive.destroy();\n    this.resources && this.resources.destroy();\n    this.container && this.container.destroy();\n    this.packaging && this.packaging.destroy();\n    this.rendition && this.rendition.destroy();\n    this.displayOptions && this.displayOptions.destroy();\n    this.spine = undefined;\n    this.locations = undefined;\n    this.pageList = undefined;\n    this.archive = undefined;\n    this.resources = undefined;\n    this.container = undefined;\n    this.packaging = undefined;\n    this.rendition = undefined;\n    this.navigation = undefined;\n    this.url = undefined;\n    this.path = undefined;\n    this.archived = false;\n  }\n\n} //-- Enable binding events to book\n\n\n(0, _eventEmitter.default)(Book.prototype);\nvar _default = Book;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\nvar _constants = require(\"./utils/constants\");\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Figures out the CSS values to apply for a layout\n * @class\n * @param {object} settings\n * @param {string} [settings.layout='reflowable']\n * @param {string} [settings.spread]\n * @param {number} [settings.minSpreadWidth=800]\n * @param {boolean} [settings.evenSpreads=false]\n */\nclass Layout {\n  constructor(settings) {\n    this.settings = settings;\n    this.name = settings.layout || \"reflowable\";\n    this._spread = settings.spread === \"none\" ? false : true;\n    this._minSpreadWidth = settings.minSpreadWidth || 800;\n    this._evenSpreads = settings.evenSpreads || false;\n\n    if (settings.flow === \"scrolled\" || settings.flow === \"scrolled-continuous\" || settings.flow === \"scrolled-doc\") {\n      this._flow = \"scrolled\";\n    } else {\n      this._flow = \"paginated\";\n    }\n\n    this.width = 0;\n    this.height = 0;\n    this.spreadWidth = 0;\n    this.delta = 0;\n    this.columnWidth = 0;\n    this.gap = 0;\n    this.divisor = 1;\n    this.props = {\n      name: this.name,\n      spread: this._spread,\n      flow: this._flow,\n      width: 0,\n      height: 0,\n      spreadWidth: 0,\n      delta: 0,\n      columnWidth: 0,\n      gap: 0,\n      divisor: 1\n    };\n  }\n  /**\n   * Switch the flow between paginated and scrolled\n   * @param  {string} flow paginated | scrolled\n   * @return {string} simplified flow\n   */\n\n\n  flow(flow) {\n    if (typeof flow != \"undefined\") {\n      if (flow === \"scrolled\" || flow === \"scrolled-continuous\" || flow === \"scrolled-doc\") {\n        this._flow = \"scrolled\";\n      } else {\n        this._flow = \"paginated\";\n      } // this.props.flow = this._flow;\n\n\n      this.update({\n        flow: this._flow\n      });\n    }\n\n    return this._flow;\n  }\n  /**\n   * Switch between using spreads or not, and set the\n   * width at which they switch to single.\n   * @param  {string} spread \"none\" | \"always\" | \"auto\"\n   * @param  {number} min integer in pixels\n   * @return {boolean} spread true | false\n   */\n\n\n  spread(spread, min) {\n    if (spread) {\n      this._spread = spread === \"none\" ? false : true; // this.props.spread = this._spread;\n\n      this.update({\n        spread: this._spread\n      });\n    }\n\n    if (min >= 0) {\n      this._minSpreadWidth = min;\n    }\n\n    return this._spread;\n  }\n  /**\n   * Calculate the dimensions of the pagination\n   * @param  {number} _width  width of the rendering\n   * @param  {number} _height height of the rendering\n   * @param  {number} _gap    width of the gap between columns\n   */\n\n\n  calculate(_width, _height, _gap) {\n    var divisor = 1;\n    var gap = _gap || 0; //-- Check the width and create even width columns\n    // var fullWidth = Math.floor(_width);\n\n    var width = _width;\n    var height = _height;\n    var section = Math.floor(width / 12);\n    var columnWidth;\n    var spreadWidth;\n    var pageWidth;\n    var delta;\n\n    if (this._spread && width >= this._minSpreadWidth) {\n      divisor = 2;\n    } else {\n      divisor = 1;\n    }\n\n    if (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\n      gap = section % 2 === 0 ? section : section - 1;\n    }\n\n    if (this.name === \"pre-paginated\") {\n      gap = 0;\n    } //-- Double Page\n\n\n    if (divisor > 1) {\n      // width = width - gap;\n      // columnWidth = (width - gap) / divisor;\n      // gap = gap / divisor;\n      columnWidth = width / divisor - gap;\n      pageWidth = columnWidth + gap;\n    } else {\n      columnWidth = width;\n      pageWidth = width;\n    }\n\n    if (this.name === \"pre-paginated\" && divisor > 1) {\n      width = columnWidth;\n    }\n\n    spreadWidth = columnWidth * divisor + gap;\n    delta = width;\n    this.width = width;\n    this.height = height;\n    this.spreadWidth = spreadWidth;\n    this.pageWidth = pageWidth;\n    this.delta = delta;\n    this.columnWidth = columnWidth;\n    this.gap = gap;\n    this.divisor = divisor; // this.props.width = width;\n    // this.props.height = _height;\n    // this.props.spreadWidth = spreadWidth;\n    // this.props.pageWidth = pageWidth;\n    // this.props.delta = delta;\n    //\n    // this.props.columnWidth = colWidth;\n    // this.props.gap = gap;\n    // this.props.divisor = divisor;\n\n    this.update({\n      width,\n      height,\n      spreadWidth,\n      pageWidth,\n      delta,\n      columnWidth,\n      gap,\n      divisor\n    });\n  }\n  /**\n   * Apply Css to a Document\n   * @param  {Contents} contents\n   * @return {Promise}\n   */\n\n\n  format(contents, section, axis) {\n    var formating;\n\n    if (this.name === \"pre-paginated\") {\n      formating = contents.fit(this.columnWidth, this.height, section);\n    } else if (this._flow === \"paginated\") {\n      formating = contents.columns(this.width, this.height, this.columnWidth, this.gap, this.settings.direction);\n    } else if (axis && axis === \"horizontal\") {\n      formating = contents.size(null, this.height);\n    } else {\n      formating = contents.size(this.width, null);\n    }\n\n    return formating; // might be a promise in some View Managers\n  }\n  /**\n   * Count number of pages\n   * @param  {number} totalLength\n   * @param  {number} pageLength\n   * @return {{spreads: Number, pages: Number}}\n   */\n\n\n  count(totalLength, pageLength) {\n    let spreads, pages;\n\n    if (this.name === \"pre-paginated\") {\n      spreads = 1;\n      pages = 1;\n    } else if (this._flow === \"paginated\") {\n      pageLength = pageLength || this.delta;\n      spreads = Math.ceil(totalLength / pageLength);\n      pages = spreads * this.divisor;\n    } else {\n      // scrolled\n      pageLength = pageLength || this.height;\n      spreads = Math.ceil(totalLength / pageLength);\n      pages = spreads;\n    }\n\n    return {\n      spreads,\n      pages\n    };\n  }\n  /**\n   * Update props that have changed\n   * @private\n   * @param  {object} props\n   */\n\n\n  update(props) {\n    // Remove props that haven't changed\n    Object.keys(props).forEach(propName => {\n      if (this.props[propName] === props[propName]) {\n        delete props[propName];\n      }\n    });\n\n    if (Object.keys(props).length > 0) {\n      let newProps = (0, _core.extend)(this.props, props);\n      this.emit(_constants.EVENTS.LAYOUT.UPDATED, newProps, props);\n    }\n  }\n\n}\n\n(0, _eventEmitter.default)(Layout.prototype);\nvar _default = Layout;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _core = require(\"./utils/core\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Map text locations to CFI ranges\n * @class\n * @param {Layout} layout Layout to apply\n * @param {string} [direction=\"ltr\"] Text direction\n * @param {string} [axis=\"horizontal\"] vertical or horizontal axis\n * @param {boolean} [dev] toggle developer highlighting\n */\nclass Mapping {\n  constructor(layout, direction, axis, dev = false) {\n    this.layout = layout;\n    this.horizontal = axis === \"horizontal\" ? true : false;\n    this.direction = direction || \"ltr\";\n    this._dev = dev;\n  }\n  /**\n   * Find CFI pairs for entire section at once\n   */\n\n\n  section(view) {\n    var ranges = this.findRanges(view);\n    var map = this.rangeListToCfiList(view.section.cfiBase, ranges);\n    return map;\n  }\n  /**\n   * Find CFI pairs for a page\n   * @param {Contents} contents Contents from view\n   * @param {string} cfiBase string of the base for a cfi\n   * @param {number} start position to start at\n   * @param {number} end position to end at\n   */\n\n\n  page(contents, cfiBase, start, end) {\n    var root = contents && contents.document ? contents.document.body : false;\n    var result;\n\n    if (!root) {\n      return;\n    }\n\n    result = this.rangePairToCfiPair(cfiBase, {\n      start: this.findStart(root, start, end),\n      end: this.findEnd(root, start, end)\n    });\n\n    if (this._dev === true) {\n      let doc = contents.document;\n      let startRange = new _epubcfi.default(result.start).toRange(doc);\n      let endRange = new _epubcfi.default(result.end).toRange(doc);\n      let selection = doc.defaultView.getSelection();\n      let r = doc.createRange();\n      selection.removeAllRanges();\n      r.setStart(startRange.startContainer, startRange.startOffset);\n      r.setEnd(endRange.endContainer, endRange.endOffset);\n      selection.addRange(r);\n    }\n\n    return result;\n  }\n  /**\n   * Walk a node, preforming a function on each node it finds\n   * @private\n   * @param {Node} root Node to walkToNode\n   * @param {function} func walk function\n   * @return {*} returns the result of the walk function\n   */\n\n\n  walk(root, func) {\n    // IE11 has strange issue, if root is text node IE throws exception on\n    // calling treeWalker.nextNode(), saying\n    // Unexpected call to method or property access instead of returing null value\n    if (root && root.nodeType === Node.TEXT_NODE) {\n      return;\n    } // safeFilter is required so that it can work in IE as filter is a function for IE\n    // and for other browser filter is an object.\n\n\n    var filter = {\n      acceptNode: function (node) {\n        if (node.data.trim().length > 0) {\n          return NodeFilter.FILTER_ACCEPT;\n        } else {\n          return NodeFilter.FILTER_REJECT;\n        }\n      }\n    };\n    var safeFilter = filter.acceptNode;\n    safeFilter.acceptNode = filter.acceptNode;\n    var treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, safeFilter, false);\n    var node;\n    var result;\n\n    while (node = treeWalker.nextNode()) {\n      result = func(node);\n      if (result) break;\n    }\n\n    return result;\n  }\n\n  findRanges(view) {\n    var columns = [];\n    var scrollWidth = view.contents.scrollWidth();\n    var spreads = Math.ceil(scrollWidth / this.layout.spreadWidth);\n    var count = spreads * this.layout.divisor;\n    var columnWidth = this.layout.columnWidth;\n    var gap = this.layout.gap;\n    var start, end;\n\n    for (var i = 0; i < count.pages; i++) {\n      start = (columnWidth + gap) * i;\n      end = columnWidth * (i + 1) + gap * i;\n      columns.push({\n        start: this.findStart(view.document.body, start, end),\n        end: this.findEnd(view.document.body, start, end)\n      });\n    }\n\n    return columns;\n  }\n  /**\n   * Find Start Range\n   * @private\n   * @param {Node} root root node\n   * @param {number} start position to start at\n   * @param {number} end position to end at\n   * @return {Range}\n   */\n\n\n  findStart(root, start, end) {\n    var stack = [root];\n    var $el;\n    var found;\n    var $prev = root;\n\n    while (stack.length) {\n      $el = stack.shift();\n      found = this.walk($el, node => {\n        var left, right, top, bottom;\n        var elPos;\n        var elRange;\n        elPos = (0, _core.nodeBounds)(node);\n\n        if (this.horizontal && this.direction === \"ltr\") {\n          left = this.horizontal ? elPos.left : elPos.top;\n          right = this.horizontal ? elPos.right : elPos.bottom;\n\n          if (left >= start && left <= end) {\n            return node;\n          } else if (right > start) {\n            return node;\n          } else {\n            $prev = node;\n            stack.push(node);\n          }\n        } else if (this.horizontal && this.direction === \"rtl\") {\n          left = elPos.left;\n          right = elPos.right;\n\n          if (right <= end && right >= start) {\n            return node;\n          } else if (left < end) {\n            return node;\n          } else {\n            $prev = node;\n            stack.push(node);\n          }\n        } else {\n          top = elPos.top;\n          bottom = elPos.bottom;\n\n          if (top >= start && top <= end) {\n            return node;\n          } else if (bottom > start) {\n            return node;\n          } else {\n            $prev = node;\n            stack.push(node);\n          }\n        }\n      });\n\n      if (found) {\n        return this.findTextStartRange(found, start, end);\n      }\n    } // Return last element\n\n\n    return this.findTextStartRange($prev, start, end);\n  }\n  /**\n   * Find End Range\n   * @private\n   * @param {Node} root root node\n   * @param {number} start position to start at\n   * @param {number} end position to end at\n   * @return {Range}\n   */\n\n\n  findEnd(root, start, end) {\n    var stack = [root];\n    var $el;\n    var $prev = root;\n    var found;\n\n    while (stack.length) {\n      $el = stack.shift();\n      found = this.walk($el, node => {\n        var left, right, top, bottom;\n        var elPos;\n        var elRange;\n        elPos = (0, _core.nodeBounds)(node);\n\n        if (this.horizontal && this.direction === \"ltr\") {\n          left = Math.round(elPos.left);\n          right = Math.round(elPos.right);\n\n          if (left > end && $prev) {\n            return $prev;\n          } else if (right > end) {\n            return node;\n          } else {\n            $prev = node;\n            stack.push(node);\n          }\n        } else if (this.horizontal && this.direction === \"rtl\") {\n          left = Math.round(this.horizontal ? elPos.left : elPos.top);\n          right = Math.round(this.horizontal ? elPos.right : elPos.bottom);\n\n          if (right < start && $prev) {\n            return $prev;\n          } else if (left < start) {\n            return node;\n          } else {\n            $prev = node;\n            stack.push(node);\n          }\n        } else {\n          top = Math.round(elPos.top);\n          bottom = Math.round(elPos.bottom);\n\n          if (top > end && $prev) {\n            return $prev;\n          } else if (bottom > end) {\n            return node;\n          } else {\n            $prev = node;\n            stack.push(node);\n          }\n        }\n      });\n\n      if (found) {\n        return this.findTextEndRange(found, start, end);\n      }\n    } // end of chapter\n\n\n    return this.findTextEndRange($prev, start, end);\n  }\n  /**\n   * Find Text Start Range\n   * @private\n   * @param {Node} root root node\n   * @param {number} start position to start at\n   * @param {number} end position to end at\n   * @return {Range}\n   */\n\n\n  findTextStartRange(node, start, end) {\n    var ranges = this.splitTextNodeIntoRanges(node);\n    var range;\n    var pos;\n    var left, top, right;\n\n    for (var i = 0; i < ranges.length; i++) {\n      range = ranges[i];\n      pos = range.getBoundingClientRect();\n\n      if (this.horizontal && this.direction === \"ltr\") {\n        left = pos.left;\n\n        if (left >= start) {\n          return range;\n        }\n      } else if (this.horizontal && this.direction === \"rtl\") {\n        right = pos.right;\n\n        if (right <= end) {\n          return range;\n        }\n      } else {\n        top = pos.top;\n\n        if (top >= start) {\n          return range;\n        }\n      } // prev = range;\n\n    }\n\n    return ranges[0];\n  }\n  /**\n   * Find Text End Range\n   * @private\n   * @param {Node} root root node\n   * @param {number} start position to start at\n   * @param {number} end position to end at\n   * @return {Range}\n   */\n\n\n  findTextEndRange(node, start, end) {\n    var ranges = this.splitTextNodeIntoRanges(node);\n    var prev;\n    var range;\n    var pos;\n    var left, right, top, bottom;\n\n    for (var i = 0; i < ranges.length; i++) {\n      range = ranges[i];\n      pos = range.getBoundingClientRect();\n\n      if (this.horizontal && this.direction === \"ltr\") {\n        left = pos.left;\n        right = pos.right;\n\n        if (left > end && prev) {\n          return prev;\n        } else if (right > end) {\n          return range;\n        }\n      } else if (this.horizontal && this.direction === \"rtl\") {\n        left = pos.left;\n        right = pos.right;\n\n        if (right < start && prev) {\n          return prev;\n        } else if (left < start) {\n          return range;\n        }\n      } else {\n        top = pos.top;\n        bottom = pos.bottom;\n\n        if (top > end && prev) {\n          return prev;\n        } else if (bottom > end) {\n          return range;\n        }\n      }\n\n      prev = range;\n    } // Ends before limit\n\n\n    return ranges[ranges.length - 1];\n  }\n  /**\n   * Split up a text node into ranges for each word\n   * @private\n   * @param {Node} root root node\n   * @param {string} [_splitter] what to split on\n   * @return {Range[]}\n   */\n\n\n  splitTextNodeIntoRanges(node, _splitter) {\n    var ranges = [];\n    var textContent = node.textContent || \"\";\n    var text = textContent.trim();\n    var range;\n    var doc = node.ownerDocument;\n    var splitter = _splitter || \" \";\n    var pos = text.indexOf(splitter);\n\n    if (pos === -1 || node.nodeType != Node.TEXT_NODE) {\n      range = doc.createRange();\n      range.selectNodeContents(node);\n      return [range];\n    }\n\n    range = doc.createRange();\n    range.setStart(node, 0);\n    range.setEnd(node, pos);\n    ranges.push(range);\n    range = false;\n\n    while (pos != -1) {\n      pos = text.indexOf(splitter, pos + 1);\n\n      if (pos > 0) {\n        if (range) {\n          range.setEnd(node, pos);\n          ranges.push(range);\n        }\n\n        range = doc.createRange();\n        range.setStart(node, pos + 1);\n      }\n    }\n\n    if (range) {\n      range.setEnd(node, text.length);\n      ranges.push(range);\n    }\n\n    return ranges;\n  }\n  /**\n   * Turn a pair of ranges into a pair of CFIs\n   * @private\n   * @param {string} cfiBase base string for an EpubCFI\n   * @param {object} rangePair { start: Range, end: Range }\n   * @return {object} { start: \"epubcfi(...)\", end: \"epubcfi(...)\" }\n   */\n\n\n  rangePairToCfiPair(cfiBase, rangePair) {\n    var startRange = rangePair.start;\n    var endRange = rangePair.end;\n    startRange.collapse(true);\n    endRange.collapse(false);\n    let startCfi = new _epubcfi.default(startRange, cfiBase).toString();\n    let endCfi = new _epubcfi.default(endRange, cfiBase).toString();\n    return {\n      start: startCfi,\n      end: endCfi\n    };\n  }\n\n  rangeListToCfiList(cfiBase, columns) {\n    var map = [];\n    var cifPair;\n\n    for (var i = 0; i < columns.length; i++) {\n      cifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\n      map.push(cifPair);\n    }\n\n    return map;\n  }\n  /**\n   * Set the axis for mapping\n   * @param {string} axis horizontal | vertical\n   * @return {boolean} is it horizontal?\n   */\n\n\n  axis(axis) {\n    if (axis) {\n      this.horizontal = axis === \"horizontal\" ? true : false;\n    }\n\n    return this.horizontal;\n  }\n\n}\n\nvar _default = Mapping;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _core = require(\"../../utils/core\");\n\nvar _epubcfi = _interopRequireDefault(require(\"../../epubcfi\"));\n\nvar _contents = _interopRequireDefault(require(\"../../contents\"));\n\nvar _constants = require(\"../../utils/constants\");\n\nvar _marksPane = require(\"marks-pane\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass IframeView {\n  constructor(section, options) {\n    this.settings = (0, _core.extend)({\n      ignoreClass: \"\",\n      axis: undefined,\n      //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n      direction: undefined,\n      width: 0,\n      height: 0,\n      layout: undefined,\n      globalLayoutProperties: {},\n      method: undefined,\n      forceRight: false,\n      allowScriptedContent: false\n    }, options || {});\n    this.id = \"epubjs-view-\" + (0, _core.uuid)();\n    this.section = section;\n    this.index = section.index;\n    this.element = this.container(this.settings.axis);\n    this.added = false;\n    this.displayed = false;\n    this.rendered = false; // this.width  = this.settings.width;\n    // this.height = this.settings.height;\n\n    this.fixedWidth = 0;\n    this.fixedHeight = 0; // Blank Cfi for Parsing\n\n    this.epubcfi = new _epubcfi.default();\n    this.layout = this.settings.layout; // Dom events to listen for\n    // this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n    this.pane = undefined;\n    this.highlights = {};\n    this.underlines = {};\n    this.marks = {};\n  }\n\n  container(axis) {\n    var element = document.createElement(\"div\");\n    element.classList.add(\"epub-view\"); // this.element.style.minHeight = \"100px\";\n\n    element.style.height = \"0px\";\n    element.style.width = \"0px\";\n    element.style.overflow = \"hidden\";\n    element.style.position = \"relative\";\n    element.style.display = \"block\";\n\n    if (axis && axis == \"horizontal\") {\n      element.style.flex = \"none\";\n    } else {\n      element.style.flex = \"initial\";\n    }\n\n    return element;\n  }\n\n  create() {\n    if (this.iframe) {\n      return this.iframe;\n    }\n\n    if (!this.element) {\n      this.element = this.createContainer();\n    }\n\n    this.iframe = document.createElement(\"iframe\");\n    this.iframe.id = this.id;\n    this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\n    this.iframe.style.overflow = \"hidden\";\n    this.iframe.seamless = \"seamless\"; // Back up if seamless isn't supported\n\n    this.iframe.style.border = \"none\"; // sandbox\n\n    this.iframe.sandbox = \"allow-same-origin\";\n\n    if (this.settings.allowScriptedContent && this.section.properties.indexOf(\"scripted\") > -1) {\n      this.iframe.sandbox += \" allow-scripts\";\n    }\n\n    this.iframe.setAttribute(\"enable-annotation\", \"true\");\n    this.resizing = true; // this.iframe.style.display = \"none\";\n\n    this.element.style.visibility = \"hidden\";\n    this.iframe.style.visibility = \"hidden\";\n    this.iframe.style.width = \"0\";\n    this.iframe.style.height = \"0\";\n    this._width = 0;\n    this._height = 0;\n    this.element.setAttribute(\"ref\", this.index);\n    this.added = true;\n    this.elementBounds = (0, _core.bounds)(this.element); // if(width || height){\n    //   this.resize(width, height);\n    // } else if(this.width && this.height){\n    //   this.resize(this.width, this.height);\n    // } else {\n    //   this.iframeBounds = bounds(this.iframe);\n    // }\n\n    if (\"srcdoc\" in this.iframe) {\n      this.supportsSrcdoc = true;\n    } else {\n      this.supportsSrcdoc = false;\n    }\n\n    if (!this.settings.method) {\n      this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n    }\n\n    return this.iframe;\n  }\n\n  render(request, show) {\n    // view.onLayout = this.layout.format.bind(this.layout);\n    this.create(); // Fit to size of the container, apply padding\n\n    this.size();\n\n    if (!this.sectionRender) {\n      this.sectionRender = this.section.render(request);\n    } // Render Chain\n\n\n    return this.sectionRender.then(function (contents) {\n      return this.load(contents);\n    }.bind(this)).then(function () {\n      // find and report the writingMode axis\n      let writingMode = this.contents.writingMode(); // Set the axis based on the flow and writing mode\n\n      let axis;\n\n      if (this.settings.flow === \"scrolled\") {\n        axis = writingMode.indexOf(\"vertical\") === 0 ? \"horizontal\" : \"vertical\";\n      } else {\n        axis = writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n      }\n\n      if (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\n        this.layout.delta = this.layout.height;\n      }\n\n      this.setAxis(axis);\n      this.emit(_constants.EVENTS.VIEWS.AXIS, axis);\n      this.setWritingMode(writingMode);\n      this.emit(_constants.EVENTS.VIEWS.WRITING_MODE, writingMode); // apply the layout function to the contents\n\n      this.layout.format(this.contents, this.section, this.axis); // Listen for events that require an expansion of the iframe\n\n      this.addListeners();\n      return new Promise((resolve, reject) => {\n        // Expand the iframe to the full size of the content\n        this.expand();\n\n        if (this.settings.forceRight) {\n          this.element.style.marginLeft = this.width() + \"px\";\n        }\n\n        resolve();\n      });\n    }.bind(this), function (e) {\n      this.emit(_constants.EVENTS.VIEWS.LOAD_ERROR, e);\n      return new Promise((resolve, reject) => {\n        reject(e);\n      });\n    }.bind(this)).then(function () {\n      this.emit(_constants.EVENTS.VIEWS.RENDERED, this.section);\n    }.bind(this));\n  }\n\n  reset() {\n    if (this.iframe) {\n      this.iframe.style.width = \"0\";\n      this.iframe.style.height = \"0\";\n      this._width = 0;\n      this._height = 0;\n      this._textWidth = undefined;\n      this._contentWidth = undefined;\n      this._textHeight = undefined;\n      this._contentHeight = undefined;\n    }\n\n    this._needsReframe = true;\n  } // Determine locks base on settings\n\n\n  size(_width, _height) {\n    var width = _width || this.settings.width;\n    var height = _height || this.settings.height;\n\n    if (this.layout.name === \"pre-paginated\") {\n      this.lock(\"both\", width, height);\n    } else if (this.settings.axis === \"horizontal\") {\n      this.lock(\"height\", width, height);\n    } else {\n      this.lock(\"width\", width, height);\n    }\n\n    this.settings.width = width;\n    this.settings.height = height;\n  } // Lock an axis to element dimensions, taking borders into account\n\n\n  lock(what, width, height) {\n    var elBorders = (0, _core.borders)(this.element);\n    var iframeBorders;\n\n    if (this.iframe) {\n      iframeBorders = (0, _core.borders)(this.iframe);\n    } else {\n      iframeBorders = {\n        width: 0,\n        height: 0\n      };\n    }\n\n    if (what == \"width\" && (0, _core.isNumber)(width)) {\n      this.lockedWidth = width - elBorders.width - iframeBorders.width; // this.resize(this.lockedWidth, width); //  width keeps ratio correct\n    }\n\n    if (what == \"height\" && (0, _core.isNumber)(height)) {\n      this.lockedHeight = height - elBorders.height - iframeBorders.height; // this.resize(width, this.lockedHeight);\n    }\n\n    if (what === \"both\" && (0, _core.isNumber)(width) && (0, _core.isNumber)(height)) {\n      this.lockedWidth = width - elBorders.width - iframeBorders.width;\n      this.lockedHeight = height - elBorders.height - iframeBorders.height; // this.resize(this.lockedWidth, this.lockedHeight);\n    }\n\n    if (this.displayed && this.iframe) {\n      // this.contents.layout();\n      this.expand();\n    }\n  } // Resize a single axis based on content dimensions\n\n\n  expand(force) {\n    var width = this.lockedWidth;\n    var height = this.lockedHeight;\n    var columns;\n    var textWidth, textHeight;\n    if (!this.iframe || this._expanding) return;\n    this._expanding = true;\n\n    if (this.layout.name === \"pre-paginated\") {\n      width = this.layout.columnWidth;\n      height = this.layout.height;\n    } // Expand Horizontally\n    else if (this.settings.axis === \"horizontal\") {\n      // Get the width of the text\n      width = this.contents.textWidth();\n\n      if (width % this.layout.pageWidth > 0) {\n        width = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n      }\n\n      if (this.settings.forceEvenPages) {\n        columns = width / this.layout.pageWidth;\n\n        if (this.layout.divisor > 1 && this.layout.name === \"reflowable\" && columns % 2 > 0) {\n          // add a blank page\n          width += this.layout.pageWidth;\n        }\n      }\n    } // Expand Vertically\n    else if (this.settings.axis === \"vertical\") {\n      height = this.contents.textHeight();\n\n      if (this.settings.flow === \"paginated\" && height % this.layout.height > 0) {\n        height = Math.ceil(height / this.layout.height) * this.layout.height;\n      }\n    } // Only Resize if dimensions have changed or\n    // if Frame is still hidden, so needs reframing\n\n\n    if (this._needsReframe || width != this._width || height != this._height) {\n      this.reframe(width, height);\n    }\n\n    this._expanding = false;\n  }\n\n  reframe(width, height) {\n    var size;\n\n    if ((0, _core.isNumber)(width)) {\n      this.element.style.width = width + \"px\";\n      this.iframe.style.width = width + \"px\";\n      this._width = width;\n    }\n\n    if ((0, _core.isNumber)(height)) {\n      this.element.style.height = height + \"px\";\n      this.iframe.style.height = height + \"px\";\n      this._height = height;\n    }\n\n    let widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n    let heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n    size = {\n      width: width,\n      height: height,\n      widthDelta: widthDelta,\n      heightDelta: heightDelta\n    };\n    this.pane && this.pane.render();\n    requestAnimationFrame(() => {\n      let mark;\n\n      for (let m in this.marks) {\n        if (this.marks.hasOwnProperty(m)) {\n          mark = this.marks[m];\n          this.placeMark(mark.element, mark.range);\n        }\n      }\n    });\n    this.onResize(this, size);\n    this.emit(_constants.EVENTS.VIEWS.RESIZED, size);\n    this.prevBounds = size;\n    this.elementBounds = (0, _core.bounds)(this.element);\n  }\n\n  load(contents) {\n    var loading = new _core.defer();\n    var loaded = loading.promise;\n\n    if (!this.iframe) {\n      loading.reject(new Error(\"No Iframe Available\"));\n      return loaded;\n    }\n\n    this.iframe.onload = function (event) {\n      this.onLoad(event, loading);\n    }.bind(this);\n\n    if (this.settings.method === \"blobUrl\") {\n      this.blobUrl = (0, _core.createBlobUrl)(contents, \"application/xhtml+xml\");\n      this.iframe.src = this.blobUrl;\n      this.element.appendChild(this.iframe);\n    } else if (this.settings.method === \"srcdoc\") {\n      this.iframe.srcdoc = contents;\n      this.element.appendChild(this.iframe);\n    } else {\n      this.element.appendChild(this.iframe);\n      this.document = this.iframe.contentDocument;\n\n      if (!this.document) {\n        loading.reject(new Error(\"No Document Available\"));\n        return loaded;\n      }\n\n      this.iframe.contentDocument.open(); // For Cordova windows platform\n\n      if (window.MSApp && MSApp.execUnsafeLocalFunction) {\n        var outerThis = this;\n        MSApp.execUnsafeLocalFunction(function () {\n          outerThis.iframe.contentDocument.write(contents);\n        });\n      } else {\n        this.iframe.contentDocument.write(contents);\n      }\n\n      this.iframe.contentDocument.close();\n    }\n\n    return loaded;\n  }\n\n  onLoad(event, promise) {\n    this.window = this.iframe.contentWindow;\n    this.document = this.iframe.contentDocument;\n    this.contents = new _contents.default(this.document, this.document.body, this.section.cfiBase, this.section.index);\n    this.rendering = false;\n    var link = this.document.querySelector(\"link[rel='canonical']\");\n\n    if (link) {\n      link.setAttribute(\"href\", this.section.canonical);\n    } else {\n      link = this.document.createElement(\"link\");\n      link.setAttribute(\"rel\", \"canonical\");\n      link.setAttribute(\"href\", this.section.canonical);\n      this.document.querySelector(\"head\").appendChild(link);\n    }\n\n    this.contents.on(_constants.EVENTS.CONTENTS.EXPAND, () => {\n      if (this.displayed && this.iframe) {\n        this.expand();\n\n        if (this.contents) {\n          this.layout.format(this.contents);\n        }\n      }\n    });\n    this.contents.on(_constants.EVENTS.CONTENTS.RESIZE, e => {\n      if (this.displayed && this.iframe) {\n        this.expand();\n\n        if (this.contents) {\n          this.layout.format(this.contents);\n        }\n      }\n    });\n    promise.resolve(this.contents);\n  }\n\n  setLayout(layout) {\n    this.layout = layout;\n\n    if (this.contents) {\n      this.layout.format(this.contents);\n      this.expand();\n    }\n  }\n\n  setAxis(axis) {\n    this.settings.axis = axis;\n\n    if (axis == \"horizontal\") {\n      this.element.style.flex = \"none\";\n    } else {\n      this.element.style.flex = \"initial\";\n    }\n\n    this.size();\n  }\n\n  setWritingMode(mode) {\n    // this.element.style.writingMode = writingMode;\n    this.writingMode = mode;\n  }\n\n  addListeners() {//TODO: Add content listeners for expanding\n  }\n\n  removeListeners(layoutFunc) {//TODO: remove content listeners for expanding\n  }\n\n  display(request) {\n    var displayed = new _core.defer();\n\n    if (!this.displayed) {\n      this.render(request).then(function () {\n        this.emit(_constants.EVENTS.VIEWS.DISPLAYED, this);\n        this.onDisplayed(this);\n        this.displayed = true;\n        displayed.resolve(this);\n      }.bind(this), function (err) {\n        displayed.reject(err, this);\n      });\n    } else {\n      displayed.resolve(this);\n    }\n\n    return displayed.promise;\n  }\n\n  show() {\n    this.element.style.visibility = \"visible\";\n\n    if (this.iframe) {\n      this.iframe.style.visibility = \"visible\"; // Remind Safari to redraw the iframe\n\n      this.iframe.style.transform = \"translateZ(0)\";\n      this.iframe.offsetWidth;\n      this.iframe.style.transform = null;\n    }\n\n    this.emit(_constants.EVENTS.VIEWS.SHOWN, this);\n  }\n\n  hide() {\n    // this.iframe.style.display = \"none\";\n    this.element.style.visibility = \"hidden\";\n    this.iframe.style.visibility = \"hidden\";\n    this.stopExpanding = true;\n    this.emit(_constants.EVENTS.VIEWS.HIDDEN, this);\n  }\n\n  offset() {\n    return {\n      top: this.element.offsetTop,\n      left: this.element.offsetLeft\n    };\n  }\n\n  width() {\n    return this._width;\n  }\n\n  height() {\n    return this._height;\n  }\n\n  position() {\n    return this.element.getBoundingClientRect();\n  }\n\n  locationOf(target) {\n    var parentPos = this.iframe.getBoundingClientRect();\n    var targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n    return {\n      \"left\": targetPos.left,\n      \"top\": targetPos.top\n    };\n  }\n\n  onDisplayed(view) {// Stub, override with a custom functions\n  }\n\n  onResize(view, e) {// Stub, override with a custom functions\n  }\n\n  bounds(force) {\n    if (force || !this.elementBounds) {\n      this.elementBounds = (0, _core.bounds)(this.element);\n    }\n\n    return this.elementBounds;\n  }\n\n  highlight(cfiRange, data = {}, cb, className = \"epubjs-hl\", styles = {}) {\n    if (!this.contents) {\n      return;\n    }\n\n    const attributes = Object.assign({\n      \"fill\": \"yellow\",\n      \"fill-opacity\": \"0.3\",\n      \"mix-blend-mode\": \"multiply\"\n    }, styles);\n    let range = this.contents.range(cfiRange);\n\n    let emitter = () => {\n      this.emit(_constants.EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n    };\n\n    data[\"epubcfi\"] = cfiRange;\n\n    if (!this.pane) {\n      this.pane = new _marksPane.Pane(this.iframe, this.element);\n    }\n\n    let m = new _marksPane.Highlight(range, className, data, attributes);\n    let h = this.pane.addMark(m);\n    this.highlights[cfiRange] = {\n      \"mark\": h,\n      \"element\": h.element,\n      \"listeners\": [emitter, cb]\n    };\n    h.element.setAttribute(\"ref\", className);\n    h.element.addEventListener(\"click\", emitter);\n    h.element.addEventListener(\"touchstart\", emitter);\n\n    if (cb) {\n      h.element.addEventListener(\"click\", cb);\n      h.element.addEventListener(\"touchstart\", cb);\n    }\n\n    return h;\n  }\n\n  underline(cfiRange, data = {}, cb, className = \"epubjs-ul\", styles = {}) {\n    if (!this.contents) {\n      return;\n    }\n\n    const attributes = Object.assign({\n      \"stroke\": \"black\",\n      \"stroke-opacity\": \"0.3\",\n      \"mix-blend-mode\": \"multiply\"\n    }, styles);\n    let range = this.contents.range(cfiRange);\n\n    let emitter = () => {\n      this.emit(_constants.EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n    };\n\n    data[\"epubcfi\"] = cfiRange;\n\n    if (!this.pane) {\n      this.pane = new _marksPane.Pane(this.iframe, this.element);\n    }\n\n    let m = new _marksPane.Underline(range, className, data, attributes);\n    let h = this.pane.addMark(m);\n    this.underlines[cfiRange] = {\n      \"mark\": h,\n      \"element\": h.element,\n      \"listeners\": [emitter, cb]\n    };\n    h.element.setAttribute(\"ref\", className);\n    h.element.addEventListener(\"click\", emitter);\n    h.element.addEventListener(\"touchstart\", emitter);\n\n    if (cb) {\n      h.element.addEventListener(\"click\", cb);\n      h.element.addEventListener(\"touchstart\", cb);\n    }\n\n    return h;\n  }\n\n  mark(cfiRange, data = {}, cb) {\n    if (!this.contents) {\n      return;\n    }\n\n    if (cfiRange in this.marks) {\n      let item = this.marks[cfiRange];\n      return item;\n    }\n\n    let range = this.contents.range(cfiRange);\n\n    if (!range) {\n      return;\n    }\n\n    let container = range.commonAncestorContainer;\n    let parent = container.nodeType === 1 ? container : container.parentNode;\n\n    let emitter = e => {\n      this.emit(_constants.EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n    };\n\n    if (range.collapsed && container.nodeType === 1) {\n      range = new Range();\n      range.selectNodeContents(container);\n    } else if (range.collapsed) {\n      // Webkit doesn't like collapsed ranges\n      range = new Range();\n      range.selectNodeContents(parent);\n    }\n\n    let mark = this.document.createElement(\"a\");\n    mark.setAttribute(\"ref\", \"epubjs-mk\");\n    mark.style.position = \"absolute\";\n    mark.dataset[\"epubcfi\"] = cfiRange;\n\n    if (data) {\n      Object.keys(data).forEach(key => {\n        mark.dataset[key] = data[key];\n      });\n    }\n\n    if (cb) {\n      mark.addEventListener(\"click\", cb);\n      mark.addEventListener(\"touchstart\", cb);\n    }\n\n    mark.addEventListener(\"click\", emitter);\n    mark.addEventListener(\"touchstart\", emitter);\n    this.placeMark(mark, range);\n    this.element.appendChild(mark);\n    this.marks[cfiRange] = {\n      \"element\": mark,\n      \"range\": range,\n      \"listeners\": [emitter, cb]\n    };\n    return parent;\n  }\n\n  placeMark(element, range) {\n    let top, right, left;\n\n    if (this.layout.name === \"pre-paginated\" || this.settings.axis !== \"horizontal\") {\n      let pos = range.getBoundingClientRect();\n      top = pos.top;\n      right = pos.right;\n    } else {\n      // Element might break columns, so find the left most element\n      let rects = range.getClientRects();\n      let rect;\n\n      for (var i = 0; i != rects.length; i++) {\n        rect = rects[i];\n\n        if (!left || rect.left < left) {\n          left = rect.left; // right = rect.right;\n\n          right = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - this.layout.gap / 2;\n          top = rect.top;\n        }\n      }\n    }\n\n    element.style.top = `${top}px`;\n    element.style.left = `${right}px`;\n  }\n\n  unhighlight(cfiRange) {\n    let item;\n\n    if (cfiRange in this.highlights) {\n      item = this.highlights[cfiRange];\n      this.pane.removeMark(item.mark);\n      item.listeners.forEach(l => {\n        if (l) {\n          item.element.removeEventListener(\"click\", l);\n          item.element.removeEventListener(\"touchstart\", l);\n        }\n\n        ;\n      });\n      delete this.highlights[cfiRange];\n    }\n  }\n\n  ununderline(cfiRange) {\n    let item;\n\n    if (cfiRange in this.underlines) {\n      item = this.underlines[cfiRange];\n      this.pane.removeMark(item.mark);\n      item.listeners.forEach(l => {\n        if (l) {\n          item.element.removeEventListener(\"click\", l);\n          item.element.removeEventListener(\"touchstart\", l);\n        }\n\n        ;\n      });\n      delete this.underlines[cfiRange];\n    }\n  }\n\n  unmark(cfiRange) {\n    let item;\n\n    if (cfiRange in this.marks) {\n      item = this.marks[cfiRange];\n      this.element.removeChild(item.element);\n      item.listeners.forEach(l => {\n        if (l) {\n          item.element.removeEventListener(\"click\", l);\n          item.element.removeEventListener(\"touchstart\", l);\n        }\n\n        ;\n      });\n      delete this.marks[cfiRange];\n    }\n  }\n\n  destroy() {\n    for (let cfiRange in this.highlights) {\n      this.unhighlight(cfiRange);\n    }\n\n    for (let cfiRange in this.underlines) {\n      this.ununderline(cfiRange);\n    }\n\n    for (let cfiRange in this.marks) {\n      this.unmark(cfiRange);\n    }\n\n    if (this.blobUrl) {\n      (0, _core.revokeBlobUrl)(this.blobUrl);\n    }\n\n    if (this.displayed) {\n      this.displayed = false;\n      this.removeListeners();\n      this.contents.destroy();\n      this.stopExpanding = true;\n      this.element.removeChild(this.iframe);\n\n      if (this.pane) {\n        this.pane.element.remove();\n        this.pane = undefined;\n      }\n\n      this.iframe = undefined;\n      this.contents = undefined;\n      this._textWidth = null;\n      this._textHeight = null;\n      this._width = null;\n      this._height = null;\n    } // this.element.style.height = \"0px\";\n    // this.element.style.width = \"0px\";\n\n  }\n\n}\n\n(0, _eventEmitter.default)(IframeView.prototype);\nvar _default = IframeView;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"../../utils/core\");\n\nvar _default2 = _interopRequireDefault(require(\"../default\"));\n\nvar _snap = _interopRequireDefault(require(\"../helpers/snap\"));\n\nvar _constants = require(\"../../utils/constants\");\n\nvar _debounce = _interopRequireDefault(require(\"lodash/debounce\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass ContinuousViewManager extends _default2.default {\n  constructor(options) {\n    super(options);\n    this.name = \"continuous\";\n    this.settings = (0, _core.extend)(this.settings || {}, {\n      infinite: true,\n      overflow: undefined,\n      axis: undefined,\n      writingMode: undefined,\n      flow: \"scrolled\",\n      offset: 500,\n      offsetDelta: 250,\n      width: undefined,\n      height: undefined,\n      snap: false,\n      afterScrolledTimeout: 10,\n      allowScriptedContent: false\n    });\n    (0, _core.extend)(this.settings, options.settings || {}); // Gap can be 0, but defaults doesn't handle that\n\n    if (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\n      this.settings.gap = options.settings.gap;\n    }\n\n    this.viewSettings = {\n      ignoreClass: this.settings.ignoreClass,\n      axis: this.settings.axis,\n      flow: this.settings.flow,\n      layout: this.layout,\n      width: 0,\n      height: 0,\n      forceEvenPages: false,\n      allowScriptedContent: this.settings.allowScriptedContent\n    };\n    this.scrollTop = 0;\n    this.scrollLeft = 0;\n  }\n\n  display(section, target) {\n    return _default2.default.prototype.display.call(this, section, target).then(function () {\n      return this.fill();\n    }.bind(this));\n  }\n\n  fill(_full) {\n    var full = _full || new _core.defer();\n    this.q.enqueue(() => {\n      return this.check();\n    }).then(result => {\n      if (result) {\n        this.fill(full);\n      } else {\n        full.resolve();\n      }\n    });\n    return full.promise;\n  }\n\n  moveTo(offset) {\n    // var bounds = this.stage.bounds();\n    // var dist = Math.floor(offset.top / bounds.height) * bounds.height;\n    var distX = 0,\n        distY = 0;\n    var offsetX = 0,\n        offsetY = 0;\n\n    if (!this.isPaginated) {\n      distY = offset.top;\n      offsetY = offset.top + this.settings.offsetDelta;\n    } else {\n      distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n      offsetX = distX + this.settings.offsetDelta;\n    }\n\n    if (distX > 0 || distY > 0) {\n      this.scrollBy(distX, distY, true);\n    }\n  }\n\n  afterResized(view) {\n    this.emit(_constants.EVENTS.MANAGERS.RESIZE, view.section);\n  } // Remove Previous Listeners if present\n\n\n  removeShownListeners(view) {\n    // view.off(\"shown\", this.afterDisplayed);\n    // view.off(\"shown\", this.afterDisplayedAbove);\n    view.onDisplayed = function () {};\n  }\n\n  add(section) {\n    var view = this.createView(section);\n    this.views.append(view);\n    view.on(_constants.EVENTS.VIEWS.RESIZED, bounds => {\n      view.expanded = true;\n    });\n    view.on(_constants.EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(_constants.EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    }); // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    return view.display(this.request);\n  }\n\n  append(section) {\n    var view = this.createView(section);\n    view.on(_constants.EVENTS.VIEWS.RESIZED, bounds => {\n      view.expanded = true;\n    });\n    view.on(_constants.EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(_constants.EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    this.views.append(view);\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    return view;\n  }\n\n  prepend(section) {\n    var view = this.createView(section);\n    view.on(_constants.EVENTS.VIEWS.RESIZED, bounds => {\n      this.counter(bounds);\n      view.expanded = true;\n    });\n    view.on(_constants.EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(_constants.EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    this.views.prepend(view);\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    return view;\n  }\n\n  counter(bounds) {\n    if (this.settings.axis === \"vertical\") {\n      this.scrollBy(0, bounds.heightDelta, true);\n    } else {\n      this.scrollBy(bounds.widthDelta, 0, true);\n    }\n  }\n\n  update(_offset) {\n    var container = this.bounds();\n    var views = this.views.all();\n    var viewsLength = views.length;\n    var visible = [];\n    var offset = typeof _offset != \"undefined\" ? _offset : this.settings.offset || 0;\n    var isVisible;\n    var view;\n    var updating = new _core.defer();\n    var promises = [];\n\n    for (var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      isVisible = this.isVisible(view, offset, offset, container);\n\n      if (isVisible === true) {\n        // console.log(\"visible \" + view.index, view.displayed);\n        if (!view.displayed) {\n          let displayed = view.display(this.request).then(function (view) {\n            view.show();\n          }, err => {\n            view.hide();\n          });\n          promises.push(displayed);\n        } else {\n          view.show();\n        }\n\n        visible.push(view);\n      } else {\n        this.q.enqueue(view.destroy.bind(view)); // console.log(\"hidden \" + view.index, view.displayed);\n\n        clearTimeout(this.trimTimeout);\n        this.trimTimeout = setTimeout(function () {\n          this.q.enqueue(this.trim.bind(this));\n        }.bind(this), 250);\n      }\n    }\n\n    if (promises.length) {\n      return Promise.all(promises).catch(err => {\n        updating.reject(err);\n      });\n    } else {\n      updating.resolve();\n      return updating.promise;\n    }\n  }\n\n  check(_offsetLeft, _offsetTop) {\n    var checking = new _core.defer();\n    var newViews = [];\n    var horizontal = this.settings.axis === \"horizontal\";\n    var delta = this.settings.offset || 0;\n\n    if (_offsetLeft && horizontal) {\n      delta = _offsetLeft;\n    }\n\n    if (_offsetTop && !horizontal) {\n      delta = _offsetTop;\n    }\n\n    var bounds = this._bounds; // bounds saved this until resize\n\n    let offset = horizontal ? this.scrollLeft : this.scrollTop;\n    let visibleLength = horizontal ? Math.floor(bounds.width) : bounds.height;\n    let contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\n    let writingMode = this.writingMode && this.writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n    let rtlScrollType = this.settings.rtlScrollType;\n    let rtl = this.settings.direction === \"rtl\";\n\n    if (!this.settings.fullsize) {\n      // Scroll offset starts at width of element\n      if (rtl && rtlScrollType === \"default\" && writingMode === \"horizontal\") {\n        offset = contentLength - visibleLength - offset;\n      } // Scroll offset starts at 0 and goes negative\n\n\n      if (rtl && rtlScrollType === \"negative\" && writingMode === \"horizontal\") {\n        offset = offset * -1;\n      }\n    } else {\n      // Scroll offset starts at 0 and goes negative\n      if (horizontal && rtl && rtlScrollType === \"negative\" || !horizontal && rtl && rtlScrollType === \"default\") {\n        offset = offset * -1;\n      }\n    }\n\n    let prepend = () => {\n      let first = this.views.first();\n      let prev = first && first.section.prev();\n\n      if (prev) {\n        newViews.push(this.prepend(prev));\n      }\n    };\n\n    let append = () => {\n      let last = this.views.last();\n      let next = last && last.section.next();\n\n      if (next) {\n        newViews.push(this.append(next));\n      }\n    };\n\n    let end = offset + visibleLength + delta;\n    let start = offset - delta;\n\n    if (end >= contentLength) {\n      append();\n    }\n\n    if (start < 0) {\n      prepend();\n    }\n\n    let promises = newViews.map(view => {\n      return view.display(this.request);\n    });\n\n    if (newViews.length) {\n      return Promise.all(promises).then(() => {\n        return this.check();\n      }).then(() => {\n        // Check to see if anything new is on screen after rendering\n        return this.update(delta);\n      }, err => {\n        return err;\n      });\n    } else {\n      this.q.enqueue(function () {\n        this.update();\n      }.bind(this));\n      checking.resolve(false);\n      return checking.promise;\n    }\n  }\n\n  trim() {\n    var task = new _core.defer();\n    var displayed = this.views.displayed();\n    var first = displayed[0];\n    var last = displayed[displayed.length - 1];\n    var firstIndex = this.views.indexOf(first);\n    var lastIndex = this.views.indexOf(last);\n    var above = this.views.slice(0, firstIndex);\n    var below = this.views.slice(lastIndex + 1); // Erase all but last above\n\n    for (var i = 0; i < above.length - 1; i++) {\n      this.erase(above[i], above);\n    } // Erase all except first below\n\n\n    for (var j = 1; j < below.length; j++) {\n      this.erase(below[j]);\n    }\n\n    task.resolve();\n    return task.promise;\n  }\n\n  erase(view, above) {\n    //Trim\n    var prevTop;\n    var prevLeft;\n\n    if (!this.settings.fullsize) {\n      prevTop = this.container.scrollTop;\n      prevLeft = this.container.scrollLeft;\n    } else {\n      prevTop = window.scrollY;\n      prevLeft = window.scrollX;\n    }\n\n    var bounds = view.bounds();\n    this.views.remove(view);\n\n    if (above) {\n      if (this.settings.axis === \"vertical\") {\n        this.scrollTo(0, prevTop - bounds.height, true);\n      } else {\n        if (this.settings.direction === 'rtl') {\n          if (!this.settings.fullsize) {\n            this.scrollTo(prevLeft, 0, true);\n          } else {\n            this.scrollTo(prevLeft + Math.floor(bounds.width), 0, true);\n          }\n        } else {\n          this.scrollTo(prevLeft - Math.floor(bounds.width), 0, true);\n        }\n      }\n    }\n  }\n\n  addEventListeners(stage) {\n    window.addEventListener(\"unload\", function (e) {\n      this.ignore = true; // this.scrollTo(0,0);\n\n      this.destroy();\n    }.bind(this));\n    this.addScrollListeners();\n\n    if (this.isPaginated && this.settings.snap) {\n      this.snapper = new _snap.default(this, this.settings.snap && typeof this.settings.snap === \"object\" && this.settings.snap);\n    }\n  }\n\n  addScrollListeners() {\n    var scroller;\n    this.tick = _core.requestAnimationFrame;\n    let dir = this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\" ? -1 : 1;\n    this.scrollDeltaVert = 0;\n    this.scrollDeltaHorz = 0;\n\n    if (!this.settings.fullsize) {\n      scroller = this.container;\n      this.scrollTop = this.container.scrollTop;\n      this.scrollLeft = this.container.scrollLeft;\n    } else {\n      scroller = window;\n      this.scrollTop = window.scrollY * dir;\n      this.scrollLeft = window.scrollX * dir;\n    }\n\n    this._onScroll = this.onScroll.bind(this);\n    scroller.addEventListener(\"scroll\", this._onScroll);\n    this._scrolled = (0, _debounce.default)(this.scrolled.bind(this), 30); // this.tick.call(window, this.onScroll.bind(this));\n\n    this.didScroll = false;\n  }\n\n  removeEventListeners() {\n    var scroller;\n\n    if (!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n\n    scroller.removeEventListener(\"scroll\", this._onScroll);\n    this._onScroll = undefined;\n  }\n\n  onScroll() {\n    let scrollTop;\n    let scrollLeft;\n    let dir = this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\" ? -1 : 1;\n\n    if (!this.settings.fullsize) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY * dir;\n      scrollLeft = window.scrollX * dir;\n    }\n\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n\n    if (!this.ignore) {\n      this._scrolled();\n    } else {\n      this.ignore = false;\n    }\n\n    this.scrollDeltaVert += Math.abs(scrollTop - this.prevScrollTop);\n    this.scrollDeltaHorz += Math.abs(scrollLeft - this.prevScrollLeft);\n    this.prevScrollTop = scrollTop;\n    this.prevScrollLeft = scrollLeft;\n    clearTimeout(this.scrollTimeout);\n    this.scrollTimeout = setTimeout(function () {\n      this.scrollDeltaVert = 0;\n      this.scrollDeltaHorz = 0;\n    }.bind(this), 150);\n    clearTimeout(this.afterScrolled);\n    this.didScroll = false;\n  }\n\n  scrolled() {\n    this.q.enqueue(function () {\n      return this.check();\n    }.bind(this));\n    this.emit(_constants.EVENTS.MANAGERS.SCROLL, {\n      top: this.scrollTop,\n      left: this.scrollLeft\n    });\n    clearTimeout(this.afterScrolled);\n    this.afterScrolled = setTimeout(function () {\n      // Don't report scroll if we are about the snap\n      if (this.snapper && this.snapper.supportsTouch && this.snapper.needsSnap()) {\n        return;\n      }\n\n      this.emit(_constants.EVENTS.MANAGERS.SCROLLED, {\n        top: this.scrollTop,\n        left: this.scrollLeft\n      });\n    }.bind(this), this.settings.afterScrolledTimeout);\n  }\n\n  next() {\n    let delta = this.layout.props.name === \"pre-paginated\" && this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n    if (!this.views.length) return;\n\n    if (this.isPaginated && this.settings.axis === \"horizontal\") {\n      this.scrollBy(delta, 0, true);\n    } else {\n      this.scrollBy(0, this.layout.height, true);\n    }\n\n    this.q.enqueue(function () {\n      return this.check();\n    }.bind(this));\n  }\n\n  prev() {\n    let delta = this.layout.props.name === \"pre-paginated\" && this.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\n    if (!this.views.length) return;\n\n    if (this.isPaginated && this.settings.axis === \"horizontal\") {\n      this.scrollBy(-delta, 0, true);\n    } else {\n      this.scrollBy(0, -this.layout.height, true);\n    }\n\n    this.q.enqueue(function () {\n      return this.check();\n    }.bind(this));\n  }\n\n  updateFlow(flow) {\n    if (this.rendered && this.snapper) {\n      this.snapper.destroy();\n      this.snapper = undefined;\n    }\n\n    super.updateFlow(flow, \"scroll\");\n\n    if (this.rendered && this.isPaginated && this.settings.snap) {\n      this.snapper = new _snap.default(this, this.settings.snap && typeof this.settings.snap === \"object\" && this.settings.snap);\n    }\n  }\n\n  destroy() {\n    super.destroy();\n\n    if (this.snapper) {\n      this.snapper.destroy();\n    }\n  }\n\n}\n\nvar _default = ContinuousViewManager;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar epubViewStyles = {\n  viewHolder: {\n    position: 'relative',\n    height: '100%',\n    width: '100%'\n  },\n  view: {\n    height: '100%'\n  }\n};\nvar _default = epubViewStyles;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar reactReaderStyles = {\n  container: {\n    overflow: 'hidden',\n    height: '100%'\n  },\n  readerArea: {\n    position: 'relative',\n    zIndex: 1,\n    height: '100%',\n    width: '100%',\n    backgroundColor: '#fff',\n    transition: 'all .3s ease'\n  },\n  containerExpanded: {\n    transform: 'translateX(256px)'\n  },\n  titleArea: {\n    position: 'absolute',\n    top: 20,\n    left: 50,\n    right: 50,\n    textAlign: 'center',\n    color: '#999'\n  },\n  reader: {\n    position: 'absolute',\n    top: 50,\n    left: 50,\n    bottom: 20,\n    right: 50\n  },\n  swipeWrapper: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    bottom: 0,\n    right: 0,\n    zIndex: 200\n  },\n  prev: {\n    left: 1\n  },\n  next: {\n    right: 1\n  },\n  arrow: {\n    outline: 'none',\n    border: 'none',\n    background: 'none',\n    position: 'absolute',\n    top: '50%',\n    marginTop: -32,\n    fontSize: 64,\n    padding: '0 10px',\n    color: '#E2E2E2',\n    fontFamily: 'arial, sans-serif',\n    cursor: 'pointer',\n    userSelect: 'none',\n    appearance: 'none',\n    fontWeight: 'normal'\n  },\n  arrowHover: {\n    color: '#777'\n  },\n  tocBackground: {\n    position: 'absolute',\n    left: 256,\n    top: 0,\n    bottom: 0,\n    right: 0,\n    zIndex: 1\n  },\n  tocArea: {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    bottom: 0,\n    zIndex: 0,\n    width: 256,\n    overflowY: 'auto',\n    WebkitOverflowScrolling: 'touch',\n    background: '#f2f2f2',\n    padding: '10px 0'\n  },\n  tocAreaButton: {\n    userSelect: 'none',\n    appearance: 'none',\n    background: 'none',\n    border: 'none',\n    display: 'block',\n    fontFamily: 'sans-serif',\n    width: '100%',\n    fontSize: '.9em',\n    textAlign: 'left',\n    padding: '.9em 1em',\n    borderBottom: '1px solid #ddd',\n    color: '#aaa',\n    boxSizing: 'border-box',\n    outline: 'none',\n    cursor: 'pointer'\n  },\n  tocButton: {\n    background: 'none',\n    border: 'none',\n    width: 32,\n    height: 32,\n    position: 'absolute',\n    top: 10,\n    left: 10,\n    borderRadius: 2,\n    outline: 'none',\n    cursor: 'pointer'\n  },\n  tocButtonExpanded: {\n    background: '#f2f2f2'\n  },\n  tocButtonBar: {\n    position: 'absolute',\n    width: '60%',\n    background: '#ccc',\n    height: 2,\n    left: '50%',\n    margin: '-1px -30%',\n    top: '50%',\n    transition: 'all .5s ease'\n  },\n  tocButtonBarTop: {\n    top: '35%'\n  },\n  tocButtonBottom: {\n    top: '66%'\n  },\n  loadingView: {\n    position: 'absolute',\n    top: '50%',\n    left: '10%',\n    right: '10%',\n    color: '#ccc',\n    textAlign: 'center',\n    margintop: '-.5em'\n  }\n};\nvar _default = reactReaderStyles;\nexports.default = _default;","export const transitions = {\n  scale: {\n    entering: { transform: 'translateX(-50%) scale(1.5)' },\n    entered: { transform: 'translateX(-50%) scale(1)' },\n    exiting: { transform: 'translateX(-50%) scale(1.5)' },\n    exited: { transform: 'translateX(-50%) scale(1)' },\n  },\n  rotate: {\n    entering: { transform: 'translateX(-50%) rotate(360deg)' },\n    entered: { transform: 'translateX(-50%) rotate(0deg)' },\n    exiting: { transform: 'translateX(-50%) rotate(0deg)' },\n    exited: { transform: 'translateX(-50%) rotate(360deg)' },\n  },\n  skew: {\n    entering: { transform: 'translateX(-50%) skewX(20deg)' },\n    entered: { transform: 'translateX(-50%) skewX(0deg)' },\n    exiting: { transform: 'translateX(-50%) skewX(20deg)' },\n    exited: { transform: 'translateX(-50%) skewX(0deg)' },\n  },\n};\n","\"use strict\";\n\nvar _CSSTransition = _interopRequireDefault(require(\"./CSSTransition\"));\n\nvar _ReplaceTransition = _interopRequireDefault(require(\"./ReplaceTransition\"));\n\nvar _TransitionGroup = _interopRequireDefault(require(\"./TransitionGroup\"));\n\nvar _Transition = _interopRequireDefault(require(\"./Transition\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = {\n  Transition: _Transition.default,\n  TransitionGroup: _TransitionGroup.default,\n  ReplaceTransition: _ReplaceTransition.default,\n  CSSTransition: _CSSTransition.default\n};","\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar PropTypes = _interopRequireWildcard(require(\"prop-types\"));\n\nvar _addClass = _interopRequireDefault(require(\"dom-helpers/class/addClass\"));\n\nvar _removeClass = _interopRequireDefault(require(\"dom-helpers/class/removeClass\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _Transition = _interopRequireDefault(require(\"./Transition\"));\n\nvar _PropTypes = require(\"./utils/PropTypes\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nvar addClass = function addClass(node, classes) {\n  return node && classes && classes.split(' ').forEach(function (c) {\n    return (0, _addClass.default)(node, c);\n  });\n};\n\nvar removeClass = function removeClass(node, classes) {\n  return node && classes && classes.split(' ').forEach(function (c) {\n    return (0, _removeClass.default)(node, c);\n  });\n};\n/**\n * A transition component inspired by the excellent\n * [ng-animate](http://www.nganimate.org/) library, you should use it if you're\n * using CSS transitions or animations. It's built upon the\n * [`Transition`](https://reactcommunity.org/react-transition-group/transition)\n * component, so it inherits all of its props.\n *\n * `CSSTransition` applies a pair of class names during the `appear`, `enter`,\n * and `exit` states of the transition. The first class is applied and then a\n * second `*-active` class in order to activate the CSSS transition. After the\n * transition, matching `*-done` class names are applied to persist the\n * transition state.\n *\n * ```jsx\n * function App() {\n *   const [inProp, setInProp] = useState(false);\n *   return (\n *     <div>\n *       <CSSTransition in={inProp} timeout={200} classNames=\"my-node\">\n *         <div>\n *           {\"I'll receive my-node-* classes\"}\n *         </div>\n *       </CSSTransition>\n *       <button type=\"button\" onClick={() => setInProp(true)}>\n *         Click to Enter\n *       </button>\n *     </div>\n *   );\n * }\n * ```\n *\n * When the `in` prop is set to `true`, the child component will first receive\n * the class `example-enter`, then the `example-enter-active` will be added in\n * the next tick. `CSSTransition` [forces a\n * reflow](https://github.com/reactjs/react-transition-group/blob/5007303e729a74be66a21c3e2205e4916821524b/src/CSSTransition.js#L208-L215)\n * between before adding the `example-enter-active`. This is an important trick\n * because it allows us to transition between `example-enter` and\n * `example-enter-active` even though they were added immediately one after\n * another. Most notably, this is what makes it possible for us to animate\n * _appearance_.\n *\n * ```css\n * .my-node-enter {\n *   opacity: 0;\n * }\n * .my-node-enter-active {\n *   opacity: 1;\n *   transition: opacity 200ms;\n * }\n * .my-node-exit {\n *   opacity: 1;\n * }\n * .my-node-exit-active {\n *   opacity: 0;\n *   transition: opacity: 200ms;\n * }\n * ```\n *\n * `*-active` classes represent which styles you want to animate **to**.\n */\n\n\nvar CSSTransition =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(CSSTransition, _React$Component);\n\n  function CSSTransition() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n\n    _this.onEnter = function (node, appearing) {\n      var _this$getClassNames = _this.getClassNames(appearing ? 'appear' : 'enter'),\n          className = _this$getClassNames.className;\n\n      _this.removeClasses(node, 'exit');\n\n      addClass(node, className);\n\n      if (_this.props.onEnter) {\n        _this.props.onEnter(node, appearing);\n      }\n    };\n\n    _this.onEntering = function (node, appearing) {\n      var _this$getClassNames2 = _this.getClassNames(appearing ? 'appear' : 'enter'),\n          activeClassName = _this$getClassNames2.activeClassName;\n\n      _this.reflowAndAddClass(node, activeClassName);\n\n      if (_this.props.onEntering) {\n        _this.props.onEntering(node, appearing);\n      }\n    };\n\n    _this.onEntered = function (node, appearing) {\n      var appearClassName = _this.getClassNames('appear').doneClassName;\n\n      var enterClassName = _this.getClassNames('enter').doneClassName;\n\n      var doneClassName = appearing ? appearClassName + \" \" + enterClassName : enterClassName;\n\n      _this.removeClasses(node, appearing ? 'appear' : 'enter');\n\n      addClass(node, doneClassName);\n\n      if (_this.props.onEntered) {\n        _this.props.onEntered(node, appearing);\n      }\n    };\n\n    _this.onExit = function (node) {\n      var _this$getClassNames3 = _this.getClassNames('exit'),\n          className = _this$getClassNames3.className;\n\n      _this.removeClasses(node, 'appear');\n\n      _this.removeClasses(node, 'enter');\n\n      addClass(node, className);\n\n      if (_this.props.onExit) {\n        _this.props.onExit(node);\n      }\n    };\n\n    _this.onExiting = function (node) {\n      var _this$getClassNames4 = _this.getClassNames('exit'),\n          activeClassName = _this$getClassNames4.activeClassName;\n\n      _this.reflowAndAddClass(node, activeClassName);\n\n      if (_this.props.onExiting) {\n        _this.props.onExiting(node);\n      }\n    };\n\n    _this.onExited = function (node) {\n      var _this$getClassNames5 = _this.getClassNames('exit'),\n          doneClassName = _this$getClassNames5.doneClassName;\n\n      _this.removeClasses(node, 'exit');\n\n      addClass(node, doneClassName);\n\n      if (_this.props.onExited) {\n        _this.props.onExited(node);\n      }\n    };\n\n    _this.getClassNames = function (type) {\n      var classNames = _this.props.classNames;\n      var isStringClassNames = typeof classNames === 'string';\n      var prefix = isStringClassNames && classNames ? classNames + '-' : '';\n      var className = isStringClassNames ? prefix + type : classNames[type];\n      var activeClassName = isStringClassNames ? className + '-active' : classNames[type + 'Active'];\n      var doneClassName = isStringClassNames ? className + '-done' : classNames[type + 'Done'];\n      return {\n        className: className,\n        activeClassName: activeClassName,\n        doneClassName: doneClassName\n      };\n    };\n\n    return _this;\n  }\n\n  var _proto = CSSTransition.prototype;\n\n  _proto.removeClasses = function removeClasses(node, type) {\n    var _this$getClassNames6 = this.getClassNames(type),\n        className = _this$getClassNames6.className,\n        activeClassName = _this$getClassNames6.activeClassName,\n        doneClassName = _this$getClassNames6.doneClassName;\n\n    className && removeClass(node, className);\n    activeClassName && removeClass(node, activeClassName);\n    doneClassName && removeClass(node, doneClassName);\n  };\n\n  _proto.reflowAndAddClass = function reflowAndAddClass(node, className) {\n    // This is for to force a repaint,\n    // which is necessary in order to transition styles when adding a class name.\n    if (className) {\n      /* eslint-disable no-unused-expressions */\n      node && node.scrollTop;\n      /* eslint-enable no-unused-expressions */\n\n      addClass(node, className);\n    }\n  };\n\n  _proto.render = function render() {\n    var props = _extends({}, this.props);\n\n    delete props.classNames;\n    return _react.default.createElement(_Transition.default, _extends({}, props, {\n      onEnter: this.onEnter,\n      onEntered: this.onEntered,\n      onEntering: this.onEntering,\n      onExit: this.onExit,\n      onExiting: this.onExiting,\n      onExited: this.onExited\n    }));\n  };\n\n  return CSSTransition;\n}(_react.default.Component);\n\nCSSTransition.defaultProps = {\n  classNames: ''\n};\nCSSTransition.propTypes = process.env.NODE_ENV !== \"production\" ? _extends({}, _Transition.default.propTypes, {\n  /**\n   * The animation classNames applied to the component as it enters, exits or\n   * has finished the transition. A single name can be provided and it will be\n   * suffixed for each stage: e.g.\n   *\n   * `classNames=\"fade\"` applies `fade-enter`, `fade-enter-active`,\n   * `fade-enter-done`, `fade-exit`, `fade-exit-active`, `fade-exit-done`,\n   * `fade-appear`, `fade-appear-active`, and `fade-appear-done`.\n   *\n   * **Note**: `fade-appear-done` and `fade-enter-done` will _both_ be applied.\n   * This allows you to define different behavior for when appearing is done and\n   * when regular entering is done, using selectors like\n   * `.fade-enter-done:not(.fade-appear-done)`. For example, you could apply an\n   * epic entrance animation when element first appears in the DOM using\n   * [Animate.css](https://daneden.github.io/animate.css/). Otherwise you can\n   * simply use `fade-enter-done` for defining both cases.\n   *\n   * Each individual classNames can also be specified independently like:\n   *\n   * ```js\n   * classNames={{\n   *  appear: 'my-appear',\n   *  appearActive: 'my-active-appear',\n   *  appearDone: 'my-done-appear',\n   *  enter: 'my-enter',\n   *  enterActive: 'my-active-enter',\n   *  enterDone: 'my-done-enter',\n   *  exit: 'my-exit',\n   *  exitActive: 'my-active-exit',\n   *  exitDone: 'my-done-exit',\n   * }}\n   * ```\n   *\n   * If you want to set these classes using CSS Modules:\n   *\n   * ```js\n   * import styles from './styles.css';\n   * ```\n   *\n   * you might want to use camelCase in your CSS file, that way could simply\n   * spread them instead of listing them one by one:\n   *\n   * ```js\n   * classNames={{ ...styles }}\n   * ```\n   *\n   * @type {string | {\n   *  appear?: string,\n   *  appearActive?: string,\n   *  appearDone?: string,\n   *  enter?: string,\n   *  enterActive?: string,\n   *  enterDone?: string,\n   *  exit?: string,\n   *  exitActive?: string,\n   *  exitDone?: string,\n   * }}\n   */\n  classNames: _PropTypes.classNamesShape,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'enter' or 'appear' class is\n   * applied.\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEnter: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'enter-active' or\n   * 'appear-active' class is applied.\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEntering: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'enter' or\n   * 'appear' classes are **removed** and the `done` class is added to the DOM node.\n   *\n   * @type Function(node: HtmlElement, isAppearing: bool)\n   */\n  onEntered: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'exit' class is\n   * applied.\n   *\n   * @type Function(node: HtmlElement)\n   */\n  onExit: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'exit-active' is applied.\n   *\n   * @type Function(node: HtmlElement)\n   */\n  onExiting: PropTypes.func,\n\n  /**\n   * A `<Transition>` callback fired immediately after the 'exit' classes\n   * are **removed** and the `exit-done` class is added to the DOM node.\n   *\n   * @type Function(node: HtmlElement)\n   */\n  onExited: PropTypes.func\n}) : {};\nvar _default = CSSTransition;\nexports.default = _default;\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.default = addClass;\n\nvar _hasClass = _interopRequireDefault(require(\"./hasClass\"));\n\nfunction addClass(element, className) {\n  if (element.classList) element.classList.add(className);else if (!(0, _hasClass.default)(element, className)) if (typeof element.className === 'string') element.className = element.className + ' ' + className;else element.setAttribute('class', (element.className && element.className.baseVal || '') + ' ' + className);\n}\n\nmodule.exports = exports[\"default\"];","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = hasClass;\n\nfunction hasClass(element, className) {\n  if (element.classList) return !!className && element.classList.contains(className);else return (\" \" + (element.className.baseVal || element.className) + \" \").indexOf(\" \" + className + \" \") !== -1;\n}\n\nmodule.exports = exports[\"default\"];","'use strict';\n\nfunction replaceClassName(origClass, classToRemove) {\n  return origClass.replace(new RegExp('(^|\\\\s)' + classToRemove + '(?:\\\\s|$)', 'g'), '$1').replace(/\\s+/g, ' ').replace(/^\\s*|\\s*$/g, '');\n}\n\nmodule.exports = function removeClass(element, className) {\n  if (element.classList) element.classList.remove(className);else if (typeof element.className === 'string') element.className = replaceClassName(element.className, className);else element.setAttribute('class', replaceClassName(element.className && element.className.baseVal || '', className));\n};","\"use strict\";\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactDom = require(\"react-dom\");\n\nvar _TransitionGroup = _interopRequireDefault(require(\"./TransitionGroup\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\n/**\n * The `<ReplaceTransition>` component is a specialized `Transition` component\n * that animates between two children.\n *\n * ```jsx\n * <ReplaceTransition in>\n *   <Fade><div>I appear first</div></Fade>\n *   <Fade><div>I replace the above</div></Fade>\n * </ReplaceTransition>\n * ```\n */\nvar ReplaceTransition =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inheritsLoose(ReplaceTransition, _React$Component);\n\n  function ReplaceTransition() {\n    var _this;\n\n    for (var _len = arguments.length, _args = new Array(_len), _key = 0; _key < _len; _key++) {\n      _args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(_args)) || this;\n\n    _this.handleEnter = function () {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      return _this.handleLifecycle('onEnter', 0, args);\n    };\n\n    _this.handleEntering = function () {\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      return _this.handleLifecycle('onEntering', 0, args);\n    };\n\n    _this.handleEntered = function () {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      return _this.handleLifecycle('onEntered', 0, args);\n    };\n\n    _this.handleExit = function () {\n      for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n        args[_key5] = arguments[_key5];\n      }\n\n      return _this.handleLifecycle('onExit', 1, args);\n    };\n\n    _this.handleExiting = function () {\n      for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n        args[_key6] = arguments[_key6];\n      }\n\n      return _this.handleLifecycle('onExiting', 1, args);\n    };\n\n    _this.handleExited = function () {\n      for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      return _this.handleLifecycle('onExited', 1, args);\n    };\n\n    return _this;\n  }\n\n  var _proto = ReplaceTransition.prototype;\n\n  _proto.handleLifecycle = function handleLifecycle(handler, idx, originalArgs) {\n    var _child$props;\n\n    var children = this.props.children;\n\n    var child = _react.default.Children.toArray(children)[idx];\n\n    if (child.props[handler]) (_child$props = child.props)[handler].apply(_child$props, originalArgs);\n    if (this.props[handler]) this.props[handler]((0, _reactDom.findDOMNode)(this));\n  };\n\n  _proto.render = function render() {\n    var _this$props = this.props,\n        children = _this$props.children,\n        inProp = _this$props.in,\n        props = _objectWithoutPropertiesLoose(_this$props, [\"children\", \"in\"]);\n\n    var _React$Children$toArr = _react.default.Children.toArray(children),\n        first = _React$Children$toArr[0],\n        second = _React$Children$toArr[1];\n\n    delete props.onEnter;\n    delete props.onEntering;\n    delete props.onEntered;\n    delete props.onExit;\n    delete props.onExiting;\n    delete props.onExited;\n    return _react.default.createElement(_TransitionGroup.default, props, inProp ? _react.default.cloneElement(first, {\n      key: 'first',\n      onEnter: this.handleEnter,\n      onEntering: this.handleEntering,\n      onEntered: this.handleEntered\n    }) : _react.default.cloneElement(second, {\n      key: 'second',\n      onEnter: this.handleExit,\n      onEntering: this.handleExiting,\n      onEntered: this.handleExited\n    }));\n  };\n\n  return ReplaceTransition;\n}(_react.default.Component);\n\nReplaceTransition.propTypes = process.env.NODE_ENV !== \"production\" ? {\n  in: _propTypes.default.bool.isRequired,\n  children: function children(props, propName) {\n    if (_react.default.Children.count(props[propName]) !== 2) return new Error(\"\\\"\" + propName + \"\\\" must be exactly two transition components.\");\n    return null;\n  }\n} : {};\nvar _default = ReplaceTransition;\nexports.default = _default;\nmodule.exports = exports[\"default\"];","\"use strict\";\n\nexports.__esModule = true;\nexports.getChildMapping = getChildMapping;\nexports.mergeChildMappings = mergeChildMappings;\nexports.getInitialChildMapping = getInitialChildMapping;\nexports.getNextChildMapping = getNextChildMapping;\n\nvar _react = require(\"react\");\n\n/**\n * Given `this.props.children`, return an object mapping key to child.\n *\n * @param {*} children `this.props.children`\n * @return {object} Mapping of key to child\n */\nfunction getChildMapping(children, mapFn) {\n  var mapper = function mapper(child) {\n    return mapFn && (0, _react.isValidElement)(child) ? mapFn(child) : child;\n  };\n\n  var result = Object.create(null);\n  if (children) _react.Children.map(children, function (c) {\n    return c;\n  }).forEach(function (child) {\n    // run the map function here instead so that the key is the computed one\n    result[child.key] = mapper(child);\n  });\n  return result;\n}\n/**\n * When you're adding or removing children some may be added or removed in the\n * same render pass. We want to show *both* since we want to simultaneously\n * animate elements in and out. This function takes a previous set of keys\n * and a new set of keys and merges them with its best guess of the correct\n * ordering. In the future we may expose some of the utilities in\n * ReactMultiChild to make this easy, but for now React itself does not\n * directly have this concept of the union of prevChildren and nextChildren\n * so we implement it here.\n *\n * @param {object} prev prev children as returned from\n * `ReactTransitionChildMapping.getChildMapping()`.\n * @param {object} next next children as returned from\n * `ReactTransitionChildMapping.getChildMapping()`.\n * @return {object} a key set that contains all keys in `prev` and all keys\n * in `next` in a reasonable order.\n */\n\n\nfunction mergeChildMappings(prev, next) {\n  prev = prev || {};\n  next = next || {};\n\n  function getValueForKey(key) {\n    return key in next ? next[key] : prev[key];\n  } // For each key of `next`, the list of keys to insert before that key in\n  // the combined list\n\n\n  var nextKeysPending = Object.create(null);\n  var pendingKeys = [];\n\n  for (var prevKey in prev) {\n    if (prevKey in next) {\n      if (pendingKeys.length) {\n        nextKeysPending[prevKey] = pendingKeys;\n        pendingKeys = [];\n      }\n    } else {\n      pendingKeys.push(prevKey);\n    }\n  }\n\n  var i;\n  var childMapping = {};\n\n  for (var nextKey in next) {\n    if (nextKeysPending[nextKey]) {\n      for (i = 0; i < nextKeysPending[nextKey].length; i++) {\n        var pendingNextKey = nextKeysPending[nextKey][i];\n        childMapping[nextKeysPending[nextKey][i]] = getValueForKey(pendingNextKey);\n      }\n    }\n\n    childMapping[nextKey] = getValueForKey(nextKey);\n  } // Finally, add the keys which didn't appear before any key in `next`\n\n\n  for (i = 0; i < pendingKeys.length; i++) {\n    childMapping[pendingKeys[i]] = getValueForKey(pendingKeys[i]);\n  }\n\n  return childMapping;\n}\n\nfunction getProp(child, prop, props) {\n  return props[prop] != null ? props[prop] : child.props[prop];\n}\n\nfunction getInitialChildMapping(props, onExited) {\n  return getChildMapping(props.children, function (child) {\n    return (0, _react.cloneElement)(child, {\n      onExited: onExited.bind(null, child),\n      in: true,\n      appear: getProp(child, 'appear', props),\n      enter: getProp(child, 'enter', props),\n      exit: getProp(child, 'exit', props)\n    });\n  });\n}\n\nfunction getNextChildMapping(nextProps, prevChildMapping, onExited) {\n  var nextChildMapping = getChildMapping(nextProps.children);\n  var children = mergeChildMappings(prevChildMapping, nextChildMapping);\n  Object.keys(children).forEach(function (key) {\n    var child = children[key];\n    if (!(0, _react.isValidElement)(child)) return;\n    var hasPrev = key in prevChildMapping;\n    var hasNext = key in nextChildMapping;\n    var prevChild = prevChildMapping[key];\n    var isLeaving = (0, _react.isValidElement)(prevChild) && !prevChild.props.in; // item is new (entering)\n\n    if (hasNext && (!hasPrev || isLeaving)) {\n      // console.log('entering', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        onExited: onExited.bind(null, child),\n        in: true,\n        exit: getProp(child, 'exit', nextProps),\n        enter: getProp(child, 'enter', nextProps)\n      });\n    } else if (!hasNext && hasPrev && !isLeaving) {\n      // item is old (exiting)\n      // console.log('leaving', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        in: false\n      });\n    } else if (hasNext && hasPrev && (0, _react.isValidElement)(prevChild)) {\n      // item hasn't changed transition states\n      // copy over the last transition props;\n      // console.log('unchanged', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        onExited: onExited.bind(null, child),\n        in: prevChild.props.in,\n        exit: getProp(child, 'exit', nextProps),\n        enter: getProp(child, 'enter', nextProps)\n      });\n    }\n  });\n  return children;\n}","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _index = _interopRequireDefault(require(\"epubjs/lib/index\"));\n\nvar _style = _interopRequireDefault(require(\"./style\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// MTL removed - line does not seem like a requirement any more (and was causing an error)\n// global.ePub = Epub; // Fix for v3 branch of epub.js -> needs ePub to by a global var\nvar EpubView = /*#__PURE__*/function (_Component) {\n  _inherits(EpubView, _Component);\n\n  var _super = _createSuper(EpubView);\n\n  function EpubView(props) {\n    var _this;\n\n    _classCallCheck(this, EpubView);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"onLocationChange\", function (loc) {\n      var _this$props = _this.props,\n          location = _this$props.location,\n          locationChanged = _this$props.locationChanged;\n      var newLocation = loc && loc.start;\n\n      if (location !== newLocation) {\n        _this.location = newLocation;\n        locationChanged && locationChanged(newLocation);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleKeyPress\", function (_ref) {\n      var key = _ref.key;\n      key && key === 'ArrowRight' && _this.nextPage();\n      key && key === 'ArrowLeft' && _this.prevPage();\n    });\n\n    _this.state = {\n      isLoaded: false,\n      toc: []\n    };\n    _this.viewerRef = /*#__PURE__*/_react.default.createRef();\n    _this.location = props.location;\n    _this.book = _this.rendition = _this.prevPage = _this.nextPage = null;\n    return _this;\n  }\n\n  _createClass(EpubView, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initBook(true);\n      document.addEventListener('keyup', this.handleKeyPress, false);\n    }\n  }, {\n    key: \"initBook\",\n    value: function initBook() {\n      var _this2 = this;\n\n      var _this$props2 = this.props,\n          url = _this$props2.url,\n          tocChanged = _this$props2.tocChanged,\n          epubInitOptions = _this$props2.epubInitOptions;\n\n      if (this.book) {\n        this.book.destroy();\n      }\n\n      this.book = new _index.default(url, epubInitOptions);\n      this.book.loaded.navigation.then(function (_ref2) {\n        var toc = _ref2.toc;\n\n        _this2.setState({\n          isLoaded: true,\n          toc: toc\n        }, function () {\n          tocChanged && tocChanged(toc);\n\n          _this2.initReader();\n        });\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.book = this.rendition = this.prevPage = this.nextPage = null;\n      document.removeEventListener('keyup', this.handleKeyPress, false);\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      return !this.state.isLoaded || nextProps.location !== this.props.location || nextProps.location !== this.props.location;\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.location !== this.props.location && this.location !== this.props.location) {\n        this.rendition.display(this.props.location);\n      }\n\n      if (prevProps.url !== this.props.url) {\n        this.initBook();\n      }\n    }\n  }, {\n    key: \"initReader\",\n    value: function initReader() {\n      var _this3 = this;\n\n      var toc = this.state.toc;\n      var _this$props3 = this.props,\n          location = _this$props3.location,\n          epubOptions = _this$props3.epubOptions,\n          getRendition = _this$props3.getRendition;\n      var node = this.viewerRef.current;\n      this.rendition = this.book.renderTo(node, _objectSpread({\n        contained: true,\n        width: '100%',\n        height: '100%'\n      }, epubOptions));\n\n      this.prevPage = function () {\n        _this3.rendition.prev();\n      };\n\n      this.nextPage = function () {\n        _this3.rendition.next();\n      };\n\n      this.registerEvents();\n      getRendition && getRendition(this.rendition);\n\n      if (typeof location === 'string' || typeof location === 'number') {\n        this.rendition.display(location);\n      } else if (toc.length > 0 && toc[0].href) {\n        this.rendition.display(toc[0].href);\n      } else {\n        this.rendition.display();\n      }\n    }\n  }, {\n    key: \"registerEvents\",\n    value: function registerEvents() {\n      var _this$props4 = this.props,\n          handleKeyPress = _this$props4.handleKeyPress,\n          handleTextSelected = _this$props4.handleTextSelected;\n      this.rendition.on('locationChanged', this.onLocationChange);\n      this.rendition.on('keyup', handleKeyPress || this.handleKeyPress);\n\n      if (handleTextSelected) {\n        this.rendition.on('selected', handleTextSelected);\n      }\n    }\n  }, {\n    key: \"renderBook\",\n    value: function renderBook() {\n      var styles = this.props.styles;\n      return /*#__PURE__*/_react.default.createElement(\"div\", {\n        ref: this.viewerRef,\n        style: styles.view\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var isLoaded = this.state.isLoaded;\n      var _this$props5 = this.props,\n          loadingView = _this$props5.loadingView,\n          styles = _this$props5.styles;\n      return /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.viewHolder\n      }, isLoaded && this.renderBook() || loadingView);\n    }\n  }]);\n\n  return EpubView;\n}(_react.Component);\n\nEpubView.defaultProps = {\n  loadingView: null,\n  locationChanged: null,\n  tocChanged: null,\n  styles: _style.default,\n  epubOptions: {},\n  epubInitOptions: {}\n};\nEpubView.propTypes = {\n  url: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.instanceOf(ArrayBuffer)]),\n  loadingView: _propTypes.default.element,\n  location: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),\n  locationChanged: _propTypes.default.func,\n  tocChanged: _propTypes.default.func,\n  styles: _propTypes.default.object,\n  epubInitOptions: _propTypes.default.object,\n  epubOptions: _propTypes.default.object,\n  getRendition: _propTypes.default.func,\n  handleKeyPress: _propTypes.default.func,\n  handleTextSelected: _propTypes.default.func\n};\nvar _default = EpubView;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"Book\", {\n  enumerable: true,\n  get: function () {\n    return _book.default;\n  }\n});\nObject.defineProperty(exports, \"Contents\", {\n  enumerable: true,\n  get: function () {\n    return _contents.default;\n  }\n});\nObject.defineProperty(exports, \"EpubCFI\", {\n  enumerable: true,\n  get: function () {\n    return _epubcfi.default;\n  }\n});\nObject.defineProperty(exports, \"Layout\", {\n  enumerable: true,\n  get: function () {\n    return _layout.default;\n  }\n});\nObject.defineProperty(exports, \"Rendition\", {\n  enumerable: true,\n  get: function () {\n    return _rendition.default;\n  }\n});\nexports.default = void 0;\n\nvar _book = _interopRequireDefault(require(\"./book\"));\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _rendition = _interopRequireDefault(require(\"./rendition\"));\n\nvar _contents = _interopRequireDefault(require(\"./contents\"));\n\nvar _layout = _interopRequireDefault(require(\"./layout\"));\n\nvar _epub = _interopRequireDefault(require(\"./epub\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _default = _epub.default;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _hook = _interopRequireDefault(require(\"./utils/hook\"));\n\nvar _section = _interopRequireDefault(require(\"./section\"));\n\nvar _replacements = require(\"./utils/replacements\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * A collection of Spine Items\n */\nclass Spine {\n  constructor() {\n    this.spineItems = [];\n    this.spineByHref = {};\n    this.spineById = {};\n    this.hooks = {};\n    this.hooks.serialize = new _hook.default();\n    this.hooks.content = new _hook.default(); // Register replacements\n\n    this.hooks.content.register(_replacements.replaceBase);\n    this.hooks.content.register(_replacements.replaceCanonical);\n    this.hooks.content.register(_replacements.replaceMeta);\n    this.epubcfi = new _epubcfi.default();\n    this.loaded = false;\n    this.items = undefined;\n    this.manifest = undefined;\n    this.spineNodeIndex = undefined;\n    this.baseUrl = undefined;\n    this.length = undefined;\n  }\n  /**\n   * Unpack items from a opf into spine items\n   * @param  {Packaging} _package\n   * @param  {method} resolver URL resolver\n   * @param  {method} canonical Resolve canonical url\n   */\n\n\n  unpack(_package, resolver, canonical) {\n    this.items = _package.spine;\n    this.manifest = _package.manifest;\n    this.spineNodeIndex = _package.spineNodeIndex;\n    this.baseUrl = _package.baseUrl || _package.basePath || \"\";\n    this.length = this.items.length;\n    this.items.forEach((item, index) => {\n      var manifestItem = this.manifest[item.idref];\n      var spineItem;\n      item.index = index;\n      item.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\n\n      if (item.href) {\n        item.url = resolver(item.href, true);\n        item.canonical = canonical(item.href);\n      }\n\n      if (manifestItem) {\n        item.href = manifestItem.href;\n        item.url = resolver(item.href, true);\n        item.canonical = canonical(item.href);\n\n        if (manifestItem.properties.length) {\n          item.properties.push.apply(item.properties, manifestItem.properties);\n        }\n      }\n\n      if (item.linear === \"yes\") {\n        item.prev = function () {\n          let prevIndex = item.index;\n\n          while (prevIndex > 0) {\n            let prev = this.get(prevIndex - 1);\n\n            if (prev && prev.linear) {\n              return prev;\n            }\n\n            prevIndex -= 1;\n          }\n\n          return;\n        }.bind(this);\n\n        item.next = function () {\n          let nextIndex = item.index;\n\n          while (nextIndex < this.spineItems.length - 1) {\n            let next = this.get(nextIndex + 1);\n\n            if (next && next.linear) {\n              return next;\n            }\n\n            nextIndex += 1;\n          }\n\n          return;\n        }.bind(this);\n      } else {\n        item.prev = function () {\n          return;\n        };\n\n        item.next = function () {\n          return;\n        };\n      }\n\n      spineItem = new _section.default(item, this.hooks);\n      this.append(spineItem);\n    });\n    this.loaded = true;\n  }\n  /**\n   * Get an item from the spine\n   * @param  {string|number} [target]\n   * @return {Section} section\n   * @example spine.get();\n   * @example spine.get(1);\n   * @example spine.get(\"chap1.html\");\n   * @example spine.get(\"#id1234\");\n   */\n\n\n  get(target) {\n    var index = 0;\n\n    if (typeof target === \"undefined\") {\n      while (index < this.spineItems.length) {\n        let next = this.spineItems[index];\n\n        if (next && next.linear) {\n          break;\n        }\n\n        index += 1;\n      }\n    } else if (this.epubcfi.isCfiString(target)) {\n      let cfi = new _epubcfi.default(target);\n      index = cfi.spinePos;\n    } else if (typeof target === \"number\" || isNaN(target) === false) {\n      index = target;\n    } else if (typeof target === \"string\" && target.indexOf(\"#\") === 0) {\n      index = this.spineById[target.substring(1)];\n    } else if (typeof target === \"string\") {\n      // Remove fragments\n      target = target.split(\"#\")[0];\n      index = this.spineByHref[target] || this.spineByHref[encodeURI(target)];\n    }\n\n    return this.spineItems[index] || null;\n  }\n  /**\n   * Append a Section to the Spine\n   * @private\n   * @param  {Section} section\n   */\n\n\n  append(section) {\n    var index = this.spineItems.length;\n    section.index = index;\n    this.spineItems.push(section); // Encode and Decode href lookups\n    // see pr for details: https://github.com/futurepress/epub.js/pull/358\n\n    this.spineByHref[decodeURI(section.href)] = index;\n    this.spineByHref[encodeURI(section.href)] = index;\n    this.spineByHref[section.href] = index;\n    this.spineById[section.idref] = index;\n    return index;\n  }\n  /**\n   * Prepend a Section to the Spine\n   * @private\n   * @param  {Section} section\n   */\n\n\n  prepend(section) {\n    // var index = this.spineItems.unshift(section);\n    this.spineByHref[section.href] = 0;\n    this.spineById[section.idref] = 0; // Re-index\n\n    this.spineItems.forEach(function (item, index) {\n      item.index = index;\n    });\n    return 0;\n  } // insert(section, index) {\n  //\n  // };\n\n  /**\n   * Remove a Section from the Spine\n   * @private\n   * @param  {Section} section\n   */\n\n\n  remove(section) {\n    var index = this.spineItems.indexOf(section);\n\n    if (index > -1) {\n      delete this.spineByHref[section.href];\n      delete this.spineById[section.idref];\n      return this.spineItems.splice(index, 1);\n    }\n  }\n  /**\n   * Loop over the Sections in the Spine\n   * @return {method} forEach\n   */\n\n\n  each() {\n    return this.spineItems.forEach.apply(this.spineItems, arguments);\n  }\n  /**\n   * Find the first Section in the Spine\n   * @return {Section} first section\n   */\n\n\n  first() {\n    let index = 0;\n\n    do {\n      let next = this.get(index);\n\n      if (next && next.linear) {\n        return next;\n      }\n\n      index += 1;\n    } while (index < this.spineItems.length);\n  }\n  /**\n   * Find the last Section in the Spine\n   * @return {Section} last section\n   */\n\n\n  last() {\n    let index = this.spineItems.length - 1;\n\n    do {\n      let prev = this.get(index);\n\n      if (prev && prev.linear) {\n        return prev;\n      }\n\n      index -= 1;\n    } while (index >= 0);\n  }\n\n  destroy() {\n    this.each(section => section.destroy());\n    this.spineItems = undefined;\n    this.spineByHref = undefined;\n    this.spineById = undefined;\n    this.hooks.serialize.clear();\n    this.hooks.content.clear();\n    this.hooks = undefined;\n    this.epubcfi = undefined;\n    this.loaded = false;\n    this.items = undefined;\n    this.manifest = undefined;\n    this.spineNodeIndex = undefined;\n    this.baseUrl = undefined;\n    this.length = undefined;\n  }\n\n}\n\nvar _default = Spine;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _hook = _interopRequireDefault(require(\"./utils/hook\"));\n\nvar _replacements = require(\"./utils/replacements\");\n\nvar _request2 = _interopRequireDefault(require(\"./utils/request\"));\n\nvar _xmldom = require(\"@xmldom/xmldom\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Represents a Section of the Book\n *\n * In most books this is equivelent to a Chapter\n * @param {object} item  The spine item representing the section\n * @param {object} hooks hooks for serialize and content\n */\nclass Section {\n  constructor(item, hooks) {\n    this.idref = item.idref;\n    this.linear = item.linear === \"yes\";\n    this.properties = item.properties;\n    this.index = item.index;\n    this.href = item.href;\n    this.url = item.url;\n    this.canonical = item.canonical;\n    this.next = item.next;\n    this.prev = item.prev;\n    this.cfiBase = item.cfiBase;\n\n    if (hooks) {\n      this.hooks = hooks;\n    } else {\n      this.hooks = {};\n      this.hooks.serialize = new _hook.default(this);\n      this.hooks.content = new _hook.default(this);\n    }\n\n    this.document = undefined;\n    this.contents = undefined;\n    this.output = undefined;\n  }\n  /**\n   * Load the section from its url\n   * @param  {method} [_request] a request method to use for loading\n   * @return {document} a promise with the xml document\n   */\n\n\n  load(_request) {\n    var request = _request || this.request || _request2.default;\n    var loading = new _core.defer();\n    var loaded = loading.promise;\n\n    if (this.contents) {\n      loading.resolve(this.contents);\n    } else {\n      request(this.url).then(function (xml) {\n        // var directory = new Url(this.url).directory;\n        this.document = xml;\n        this.contents = xml.documentElement;\n        return this.hooks.content.trigger(this.document, this);\n      }.bind(this)).then(function () {\n        loading.resolve(this.contents);\n      }.bind(this)).catch(function (error) {\n        loading.reject(error);\n      });\n    }\n\n    return loaded;\n  }\n  /**\n   * Adds a base tag for resolving urls in the section\n   * @private\n   */\n\n\n  base() {\n    return (0, _replacements.replaceBase)(this.document, this);\n  }\n  /**\n   * Render the contents of a section\n   * @param  {method} [_request] a request method to use for loading\n   * @return {string} output a serialized XML Document\n   */\n\n\n  render(_request) {\n    var rendering = new _core.defer();\n    var rendered = rendering.promise;\n    this.output; // TODO: better way to return this from hooks?\n\n    this.load(_request).then(function (contents) {\n      var userAgent = typeof navigator !== 'undefined' && navigator.userAgent || '';\n      var isIE = userAgent.indexOf('Trident') >= 0;\n      var Serializer;\n\n      if (typeof XMLSerializer === \"undefined\" || isIE) {\n        Serializer = _xmldom.DOMParser;\n      } else {\n        Serializer = XMLSerializer;\n      }\n\n      var serializer = new Serializer();\n      this.output = serializer.serializeToString(contents);\n      return this.output;\n    }.bind(this)).then(function () {\n      return this.hooks.serialize.trigger(this.output, this);\n    }.bind(this)).then(function () {\n      rendering.resolve(this.output);\n    }.bind(this)).catch(function (error) {\n      rendering.reject(error);\n    });\n    return rendered;\n  }\n  /**\n   * Find a string in a section\n   * @param  {string} _query The query string to find\n   * @return {object[]} A list of matches, with form {cfi, excerpt}\n   */\n\n\n  find(_query) {\n    var section = this;\n    var matches = [];\n\n    var query = _query.toLowerCase();\n\n    var find = function (node) {\n      var text = node.textContent.toLowerCase();\n      var range = section.document.createRange();\n      var cfi;\n      var pos;\n      var last = -1;\n      var excerpt;\n      var limit = 150;\n\n      while (pos != -1) {\n        // Search for the query\n        pos = text.indexOf(query, last + 1);\n\n        if (pos != -1) {\n          // We found it! Generate a CFI\n          range = section.document.createRange();\n          range.setStart(node, pos);\n          range.setEnd(node, pos + query.length);\n          cfi = section.cfiFromRange(range); // Generate the excerpt\n\n          if (node.textContent.length < limit) {\n            excerpt = node.textContent;\n          } else {\n            excerpt = node.textContent.substring(pos - limit / 2, pos + limit / 2);\n            excerpt = \"...\" + excerpt + \"...\";\n          } // Add the CFI to the matches list\n\n\n          matches.push({\n            cfi: cfi,\n            excerpt: excerpt\n          });\n        }\n\n        last = pos;\n      }\n    };\n\n    (0, _core.sprint)(section.document, function (node) {\n      find(node);\n    });\n    return matches;\n  }\n\n  /**\n   * Search a string in multiple sequential Element of the section. If the document.createTreeWalker api is missed(eg: IE8), use `find` as a fallback.\n   * @param  {string} _query The query string to search\n   * @param  {int} maxSeqEle The maximum number of Element that are combined for search, defualt value is 5.\n   * @return {object[]} A list of matches, with form {cfi, excerpt}\n   */\n  search(_query, maxSeqEle = 5) {\n    if (typeof document.createTreeWalker == \"undefined\") {\n      return this.find(_query);\n    }\n\n    let matches = [];\n    const excerptLimit = 150;\n    const section = this;\n\n    const query = _query.toLowerCase();\n\n    const search = function (nodeList) {\n      const textWithCase = nodeList.reduce((acc, current) => {\n        return acc + current.textContent;\n      }, \"\");\n      const text = textWithCase.toLowerCase();\n      const pos = text.indexOf(query);\n\n      if (pos != -1) {\n        const startNodeIndex = 0,\n              endPos = pos + query.length;\n        let endNodeIndex = 0,\n            l = 0;\n\n        if (pos < nodeList[startNodeIndex].length) {\n          let cfi;\n\n          while (endNodeIndex < nodeList.length - 1) {\n            l += nodeList[endNodeIndex].length;\n\n            if (endPos <= l) {\n              break;\n            }\n\n            endNodeIndex += 1;\n          }\n\n          let startNode = nodeList[startNodeIndex],\n              endNode = nodeList[endNodeIndex];\n          let range = section.document.createRange();\n          range.setStart(startNode, pos);\n          let beforeEndLengthCount = nodeList.slice(0, endNodeIndex).reduce((acc, current) => {\n            return acc + current.textContent.length;\n          }, 0);\n          range.setEnd(endNode, beforeEndLengthCount > endPos ? endPos : endPos - beforeEndLengthCount);\n          cfi = section.cfiFromRange(range);\n          let excerpt = nodeList.slice(0, endNodeIndex + 1).reduce((acc, current) => {\n            return acc + current.textContent;\n          }, \"\");\n\n          if (excerpt.length > excerptLimit) {\n            excerpt = excerpt.substring(pos - excerptLimit / 2, pos + excerptLimit / 2);\n            excerpt = \"...\" + excerpt + \"...\";\n          }\n\n          matches.push({\n            cfi: cfi,\n            excerpt: excerpt\n          });\n        }\n      }\n    };\n\n    const treeWalker = document.createTreeWalker(section.document, NodeFilter.SHOW_TEXT, null, false);\n    let node,\n        nodeList = [];\n\n    while (node = treeWalker.nextNode()) {\n      nodeList.push(node);\n\n      if (nodeList.length == maxSeqEle) {\n        search(nodeList.slice(0, maxSeqEle));\n        nodeList = nodeList.slice(1, maxSeqEle);\n      }\n    }\n\n    if (nodeList.length > 0) {\n      search(nodeList);\n    }\n\n    return matches;\n  }\n  /**\n  * Reconciles the current chapters layout properies with\n  * the global layout properities.\n  * @param {object} globalLayout  The global layout settings object, chapter properties string\n  * @return {object} layoutProperties Object with layout properties\n  */\n\n\n  reconcileLayoutSettings(globalLayout) {\n    //-- Get the global defaults\n    var settings = {\n      layout: globalLayout.layout,\n      spread: globalLayout.spread,\n      orientation: globalLayout.orientation\n    }; //-- Get the chapter's display type\n\n    this.properties.forEach(function (prop) {\n      var rendition = prop.replace(\"rendition:\", \"\");\n      var split = rendition.indexOf(\"-\");\n      var property, value;\n\n      if (split != -1) {\n        property = rendition.slice(0, split);\n        value = rendition.slice(split + 1);\n        settings[property] = value;\n      }\n    });\n    return settings;\n  }\n  /**\n   * Get a CFI from a Range in the Section\n   * @param  {range} _range\n   * @return {string} cfi an EpubCFI string\n   */\n\n\n  cfiFromRange(_range) {\n    return new _epubcfi.default(_range, this.cfiBase).toString();\n  }\n  /**\n   * Get a CFI from an Element in the Section\n   * @param  {element} el\n   * @return {string} cfi an EpubCFI string\n   */\n\n\n  cfiFromElement(el) {\n    return new _epubcfi.default(el, this.cfiBase).toString();\n  }\n  /**\n   * Unload the section document\n   */\n\n\n  unload() {\n    this.document = undefined;\n    this.contents = undefined;\n    this.output = undefined;\n  }\n\n  destroy() {\n    this.unload();\n    this.hooks.serialize.clear();\n    this.hooks.content.clear();\n    this.hooks = undefined;\n    this.idref = undefined;\n    this.linear = undefined;\n    this.properties = undefined;\n    this.index = undefined;\n    this.href = undefined;\n    this.url = undefined;\n    this.next = undefined;\n    this.prev = undefined;\n    this.cfiBase = undefined;\n  }\n\n}\n\nvar _default = Section;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\nvar _queue = _interopRequireDefault(require(\"./utils/queue\"));\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _constants = require(\"./utils/constants\");\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Find Locations for a Book\n * @param {Spine} spine\n * @param {request} request\n * @param {number} [pause=100]\n */\nclass Locations {\n  constructor(spine, request, pause) {\n    this.spine = spine;\n    this.request = request;\n    this.pause = pause || 100;\n    this.q = new _queue.default(this);\n    this.epubcfi = new _epubcfi.default();\n    this._locations = [];\n    this._locationsWords = [];\n    this.total = 0;\n    this.break = 150;\n    this._current = 0;\n    this._wordCounter = 0;\n    this.currentLocation = '';\n    this._currentCfi = '';\n    this.processingTimeout = undefined;\n  }\n  /**\n   * Load all of sections in the book to generate locations\n   * @param  {int} chars how many chars to split on\n   * @return {object} locations\n   */\n\n\n  generate(chars) {\n    if (chars) {\n      this.break = chars;\n    }\n\n    this.q.pause();\n    this.spine.each(function (section) {\n      if (section.linear) {\n        this.q.enqueue(this.process.bind(this), section);\n      }\n    }.bind(this));\n    return this.q.run().then(function () {\n      this.total = this._locations.length - 1;\n\n      if (this._currentCfi) {\n        this.currentLocation = this._currentCfi;\n      }\n\n      return this._locations; // console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\n    }.bind(this));\n  }\n\n  createRange() {\n    return {\n      startContainer: undefined,\n      startOffset: undefined,\n      endContainer: undefined,\n      endOffset: undefined\n    };\n  }\n\n  process(section) {\n    return section.load(this.request).then(function (contents) {\n      var completed = new _core.defer();\n      var locations = this.parse(contents, section.cfiBase);\n      this._locations = this._locations.concat(locations);\n      section.unload();\n      this.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\n      return completed.promise;\n    }.bind(this));\n  }\n\n  parse(contents, cfiBase, chars) {\n    var locations = [];\n    var range;\n    var doc = contents.ownerDocument;\n    var body = (0, _core.qs)(doc, \"body\");\n    var counter = 0;\n    var prev;\n\n    var _break = chars || this.break;\n\n    var parser = function (node) {\n      var len = node.length;\n      var dist;\n      var pos = 0;\n\n      if (node.textContent.trim().length === 0) {\n        return false; // continue\n      } // Start range\n\n\n      if (counter == 0) {\n        range = this.createRange();\n        range.startContainer = node;\n        range.startOffset = 0;\n      }\n\n      dist = _break - counter; // Node is smaller than a break,\n      // skip over it\n\n      if (dist > len) {\n        counter += len;\n        pos = len;\n      }\n\n      while (pos < len) {\n        dist = _break - counter;\n\n        if (counter === 0) {\n          // Start new range\n          pos += 1;\n          range = this.createRange();\n          range.startContainer = node;\n          range.startOffset = pos;\n        } // pos += dist;\n        // Gone over\n\n\n        if (pos + dist >= len) {\n          // Continue counter for next node\n          counter += len - pos; // break\n\n          pos = len; // At End\n        } else {\n          // Advance pos\n          pos += dist; // End the previous range\n\n          range.endContainer = node;\n          range.endOffset = pos; // cfi = section.cfiFromRange(range);\n\n          let cfi = new _epubcfi.default(range, cfiBase).toString();\n          locations.push(cfi);\n          counter = 0;\n        }\n      }\n\n      prev = node;\n    };\n\n    (0, _core.sprint)(body, parser.bind(this)); // Close remaining\n\n    if (range && range.startContainer && prev) {\n      range.endContainer = prev;\n      range.endOffset = prev.length;\n      let cfi = new _epubcfi.default(range, cfiBase).toString();\n      locations.push(cfi);\n      counter = 0;\n    }\n\n    return locations;\n  }\n  /**\n   * Load all of sections in the book to generate locations\n   * @param  {string} startCfi start position\n   * @param  {int} wordCount how many words to split on\n   * @param  {int} count result count\n   * @return {object} locations\n   */\n\n\n  generateFromWords(startCfi, wordCount, count) {\n    var start = startCfi ? new _epubcfi.default(startCfi) : undefined;\n    this.q.pause();\n    this._locationsWords = [];\n    this._wordCounter = 0;\n    this.spine.each(function (section) {\n      if (section.linear) {\n        if (start) {\n          if (section.index >= start.spinePos) {\n            this.q.enqueue(this.processWords.bind(this), section, wordCount, start, count);\n          }\n        } else {\n          this.q.enqueue(this.processWords.bind(this), section, wordCount, start, count);\n        }\n      }\n    }.bind(this));\n    return this.q.run().then(function () {\n      if (this._currentCfi) {\n        this.currentLocation = this._currentCfi;\n      }\n\n      return this._locationsWords;\n    }.bind(this));\n  }\n\n  processWords(section, wordCount, startCfi, count) {\n    if (count && this._locationsWords.length >= count) {\n      return Promise.resolve();\n    }\n\n    return section.load(this.request).then(function (contents) {\n      var completed = new _core.defer();\n      var locations = this.parseWords(contents, section, wordCount, startCfi);\n      var remainingCount = count - this._locationsWords.length;\n      this._locationsWords = this._locationsWords.concat(locations.length >= count ? locations.slice(0, remainingCount) : locations);\n      section.unload();\n      this.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\n      return completed.promise;\n    }.bind(this));\n  } //http://stackoverflow.com/questions/18679576/counting-words-in-string\n\n\n  countWords(s) {\n    s = s.replace(/(^\\s*)|(\\s*$)/gi, \"\"); //exclude  start and end white-space\n\n    s = s.replace(/[ ]{2,}/gi, \" \"); //2 or more space to 1\n\n    s = s.replace(/\\n /, \"\\n\"); // exclude newline with a start spacing\n\n    return s.split(\" \").length;\n  }\n\n  parseWords(contents, section, wordCount, startCfi) {\n    var cfiBase = section.cfiBase;\n    var locations = [];\n    var doc = contents.ownerDocument;\n    var body = (0, _core.qs)(doc, \"body\");\n    var prev;\n    var _break = wordCount;\n    var foundStartNode = startCfi ? startCfi.spinePos !== section.index : true;\n    var startNode;\n\n    if (startCfi && section.index === startCfi.spinePos) {\n      startNode = startCfi.findNode(startCfi.range ? startCfi.path.steps.concat(startCfi.start.steps) : startCfi.path.steps, contents.ownerDocument);\n    }\n\n    var parser = function (node) {\n      if (!foundStartNode) {\n        if (node === startNode) {\n          foundStartNode = true;\n        } else {\n          return false;\n        }\n      }\n\n      if (node.textContent.length < 10) {\n        if (node.textContent.trim().length === 0) {\n          return false;\n        }\n      }\n\n      var len = this.countWords(node.textContent);\n      var dist;\n      var pos = 0;\n\n      if (len === 0) {\n        return false; // continue\n      }\n\n      dist = _break - this._wordCounter; // Node is smaller than a break,\n      // skip over it\n\n      if (dist > len) {\n        this._wordCounter += len;\n        pos = len;\n      }\n\n      while (pos < len) {\n        dist = _break - this._wordCounter; // Gone over\n\n        if (pos + dist >= len) {\n          // Continue counter for next node\n          this._wordCounter += len - pos; // break\n\n          pos = len; // At End\n        } else {\n          // Advance pos\n          pos += dist;\n          let cfi = new _epubcfi.default(node, cfiBase);\n          locations.push({\n            cfi: cfi.toString(),\n            wordCount: this._wordCounter\n          });\n          this._wordCounter = 0;\n        }\n      }\n\n      prev = node;\n    };\n\n    (0, _core.sprint)(body, parser.bind(this));\n    return locations;\n  }\n  /**\n   * Get a location from an EpubCFI\n   * @param {EpubCFI} cfi\n   * @return {number}\n   */\n\n\n  locationFromCfi(cfi) {\n    let loc;\n\n    if (_epubcfi.default.prototype.isCfiString(cfi)) {\n      cfi = new _epubcfi.default(cfi);\n    } // Check if the location has not been set yet\n\n\n    if (this._locations.length === 0) {\n      return -1;\n    }\n\n    loc = (0, _core.locationOf)(cfi, this._locations, this.epubcfi.compare);\n\n    if (loc > this.total) {\n      return this.total;\n    }\n\n    return loc;\n  }\n  /**\n   * Get a percentage position in locations from an EpubCFI\n   * @param {EpubCFI} cfi\n   * @return {number}\n   */\n\n\n  percentageFromCfi(cfi) {\n    if (this._locations.length === 0) {\n      return null;\n    } // Find closest cfi\n\n\n    var loc = this.locationFromCfi(cfi); // Get percentage in total\n\n    return this.percentageFromLocation(loc);\n  }\n  /**\n   * Get a percentage position from a location index\n   * @param {number} location\n   * @return {number}\n   */\n\n\n  percentageFromLocation(loc) {\n    if (!loc || !this.total) {\n      return 0;\n    }\n\n    return loc / this.total;\n  }\n  /**\n   * Get an EpubCFI from location index\n   * @param {number} loc\n   * @return {EpubCFI} cfi\n   */\n\n\n  cfiFromLocation(loc) {\n    var cfi = -1; // check that pg is an int\n\n    if (typeof loc != \"number\") {\n      loc = parseInt(loc);\n    }\n\n    if (loc >= 0 && loc < this._locations.length) {\n      cfi = this._locations[loc];\n    }\n\n    return cfi;\n  }\n  /**\n   * Get an EpubCFI from location percentage\n   * @param {number} percentage\n   * @return {EpubCFI} cfi\n   */\n\n\n  cfiFromPercentage(percentage) {\n    let loc;\n\n    if (percentage > 1) {\n      console.warn(\"Normalize cfiFromPercentage value to between 0 - 1\");\n    } // Make sure 1 goes to very end\n\n\n    if (percentage >= 1) {\n      let cfi = new _epubcfi.default(this._locations[this.total]);\n      cfi.collapse();\n      return cfi.toString();\n    }\n\n    loc = Math.ceil(this.total * percentage);\n    return this.cfiFromLocation(loc);\n  }\n  /**\n   * Load locations from JSON\n   * @param {json} locations\n   */\n\n\n  load(locations) {\n    if (typeof locations === \"string\") {\n      this._locations = JSON.parse(locations);\n    } else {\n      this._locations = locations;\n    }\n\n    this.total = this._locations.length - 1;\n    return this._locations;\n  }\n  /**\n   * Save locations to JSON\n   * @return {json}\n   */\n\n\n  save() {\n    return JSON.stringify(this._locations);\n  }\n\n  getCurrent() {\n    return this._current;\n  }\n\n  setCurrent(curr) {\n    var loc;\n\n    if (typeof curr == \"string\") {\n      this._currentCfi = curr;\n    } else if (typeof curr == \"number\") {\n      this._current = curr;\n    } else {\n      return;\n    }\n\n    if (this._locations.length === 0) {\n      return;\n    }\n\n    if (typeof curr == \"string\") {\n      loc = this.locationFromCfi(curr);\n      this._current = loc;\n    } else {\n      loc = curr;\n    }\n\n    this.emit(_constants.EVENTS.LOCATIONS.CHANGED, {\n      percentage: this.percentageFromLocation(loc)\n    });\n  }\n  /**\n   * Get the current location\n   */\n\n\n  get currentLocation() {\n    return this._current;\n  }\n  /**\n   * Set the current location\n   */\n\n\n  set currentLocation(curr) {\n    this.setCurrent(curr);\n  }\n  /**\n   * Locations length\n   */\n\n\n  length() {\n    return this._locations.length;\n  }\n\n  destroy() {\n    this.spine = undefined;\n    this.request = undefined;\n    this.pause = undefined;\n    this.q.stop();\n    this.q = undefined;\n    this.epubcfi = undefined;\n    this._locations = undefined;\n    this.total = undefined;\n    this.break = undefined;\n    this._current = undefined;\n    this.currentLocation = undefined;\n    this._currentCfi = undefined;\n    clearTimeout(this.processingTimeout);\n  }\n\n}\n\n(0, _eventEmitter.default)(Locations.prototype);\nvar _default = Locations;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _pathWebpack = _interopRequireDefault(require(\"path-webpack\"));\n\nvar _core = require(\"./utils/core\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Handles Parsing and Accessing an Epub Container\n * @class\n * @param {document} [containerDocument] xml document\n */\nclass Container {\n  constructor(containerDocument) {\n    this.packagePath = '';\n    this.directory = '';\n    this.encoding = '';\n\n    if (containerDocument) {\n      this.parse(containerDocument);\n    }\n  }\n  /**\n   * Parse the Container XML\n   * @param  {document} containerDocument\n   */\n\n\n  parse(containerDocument) {\n    //-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\n    var rootfile;\n\n    if (!containerDocument) {\n      throw new Error(\"Container File Not Found\");\n    }\n\n    rootfile = (0, _core.qs)(containerDocument, \"rootfile\");\n\n    if (!rootfile) {\n      throw new Error(\"No RootFile Found\");\n    }\n\n    this.packagePath = rootfile.getAttribute(\"full-path\");\n    this.directory = _pathWebpack.default.dirname(this.packagePath);\n    this.encoding = containerDocument.xmlEncoding;\n  }\n\n  destroy() {\n    this.packagePath = undefined;\n    this.directory = undefined;\n    this.encoding = undefined;\n  }\n\n}\n\nvar _default = Container;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\n/**\n * Open Packaging Format Parser\n * @class\n * @param {document} packageDocument OPF XML\n */\nclass Packaging {\n  constructor(packageDocument) {\n    this.manifest = {};\n    this.navPath = '';\n    this.ncxPath = '';\n    this.coverPath = '';\n    this.spineNodeIndex = 0;\n    this.spine = [];\n    this.metadata = {};\n\n    if (packageDocument) {\n      this.parse(packageDocument);\n    }\n  }\n  /**\n   * Parse OPF XML\n   * @param  {document} packageDocument OPF XML\n   * @return {object} parsed package parts\n   */\n\n\n  parse(packageDocument) {\n    var metadataNode, manifestNode, spineNode;\n\n    if (!packageDocument) {\n      throw new Error(\"Package File Not Found\");\n    }\n\n    metadataNode = (0, _core.qs)(packageDocument, \"metadata\");\n\n    if (!metadataNode) {\n      throw new Error(\"No Metadata Found\");\n    }\n\n    manifestNode = (0, _core.qs)(packageDocument, \"manifest\");\n\n    if (!manifestNode) {\n      throw new Error(\"No Manifest Found\");\n    }\n\n    spineNode = (0, _core.qs)(packageDocument, \"spine\");\n\n    if (!spineNode) {\n      throw new Error(\"No Spine Found\");\n    }\n\n    this.manifest = this.parseManifest(manifestNode);\n    this.navPath = this.findNavPath(manifestNode);\n    this.ncxPath = this.findNcxPath(manifestNode, spineNode);\n    this.coverPath = this.findCoverPath(packageDocument);\n    this.spineNodeIndex = (0, _core.indexOfElementNode)(spineNode);\n    this.spine = this.parseSpine(spineNode, this.manifest);\n    this.uniqueIdentifier = this.findUniqueIdentifier(packageDocument);\n    this.metadata = this.parseMetadata(metadataNode);\n    this.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\n    return {\n      \"metadata\": this.metadata,\n      \"spine\": this.spine,\n      \"manifest\": this.manifest,\n      \"navPath\": this.navPath,\n      \"ncxPath\": this.ncxPath,\n      \"coverPath\": this.coverPath,\n      \"spineNodeIndex\": this.spineNodeIndex\n    };\n  }\n  /**\n   * Parse Metadata\n   * @private\n   * @param  {node} xml\n   * @return {object} metadata\n   */\n\n\n  parseMetadata(xml) {\n    var metadata = {};\n    metadata.title = this.getElementText(xml, \"title\");\n    metadata.creator = this.getElementText(xml, \"creator\");\n    metadata.description = this.getElementText(xml, \"description\");\n    metadata.pubdate = this.getElementText(xml, \"date\");\n    metadata.publisher = this.getElementText(xml, \"publisher\");\n    metadata.identifier = this.getElementText(xml, \"identifier\");\n    metadata.language = this.getElementText(xml, \"language\");\n    metadata.rights = this.getElementText(xml, \"rights\");\n    metadata.modified_date = this.getPropertyText(xml, \"dcterms:modified\");\n    metadata.layout = this.getPropertyText(xml, \"rendition:layout\");\n    metadata.orientation = this.getPropertyText(xml, \"rendition:orientation\");\n    metadata.flow = this.getPropertyText(xml, \"rendition:flow\");\n    metadata.viewport = this.getPropertyText(xml, \"rendition:viewport\");\n    metadata.media_active_class = this.getPropertyText(xml, \"media:active-class\");\n    metadata.spread = this.getPropertyText(xml, \"rendition:spread\"); // metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\n\n    return metadata;\n  }\n  /**\n   * Parse Manifest\n   * @private\n   * @param  {node} manifestXml\n   * @return {object} manifest\n   */\n\n\n  parseManifest(manifestXml) {\n    var manifest = {}; //-- Turn items into an array\n    // var selected = manifestXml.querySelectorAll(\"item\");\n\n    var selected = (0, _core.qsa)(manifestXml, \"item\");\n    var items = Array.prototype.slice.call(selected); //-- Create an object with the id as key\n\n    items.forEach(function (item) {\n      var id = item.getAttribute(\"id\"),\n          href = item.getAttribute(\"href\") || \"\",\n          type = item.getAttribute(\"media-type\") || \"\",\n          overlay = item.getAttribute(\"media-overlay\") || \"\",\n          properties = item.getAttribute(\"properties\") || \"\";\n      manifest[id] = {\n        \"href\": href,\n        // \"url\" : href,\n        \"type\": type,\n        \"overlay\": overlay,\n        \"properties\": properties.length ? properties.split(\" \") : []\n      };\n    });\n    return manifest;\n  }\n  /**\n   * Parse Spine\n   * @private\n   * @param  {node} spineXml\n   * @param  {Packaging.manifest} manifest\n   * @return {object} spine\n   */\n\n\n  parseSpine(spineXml, manifest) {\n    var spine = [];\n    var selected = (0, _core.qsa)(spineXml, \"itemref\");\n    var items = Array.prototype.slice.call(selected); // var epubcfi = new EpubCFI();\n    //-- Add to array to mantain ordering and cross reference with manifest\n\n    items.forEach(function (item, index) {\n      var idref = item.getAttribute(\"idref\"); // var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\n\n      var props = item.getAttribute(\"properties\") || \"\";\n      var propArray = props.length ? props.split(\" \") : []; // var manifestProps = manifest[Id].properties;\n      // var manifestPropArray = manifestProps.length ? manifestProps.split(\" \") : [];\n\n      var itemref = {\n        \"idref\": idref,\n        \"linear\": item.getAttribute(\"linear\") || \"yes\",\n        \"properties\": propArray,\n        // \"href\" : manifest[Id].href,\n        // \"url\" :  manifest[Id].url,\n        \"index\": index // \"cfiBase\" : cfiBase\n\n      };\n      spine.push(itemref);\n    });\n    return spine;\n  }\n  /**\n   * Find Unique Identifier\n   * @private\n   * @param  {node} packageXml\n   * @return {string} Unique Identifier text\n   */\n\n\n  findUniqueIdentifier(packageXml) {\n    var uniqueIdentifierId = packageXml.documentElement.getAttribute(\"unique-identifier\");\n\n    if (!uniqueIdentifierId) {\n      return \"\";\n    }\n\n    var identifier = packageXml.getElementById(uniqueIdentifierId);\n\n    if (!identifier) {\n      return \"\";\n    }\n\n    if (identifier.localName === \"identifier\" && identifier.namespaceURI === \"http://purl.org/dc/elements/1.1/\") {\n      return identifier.childNodes.length > 0 ? identifier.childNodes[0].nodeValue.trim() : \"\";\n    }\n\n    return \"\";\n  }\n  /**\n   * Find TOC NAV\n   * @private\n   * @param {element} manifestNode\n   * @return {string}\n   */\n\n\n  findNavPath(manifestNode) {\n    // Find item with property \"nav\"\n    // Should catch nav irregardless of order\n    // var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\n    var node = (0, _core.qsp)(manifestNode, \"item\", {\n      \"properties\": \"nav\"\n    });\n    return node ? node.getAttribute(\"href\") : false;\n  }\n  /**\n   * Find TOC NCX\n   * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\n   * @private\n   * @param {element} manifestNode\n   * @param {element} spineNode\n   * @return {string}\n   */\n\n\n  findNcxPath(manifestNode, spineNode) {\n    // var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\n    var node = (0, _core.qsp)(manifestNode, \"item\", {\n      \"media-type\": \"application/x-dtbncx+xml\"\n    });\n    var tocId; // If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\n    // according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\n    // \"The item that describes the NCX must be referenced by the spine toc attribute.\"\n\n    if (!node) {\n      tocId = spineNode.getAttribute(\"toc\");\n\n      if (tocId) {\n        // node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\n        node = manifestNode.querySelector(`#${tocId}`);\n      }\n    }\n\n    return node ? node.getAttribute(\"href\") : false;\n  }\n  /**\n   * Find the Cover Path\n   * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\n   * Fallback for Epub 2.0\n   * @private\n   * @param  {node} packageXml\n   * @return {string} href\n   */\n\n\n  findCoverPath(packageXml) {\n    var pkg = (0, _core.qs)(packageXml, \"package\");\n    var epubVersion = pkg.getAttribute(\"version\"); // Try parsing cover with epub 3.\n    // var node = packageXml.querySelector(\"item[properties='cover-image']\");\n\n    var node = (0, _core.qsp)(packageXml, \"item\", {\n      \"properties\": \"cover-image\"\n    });\n    if (node) return node.getAttribute(\"href\"); // Fallback to epub 2.\n\n    var metaCover = (0, _core.qsp)(packageXml, \"meta\", {\n      \"name\": \"cover\"\n    });\n\n    if (metaCover) {\n      var coverId = metaCover.getAttribute(\"content\"); // var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\n\n      var cover = packageXml.getElementById(coverId);\n      return cover ? cover.getAttribute(\"href\") : \"\";\n    } else {\n      return false;\n    }\n  }\n  /**\n   * Get text of a namespaced element\n   * @private\n   * @param  {node} xml\n   * @param  {string} tag\n   * @return {string} text\n   */\n\n\n  getElementText(xml, tag) {\n    var found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag);\n    var el;\n    if (!found || found.length === 0) return \"\";\n    el = found[0];\n\n    if (el.childNodes.length) {\n      return el.childNodes[0].nodeValue;\n    }\n\n    return \"\";\n  }\n  /**\n   * Get text by property\n   * @private\n   * @param  {node} xml\n   * @param  {string} property\n   * @return {string} text\n   */\n\n\n  getPropertyText(xml, property) {\n    var el = (0, _core.qsp)(xml, \"meta\", {\n      \"property\": property\n    });\n\n    if (el && el.childNodes.length) {\n      return el.childNodes[0].nodeValue;\n    }\n\n    return \"\";\n  }\n  /**\n   * Load JSON Manifest\n   * @param  {document} packageDocument OPF XML\n   * @return {object} parsed package parts\n   */\n\n\n  load(json) {\n    this.metadata = json.metadata;\n    let spine = json.readingOrder || json.spine;\n    this.spine = spine.map((item, index) => {\n      item.index = index;\n      item.linear = item.linear || \"yes\";\n      return item;\n    });\n    json.resources.forEach((item, index) => {\n      this.manifest[index] = item;\n\n      if (item.rel && item.rel[0] === \"cover\") {\n        this.coverPath = item.href;\n      }\n    });\n    this.spineNodeIndex = 0;\n    this.toc = json.toc.map((item, index) => {\n      item.label = item.title;\n      return item;\n    });\n    return {\n      \"metadata\": this.metadata,\n      \"spine\": this.spine,\n      \"manifest\": this.manifest,\n      \"navPath\": this.navPath,\n      \"ncxPath\": this.ncxPath,\n      \"coverPath\": this.coverPath,\n      \"spineNodeIndex\": this.spineNodeIndex,\n      \"toc\": this.toc\n    };\n  }\n\n  destroy() {\n    this.manifest = undefined;\n    this.navPath = undefined;\n    this.ncxPath = undefined;\n    this.coverPath = undefined;\n    this.spineNodeIndex = undefined;\n    this.spine = undefined;\n    this.metadata = undefined;\n  }\n\n}\n\nvar _default = Packaging;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\n/**\n * Navigation Parser\n * @param {document} xml navigation html / xhtml / ncx\n */\nclass Navigation {\n  constructor(xml) {\n    this.toc = [];\n    this.tocByHref = {};\n    this.tocById = {};\n    this.landmarks = [];\n    this.landmarksByType = {};\n    this.length = 0;\n\n    if (xml) {\n      this.parse(xml);\n    }\n  }\n  /**\n   * Parse out the navigation items\n   * @param {document} xml navigation html / xhtml / ncx\n   */\n\n\n  parse(xml) {\n    let isXml = xml.nodeType;\n    let html;\n    let ncx;\n\n    if (isXml) {\n      html = (0, _core.qs)(xml, \"html\");\n      ncx = (0, _core.qs)(xml, \"ncx\");\n    }\n\n    if (!isXml) {\n      this.toc = this.load(xml);\n    } else if (html) {\n      this.toc = this.parseNav(xml);\n      this.landmarks = this.parseLandmarks(xml);\n    } else if (ncx) {\n      this.toc = this.parseNcx(xml);\n    }\n\n    this.length = 0;\n    this.unpack(this.toc);\n  }\n  /**\n   * Unpack navigation items\n   * @private\n   * @param  {array} toc\n   */\n\n\n  unpack(toc) {\n    var item;\n\n    for (var i = 0; i < toc.length; i++) {\n      item = toc[i];\n\n      if (item.href) {\n        this.tocByHref[item.href] = i;\n      }\n\n      if (item.id) {\n        this.tocById[item.id] = i;\n      }\n\n      this.length++;\n\n      if (item.subitems.length) {\n        this.unpack(item.subitems);\n      }\n    }\n  }\n  /**\n   * Get an item from the navigation\n   * @param  {string} target\n   * @return {object} navItem\n   */\n\n\n  get(target) {\n    var index;\n\n    if (!target) {\n      return this.toc;\n    }\n\n    if (target.indexOf(\"#\") === 0) {\n      index = this.tocById[target.substring(1)];\n    } else if (target in this.tocByHref) {\n      index = this.tocByHref[target];\n    }\n\n    return this.getByIndex(target, index, this.toc);\n  }\n  /**\n   * Get an item from navigation subitems recursively by index\n   * @param  {string} target\n   * @param  {number} index\n   * @param  {array} navItems\n   * @return {object} navItem\n   */\n\n\n  getByIndex(target, index, navItems) {\n    if (navItems.length === 0) {\n      return;\n    }\n\n    const item = navItems[index];\n\n    if (item && (target === item.id || target === item.href)) {\n      return item;\n    } else {\n      let result;\n\n      for (let i = 0; i < navItems.length; ++i) {\n        result = this.getByIndex(target, index, navItems[i].subitems);\n\n        if (result) {\n          break;\n        }\n      }\n\n      return result;\n    }\n  }\n  /**\n   * Get a landmark by type\n   * List of types: https://idpf.github.io/epub-vocabs/structure/\n   * @param  {string} type\n   * @return {object} landmarkItem\n   */\n\n\n  landmark(type) {\n    var index;\n\n    if (!type) {\n      return this.landmarks;\n    }\n\n    index = this.landmarksByType[type];\n    return this.landmarks[index];\n  }\n  /**\n   * Parse toc from a Epub > 3.0 Nav\n   * @private\n   * @param  {document} navHtml\n   * @return {array} navigation list\n   */\n\n\n  parseNav(navHtml) {\n    var navElement = (0, _core.querySelectorByType)(navHtml, \"nav\", \"toc\");\n    var list = [];\n    if (!navElement) return list;\n    let navList = (0, _core.filterChildren)(navElement, \"ol\", true);\n    if (!navList) return list;\n    list = this.parseNavList(navList);\n    return list;\n  }\n  /**\n   * Parses lists in the toc\n   * @param  {document} navListHtml\n   * @param  {string} parent id\n   * @return {array} navigation list\n   */\n\n\n  parseNavList(navListHtml, parent) {\n    const result = [];\n    if (!navListHtml) return result;\n    if (!navListHtml.children) return result;\n\n    for (let i = 0; i < navListHtml.children.length; i++) {\n      const item = this.navItem(navListHtml.children[i], parent);\n\n      if (item) {\n        result.push(item);\n      }\n    }\n\n    return result;\n  }\n  /**\n   * Create a navItem\n   * @private\n   * @param  {element} item\n   * @return {object} navItem\n   */\n\n\n  navItem(item, parent) {\n    let id = item.getAttribute(\"id\") || undefined;\n    let content = (0, _core.filterChildren)(item, \"a\", true);\n\n    if (!content) {\n      return;\n    }\n\n    let src = content.getAttribute(\"href\") || \"\";\n\n    if (!id) {\n      id = src;\n    }\n\n    let text = content.textContent || \"\";\n    let subitems = [];\n    let nested = (0, _core.filterChildren)(item, \"ol\", true);\n\n    if (nested) {\n      subitems = this.parseNavList(nested, id);\n    }\n\n    return {\n      \"id\": id,\n      \"href\": src,\n      \"label\": text,\n      \"subitems\": subitems,\n      \"parent\": parent\n    };\n  }\n  /**\n   * Parse landmarks from a Epub > 3.0 Nav\n   * @private\n   * @param  {document} navHtml\n   * @return {array} landmarks list\n   */\n\n\n  parseLandmarks(navHtml) {\n    var navElement = (0, _core.querySelectorByType)(navHtml, \"nav\", \"landmarks\");\n    var navItems = navElement ? (0, _core.qsa)(navElement, \"li\") : [];\n    var length = navItems.length;\n    var i;\n    var list = [];\n    var item;\n    if (!navItems || length === 0) return list;\n\n    for (i = 0; i < length; ++i) {\n      item = this.landmarkItem(navItems[i]);\n\n      if (item) {\n        list.push(item);\n        this.landmarksByType[item.type] = i;\n      }\n    }\n\n    return list;\n  }\n  /**\n   * Create a landmarkItem\n   * @private\n   * @param  {element} item\n   * @return {object} landmarkItem\n   */\n\n\n  landmarkItem(item) {\n    let content = (0, _core.filterChildren)(item, \"a\", true);\n\n    if (!content) {\n      return;\n    }\n\n    let type = content.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") || undefined;\n    let href = content.getAttribute(\"href\") || \"\";\n    let text = content.textContent || \"\";\n    return {\n      \"href\": href,\n      \"label\": text,\n      \"type\": type\n    };\n  }\n  /**\n   * Parse from a Epub > 3.0 NC\n   * @private\n   * @param  {document} navHtml\n   * @return {array} navigation list\n   */\n\n\n  parseNcx(tocXml) {\n    var navPoints = (0, _core.qsa)(tocXml, \"navPoint\");\n    var length = navPoints.length;\n    var i;\n    var toc = {};\n    var list = [];\n    var item, parent;\n    if (!navPoints || length === 0) return list;\n\n    for (i = 0; i < length; ++i) {\n      item = this.ncxItem(navPoints[i]);\n      toc[item.id] = item;\n\n      if (!item.parent) {\n        list.push(item);\n      } else {\n        parent = toc[item.parent];\n        parent.subitems.push(item);\n      }\n    }\n\n    return list;\n  }\n  /**\n   * Create a ncxItem\n   * @private\n   * @param  {element} item\n   * @return {object} ncxItem\n   */\n\n\n  ncxItem(item) {\n    var id = item.getAttribute(\"id\") || false,\n        content = (0, _core.qs)(item, \"content\"),\n        src = content.getAttribute(\"src\"),\n        navLabel = (0, _core.qs)(item, \"navLabel\"),\n        text = navLabel.textContent ? navLabel.textContent : \"\",\n        subitems = [],\n        parentNode = item.parentNode,\n        parent;\n\n    if (parentNode && (parentNode.nodeName === \"navPoint\" || parentNode.nodeName.split(':').slice(-1)[0] === \"navPoint\")) {\n      parent = parentNode.getAttribute(\"id\");\n    }\n\n    return {\n      \"id\": id,\n      \"href\": src,\n      \"label\": text,\n      \"subitems\": subitems,\n      \"parent\": parent\n    };\n  }\n  /**\n   * Load Spine Items\n   * @param  {object} json the items to be loaded\n   * @return {Array} navItems\n   */\n\n\n  load(json) {\n    return json.map(item => {\n      item.label = item.title;\n      item.subitems = item.children ? this.load(item.children) : [];\n      return item;\n    });\n  }\n  /**\n   * forEach pass through\n   * @param  {Function} fn function to run on each item\n   * @return {method} forEach loop\n   */\n\n\n  forEach(fn) {\n    return this.toc.forEach(fn);\n  }\n\n}\n\nvar _default = Navigation;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _replacements = require(\"./utils/replacements\");\n\nvar _core = require(\"./utils/core\");\n\nvar _url = _interopRequireDefault(require(\"./utils/url\"));\n\nvar _mime = _interopRequireDefault(require(\"./utils/mime\"));\n\nvar _path = _interopRequireDefault(require(\"./utils/path\"));\n\nvar _pathWebpack = _interopRequireDefault(require(\"path-webpack\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Handle Package Resources\n * @class\n * @param {Manifest} manifest\n * @param {object} [options]\n * @param {string} [options.replacements=\"base64\"]\n * @param {Archive} [options.archive]\n * @param {method} [options.resolver]\n */\nclass Resources {\n  constructor(manifest, options) {\n    this.settings = {\n      replacements: options && options.replacements || \"base64\",\n      archive: options && options.archive,\n      resolver: options && options.resolver,\n      request: options && options.request\n    };\n    this.process(manifest);\n  }\n  /**\n   * Process resources\n   * @param {Manifest} manifest\n   */\n\n\n  process(manifest) {\n    this.manifest = manifest;\n    this.resources = Object.keys(manifest).map(function (key) {\n      return manifest[key];\n    });\n    this.replacementUrls = [];\n    this.html = [];\n    this.assets = [];\n    this.css = [];\n    this.urls = [];\n    this.cssUrls = [];\n    this.split();\n    this.splitUrls();\n  }\n  /**\n   * Split resources by type\n   * @private\n   */\n\n\n  split() {\n    // HTML\n    this.html = this.resources.filter(function (item) {\n      if (item.type === \"application/xhtml+xml\" || item.type === \"text/html\") {\n        return true;\n      }\n    }); // Exclude HTML\n\n    this.assets = this.resources.filter(function (item) {\n      if (item.type !== \"application/xhtml+xml\" && item.type !== \"text/html\") {\n        return true;\n      }\n    }); // Only CSS\n\n    this.css = this.resources.filter(function (item) {\n      if (item.type === \"text/css\") {\n        return true;\n      }\n    });\n  }\n  /**\n   * Convert split resources into Urls\n   * @private\n   */\n\n\n  splitUrls() {\n    // All Assets Urls\n    this.urls = this.assets.map(function (item) {\n      return item.href;\n    }.bind(this)); // Css Urls\n\n    this.cssUrls = this.css.map(function (item) {\n      return item.href;\n    });\n  }\n  /**\n   * Create a url to a resource\n   * @param {string} url\n   * @return {Promise<string>} Promise resolves with url string\n   */\n\n\n  createUrl(url) {\n    var parsedUrl = new _url.default(url);\n\n    var mimeType = _mime.default.lookup(parsedUrl.filename);\n\n    if (this.settings.archive) {\n      return this.settings.archive.createUrl(url, {\n        \"base64\": this.settings.replacements === \"base64\"\n      });\n    } else {\n      if (this.settings.replacements === \"base64\") {\n        return this.settings.request(url, 'blob').then(blob => {\n          return (0, _core.blob2base64)(blob);\n        }).then(blob => {\n          return (0, _core.createBase64Url)(blob, mimeType);\n        });\n      } else {\n        return this.settings.request(url, 'blob').then(blob => {\n          return (0, _core.createBlobUrl)(blob, mimeType);\n        });\n      }\n    }\n  }\n  /**\n   * Create blob urls for all the assets\n   * @return {Promise}         returns replacement urls\n   */\n\n\n  replacements() {\n    if (this.settings.replacements === \"none\") {\n      return new Promise(function (resolve) {\n        resolve(this.urls);\n      }.bind(this));\n    }\n\n    var replacements = this.urls.map(url => {\n      var absolute = this.settings.resolver(url);\n      return this.createUrl(absolute).catch(err => {\n        console.error(err);\n        return null;\n      });\n    });\n    return Promise.all(replacements).then(replacementUrls => {\n      this.replacementUrls = replacementUrls.filter(url => {\n        return typeof url === \"string\";\n      });\n      return replacementUrls;\n    });\n  }\n  /**\n   * Replace URLs in CSS resources\n   * @private\n   * @param  {Archive} [archive]\n   * @param  {method} [resolver]\n   * @return {Promise}\n   */\n\n\n  replaceCss(archive, resolver) {\n    var replaced = [];\n    archive = archive || this.settings.archive;\n    resolver = resolver || this.settings.resolver;\n    this.cssUrls.forEach(function (href) {\n      var replacement = this.createCssFile(href, archive, resolver).then(function (replacementUrl) {\n        // switch the url in the replacementUrls\n        var indexInUrls = this.urls.indexOf(href);\n\n        if (indexInUrls > -1) {\n          this.replacementUrls[indexInUrls] = replacementUrl;\n        }\n      }.bind(this));\n      replaced.push(replacement);\n    }.bind(this));\n    return Promise.all(replaced);\n  }\n  /**\n   * Create a new CSS file with the replaced URLs\n   * @private\n   * @param  {string} href the original css file\n   * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\n   */\n\n\n  createCssFile(href) {\n    var newUrl;\n\n    if (_pathWebpack.default.isAbsolute(href)) {\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n\n    var absolute = this.settings.resolver(href); // Get the text of the css file from the archive\n\n    var textResponse;\n\n    if (this.settings.archive) {\n      textResponse = this.settings.archive.getText(absolute);\n    } else {\n      textResponse = this.settings.request(absolute, \"text\");\n    } // Get asset links relative to css file\n\n\n    var relUrls = this.urls.map(assetHref => {\n      var resolved = this.settings.resolver(assetHref);\n      var relative = new _path.default(absolute).relative(resolved);\n      return relative;\n    });\n\n    if (!textResponse) {\n      // file not found, don't replace\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n\n    return textResponse.then(text => {\n      // Replacements in the css text\n      text = (0, _replacements.substitute)(text, relUrls, this.replacementUrls); // Get the new url\n\n      if (this.settings.replacements === \"base64\") {\n        newUrl = (0, _core.createBase64Url)(text, \"text/css\");\n      } else {\n        newUrl = (0, _core.createBlobUrl)(text, \"text/css\");\n      }\n\n      return newUrl;\n    }, err => {\n      // handle response errors\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    });\n  }\n  /**\n   * Resolve all resources URLs relative to an absolute URL\n   * @param  {string} absolute to be resolved to\n   * @param  {resolver} [resolver]\n   * @return {string[]} array with relative Urls\n   */\n\n\n  relativeTo(absolute, resolver) {\n    resolver = resolver || this.settings.resolver; // Get Urls relative to current sections\n\n    return this.urls.map(function (href) {\n      var resolved = resolver(href);\n      var relative = new _path.default(absolute).relative(resolved);\n      return relative;\n    }.bind(this));\n  }\n  /**\n   * Get a URL for a resource\n   * @param  {string} path\n   * @return {string} url\n   */\n\n\n  get(path) {\n    var indexInUrls = this.urls.indexOf(path);\n\n    if (indexInUrls === -1) {\n      return;\n    }\n\n    if (this.replacementUrls.length) {\n      return new Promise(function (resolve, reject) {\n        resolve(this.replacementUrls[indexInUrls]);\n      }.bind(this));\n    } else {\n      return this.createUrl(path);\n    }\n  }\n  /**\n   * Substitute urls in content, with replacements,\n   * relative to a url if provided\n   * @param  {string} content\n   * @param  {string} [url]   url to resolve to\n   * @return {string}         content with urls substituted\n   */\n\n\n  substitute(content, url) {\n    var relUrls;\n\n    if (url) {\n      relUrls = this.relativeTo(url);\n    } else {\n      relUrls = this.urls;\n    }\n\n    return (0, _replacements.substitute)(content, relUrls, this.replacementUrls);\n  }\n\n  destroy() {\n    this.settings = undefined;\n    this.manifest = undefined;\n    this.resources = undefined;\n    this.replacementUrls = undefined;\n    this.html = undefined;\n    this.assets = undefined;\n    this.css = undefined;\n    this.urls = undefined;\n    this.cssUrls = undefined;\n  }\n\n}\n\nvar _default = Resources;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _core = require(\"./utils/core\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Page List Parser\n * @param {document} [xml]\n */\nclass PageList {\n  constructor(xml) {\n    this.pages = [];\n    this.locations = [];\n    this.epubcfi = new _epubcfi.default();\n    this.firstPage = 0;\n    this.lastPage = 0;\n    this.totalPages = 0;\n    this.toc = undefined;\n    this.ncx = undefined;\n\n    if (xml) {\n      this.pageList = this.parse(xml);\n    }\n\n    if (this.pageList && this.pageList.length) {\n      this.process(this.pageList);\n    }\n  }\n  /**\n   * Parse PageList Xml\n   * @param  {document} xml\n   */\n\n\n  parse(xml) {\n    var html = (0, _core.qs)(xml, \"html\");\n    var ncx = (0, _core.qs)(xml, \"ncx\");\n\n    if (html) {\n      return this.parseNav(xml);\n    } else if (ncx) {\n      return this.parseNcx(xml);\n    }\n  }\n  /**\n   * Parse a Nav PageList\n   * @private\n   * @param  {node} navHtml\n   * @return {PageList.item[]} list\n   */\n\n\n  parseNav(navHtml) {\n    var navElement = (0, _core.querySelectorByType)(navHtml, \"nav\", \"page-list\");\n    var navItems = navElement ? (0, _core.qsa)(navElement, \"li\") : [];\n    var length = navItems.length;\n    var i;\n    var list = [];\n    var item;\n    if (!navItems || length === 0) return list;\n\n    for (i = 0; i < length; ++i) {\n      item = this.item(navItems[i]);\n      list.push(item);\n    }\n\n    return list;\n  }\n\n  parseNcx(navXml) {\n    var list = [];\n    var i = 0;\n    var item;\n    var pageList;\n    var pageTargets;\n    var length = 0;\n    pageList = (0, _core.qs)(navXml, \"pageList\");\n    if (!pageList) return list;\n    pageTargets = (0, _core.qsa)(pageList, \"pageTarget\");\n    length = pageTargets.length;\n\n    if (!pageTargets || pageTargets.length === 0) {\n      return list;\n    }\n\n    for (i = 0; i < length; ++i) {\n      item = this.ncxItem(pageTargets[i]);\n      list.push(item);\n    }\n\n    return list;\n  }\n\n  ncxItem(item) {\n    var navLabel = (0, _core.qs)(item, \"navLabel\");\n    var navLabelText = (0, _core.qs)(navLabel, \"text\");\n    var pageText = navLabelText.textContent;\n    var content = (0, _core.qs)(item, \"content\");\n    var href = content.getAttribute(\"src\");\n    var page = parseInt(pageText, 10);\n    return {\n      \"href\": href,\n      \"page\": page\n    };\n  }\n  /**\n   * Page List Item\n   * @private\n   * @param  {node} item\n   * @return {object} pageListItem\n   */\n\n\n  item(item) {\n    var content = (0, _core.qs)(item, \"a\"),\n        href = content.getAttribute(\"href\") || \"\",\n        text = content.textContent || \"\",\n        page = parseInt(text),\n        isCfi = href.indexOf(\"epubcfi\"),\n        split,\n        packageUrl,\n        cfi;\n\n    if (isCfi != -1) {\n      split = href.split(\"#\");\n      packageUrl = split[0];\n      cfi = split.length > 1 ? split[1] : false;\n      return {\n        \"cfi\": cfi,\n        \"href\": href,\n        \"packageUrl\": packageUrl,\n        \"page\": page\n      };\n    } else {\n      return {\n        \"href\": href,\n        \"page\": page\n      };\n    }\n  }\n  /**\n   * Process pageList items\n   * @private\n   * @param  {array} pageList\n   */\n\n\n  process(pageList) {\n    pageList.forEach(function (item) {\n      this.pages.push(item.page);\n\n      if (item.cfi) {\n        this.locations.push(item.cfi);\n      }\n    }, this);\n    this.firstPage = parseInt(this.pages[0]);\n    this.lastPage = parseInt(this.pages[this.pages.length - 1]);\n    this.totalPages = this.lastPage - this.firstPage;\n  }\n  /**\n   * Get a PageList result from a EpubCFI\n   * @param  {string} cfi EpubCFI String\n   * @return {number} page\n   */\n\n\n  pageFromCfi(cfi) {\n    var pg = -1; // Check if the pageList has not been set yet\n\n    if (this.locations.length === 0) {\n      return -1;\n    } // TODO: check if CFI is valid?\n    // check if the cfi is in the location list\n    // var index = this.locations.indexOf(cfi);\n\n\n    var index = (0, _core.indexOfSorted)(cfi, this.locations, this.epubcfi.compare);\n\n    if (index != -1) {\n      pg = this.pages[index];\n    } else {\n      // Otherwise add it to the list of locations\n      // Insert it in the correct position in the locations page\n      //index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\n      index = (0, _core.locationOf)(cfi, this.locations, this.epubcfi.compare); // Get the page at the location just before the new one, or return the first\n\n      pg = index - 1 >= 0 ? this.pages[index - 1] : this.pages[0];\n\n      if (pg !== undefined) {// Add the new page in so that the locations and page array match up\n        //this.pages.splice(index, 0, pg);\n      } else {\n        pg = -1;\n      }\n    }\n\n    return pg;\n  }\n  /**\n   * Get an EpubCFI from a Page List Item\n   * @param  {string | number} pg\n   * @return {string} cfi\n   */\n\n\n  cfiFromPage(pg) {\n    var cfi = -1; // check that pg is an int\n\n    if (typeof pg != \"number\") {\n      pg = parseInt(pg);\n    } // check if the cfi is in the page list\n    // Pages could be unsorted.\n\n\n    var index = this.pages.indexOf(pg);\n\n    if (index != -1) {\n      cfi = this.locations[index];\n    } // TODO: handle pages not in the list\n\n\n    return cfi;\n  }\n  /**\n   * Get a Page from Book percentage\n   * @param  {number} percent\n   * @return {number} page\n   */\n\n\n  pageFromPercentage(percent) {\n    var pg = Math.round(this.totalPages * percent);\n    return pg;\n  }\n  /**\n   * Returns a value between 0 - 1 corresponding to the location of a page\n   * @param  {number} pg the page\n   * @return {number} percentage\n   */\n\n\n  percentageFromPage(pg) {\n    var percentage = (pg - this.firstPage) / this.totalPages;\n    return Math.round(percentage * 1000) / 1000;\n  }\n  /**\n   * Returns a value between 0 - 1 corresponding to the location of a cfi\n   * @param  {string} cfi EpubCFI String\n   * @return {number} percentage\n   */\n\n\n  percentageFromCfi(cfi) {\n    var pg = this.pageFromCfi(cfi);\n    var percentage = this.percentageFromPage(pg);\n    return percentage;\n  }\n  /**\n   * Destroy\n   */\n\n\n  destroy() {\n    this.pages = undefined;\n    this.locations = undefined;\n    this.epubcfi = undefined;\n    this.pageList = undefined;\n    this.toc = undefined;\n    this.ncx = undefined;\n  }\n\n}\n\nvar _default = PageList;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _url = _interopRequireDefault(require(\"./utils/url\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Themes to apply to displayed content\n * @class\n * @param {Rendition} rendition\n */\nclass Themes {\n  constructor(rendition) {\n    this.rendition = rendition;\n    this._themes = {\n      \"default\": {\n        \"rules\": {},\n        \"url\": \"\",\n        \"serialized\": \"\"\n      }\n    };\n    this._overrides = {};\n    this._current = \"default\";\n    this._injected = [];\n    this.rendition.hooks.content.register(this.inject.bind(this));\n    this.rendition.hooks.content.register(this.overrides.bind(this));\n  }\n  /**\n   * Add themes to be used by a rendition\n   * @param {object | Array<object> | string}\n   * @example themes.register(\"light\", \"http://example.com/light.css\")\n   * @example themes.register(\"light\", { \"body\": { \"color\": \"purple\"}})\n   * @example themes.register({ \"light\" : {...}, \"dark\" : {...}})\n   */\n\n\n  register() {\n    if (arguments.length === 0) {\n      return;\n    }\n\n    if (arguments.length === 1 && typeof arguments[0] === \"object\") {\n      return this.registerThemes(arguments[0]);\n    }\n\n    if (arguments.length === 1 && typeof arguments[0] === \"string\") {\n      return this.default(arguments[0]);\n    }\n\n    if (arguments.length === 2 && typeof arguments[1] === \"string\") {\n      return this.registerUrl(arguments[0], arguments[1]);\n    }\n\n    if (arguments.length === 2 && typeof arguments[1] === \"object\") {\n      return this.registerRules(arguments[0], arguments[1]);\n    }\n  }\n  /**\n   * Add a default theme to be used by a rendition\n   * @param {object | string} theme\n   * @example themes.register(\"http://example.com/default.css\")\n   * @example themes.register({ \"body\": { \"color\": \"purple\"}})\n   */\n\n\n  default(theme) {\n    if (!theme) {\n      return;\n    }\n\n    if (typeof theme === \"string\") {\n      return this.registerUrl(\"default\", theme);\n    }\n\n    if (typeof theme === \"object\") {\n      return this.registerRules(\"default\", theme);\n    }\n  }\n  /**\n   * Register themes object\n   * @param {object} themes\n   */\n\n\n  registerThemes(themes) {\n    for (var theme in themes) {\n      if (themes.hasOwnProperty(theme)) {\n        if (typeof themes[theme] === \"string\") {\n          this.registerUrl(theme, themes[theme]);\n        } else {\n          this.registerRules(theme, themes[theme]);\n        }\n      }\n    }\n  }\n  /**\n   * Register a theme by passing its css as string\n   * @param {string} name \n   * @param {string} css \n   */\n\n\n  registerCss(name, css) {\n    this._themes[name] = {\n      \"serialized\": css\n    };\n\n    if (this._injected[name] || name == 'default') {\n      this.update(name);\n    }\n  }\n  /**\n   * Register a url\n   * @param {string} name\n   * @param {string} input\n   */\n\n\n  registerUrl(name, input) {\n    var url = new _url.default(input);\n    this._themes[name] = {\n      \"url\": url.toString()\n    };\n\n    if (this._injected[name] || name == 'default') {\n      this.update(name);\n    }\n  }\n  /**\n   * Register rule\n   * @param {string} name\n   * @param {object} rules\n   */\n\n\n  registerRules(name, rules) {\n    this._themes[name] = {\n      \"rules\": rules\n    }; // TODO: serialize css rules\n\n    if (this._injected[name] || name == 'default') {\n      this.update(name);\n    }\n  }\n  /**\n   * Select a theme\n   * @param {string} name\n   */\n\n\n  select(name) {\n    var prev = this._current;\n    var contents;\n    this._current = name;\n    this.update(name);\n    contents = this.rendition.getContents();\n    contents.forEach(content => {\n      content.removeClass(prev);\n      content.addClass(name);\n    });\n  }\n  /**\n   * Update a theme\n   * @param {string} name\n   */\n\n\n  update(name) {\n    var contents = this.rendition.getContents();\n    contents.forEach(content => {\n      this.add(name, content);\n    });\n  }\n  /**\n   * Inject all themes into contents\n   * @param {Contents} contents\n   */\n\n\n  inject(contents) {\n    var links = [];\n    var themes = this._themes;\n    var theme;\n\n    for (var name in themes) {\n      if (themes.hasOwnProperty(name) && (name === this._current || name === \"default\")) {\n        theme = themes[name];\n\n        if (theme.rules && Object.keys(theme.rules).length > 0 || theme.url && links.indexOf(theme.url) === -1) {\n          this.add(name, contents);\n        }\n\n        this._injected.push(name);\n      }\n    }\n\n    if (this._current != \"default\") {\n      contents.addClass(this._current);\n    }\n  }\n  /**\n   * Add Theme to contents\n   * @param {string} name\n   * @param {Contents} contents\n   */\n\n\n  add(name, contents) {\n    var theme = this._themes[name];\n\n    if (!theme || !contents) {\n      return;\n    }\n\n    if (theme.url) {\n      contents.addStylesheet(theme.url);\n    } else if (theme.serialized) {\n      contents.addStylesheetCss(theme.serialized, name);\n      theme.injected = true;\n    } else if (theme.rules) {\n      contents.addStylesheetRules(theme.rules, name);\n      theme.injected = true;\n    }\n  }\n  /**\n   * Add override\n   * @param {string} name\n   * @param {string} value\n   * @param {boolean} priority\n   */\n\n\n  override(name, value, priority) {\n    var contents = this.rendition.getContents();\n    this._overrides[name] = {\n      value: value,\n      priority: priority === true\n    };\n    contents.forEach(content => {\n      content.css(name, this._overrides[name].value, this._overrides[name].priority);\n    });\n  }\n\n  removeOverride(name) {\n    var contents = this.rendition.getContents();\n    delete this._overrides[name];\n    contents.forEach(content => {\n      content.css(name);\n    });\n  }\n  /**\n   * Add all overrides\n   * @param {Content} content\n   */\n\n\n  overrides(contents) {\n    var overrides = this._overrides;\n\n    for (var rule in overrides) {\n      if (overrides.hasOwnProperty(rule)) {\n        contents.css(rule, overrides[rule].value, overrides[rule].priority);\n      }\n    }\n  }\n  /**\n   * Adjust the font size of a rendition\n   * @param {number} size\n   */\n\n\n  fontSize(size) {\n    this.override(\"font-size\", size);\n  }\n  /**\n   * Adjust the font-family of a rendition\n   * @param {string} f\n   */\n\n\n  font(f) {\n    this.override(\"font-family\", f, true);\n  }\n\n  destroy() {\n    this.rendition = undefined;\n    this._themes = undefined;\n    this._overrides = undefined;\n    this._current = undefined;\n    this._injected = undefined;\n  }\n\n}\n\nvar _default = Themes;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _constants = require(\"./utils/constants\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n\t* Handles managing adding & removing Annotations\n\t* @param {Rendition} rendition\n\t* @class\n\t*/\nclass Annotations {\n  constructor(rendition) {\n    this.rendition = rendition;\n    this.highlights = [];\n    this.underlines = [];\n    this.marks = [];\n    this._annotations = {};\n    this._annotationsBySectionIndex = {};\n    this.rendition.hooks.render.register(this.inject.bind(this));\n    this.rendition.hooks.unloaded.register(this.clear.bind(this));\n  }\n  /**\n   * Add an annotation to store\n   * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n   * @param {object} data Data to assign to annotation\n   * @param {function} [cb] Callback after annotation is added\n   * @param {string} className CSS class to assign to annotation\n   * @param {object} styles CSS styles to assign to annotation\n   * @returns {Annotation} annotation\n   */\n\n\n  add(type, cfiRange, data, cb, className, styles) {\n    let hash = encodeURI(cfiRange + type);\n    let cfi = new _epubcfi.default(cfiRange);\n    let sectionIndex = cfi.spinePos;\n    let annotation = new Annotation({\n      type,\n      cfiRange,\n      data,\n      sectionIndex,\n      cb,\n      className,\n      styles\n    });\n    this._annotations[hash] = annotation;\n\n    if (sectionIndex in this._annotationsBySectionIndex) {\n      this._annotationsBySectionIndex[sectionIndex].push(hash);\n    } else {\n      this._annotationsBySectionIndex[sectionIndex] = [hash];\n    }\n\n    let views = this.rendition.views();\n    views.forEach(view => {\n      if (annotation.sectionIndex === view.index) {\n        annotation.attach(view);\n      }\n    });\n    return annotation;\n  }\n  /**\n   * Remove an annotation from store\n   * @param {EpubCFI} cfiRange EpubCFI range the annotation is attached to\n   * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n   */\n\n\n  remove(cfiRange, type) {\n    let hash = encodeURI(cfiRange + type);\n\n    if (hash in this._annotations) {\n      let annotation = this._annotations[hash];\n\n      if (type && annotation.type !== type) {\n        return;\n      }\n\n      let views = this.rendition.views();\n      views.forEach(view => {\n        this._removeFromAnnotationBySectionIndex(annotation.sectionIndex, hash);\n\n        if (annotation.sectionIndex === view.index) {\n          annotation.detach(view);\n        }\n      });\n      delete this._annotations[hash];\n    }\n  }\n  /**\n   * Remove an annotations by Section Index\n   * @private\n   */\n\n\n  _removeFromAnnotationBySectionIndex(sectionIndex, hash) {\n    this._annotationsBySectionIndex[sectionIndex] = this._annotationsAt(sectionIndex).filter(h => h !== hash);\n  }\n  /**\n   * Get annotations by Section Index\n   * @private\n   */\n\n\n  _annotationsAt(index) {\n    return this._annotationsBySectionIndex[index];\n  }\n  /**\n   * Add a highlight to the store\n   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n   * @param {object} data Data to assign to annotation\n   * @param {function} cb Callback after annotation is clicked\n   * @param {string} className CSS class to assign to annotation\n   * @param {object} styles CSS styles to assign to annotation\n   */\n\n\n  highlight(cfiRange, data, cb, className, styles) {\n    return this.add(\"highlight\", cfiRange, data, cb, className, styles);\n  }\n  /**\n   * Add a underline to the store\n   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n   * @param {object} data Data to assign to annotation\n   * @param {function} cb Callback after annotation is clicked\n   * @param {string} className CSS class to assign to annotation\n   * @param {object} styles CSS styles to assign to annotation\n   */\n\n\n  underline(cfiRange, data, cb, className, styles) {\n    return this.add(\"underline\", cfiRange, data, cb, className, styles);\n  }\n  /**\n   * Add a mark to the store\n   * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\n   * @param {object} data Data to assign to annotation\n   * @param {function} cb Callback after annotation is clicked\n   */\n\n\n  mark(cfiRange, data, cb) {\n    return this.add(\"mark\", cfiRange, data, cb);\n  }\n  /**\n   * iterate over annotations in the store\n   */\n\n\n  each() {\n    return this._annotations.forEach.apply(this._annotations, arguments);\n  }\n  /**\n   * Hook for injecting annotation into a view\n   * @param {View} view\n   * @private\n   */\n\n\n  inject(view) {\n    let sectionIndex = view.index;\n\n    if (sectionIndex in this._annotationsBySectionIndex) {\n      let annotations = this._annotationsBySectionIndex[sectionIndex];\n      annotations.forEach(hash => {\n        let annotation = this._annotations[hash];\n        annotation.attach(view);\n      });\n    }\n  }\n  /**\n   * Hook for removing annotation from a view\n   * @param {View} view\n   * @private\n   */\n\n\n  clear(view) {\n    let sectionIndex = view.index;\n\n    if (sectionIndex in this._annotationsBySectionIndex) {\n      let annotations = this._annotationsBySectionIndex[sectionIndex];\n      annotations.forEach(hash => {\n        let annotation = this._annotations[hash];\n        annotation.detach(view);\n      });\n    }\n  }\n  /**\n   * [Not Implemented] Show annotations\n   * @TODO: needs implementation in View\n   */\n\n\n  show() {}\n  /**\n   * [Not Implemented] Hide annotations\n   * @TODO: needs implementation in View\n   */\n\n\n  hide() {}\n\n}\n/**\n * Annotation object\n * @class\n * @param {object} options\n * @param {string} options.type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\n * @param {EpubCFI} options.cfiRange EpubCFI range to attach annotation to\n * @param {object} options.data Data to assign to annotation\n * @param {int} options.sectionIndex Index in the Spine of the Section annotation belongs to\n * @param {function} [options.cb] Callback after annotation is clicked\n * @param {string} className CSS class to assign to annotation\n * @param {object} styles CSS styles to assign to annotation\n * @returns {Annotation} annotation\n */\n\n\nclass Annotation {\n  constructor({\n    type,\n    cfiRange,\n    data,\n    sectionIndex,\n    cb,\n    className,\n    styles\n  }) {\n    this.type = type;\n    this.cfiRange = cfiRange;\n    this.data = data;\n    this.sectionIndex = sectionIndex;\n    this.mark = undefined;\n    this.cb = cb;\n    this.className = className;\n    this.styles = styles;\n  }\n  /**\n   * Update stored data\n   * @param {object} data\n   */\n\n\n  update(data) {\n    this.data = data;\n  }\n  /**\n   * Add to a view\n   * @param {View} view\n   */\n\n\n  attach(view) {\n    let {\n      cfiRange,\n      data,\n      type,\n      mark,\n      cb,\n      className,\n      styles\n    } = this;\n    let result;\n\n    if (type === \"highlight\") {\n      result = view.highlight(cfiRange, data, cb, className, styles);\n    } else if (type === \"underline\") {\n      result = view.underline(cfiRange, data, cb, className, styles);\n    } else if (type === \"mark\") {\n      result = view.mark(cfiRange, data, cb);\n    }\n\n    this.mark = result;\n    this.emit(_constants.EVENTS.ANNOTATION.ATTACH, result);\n    return result;\n  }\n  /**\n   * Remove from a view\n   * @param {View} view\n   */\n\n\n  detach(view) {\n    let {\n      cfiRange,\n      type\n    } = this;\n    let result;\n\n    if (view) {\n      if (type === \"highlight\") {\n        result = view.unhighlight(cfiRange);\n      } else if (type === \"underline\") {\n        result = view.ununderline(cfiRange);\n      } else if (type === \"mark\") {\n        result = view.unmark(cfiRange);\n      }\n    }\n\n    this.mark = undefined;\n    this.emit(_constants.EVENTS.ANNOTATION.DETACH, result);\n    return result;\n  }\n  /**\n   * [Not Implemented] Get text of an annotation\n   * @TODO: needs implementation in contents\n   */\n\n\n  text() {}\n\n}\n\n(0, _eventEmitter.default)(Annotation.prototype);\nvar _default = Annotations;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createDefiner = createDefiner;\nexports.default = scrollType;\n\n// Detect RTL scroll type\n// Based on https://github.com/othree/jquery.rtl-scroll-type/blob/master/src/jquery.rtl-scroll.js\nfunction scrollType() {\n  var type = \"reverse\";\n  var definer = createDefiner();\n  document.body.appendChild(definer);\n\n  if (definer.scrollLeft > 0) {\n    type = \"default\";\n  } else {\n    if (typeof Element !== 'undefined' && Element.prototype.scrollIntoView) {\n      definer.children[0].children[1].scrollIntoView();\n\n      if (definer.scrollLeft < 0) {\n        type = \"negative\";\n      }\n    } else {\n      definer.scrollLeft = 1;\n\n      if (definer.scrollLeft === 0) {\n        type = \"negative\";\n      }\n    }\n  }\n\n  document.body.removeChild(definer);\n  return type;\n}\n\nfunction createDefiner() {\n  var definer = document.createElement('div');\n  definer.dir = \"rtl\";\n  definer.style.position = \"fixed\";\n  definer.style.width = \"1px\";\n  definer.style.height = \"1px\";\n  definer.style.top = \"0px\";\n  definer.style.left = \"0px\";\n  definer.style.overflow = \"hidden\";\n  var innerDiv = document.createElement('div');\n  innerDiv.style.width = \"2px\";\n  var spanA = document.createElement('span');\n  spanA.style.width = \"1px\";\n  spanA.style.display = \"inline-block\";\n  var spanB = document.createElement('span');\n  spanB.style.width = \"1px\";\n  spanB.style.display = \"inline-block\";\n  innerDiv.appendChild(spanA);\n  innerDiv.appendChild(spanB);\n  definer.appendChild(innerDiv);\n  return definer;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"../../utils/core\");\n\nvar _throttle = _interopRequireDefault(require(\"lodash/throttle\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass Stage {\n  constructor(_options) {\n    this.settings = _options || {};\n    this.id = \"epubjs-container-\" + (0, _core.uuid)();\n    this.container = this.create(this.settings);\n\n    if (this.settings.hidden) {\n      this.wrapper = this.wrap(this.container);\n    }\n  }\n  /*\n  * Creates an element to render to.\n  * Resizes to passed width and height or to the elements size\n  */\n\n\n  create(options) {\n    let height = options.height; // !== false ? options.height : \"100%\";\n\n    let width = options.width; // !== false ? options.width : \"100%\";\n\n    let overflow = options.overflow || false;\n    let axis = options.axis || \"vertical\";\n    let direction = options.direction;\n    (0, _core.extend)(this.settings, options);\n\n    if (options.height && (0, _core.isNumber)(options.height)) {\n      height = options.height + \"px\";\n    }\n\n    if (options.width && (0, _core.isNumber)(options.width)) {\n      width = options.width + \"px\";\n    } // Create new container element\n\n\n    let container = document.createElement(\"div\");\n    container.id = this.id;\n    container.classList.add(\"epub-container\"); // Style Element\n    // container.style.fontSize = \"0\";\n\n    container.style.wordSpacing = \"0\";\n    container.style.lineHeight = \"0\";\n    container.style.verticalAlign = \"top\";\n    container.style.position = \"relative\";\n\n    if (axis === \"horizontal\") {\n      // container.style.whiteSpace = \"nowrap\";\n      container.style.display = \"flex\";\n      container.style.flexDirection = \"row\";\n      container.style.flexWrap = \"nowrap\";\n    }\n\n    if (width) {\n      container.style.width = width;\n    }\n\n    if (height) {\n      container.style.height = height;\n    }\n\n    if (overflow) {\n      if (overflow === \"scroll\" && axis === \"vertical\") {\n        container.style[\"overflow-y\"] = overflow;\n        container.style[\"overflow-x\"] = \"hidden\";\n      } else if (overflow === \"scroll\" && axis === \"horizontal\") {\n        container.style[\"overflow-y\"] = \"hidden\";\n        container.style[\"overflow-x\"] = overflow;\n      } else {\n        container.style[\"overflow\"] = overflow;\n      }\n    }\n\n    if (direction) {\n      container.dir = direction;\n      container.style[\"direction\"] = direction;\n    }\n\n    if (direction && this.settings.fullsize) {\n      document.body.style[\"direction\"] = direction;\n    }\n\n    return container;\n  }\n\n  wrap(container) {\n    var wrapper = document.createElement(\"div\");\n    wrapper.style.visibility = \"hidden\";\n    wrapper.style.overflow = \"hidden\";\n    wrapper.style.width = \"0\";\n    wrapper.style.height = \"0\";\n    wrapper.appendChild(container);\n    return wrapper;\n  }\n\n  getElement(_element) {\n    var element;\n\n    if ((0, _core.isElement)(_element)) {\n      element = _element;\n    } else if (typeof _element === \"string\") {\n      element = document.getElementById(_element);\n    }\n\n    if (!element) {\n      throw new Error(\"Not an Element\");\n    }\n\n    return element;\n  }\n\n  attachTo(what) {\n    var element = this.getElement(what);\n    var base;\n\n    if (!element) {\n      return;\n    }\n\n    if (this.settings.hidden) {\n      base = this.wrapper;\n    } else {\n      base = this.container;\n    }\n\n    element.appendChild(base);\n    this.element = element;\n    return element;\n  }\n\n  getContainer() {\n    return this.container;\n  }\n\n  onResize(func) {\n    // Only listen to window for resize event if width and height are not fixed.\n    // This applies if it is set to a percent or auto.\n    if (!(0, _core.isNumber)(this.settings.width) || !(0, _core.isNumber)(this.settings.height)) {\n      this.resizeFunc = (0, _throttle.default)(func, 50);\n      window.addEventListener(\"resize\", this.resizeFunc, false);\n    }\n  }\n\n  onOrientationChange(func) {\n    this.orientationChangeFunc = func;\n    window.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\n  }\n\n  size(width, height) {\n    var bounds;\n\n    let _width = width || this.settings.width;\n\n    let _height = height || this.settings.height; // If width or height are set to false, inherit them from containing element\n\n\n    if (width === null) {\n      bounds = this.element.getBoundingClientRect();\n\n      if (bounds.width) {\n        width = Math.floor(bounds.width);\n        this.container.style.width = width + \"px\";\n      }\n    } else {\n      if ((0, _core.isNumber)(width)) {\n        this.container.style.width = width + \"px\";\n      } else {\n        this.container.style.width = width;\n      }\n    }\n\n    if (height === null) {\n      bounds = bounds || this.element.getBoundingClientRect();\n\n      if (bounds.height) {\n        height = bounds.height;\n        this.container.style.height = height + \"px\";\n      }\n    } else {\n      if ((0, _core.isNumber)(height)) {\n        this.container.style.height = height + \"px\";\n      } else {\n        this.container.style.height = height;\n      }\n    }\n\n    if (!(0, _core.isNumber)(width)) {\n      width = this.container.clientWidth;\n    }\n\n    if (!(0, _core.isNumber)(height)) {\n      height = this.container.clientHeight;\n    }\n\n    this.containerStyles = window.getComputedStyle(this.container);\n    this.containerPadding = {\n      left: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n      right: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n      top: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n      bottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n    }; // Bounds not set, get them from window\n\n    let _windowBounds = (0, _core.windowBounds)();\n\n    let bodyStyles = window.getComputedStyle(document.body);\n    let bodyPadding = {\n      left: parseFloat(bodyStyles[\"padding-left\"]) || 0,\n      right: parseFloat(bodyStyles[\"padding-right\"]) || 0,\n      top: parseFloat(bodyStyles[\"padding-top\"]) || 0,\n      bottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\n    };\n\n    if (!_width) {\n      width = _windowBounds.width - bodyPadding.left - bodyPadding.right;\n    }\n\n    if (this.settings.fullsize && !_height || !_height) {\n      height = _windowBounds.height - bodyPadding.top - bodyPadding.bottom;\n    }\n\n    return {\n      width: width - this.containerPadding.left - this.containerPadding.right,\n      height: height - this.containerPadding.top - this.containerPadding.bottom\n    };\n  }\n\n  bounds() {\n    let box;\n\n    if (this.container.style.overflow !== \"visible\") {\n      box = this.container && this.container.getBoundingClientRect();\n    }\n\n    if (!box || !box.width || !box.height) {\n      return (0, _core.windowBounds)();\n    } else {\n      return box;\n    }\n  }\n\n  getSheet() {\n    var style = document.createElement(\"style\"); // WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\n    style.appendChild(document.createTextNode(\"\"));\n    document.head.appendChild(style);\n    return style.sheet;\n  }\n\n  addStyleRules(selector, rulesArray) {\n    var scope = \"#\" + this.id + \" \";\n    var rules = \"\";\n\n    if (!this.sheet) {\n      this.sheet = this.getSheet();\n    }\n\n    rulesArray.forEach(function (set) {\n      for (var prop in set) {\n        if (set.hasOwnProperty(prop)) {\n          rules += prop + \":\" + set[prop] + \";\";\n        }\n      }\n    });\n    this.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n  }\n\n  axis(axis) {\n    if (axis === \"horizontal\") {\n      this.container.style.display = \"flex\";\n      this.container.style.flexDirection = \"row\";\n      this.container.style.flexWrap = \"nowrap\";\n    } else {\n      this.container.style.display = \"block\";\n    }\n\n    this.settings.axis = axis;\n  } // orientation(orientation) {\n  // \tif (orientation === \"landscape\") {\n  //\n  // \t} else {\n  //\n  // \t}\n  //\n  // \tthis.orientation = orientation;\n  // }\n\n\n  direction(dir) {\n    if (this.container) {\n      this.container.dir = dir;\n      this.container.style[\"direction\"] = dir;\n    }\n\n    if (this.settings.fullsize) {\n      document.body.style[\"direction\"] = dir;\n    }\n\n    this.settings.dir = dir;\n  }\n\n  overflow(overflow) {\n    if (this.container) {\n      if (overflow === \"scroll\" && this.settings.axis === \"vertical\") {\n        this.container.style[\"overflow-y\"] = overflow;\n        this.container.style[\"overflow-x\"] = \"hidden\";\n      } else if (overflow === \"scroll\" && this.settings.axis === \"horizontal\") {\n        this.container.style[\"overflow-y\"] = \"hidden\";\n        this.container.style[\"overflow-x\"] = overflow;\n      } else {\n        this.container.style[\"overflow\"] = overflow;\n      }\n    }\n\n    this.settings.overflow = overflow;\n  }\n\n  destroy() {\n    var base;\n\n    if (this.element) {\n      if (this.settings.hidden) {\n        base = this.wrapper;\n      } else {\n        base = this.container;\n      }\n\n      if (this.element.contains(this.container)) {\n        this.element.removeChild(this.container);\n      }\n\n      window.removeEventListener(\"resize\", this.resizeFunc);\n      window.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\n    }\n  }\n\n}\n\nvar _default = Stage;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nclass Views {\n  constructor(container) {\n    this.container = container;\n    this._views = [];\n    this.length = 0;\n    this.hidden = false;\n  }\n\n  all() {\n    return this._views;\n  }\n\n  first() {\n    return this._views[0];\n  }\n\n  last() {\n    return this._views[this._views.length - 1];\n  }\n\n  indexOf(view) {\n    return this._views.indexOf(view);\n  }\n\n  slice() {\n    return this._views.slice.apply(this._views, arguments);\n  }\n\n  get(i) {\n    return this._views[i];\n  }\n\n  append(view) {\n    this._views.push(view);\n\n    if (this.container) {\n      this.container.appendChild(view.element);\n    }\n\n    this.length++;\n    return view;\n  }\n\n  prepend(view) {\n    this._views.unshift(view);\n\n    if (this.container) {\n      this.container.insertBefore(view.element, this.container.firstChild);\n    }\n\n    this.length++;\n    return view;\n  }\n\n  insert(view, index) {\n    this._views.splice(index, 0, view);\n\n    if (this.container) {\n      if (index < this.container.children.length) {\n        this.container.insertBefore(view.element, this.container.children[index]);\n      } else {\n        this.container.appendChild(view.element);\n      }\n    }\n\n    this.length++;\n    return view;\n  }\n\n  remove(view) {\n    var index = this._views.indexOf(view);\n\n    if (index > -1) {\n      this._views.splice(index, 1);\n    }\n\n    this.destroy(view);\n    this.length--;\n  }\n\n  destroy(view) {\n    if (view.displayed) {\n      view.destroy();\n    }\n\n    if (this.container) {\n      this.container.removeChild(view.element);\n    }\n\n    view = null;\n  } // Iterators\n\n\n  forEach() {\n    return this._views.forEach.apply(this._views, arguments);\n  }\n\n  clear() {\n    // Remove all views\n    var view;\n    var len = this.length;\n    if (!this.length) return;\n\n    for (var i = 0; i < len; i++) {\n      view = this._views[i];\n      this.destroy(view);\n    }\n\n    this._views = [];\n    this.length = 0;\n  }\n\n  find(section) {\n    var view;\n    var len = this.length;\n\n    for (var i = 0; i < len; i++) {\n      view = this._views[i];\n\n      if (view.displayed && view.section.index == section.index) {\n        return view;\n      }\n    }\n  }\n\n  displayed() {\n    var displayed = [];\n    var view;\n    var len = this.length;\n\n    for (var i = 0; i < len; i++) {\n      view = this._views[i];\n\n      if (view.displayed) {\n        displayed.push(view);\n      }\n    }\n\n    return displayed;\n  }\n\n  show() {\n    var view;\n    var len = this.length;\n\n    for (var i = 0; i < len; i++) {\n      view = this._views[i];\n\n      if (view.displayed) {\n        view.show();\n      }\n    }\n\n    this.hidden = false;\n  }\n\n  hide() {\n    var view;\n    var len = this.length;\n\n    for (var i = 0; i < len; i++) {\n      view = this._views[i];\n\n      if (view.displayed) {\n        view.hide();\n      }\n    }\n\n    this.hidden = true;\n  }\n\n}\n\nvar _default = Views;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"../../utils/core\");\n\nvar _constants = require(\"../../utils/constants\");\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// easing equations from https://github.com/danro/easing-js/blob/master/easing.js\nconst PI_D2 = Math.PI / 2;\nconst EASING_EQUATIONS = {\n  easeOutSine: function (pos) {\n    return Math.sin(pos * PI_D2);\n  },\n  easeInOutSine: function (pos) {\n    return -0.5 * (Math.cos(Math.PI * pos) - 1);\n  },\n  easeInOutQuint: function (pos) {\n    if ((pos /= 0.5) < 1) {\n      return 0.5 * Math.pow(pos, 5);\n    }\n\n    return 0.5 * (Math.pow(pos - 2, 5) + 2);\n  },\n  easeInCubic: function (pos) {\n    return Math.pow(pos, 3);\n  }\n};\n\nclass Snap {\n  constructor(manager, options) {\n    this.settings = (0, _core.extend)({\n      duration: 80,\n      minVelocity: 0.2,\n      minDistance: 10,\n      easing: EASING_EQUATIONS['easeInCubic']\n    }, options || {});\n    this.supportsTouch = this.supportsTouch();\n\n    if (this.supportsTouch) {\n      this.setup(manager);\n    }\n  }\n\n  setup(manager) {\n    this.manager = manager;\n    this.layout = this.manager.layout;\n    this.fullsize = this.manager.settings.fullsize;\n\n    if (this.fullsize) {\n      this.element = this.manager.stage.element;\n      this.scroller = window;\n      this.disableScroll();\n    } else {\n      this.element = this.manager.stage.container;\n      this.scroller = this.element;\n      this.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\n    } // this.overflow = this.manager.overflow;\n    // set lookahead offset to page width\n\n\n    this.manager.settings.offset = this.layout.width;\n    this.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\n    this.isVertical = this.manager.settings.axis === \"vertical\"; // disable snapping if not paginated or axis in not horizontal\n\n    if (!this.manager.isPaginated || this.isVertical) {\n      return;\n    }\n\n    this.touchCanceler = false;\n    this.resizeCanceler = false;\n    this.snapping = false;\n    this.scrollLeft;\n    this.scrollTop;\n    this.startTouchX = undefined;\n    this.startTouchY = undefined;\n    this.startTime = undefined;\n    this.endTouchX = undefined;\n    this.endTouchY = undefined;\n    this.endTime = undefined;\n    this.addListeners();\n  }\n\n  supportsTouch() {\n    if ('ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch) {\n      return true;\n    }\n\n    return false;\n  }\n\n  disableScroll() {\n    this.element.style.overflow = \"hidden\";\n  }\n\n  enableScroll() {\n    this.element.style.overflow = \"\";\n  }\n\n  addListeners() {\n    this._onResize = this.onResize.bind(this);\n    window.addEventListener('resize', this._onResize);\n    this._onScroll = this.onScroll.bind(this);\n    this.scroller.addEventListener('scroll', this._onScroll);\n    this._onTouchStart = this.onTouchStart.bind(this);\n    this.scroller.addEventListener('touchstart', this._onTouchStart, {\n      passive: true\n    });\n    this.on('touchstart', this._onTouchStart);\n    this._onTouchMove = this.onTouchMove.bind(this);\n    this.scroller.addEventListener('touchmove', this._onTouchMove, {\n      passive: true\n    });\n    this.on('touchmove', this._onTouchMove);\n    this._onTouchEnd = this.onTouchEnd.bind(this);\n    this.scroller.addEventListener('touchend', this._onTouchEnd, {\n      passive: true\n    });\n    this.on('touchend', this._onTouchEnd);\n    this._afterDisplayed = this.afterDisplayed.bind(this);\n    this.manager.on(_constants.EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n  }\n\n  removeListeners() {\n    window.removeEventListener('resize', this._onResize);\n    this._onResize = undefined;\n    this.scroller.removeEventListener('scroll', this._onScroll);\n    this._onScroll = undefined;\n    this.scroller.removeEventListener('touchstart', this._onTouchStart, {\n      passive: true\n    });\n    this.off('touchstart', this._onTouchStart);\n    this._onTouchStart = undefined;\n    this.scroller.removeEventListener('touchmove', this._onTouchMove, {\n      passive: true\n    });\n    this.off('touchmove', this._onTouchMove);\n    this._onTouchMove = undefined;\n    this.scroller.removeEventListener('touchend', this._onTouchEnd, {\n      passive: true\n    });\n    this.off('touchend', this._onTouchEnd);\n    this._onTouchEnd = undefined;\n    this.manager.off(_constants.EVENTS.MANAGERS.ADDED, this._afterDisplayed);\n    this._afterDisplayed = undefined;\n  }\n\n  afterDisplayed(view) {\n    let contents = view.contents;\n    [\"touchstart\", \"touchmove\", \"touchend\"].forEach(e => {\n      contents.on(e, ev => this.triggerViewEvent(ev, contents));\n    });\n  }\n\n  triggerViewEvent(e, contents) {\n    this.emit(e.type, e, contents);\n  }\n\n  onScroll(e) {\n    this.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\n    this.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\n  }\n\n  onResize(e) {\n    this.resizeCanceler = true;\n  }\n\n  onTouchStart(e) {\n    let {\n      screenX,\n      screenY\n    } = e.touches[0];\n\n    if (this.fullsize) {\n      this.enableScroll();\n    }\n\n    this.touchCanceler = true;\n\n    if (!this.startTouchX) {\n      this.startTouchX = screenX;\n      this.startTouchY = screenY;\n      this.startTime = this.now();\n    }\n\n    this.endTouchX = screenX;\n    this.endTouchY = screenY;\n    this.endTime = this.now();\n  }\n\n  onTouchMove(e) {\n    let {\n      screenX,\n      screenY\n    } = e.touches[0];\n    let deltaY = Math.abs(screenY - this.endTouchY);\n    this.touchCanceler = true;\n\n    if (!this.fullsize && deltaY < 10) {\n      this.element.scrollLeft -= screenX - this.endTouchX;\n    }\n\n    this.endTouchX = screenX;\n    this.endTouchY = screenY;\n    this.endTime = this.now();\n  }\n\n  onTouchEnd(e) {\n    if (this.fullsize) {\n      this.disableScroll();\n    }\n\n    this.touchCanceler = false;\n    let swipped = this.wasSwiped();\n\n    if (swipped !== 0) {\n      this.snap(swipped);\n    } else {\n      this.snap();\n    }\n\n    this.startTouchX = undefined;\n    this.startTouchY = undefined;\n    this.startTime = undefined;\n    this.endTouchX = undefined;\n    this.endTouchY = undefined;\n    this.endTime = undefined;\n  }\n\n  wasSwiped() {\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    let distance = this.endTouchX - this.startTouchX;\n    let absolute = Math.abs(distance);\n    let time = this.endTime - this.startTime;\n    let velocity = distance / time;\n    let minVelocity = this.settings.minVelocity;\n\n    if (absolute <= this.settings.minDistance || absolute >= snapWidth) {\n      return 0;\n    }\n\n    if (velocity > minVelocity) {\n      // previous\n      return -1;\n    } else if (velocity < -minVelocity) {\n      // next\n      return 1;\n    }\n  }\n\n  needsSnap() {\n    let left = this.scrollLeft;\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    return left % snapWidth !== 0;\n  }\n\n  snap(howMany = 0) {\n    let left = this.scrollLeft;\n    let snapWidth = this.layout.pageWidth * this.layout.divisor;\n    let snapTo = Math.round(left / snapWidth) * snapWidth;\n\n    if (howMany) {\n      snapTo += howMany * snapWidth;\n    }\n\n    return this.smoothScrollTo(snapTo);\n  }\n\n  smoothScrollTo(destination) {\n    const deferred = new _core.defer();\n    const start = this.scrollLeft;\n    const startTime = this.now();\n    const duration = this.settings.duration;\n    const easing = this.settings.easing;\n    this.snapping = true; // add animation loop\n\n    function tick() {\n      const now = this.now();\n      const time = Math.min(1, (now - startTime) / duration);\n      const timeFunction = easing(time);\n\n      if (this.touchCanceler || this.resizeCanceler) {\n        this.resizeCanceler = false;\n        this.snapping = false;\n        deferred.resolve();\n        return;\n      }\n\n      if (time < 1) {\n        window.requestAnimationFrame(tick.bind(this));\n        this.scrollTo(start + (destination - start) * time, 0);\n      } else {\n        this.scrollTo(destination, 0);\n        this.snapping = false;\n        deferred.resolve();\n      }\n    }\n\n    tick.call(this);\n    return deferred.promise;\n  }\n\n  scrollTo(left = 0, top = 0) {\n    if (this.fullsize) {\n      window.scroll(left, top);\n    } else {\n      this.scroller.scrollLeft = left;\n      this.scroller.scrollTop = top;\n    }\n  }\n\n  now() {\n    return 'now' in window.performance ? performance.now() : new Date().getTime();\n  }\n\n  destroy() {\n    if (!this.scroller) {\n      return;\n    }\n\n    if (this.fullsize) {\n      this.enableScroll();\n    }\n\n    this.removeListeners();\n    this.scroller = undefined;\n  }\n\n}\n\n(0, _eventEmitter.default)(Snap.prototype);\nvar _default = Snap;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\nvar _request = _interopRequireDefault(require(\"./utils/request\"));\n\nvar _mime = _interopRequireDefault(require(\"./utils/mime\"));\n\nvar _path = _interopRequireDefault(require(\"./utils/path\"));\n\nvar _jszip = _interopRequireDefault(require(\"jszip/dist/jszip\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Handles Unzipping a requesting files from an Epub Archive\n * @class\n */\nclass Archive {\n  constructor() {\n    this.zip = undefined;\n    this.urlCache = {};\n    this.checkRequirements();\n  }\n  /**\n   * Checks to see if JSZip exists in global namspace,\n   * Requires JSZip if it isn't there\n   * @private\n   */\n\n\n  checkRequirements() {\n    try {\n      this.zip = new _jszip.default();\n    } catch (e) {\n      throw new Error(\"JSZip lib not loaded\");\n    }\n  }\n  /**\n   * Open an archive\n   * @param  {binary} input\n   * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n   * @return {Promise} zipfile\n   */\n\n\n  open(input, isBase64) {\n    return this.zip.loadAsync(input, {\n      \"base64\": isBase64\n    });\n  }\n  /**\n   * Load and Open an archive\n   * @param  {string} zipUrl\n   * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\n   * @return {Promise} zipfile\n   */\n\n\n  openUrl(zipUrl, isBase64) {\n    return (0, _request.default)(zipUrl, \"binary\").then(function (data) {\n      return this.zip.loadAsync(data, {\n        \"base64\": isBase64\n      });\n    }.bind(this));\n  }\n  /**\n   * Request a url from the archive\n   * @param  {string} url  a url to request from the archive\n   * @param  {string} [type] specify the type of the returned result\n   * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n   */\n\n\n  request(url, type) {\n    var deferred = new _core.defer();\n    var response;\n    var path = new _path.default(url); // If type isn't set, determine it from the file extension\n\n    if (!type) {\n      type = path.extension;\n    }\n\n    if (type == \"blob\") {\n      response = this.getBlob(url);\n    } else {\n      response = this.getText(url);\n    }\n\n    if (response) {\n      response.then(function (r) {\n        let result = this.handleResponse(r, type);\n        deferred.resolve(result);\n      }.bind(this));\n    } else {\n      deferred.reject({\n        message: \"File not found in the epub: \" + url,\n        stack: new Error().stack\n      });\n    }\n\n    return deferred.promise;\n  }\n  /**\n   * Handle the response from request\n   * @private\n   * @param  {any} response\n   * @param  {string} [type]\n   * @return {any} the parsed result\n   */\n\n\n  handleResponse(response, type) {\n    var r;\n\n    if (type == \"json\") {\n      r = JSON.parse(response);\n    } else if ((0, _core.isXml)(type)) {\n      r = (0, _core.parse)(response, \"text/xml\");\n    } else if (type == \"xhtml\") {\n      r = (0, _core.parse)(response, \"application/xhtml+xml\");\n    } else if (type == \"html\" || type == \"htm\") {\n      r = (0, _core.parse)(response, \"text/html\");\n    } else {\n      r = response;\n    }\n\n    return r;\n  }\n  /**\n   * Get a Blob from Archive by Url\n   * @param  {string} url\n   * @param  {string} [mimeType]\n   * @return {Blob}\n   */\n\n\n  getBlob(url, mimeType) {\n    var decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\n    var entry = this.zip.file(decodededUrl);\n\n    if (entry) {\n      mimeType = mimeType || _mime.default.lookup(entry.name);\n      return entry.async(\"uint8array\").then(function (uint8array) {\n        return new Blob([uint8array], {\n          type: mimeType\n        });\n      });\n    }\n  }\n  /**\n   * Get Text from Archive by Url\n   * @param  {string} url\n   * @param  {string} [encoding]\n   * @return {string}\n   */\n\n\n  getText(url, encoding) {\n    var decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\n    var entry = this.zip.file(decodededUrl);\n\n    if (entry) {\n      return entry.async(\"string\").then(function (text) {\n        return text;\n      });\n    }\n  }\n  /**\n   * Get a base64 encoded result from Archive by Url\n   * @param  {string} url\n   * @param  {string} [mimeType]\n   * @return {string} base64 encoded\n   */\n\n\n  getBase64(url, mimeType) {\n    var decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\n\n    var entry = this.zip.file(decodededUrl);\n\n    if (entry) {\n      mimeType = mimeType || _mime.default.lookup(entry.name);\n      return entry.async(\"base64\").then(function (data) {\n        return \"data:\" + mimeType + \";base64,\" + data;\n      });\n    }\n  }\n  /**\n   * Create a Url from an unarchived item\n   * @param  {string} url\n   * @param  {object} [options.base64] use base64 encoding or blob url\n   * @return {Promise} url promise with Url string\n   */\n\n\n  createUrl(url, options) {\n    var deferred = new _core.defer();\n\n    var _URL = window.URL || window.webkitURL || window.mozURL;\n\n    var tempUrl;\n    var response;\n    var useBase64 = options && options.base64;\n\n    if (url in this.urlCache) {\n      deferred.resolve(this.urlCache[url]);\n      return deferred.promise;\n    }\n\n    if (useBase64) {\n      response = this.getBase64(url);\n\n      if (response) {\n        response.then(function (tempUrl) {\n          this.urlCache[url] = tempUrl;\n          deferred.resolve(tempUrl);\n        }.bind(this));\n      }\n    } else {\n      response = this.getBlob(url);\n\n      if (response) {\n        response.then(function (blob) {\n          tempUrl = _URL.createObjectURL(blob);\n          this.urlCache[url] = tempUrl;\n          deferred.resolve(tempUrl);\n        }.bind(this));\n      }\n    }\n\n    if (!response) {\n      deferred.reject({\n        message: \"File not found in the epub: \" + url,\n        stack: new Error().stack\n      });\n    }\n\n    return deferred.promise;\n  }\n  /**\n   * Revoke Temp Url for a achive item\n   * @param  {string} url url of the item in the archive\n   */\n\n\n  revokeUrl(url) {\n    var _URL = window.URL || window.webkitURL || window.mozURL;\n\n    var fromCache = this.urlCache[url];\n    if (fromCache) _URL.revokeObjectURL(fromCache);\n  }\n\n  destroy() {\n    var _URL = window.URL || window.webkitURL || window.mozURL;\n\n    for (let fromCache in this.urlCache) {\n      _URL.revokeObjectURL(fromCache);\n    }\n\n    this.zip = undefined;\n    this.urlCache = {};\n  }\n\n}\n\nvar _default = Archive;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\nvar _request = _interopRequireDefault(require(\"./utils/request\"));\n\nvar _mime = _interopRequireDefault(require(\"./utils/mime\"));\n\nvar _path = _interopRequireDefault(require(\"./utils/path\"));\n\nvar _eventEmitter = _interopRequireDefault(require(\"event-emitter\"));\n\nvar _localforage = _interopRequireDefault(require(\"localforage\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Handles saving and requesting files from local storage\n * @class\n * @param {string} name This should be the name of the application for modals\n * @param {function} [requester]\n * @param {function} [resolver]\n */\nclass Store {\n  constructor(name, requester, resolver) {\n    this.urlCache = {};\n    this.storage = undefined;\n    this.name = name;\n    this.requester = requester || _request.default;\n    this.resolver = resolver;\n    this.online = true;\n    this.checkRequirements();\n    this.addListeners();\n  }\n  /**\n   * Checks to see if localForage exists in global namspace,\n   * Requires localForage if it isn't there\n   * @private\n   */\n\n\n  checkRequirements() {\n    try {\n      let store;\n\n      if (typeof _localforage.default === \"undefined\") {\n        store = _localforage.default;\n      }\n\n      this.storage = store.createInstance({\n        name: this.name\n      });\n    } catch (e) {\n      throw new Error(\"localForage lib not loaded\");\n    }\n  }\n  /**\n   * Add online and offline event listeners\n   * @private\n   */\n\n\n  addListeners() {\n    this._status = this.status.bind(this);\n    window.addEventListener('online', this._status);\n    window.addEventListener('offline', this._status);\n  }\n  /**\n   * Remove online and offline event listeners\n   * @private\n   */\n\n\n  removeListeners() {\n    window.removeEventListener('online', this._status);\n    window.removeEventListener('offline', this._status);\n    this._status = undefined;\n  }\n  /**\n   * Update the online / offline status\n   * @private\n   */\n\n\n  status(event) {\n    let online = navigator.onLine;\n    this.online = online;\n\n    if (online) {\n      this.emit(\"online\", this);\n    } else {\n      this.emit(\"offline\", this);\n    }\n  }\n  /**\n   * Add all of a book resources to the store\n   * @param  {Resources} resources  book resources\n   * @param  {boolean} [force] force resaving resources\n   * @return {Promise<object>} store objects\n   */\n\n\n  add(resources, force) {\n    let mapped = resources.resources.map(item => {\n      let {\n        href\n      } = item;\n      let url = this.resolver(href);\n      let encodedUrl = window.encodeURIComponent(url);\n      return this.storage.getItem(encodedUrl).then(item => {\n        if (!item || force) {\n          return this.requester(url, \"binary\").then(data => {\n            return this.storage.setItem(encodedUrl, data);\n          });\n        } else {\n          return item;\n        }\n      });\n    });\n    return Promise.all(mapped);\n  }\n  /**\n   * Put binary data from a url to storage\n   * @param  {string} url  a url to request from storage\n   * @param  {boolean} [withCredentials]\n   * @param  {object} [headers]\n   * @return {Promise<Blob>}\n   */\n\n\n  put(url, withCredentials, headers) {\n    let encodedUrl = window.encodeURIComponent(url);\n    return this.storage.getItem(encodedUrl).then(result => {\n      if (!result) {\n        return this.requester(url, \"binary\", withCredentials, headers).then(data => {\n          return this.storage.setItem(encodedUrl, data);\n        });\n      }\n\n      return result;\n    });\n  }\n  /**\n   * Request a url\n   * @param  {string} url  a url to request from storage\n   * @param  {string} [type] specify the type of the returned result\n   * @param  {boolean} [withCredentials]\n   * @param  {object} [headers]\n   * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n   */\n\n\n  request(url, type, withCredentials, headers) {\n    if (this.online) {\n      // From network\n      return this.requester(url, type, withCredentials, headers).then(data => {\n        // save to store if not present\n        this.put(url);\n        return data;\n      });\n    } else {\n      // From store\n      return this.retrieve(url, type);\n    }\n  }\n  /**\n   * Request a url from storage\n   * @param  {string} url  a url to request from storage\n   * @param  {string} [type] specify the type of the returned result\n   * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\n   */\n\n\n  retrieve(url, type) {\n    var deferred = new _core.defer();\n    var response;\n    var path = new _path.default(url); // If type isn't set, determine it from the file extension\n\n    if (!type) {\n      type = path.extension;\n    }\n\n    if (type == \"blob\") {\n      response = this.getBlob(url);\n    } else {\n      response = this.getText(url);\n    }\n\n    return response.then(r => {\n      var deferred = new _core.defer();\n      var result;\n\n      if (r) {\n        result = this.handleResponse(r, type);\n        deferred.resolve(result);\n      } else {\n        deferred.reject({\n          message: \"File not found in storage: \" + url,\n          stack: new Error().stack\n        });\n      }\n\n      return deferred.promise;\n    });\n  }\n  /**\n   * Handle the response from request\n   * @private\n   * @param  {any} response\n   * @param  {string} [type]\n   * @return {any} the parsed result\n   */\n\n\n  handleResponse(response, type) {\n    var r;\n\n    if (type == \"json\") {\n      r = JSON.parse(response);\n    } else if ((0, _core.isXml)(type)) {\n      r = (0, _core.parse)(response, \"text/xml\");\n    } else if (type == \"xhtml\") {\n      r = (0, _core.parse)(response, \"application/xhtml+xml\");\n    } else if (type == \"html\" || type == \"htm\") {\n      r = (0, _core.parse)(response, \"text/html\");\n    } else {\n      r = response;\n    }\n\n    return r;\n  }\n  /**\n   * Get a Blob from Storage by Url\n   * @param  {string} url\n   * @param  {string} [mimeType]\n   * @return {Blob}\n   */\n\n\n  getBlob(url, mimeType) {\n    let encodedUrl = window.encodeURIComponent(url);\n    return this.storage.getItem(encodedUrl).then(function (uint8array) {\n      if (!uint8array) return;\n      mimeType = mimeType || _mime.default.lookup(url);\n      return new Blob([uint8array], {\n        type: mimeType\n      });\n    });\n  }\n  /**\n   * Get Text from Storage by Url\n   * @param  {string} url\n   * @param  {string} [mimeType]\n   * @return {string}\n   */\n\n\n  getText(url, mimeType) {\n    let encodedUrl = window.encodeURIComponent(url);\n    mimeType = mimeType || _mime.default.lookup(url);\n    return this.storage.getItem(encodedUrl).then(function (uint8array) {\n      var deferred = new _core.defer();\n      var reader = new FileReader();\n      var blob;\n      if (!uint8array) return;\n      blob = new Blob([uint8array], {\n        type: mimeType\n      });\n      reader.addEventListener(\"loadend\", () => {\n        deferred.resolve(reader.result);\n      });\n      reader.readAsText(blob, mimeType);\n      return deferred.promise;\n    });\n  }\n  /**\n   * Get a base64 encoded result from Storage by Url\n   * @param  {string} url\n   * @param  {string} [mimeType]\n   * @return {string} base64 encoded\n   */\n\n\n  getBase64(url, mimeType) {\n    let encodedUrl = window.encodeURIComponent(url);\n    mimeType = mimeType || _mime.default.lookup(url);\n    return this.storage.getItem(encodedUrl).then(uint8array => {\n      var deferred = new _core.defer();\n      var reader = new FileReader();\n      var blob;\n      if (!uint8array) return;\n      blob = new Blob([uint8array], {\n        type: mimeType\n      });\n      reader.addEventListener(\"loadend\", () => {\n        deferred.resolve(reader.result);\n      });\n      reader.readAsDataURL(blob, mimeType);\n      return deferred.promise;\n    });\n  }\n  /**\n   * Create a Url from a stored item\n   * @param  {string} url\n   * @param  {object} [options.base64] use base64 encoding or blob url\n   * @return {Promise} url promise with Url string\n   */\n\n\n  createUrl(url, options) {\n    var deferred = new _core.defer();\n\n    var _URL = window.URL || window.webkitURL || window.mozURL;\n\n    var tempUrl;\n    var response;\n    var useBase64 = options && options.base64;\n\n    if (url in this.urlCache) {\n      deferred.resolve(this.urlCache[url]);\n      return deferred.promise;\n    }\n\n    if (useBase64) {\n      response = this.getBase64(url);\n\n      if (response) {\n        response.then(function (tempUrl) {\n          this.urlCache[url] = tempUrl;\n          deferred.resolve(tempUrl);\n        }.bind(this));\n      }\n    } else {\n      response = this.getBlob(url);\n\n      if (response) {\n        response.then(function (blob) {\n          tempUrl = _URL.createObjectURL(blob);\n          this.urlCache[url] = tempUrl;\n          deferred.resolve(tempUrl);\n        }.bind(this));\n      }\n    }\n\n    if (!response) {\n      deferred.reject({\n        message: \"File not found in storage: \" + url,\n        stack: new Error().stack\n      });\n    }\n\n    return deferred.promise;\n  }\n  /**\n   * Revoke Temp Url for a achive item\n   * @param  {string} url url of the item in the store\n   */\n\n\n  revokeUrl(url) {\n    var _URL = window.URL || window.webkitURL || window.mozURL;\n\n    var fromCache = this.urlCache[url];\n    if (fromCache) _URL.revokeObjectURL(fromCache);\n  }\n\n  destroy() {\n    var _URL = window.URL || window.webkitURL || window.mozURL;\n\n    for (let fromCache in this.urlCache) {\n      _URL.revokeObjectURL(fromCache);\n    }\n\n    this.urlCache = {};\n    this.removeListeners();\n  }\n\n}\n\n(0, _eventEmitter.default)(Store.prototype);\nvar _default = Store;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _core = require(\"./utils/core\");\n\n/**\n * Open DisplayOptions Format Parser\n * @class\n * @param {document} displayOptionsDocument XML\n */\nclass DisplayOptions {\n  constructor(displayOptionsDocument) {\n    this.interactive = \"\";\n    this.fixedLayout = \"\";\n    this.openToSpread = \"\";\n    this.orientationLock = \"\";\n\n    if (displayOptionsDocument) {\n      this.parse(displayOptionsDocument);\n    }\n  }\n  /**\n   * Parse XML\n   * @param  {document} displayOptionsDocument XML\n   * @return {DisplayOptions} self\n   */\n\n\n  parse(displayOptionsDocument) {\n    if (!displayOptionsDocument) {\n      return this;\n    }\n\n    const displayOptionsNode = (0, _core.qs)(displayOptionsDocument, \"display_options\");\n\n    if (!displayOptionsNode) {\n      return this;\n    }\n\n    const options = (0, _core.qsa)(displayOptionsNode, \"option\");\n    options.forEach(el => {\n      let value = \"\";\n\n      if (el.childNodes.length) {\n        value = el.childNodes[0].nodeValue;\n      }\n\n      switch (el.attributes.name.value) {\n        case \"interactive\":\n          this.interactive = value;\n          break;\n\n        case \"fixed-layout\":\n          this.fixedLayout = value;\n          break;\n\n        case \"open-to-spread\":\n          this.openToSpread = value;\n          break;\n\n        case \"orientation-lock\":\n          this.orientationLock = value;\n          break;\n      }\n    });\n    return this;\n  }\n\n  destroy() {\n    this.interactive = undefined;\n    this.fixedLayout = undefined;\n    this.openToSpread = undefined;\n    this.orientationLock = undefined;\n  }\n\n}\n\nvar _default = DisplayOptions;\nexports.default = _default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _book = _interopRequireDefault(require(\"./book\"));\n\nvar _rendition = _interopRequireDefault(require(\"./rendition\"));\n\nvar _epubcfi = _interopRequireDefault(require(\"./epubcfi\"));\n\nvar _contents = _interopRequireDefault(require(\"./contents\"));\n\nvar utils = _interopRequireWildcard(require(\"./utils/core\"));\n\nvar _constants = require(\"./utils/constants\");\n\nvar _iframe = _interopRequireDefault(require(\"./managers/views/iframe\"));\n\nvar _default2 = _interopRequireDefault(require(\"./managers/default\"));\n\nvar _continuous = _interopRequireDefault(require(\"./managers/continuous\"));\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Creates a new Book\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\n * @param {object} options to pass to the book\n * @returns {Book} a new Book object\n * @example ePub(\"/path/to/book.epub\", {})\n */\nfunction ePub(url, options) {\n  return new _book.default(url, options);\n}\n\nePub.VERSION = _constants.EPUBJS_VERSION;\n\nif (typeof global !== \"undefined\") {\n  global.EPUBJS_VERSION = _constants.EPUBJS_VERSION;\n}\n\nePub.Book = _book.default;\nePub.Rendition = _rendition.default;\nePub.Contents = _contents.default;\nePub.CFI = _epubcfi.default;\nePub.utils = utils;\nvar _default = ePub;\nexports.default = _default;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactSwipeable = require(\"react-swipeable\");\n\nvar _ = require(\"..\");\n\nvar _style = _interopRequireDefault(require(\"./style\"));\n\nvar _excluded = [\"children\"],\n    _excluded2 = [\"title\", \"showToc\", \"loadingView\", \"styles\", \"locationChanged\", \"swipeable\", \"epubViewStyles\"];\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nvar Swipeable = function Swipeable(_ref) {\n  var children = _ref.children,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  var handlers = (0, _reactSwipeable.useSwipeable)(props);\n  return /*#__PURE__*/_react.default.createElement(\"div\", handlers, children);\n};\n\nvar TocItem = /*#__PURE__*/function (_PureComponent) {\n  _inherits(TocItem, _PureComponent);\n\n  var _super = _createSuper(TocItem);\n\n  function TocItem() {\n    var _this;\n\n    _classCallCheck(this, TocItem);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"setLocation\", function () {\n      _this.props.setLocation(_this.props.href);\n    });\n\n    return _this;\n  }\n\n  _createClass(TocItem, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          label = _this$props.label,\n          styles = _this$props.styles;\n      return /*#__PURE__*/_react.default.createElement(\"button\", {\n        onClick: this.setLocation,\n        style: styles\n      }, label);\n    }\n  }]);\n\n  return TocItem;\n}(_react.PureComponent);\n\nTocItem.propTypes = {\n  label: _propTypes.default.string,\n  href: _propTypes.default.string,\n  setLocation: _propTypes.default.func,\n  styles: _propTypes.default.object\n};\n\nvar ReactReader = /*#__PURE__*/function (_PureComponent2) {\n  _inherits(ReactReader, _PureComponent2);\n\n  var _super2 = _createSuper(ReactReader);\n\n  function ReactReader(props) {\n    var _this2;\n\n    _classCallCheck(this, ReactReader);\n\n    _this2 = _super2.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this2), \"toggleToc\", function () {\n      _this2.setState({\n        expandedToc: !_this2.state.expandedToc\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this2), \"next\", function () {\n      var node = _this2.readerRef.current;\n      node.nextPage();\n    });\n\n    _defineProperty(_assertThisInitialized(_this2), \"prev\", function () {\n      var node = _this2.readerRef.current;\n      node.prevPage();\n    });\n\n    _defineProperty(_assertThisInitialized(_this2), \"onTocChange\", function (toc) {\n      var tocChanged = _this2.props.tocChanged;\n\n      _this2.setState({\n        toc: toc\n      }, function () {\n        return tocChanged && tocChanged(toc);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this2), \"setLocation\", function (loc) {\n      var locationChanged = _this2.props.locationChanged;\n\n      _this2.setState({\n        expandedToc: false\n      }, function () {\n        return locationChanged && locationChanged(loc);\n      });\n    });\n\n    _this2.readerRef = /*#__PURE__*/_react.default.createRef();\n    _this2.state = {\n      expandedToc: false,\n      toc: false\n    };\n    return _this2;\n  }\n\n  _createClass(ReactReader, [{\n    key: \"renderToc\",\n    value: function renderToc() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          toc = _this$state.toc,\n          expandedToc = _this$state.expandedToc;\n      var styles = this.props.styles;\n      return /*#__PURE__*/_react.default.createElement(\"div\", null, /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.tocArea\n      }, /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.toc\n      }, toc.map(function (item, i) {\n        return /*#__PURE__*/_react.default.createElement(TocItem, _extends({}, item, {\n          key: i,\n          setLocation: _this3.setLocation,\n          styles: styles.tocAreaButton\n        }));\n      }))), expandedToc && /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.tocBackground,\n        onClick: this.toggleToc\n      }));\n    }\n  }, {\n    key: \"renderTocToggle\",\n    value: function renderTocToggle() {\n      var expandedToc = this.state.expandedToc;\n      var styles = this.props.styles;\n      return /*#__PURE__*/_react.default.createElement(\"button\", {\n        style: Object.assign({}, styles.tocButton, expandedToc ? styles.tocButtonExpanded : {}),\n        onClick: this.toggleToc\n      }, /*#__PURE__*/_react.default.createElement(\"span\", {\n        style: Object.assign({}, styles.tocButtonBar, styles.tocButtonBarTop)\n      }), /*#__PURE__*/_react.default.createElement(\"span\", {\n        style: Object.assign({}, styles.tocButtonBar, styles.tocButtonBottom)\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props2 = this.props,\n          title = _this$props2.title,\n          showToc = _this$props2.showToc,\n          loadingView = _this$props2.loadingView,\n          styles = _this$props2.styles,\n          locationChanged = _this$props2.locationChanged,\n          swipeable = _this$props2.swipeable,\n          epubViewStyles = _this$props2.epubViewStyles,\n          props = _objectWithoutProperties(_this$props2, _excluded2);\n\n      var _this$state2 = this.state,\n          toc = _this$state2.toc,\n          expandedToc = _this$state2.expandedToc;\n      return /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.container\n      }, /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: Object.assign({}, styles.readerArea, expandedToc ? styles.containerExpanded : {})\n      }, showToc && this.renderTocToggle(), /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.titleArea\n      }, title), /*#__PURE__*/_react.default.createElement(Swipeable, {\n        onSwipedRight: this.prev,\n        onSwipedLeft: this.next,\n        trackMouse: true\n      }, /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.reader\n      }, /*#__PURE__*/_react.default.createElement(_.EpubView, _extends({\n        ref: this.readerRef,\n        loadingView: loadingView,\n        styles: epubViewStyles\n      }, props, {\n        tocChanged: this.onTocChange,\n        locationChanged: locationChanged\n      })), swipeable && /*#__PURE__*/_react.default.createElement(\"div\", {\n        style: styles.swipeWrapper\n      }))), /*#__PURE__*/_react.default.createElement(\"button\", {\n        style: Object.assign({}, styles.arrow, styles.prev),\n        onClick: this.prev\n      }, \"\\u2039\"), /*#__PURE__*/_react.default.createElement(\"button\", {\n        style: Object.assign({}, styles.arrow, styles.next),\n        onClick: this.next\n      }, \"\\u203A\")), showToc && toc && this.renderToc());\n    }\n  }]);\n\n  return ReactReader;\n}(_react.PureComponent);\n\nReactReader.defaultProps = {\n  loadingView: /*#__PURE__*/_react.default.createElement(\"div\", {\n    style: _style.default.loadingView\n  }, \"Loading\\u2026\"),\n  locationChanged: null,\n  tocChanged: null,\n  showToc: true,\n  styles: _style.default\n};\nReactReader.propTypes = {\n  title: _propTypes.default.string,\n  loadingView: _propTypes.default.element,\n  showToc: _propTypes.default.bool,\n  locationChanged: _propTypes.default.func,\n  tocChanged: _propTypes.default.func,\n  styles: _propTypes.default.object,\n  epubViewStyles: _propTypes.default.object,\n  swipeable: _propTypes.default.bool\n};\nvar _default = ReactReader;\nexports.default = _default;","import * as React from \"react\";\n\nexport const LEFT = \"Left\";\nexport const RIGHT = \"Right\";\nexport const UP = \"Up\";\nexport const DOWN = \"Down\";\nexport type HandledEvents = React.MouseEvent | TouchEvent | MouseEvent;\nexport type Vector2 = [number, number];\nexport type SwipeDirections =\n  | typeof LEFT\n  | typeof RIGHT\n  | typeof UP\n  | typeof DOWN;\nexport interface SwipeEventData {\n  absX: number;\n  absY: number;\n  deltaX: number;\n  deltaY: number;\n  dir: SwipeDirections;\n  event: HandledEvents;\n  first: boolean;\n  initial: Vector2;\n  velocity: number;\n  vxvy: Vector2;\n}\n\nexport type SwipeCallback = (eventData: SwipeEventData) => void;\nexport type TapCallback = ({ event }: { event: HandledEvents }) => void;\n\nexport type SwipeableCallbacks = {\n  // Event handler/callbacks\n  onSwipeStart: SwipeCallback;\n  onSwiped: SwipeCallback;\n  onSwipedDown: SwipeCallback;\n  onSwipedLeft: SwipeCallback;\n  onSwipedRight: SwipeCallback;\n  onSwipedUp: SwipeCallback;\n  onSwiping: SwipeCallback;\n  onTap: TapCallback;\n};\n\n// Configuration Options\nexport type ConfigurationOptionDelta =\n  | number\n  | { [key in Lowercase<SwipeDirections>]?: number };\nexport interface ConfigurationOptions {\n  delta: ConfigurationOptionDelta;\n  preventDefaultTouchmoveEvent: boolean;\n  rotationAngle: number;\n  trackMouse: boolean;\n  trackTouch: boolean;\n}\n\nexport type SwipeableProps = Partial<SwipeableCallbacks & ConfigurationOptions>;\n\nexport type SwipeablePropsWithDefaultOptions = Partial<SwipeableCallbacks> &\n  ConfigurationOptions;\n\nexport interface SwipeableHandlers {\n  ref(element: HTMLElement | null): void;\n  onMouseDown?(event: React.MouseEvent): void;\n}\n\nexport type SwipeableState = {\n  cleanUpTouch?: () => void;\n  el?: HTMLElement;\n  eventData?: SwipeEventData;\n  first: boolean;\n  initial: Vector2;\n  start: number;\n  swiping: boolean;\n  xy: Vector2;\n};\n\nexport type StateSetter = (\n  state: SwipeableState,\n  props: SwipeablePropsWithDefaultOptions\n) => SwipeableState;\nexport type Setter = (stateSetter: StateSetter) => void;\nexport type AttachTouch = (el: HTMLElement, passive: boolean) => () => void;\n","/* global document */\nimport * as React from \"react\";\nimport {\n  AttachTouch,\n  SwipeDirections,\n  DOWN,\n  SwipeEventData,\n  HandledEvents,\n  LEFT,\n  RIGHT,\n  Setter,\n  SwipeableCallbacks,\n  SwipeableHandlers,\n  SwipeableProps,\n  SwipeablePropsWithDefaultOptions,\n  SwipeableState,\n  SwipeCallback,\n  TapCallback,\n  UP,\n  Vector2,\n} from \"./types\";\n\nexport {\n  LEFT,\n  RIGHT,\n  UP,\n  DOWN,\n  SwipeDirections,\n  SwipeEventData,\n  SwipeCallback,\n  TapCallback,\n  SwipeableHandlers,\n  SwipeableProps,\n  Vector2,\n};\n\nconst defaultProps = {\n  delta: 10,\n  preventDefaultTouchmoveEvent: false,\n  rotationAngle: 0,\n  trackMouse: false,\n  trackTouch: true,\n};\nconst initialState: SwipeableState = {\n  first: true,\n  initial: [0, 0],\n  start: 0,\n  swiping: false,\n  xy: [0, 0],\n};\nconst mouseMove = \"mousemove\";\nconst mouseUp = \"mouseup\";\nconst touchEnd = \"touchend\";\nconst touchMove = \"touchmove\";\nconst touchStart = \"touchstart\";\n\nfunction getDirection(\n  absX: number,\n  absY: number,\n  deltaX: number,\n  deltaY: number\n): SwipeDirections {\n  if (absX > absY) {\n    if (deltaX > 0) {\n      return RIGHT;\n    }\n    return LEFT;\n  } else if (deltaY > 0) {\n    return DOWN;\n  }\n  return UP;\n}\n\nfunction rotateXYByAngle(pos: Vector2, angle: number): Vector2 {\n  if (angle === 0) return pos;\n  const angleInRadians = (Math.PI / 180) * angle;\n  const x =\n    pos[0] * Math.cos(angleInRadians) + pos[1] * Math.sin(angleInRadians);\n  const y =\n    pos[1] * Math.cos(angleInRadians) - pos[0] * Math.sin(angleInRadians);\n  return [x, y];\n}\n\nfunction getHandlers(\n  set: Setter,\n  handlerProps: { trackMouse: boolean | undefined }\n): [\n  {\n    ref: (element: HTMLElement | null) => void;\n    onMouseDown?: (event: React.MouseEvent) => void;\n  },\n  AttachTouch\n] {\n  const onStart = (event: HandledEvents) => {\n    // if more than a single touch don't track, for now...\n    if (event && \"touches\" in event && event.touches.length > 1) return;\n\n    set((state, props) => {\n      // setup mouse listeners on document to track swipe since swipe can leave container\n      if (props.trackMouse) {\n        document.addEventListener(mouseMove, onMove);\n        document.addEventListener(mouseUp, onUp);\n      }\n      const { clientX, clientY } =\n        \"touches\" in event ? event.touches[0] : event;\n      const xy = rotateXYByAngle([clientX, clientY], props.rotationAngle);\n      return {\n        ...state,\n        ...initialState,\n        initial: [...xy],\n        xy,\n        start: event.timeStamp || 0,\n      };\n    });\n  };\n\n  const onMove = (event: HandledEvents) => {\n    set((state, props) => {\n      // Discount a swipe if additional touches are present after\n      // a swipe has started.\n      if (\"touches\" in event && event.touches.length > 1) {\n        return state;\n      }\n      const { clientX, clientY } =\n        \"touches\" in event ? event.touches[0] : event;\n      const [x, y] = rotateXYByAngle([clientX, clientY], props.rotationAngle);\n      const deltaX = x - state.xy[0];\n      const deltaY = y - state.xy[1];\n      const absX = Math.abs(deltaX);\n      const absY = Math.abs(deltaY);\n      const time = (event.timeStamp || 0) - state.start;\n      const velocity = Math.sqrt(absX * absX + absY * absY) / (time || 1);\n      const vxvy: Vector2 = [deltaX / (time || 1), deltaY / (time || 1)];\n\n      const dir = getDirection(absX, absY, deltaX, deltaY);\n\n      // if swipe is under delta and we have not started to track a swipe: skip update\n      const delta =\n        typeof props.delta === \"number\"\n          ? props.delta\n          : props.delta[dir.toLowerCase() as Lowercase<SwipeDirections>] ||\n            defaultProps.delta;\n      if (absX < delta && absY < delta && !state.swiping) return state;\n\n      const eventData = {\n        absX,\n        absY,\n        deltaX,\n        deltaY,\n        dir,\n        event,\n        first: state.first,\n        initial: state.initial,\n        velocity,\n        vxvy,\n      };\n\n      // call onSwipeStart if present and is first swipe event\n      eventData.first && props.onSwipeStart && props.onSwipeStart(eventData);\n\n      // Call onSwiping if present\n      props.onSwiping && props.onSwiping(eventData);\n\n      // track if a swipe is cancelable(handler for swiping or swiped(dir) exists)\n      // so we can call preventDefault if needed\n      let cancelablePageSwipe = false;\n      if (props.onSwiping || props.onSwiped || `onSwiped${dir}` in props) {\n        cancelablePageSwipe = true;\n      }\n\n      if (\n        cancelablePageSwipe &&\n        props.preventDefaultTouchmoveEvent &&\n        props.trackTouch &&\n        event.cancelable\n      )\n        event.preventDefault();\n\n      return {\n        ...state,\n        // first is now always false\n        first: false,\n        eventData,\n        swiping: true,\n      };\n    });\n  };\n\n  const onEnd = (event: HandledEvents) => {\n    set((state, props) => {\n      let eventData: SwipeEventData | undefined;\n      if (state.swiping && state.eventData) {\n        eventData = { ...state.eventData, event };\n        props.onSwiped && props.onSwiped(eventData);\n\n        const onSwipedDir =\n          props[`onSwiped${eventData.dir}` as keyof SwipeableCallbacks];\n        onSwipedDir && onSwipedDir(eventData);\n      } else {\n        props.onTap && props.onTap({ event });\n      }\n      return { ...state, ...initialState, eventData };\n    });\n  };\n\n  const cleanUpMouse = () => {\n    // safe to just call removeEventListener\n    document.removeEventListener(mouseMove, onMove);\n    document.removeEventListener(mouseUp, onUp);\n  };\n\n  const onUp = (e: HandledEvents) => {\n    cleanUpMouse();\n    onEnd(e);\n  };\n\n  /**\n   * Switch of \"passive\" property for now.\n   * When `preventDefaultTouchmoveEvent` is:\n   * - true => { passive: false }\n   * - false => { passive: true }\n   *\n   * Could take entire `addEventListener` options object as a param later?\n   */\n  const attachTouch: AttachTouch = (el, passive) => {\n    let cleanup = () => {};\n    if (el && el.addEventListener) {\n      // attach touch event listeners and handlers\n      const tls: [\n        typeof touchStart | typeof touchMove | typeof touchEnd,\n        (e: HandledEvents) => void\n      ][] = [\n        [touchStart, onStart],\n        [touchMove, onMove],\n        [touchEnd, onEnd],\n      ];\n      tls.forEach(([e, h]) => el.addEventListener(e, h, { passive }));\n      // return properly scoped cleanup method for removing listeners, options not required\n      cleanup = () => tls.forEach(([e, h]) => el.removeEventListener(e, h));\n    }\n    return cleanup;\n  };\n\n  const onRef = (el: HTMLElement | null) => {\n    // \"inline\" ref functions are called twice on render, once with null then again with DOM element\n    // ignore null here\n    if (el === null) return;\n    set((state, props) => {\n      // if the same DOM el as previous just return state\n      if (state.el === el) return state;\n\n      const addState: { cleanUpTouch?: () => void } = {};\n      // if new DOM el clean up old DOM and reset cleanUpTouch\n      if (state.el && state.el !== el && state.cleanUpTouch) {\n        state.cleanUpTouch();\n        addState.cleanUpTouch = undefined;\n      }\n      // only attach if we want to track touch\n      if (props.trackTouch && el) {\n        addState.cleanUpTouch = attachTouch(\n          el,\n          !props.preventDefaultTouchmoveEvent\n        );\n      }\n\n      // store event attached DOM el for comparison, clean up, and re-attachment\n      return { ...state, el, ...addState };\n    });\n  };\n\n  // set ref callback to attach touch event listeners\n  const output: { ref: typeof onRef; onMouseDown?: typeof onStart } = {\n    ref: onRef,\n  };\n\n  // if track mouse attach mouse down listener\n  if (handlerProps.trackMouse) {\n    output.onMouseDown = onStart;\n  }\n\n  return [output, attachTouch];\n}\n\nfunction updateTransientState(\n  state: SwipeableState,\n  props: SwipeableProps,\n  attachTouch: AttachTouch\n) {\n  const addState: { cleanUpTouch?(): void } = {};\n  // clean up touch handlers if no longer tracking touches\n  if (!props.trackTouch && state.cleanUpTouch) {\n    state.cleanUpTouch();\n    addState.cleanUpTouch = undefined;\n  } else if (props.trackTouch && !state.cleanUpTouch) {\n    // attach/re-attach touch handlers\n    if (state.el) {\n      addState.cleanUpTouch = attachTouch(\n        state.el,\n        !props.preventDefaultTouchmoveEvent\n      );\n    }\n  }\n  return { ...state, ...addState };\n}\n\nexport function useSwipeable(options: SwipeableProps): SwipeableHandlers {\n  const { trackMouse } = options;\n  const transientState = React.useRef({ ...initialState });\n  const transientProps = React.useRef<SwipeablePropsWithDefaultOptions>({\n    ...defaultProps,\n  });\n  transientProps.current = { ...defaultProps, ...options };\n\n  const [handlers, attachTouch] = React.useMemo(\n    () =>\n      getHandlers(\n        (stateSetter) =>\n          (transientState.current = stateSetter(\n            transientState.current,\n            transientProps.current\n          )),\n        { trackMouse }\n      ),\n    [trackMouse]\n  );\n\n  transientState.current = updateTransientState(\n    transientState.current,\n    transientProps.current,\n    attachTouch\n  );\n\n  return handlers;\n}\n"],"sourceRoot":""}